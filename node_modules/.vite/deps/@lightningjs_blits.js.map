{
  "version": 3,
  "sources": ["../../@lightningjs/blits/src/lib/symbols.js", "../../@lightningjs/blits/src/settings.js", "../../@lightningjs/blits/src/lib/log.js", "../../@lightningjs/blits/src/lib/colors/htmlColors.js", "../../@lightningjs/blits/src/lib/colors/colors.js", "../../@lightningjs/blits/src/lib/templateparser/parser.js", "../../@lightningjs/blits/src/lib/codegenerator/generator.js", "../../@lightningjs/blits/src/lib/componentId.js", "../../@lightningjs/blits/src/lib/hooks.js", "../../@lightningjs/blits/src/lib/reactivity/effect.js", "../../@lightningjs/blits/src/helpers/deepEqualArray.js", "../../@lightningjs/blits/src/lib/reactivity/reactive.js", "../../@lightningjs/blits/src/lib/lifecycle.js", "../../@lightningjs/renderer/src/utils.ts", "../../@lightningjs/renderer/src/common/EventEmitter.ts", "../../@lightningjs/renderer/src/core/textures/Texture.ts", "../../@lightningjs/renderer/src/core/lib/utils.ts", "../../@lightningjs/renderer/src/core/lib/Matrix3d.ts", "../../@lightningjs/renderer/src/core/lib/RenderCoords.ts", "../../@lightningjs/renderer/src/core/utils.ts", "../../@lightningjs/renderer/src/core/animations/CoreAnimation.ts", "../../@lightningjs/renderer/src/core/animations/CoreAnimationController.ts", "../../@lightningjs/renderer/src/core/CoreNode.ts", "../../@lightningjs/renderer/src/core/platform.ts", "../../@lightningjs/renderer/src/core/animations/AnimationManager.ts", "../../@lightningjs/renderer/src/core/lib/ImageWorker.ts", "../../@lightningjs/renderer/src/core/textures/ColorTexture.ts", "../../@lightningjs/renderer/src/core/lib/textureCompression.ts", "../../@lightningjs/renderer/src/core/lib/textureSvg.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/utils.ts", "../../@lightningjs/renderer/src/core/textures/ImageTexture.ts", "../../@lightningjs/renderer/src/core/textures/NoiseTexture.ts", "../../@lightningjs/renderer/src/core/textures/SubTexture.ts", "../../@lightningjs/renderer/src/core/textures/RenderTexture.ts", "../../@lightningjs/renderer/src/core/lib/validateImageBitmap.ts", "../../@lightningjs/renderer/src/core/TextureError.ts", "../../@lightningjs/renderer/src/core/CoreTextureManager.ts", "../../@lightningjs/renderer/src/core/text-rendering/TrFontManager.ts", "../../@lightningjs/renderer/src/core/renderers/CoreShader.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/internal/ShaderUtils.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreShader.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/DefaultShader.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/DefaultShaderBatched.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/ShaderEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/DynamicShader.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/RoundedRectangle.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/SdfShader.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/EffectUtils.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/RadiusEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/BorderEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/LinearGradientEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/GrayscaleEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/BorderRightEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/BorderTopEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/BorderBottomEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/BorderLeftEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/GlitchEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/FadeOutEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/RadialGradientEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/RadialProgressEffect.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/shaders/effects/HolePunchEffect.ts", "../../@lightningjs/renderer/src/core/renderers/canvas/shaders/UnsupportedShader.ts", "../../@lightningjs/renderer/src/main-api/ShaderController.ts", "../../@lightningjs/renderer/src/main-api/DynamicShaderController.ts", "../../@lightningjs/renderer/src/core/CoreShaderManager.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/TextRenderer.ts", "../../@lightningjs/renderer/src/core/lib/ContextSpy.ts", "../../@lightningjs/renderer/src/core/TextureMemoryManager.ts", "../../@lightningjs/renderer/src/core/renderers/CoreContextTexture.ts", "../../@lightningjs/renderer/src/core/renderers/CoreRenderer.ts", "../../@lightningjs/renderer/src/core/CoreTextNode.ts", "../../@lightningjs/renderer/src/main-api/utils.ts", "../../@lightningjs/renderer/src/core/Stage.ts", "../../@lightningjs/renderer/src/main-api/Renderer.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/TrFontFace.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/WebTrFontFace.ts", "../../@lightningjs/renderer/src/core/renderers/CoreRenderOp.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreRenderOp.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/internal/RendererUtils.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreCtxTexture.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreCtxSubTexture.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/internal/BufferCollection.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/internal/WebGlUtils.ts", "../../@lightningjs/renderer/src/core/lib/WebGlContextWrapper.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreCtxRenderTexture.ts", "../../@lightningjs/renderer/src/core/renderers/webgl/WebGlCoreRenderer.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/SpecialCodepoints.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/SdfTrFontFace/internal/FontShaper.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/SdfTrFontFace/internal/SdfFontShaper.ts", "../../@lightningjs/renderer/src/core/text-rendering/font-face-types/SdfTrFontFace/SdfTrFontFace.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/constants.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/getStartConditions.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/PeekableGenerator.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/getUnicodeCodepoints.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/measureText.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/layoutText.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/util.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/internal/setRenderWindow.ts", "../../@lightningjs/renderer/src/core/text-rendering/TextRenderingUtils.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.ts", "../../@lightningjs/renderer/src/core/text-rendering/TextTextureRendererUtils.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/LightningTextTextureRenderer.ts", "../../@lightningjs/renderer/src/core/text-rendering/renderers/CanvasTextRenderer.ts", "../../@lightningjs/renderer/src/core/renderers/canvas/internal/ColorUtils.ts", "../../@lightningjs/renderer/src/core/renderers/canvas/CanvasCoreTexture.ts", "../../@lightningjs/renderer/src/core/renderers/canvas/internal/C2DShaderUtils.ts", "../../@lightningjs/renderer/src/core/renderers/canvas/CanvasCoreRenderer.ts", "../../@lightningjs/renderer/src/main-api/Inspector.ts", "../../@lightningjs/blits/src/constants.js", "../../@lightningjs/blits/src/engines/L3/fontLoader.js", "../../@lightningjs/blits/src/engines/L3/shaderLoader.js", "../../@lightningjs/blits/src/engines/L3/launch.js", "../../@lightningjs/blits/src/engines/L3/element.js", "../../@lightningjs/blits/src/engines/L3/index.js", "../../@lightningjs/blits/package.json", "../../@lightningjs/blits/src/launch.js", "../../@lightningjs/blits/src/router/transitions/fadeInOut.js", "../../@lightningjs/blits/src/announcer/speechSynthesis.js", "../../@lightningjs/blits/src/announcer/announcer.js", "../../@lightningjs/blits/src/router/router.js", "../../@lightningjs/blits/src/focus.js", "../../@lightningjs/blits/src/lib/eventListeners.js", "../../@lightningjs/blits/src/application.js", "../../@lightningjs/blits/src/component/base/methods.js", "../../@lightningjs/blits/src/component/base/timeouts_intervals.js", "../../@lightningjs/blits/src/component/base/events.js", "../../@lightningjs/blits/src/component/base/router.js", "../../@lightningjs/blits/src/component/base/announcer.js", "../../@lightningjs/blits/src/component/base/utils.js", "../../@lightningjs/blits/src/component/base/index.js", "../../@lightningjs/blits/src/component/setup/props.js", "../../@lightningjs/blits/src/component/setup/methods.js", "../../@lightningjs/blits/src/component/setup/state.js", "../../@lightningjs/blits/src/component/setup/computed.js", "../../@lightningjs/blits/src/component/setup/input.js", "../../@lightningjs/blits/src/component/setup/routes.js", "../../@lightningjs/blits/src/component/setup/watch.js", "../../@lightningjs/blits/src/component/setup/index.js", "../../@lightningjs/blits/src/components/Circle.js", "../../@lightningjs/blits/src/components/RouterView.js", "../../@lightningjs/blits/src/components/Sprite.js", "../../@lightningjs/blits/public/assets/fps_sprite.base64.js", "../../@lightningjs/blits/src/components/FPScounter.js", "../../@lightningjs/blits/src/components/index.js", "../../@lightningjs/blits/src/plugins/log.js", "../../@lightningjs/blits/src/plugin.js", "../../@lightningjs/blits/src/component.js", "../../@lightningjs/blits/index.js"],
  "sourcesContent": ["/**\n * Symbol registry for internal framework properties and generated code.\n *\n * @typedef {Object} BlitsSymbols\n * @property {symbol} cleanup\n * @property {symbol} currentView\n * @property {symbol} cursorTagStart\n * @property {symbol} computedKeys\n * @property {symbol} destroy\n * @property {symbol} rendererEventListeners\n * @property {symbol} getChildren\n * @property {symbol} holder\n * @property {symbol} id\n * @property {symbol} identifier\n * @property {symbol} index\n * @property {symbol} init\n * @property {symbol} inputEvents\n * @property {symbol} internalEvent\n * @property {symbol} intervals\n * @property {symbol} isProxy\n * @property {symbol} launched\n * @property {symbol} level\n * @property {symbol} methodKeys\n * @property {symbol} originalState\n * @property {symbol} propKeys\n * @property {symbol} raw\n * @property {symbol} ready\n * @property {symbol} renderer\n * @property {symbol} routes\n * @property {symbol} routerHooks\n * @property {symbol} settings\n * @property {symbol} state\n * @property {symbol} stateKeys\n * @property {symbol} textnode\n * @property {symbol} timeouts\n * @property {symbol} type\n * @property {symbol} watchers\n * @property {symbol} watchKeys\n * @property {symbol} wrapper\n * @property {symbol} children\n * @property {symbol} components\n * @property {symbol} config\n * @property {symbol} isSlot\n * @property {symbol} props\n * @property {symbol} slots\n * @property {symbol} componentType\n * @property {symbol} isComponent\n * @property {symbol} effects\n * @property {symbol} removeGlobalEffects\n */\n\n/**\n * Internal symbol registry for Blits framework and generated code.\n *\n * @type {BlitsSymbols}\n */\nexport default {\n  cleanup: Symbol('cleanup'),\n  currentView: Symbol('currentView'),\n  cursorTagStart: Symbol('cursorTagStart'),\n  computedKeys: Symbol('computedKeys'),\n  destroy: Symbol('destroy'),\n  rendererEventListeners: Symbol('rendererEventListeners'),\n  getChildren: Symbol('getChildren'),\n  holder: Symbol('holder'),\n  id: Symbol('id'),\n  identifier: Symbol('identifier'),\n  index: Symbol('index'),\n  init: Symbol('init'),\n  inputEvents: Symbol('inputEvents'),\n  internalEvent: Symbol('internalEvent'),\n  intervals: Symbol('intervals'),\n  isProxy: Symbol('isProxy'),\n  launched: Symbol('launched'),\n  level: Symbol('level'),\n  methodKeys: Symbol('methodKeys'),\n  originalState: Symbol('originalState'),\n  propKeys: Symbol('propKeys'),\n  raw: Symbol('raw'),\n  ready: Symbol('ready'),\n  renderer: Symbol('renderer'),\n  routes: Symbol('routes'),\n  routerHooks: Symbol('routerHooks'),\n  settings: Symbol('settings'),\n  state: Symbol('state'),\n  stateKeys: Symbol('stateKeys'),\n  textnode: Symbol('textnode'),\n  timeouts: Symbol('timeouts'),\n  type: Symbol('type'),\n  watchers: Symbol('watchers'),\n  watchKeys: Symbol('watchKeys'),\n  wrapper: Symbol('wrapper'),\n\n  /* Utilizing the global Symbol registry for the following purposes */\n\n  // Symbol 'children' utilized within generated code\n  children: Symbol.for('children'),\n  // Symbol 'components' utilized within generated code\n  components: Symbol.for('components'),\n  // Symbol 'config' utilized within generated code\n  config: Symbol.for('config'),\n  // Symbol 'isSlot' utilized within generated code\n  isSlot: Symbol.for('isSlot'),\n  // Symbol 'props' utilized within generated code\n  props: Symbol.for('props'),\n  // Symbol 'slots' utilized within generated code\n  slots: Symbol.for('slots'),\n  // Symbol 'componentType' utilized within generated code\n  componentType: Symbol.for('componentType'),\n  // Symbol 'isComponent' utilized within generated code\n  isComponent: Symbol.for('isComponent'),\n  // Symbol 'effects' utilized within generated code\n  effects: Symbol.for('effects'),\n  // Symbol 'removeGlobalEffects' utilized within generated code\n  removeGlobalEffects: Symbol.for('removeGlobalEffects'),\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './lib/symbols.js'\n\nconst settings = {\n  [symbols.settings]: {},\n  get(key, defaultValue = null) {\n    if (key in this[symbols.settings]) {\n      return this[symbols.settings][key]\n    } else {\n      return defaultValue\n    }\n  },\n  set(key, value) {\n    if (typeof key === 'object') {\n      Object.keys(key).forEach((k) => {\n        this.set(k, key[k])\n      })\n    } else {\n      this[symbols.settings][key] = value\n    }\n  },\n}\n\nexport default settings\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Settings from '../settings.js'\n\nconst n = () => {}\n\nconst pad = (n) => String(n).padStart(2, '0')\n\n/**\n * Returns the current time as a locale time string (hh:mm:ss).\n * @returns {string} The current time string.\n */\nconst time = () => {\n  const now = new Date()\n  return pad(now.getHours()) + ':' + pad(now.getMinutes()) + ':' + pad(now.getSeconds())\n}\n\n/**\n * Returns a logger object for the given context, with info, warn, debug, and error methods.\n * Logging methods are no-ops if the debug level does not match.\n *\n * @param {string} context - The context label for log messages.\n * @returns {Object} Logger object with info, warn, debug, and error methods.\n */\nconst logger = (context) => {\n  const level = Settings.get('debugLevel')\n  const log = {}\n\n  Object.defineProperty(log, 'info', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('info') > -1)) &&\n          console.info.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #0284c7; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'warn', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('warn') > -1)) &&\n          console.warn.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #fbbf24; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'error', {\n    get() {\n      return (\n        ((level >= 1 || (Array.isArray(level) && level.indexOf('error') > -1)) &&\n          console.error.bind(\n            window.console,\n            `%c ⚡️ ${context} %c ${time()}`,\n            'background-color: #dc2626; color: white; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  Object.defineProperty(log, 'debug', {\n    get() {\n      return (\n        ((level >= 2 || (Array.isArray(level) && level.indexOf('debug') > -1)) &&\n          console.debug.bind(\n            window.console,\n            `%c ⚡️ ${context} %c (${new Date().toLocaleTimeString([], {\n              hour: '2-digit',\n              minute: '2-digit',\n              second: '2-digit',\n            })})`,\n            'background-color: #e2e8f0; color: #334155; padding: 3px 6px 3px 1px; border-radius: 3px',\n            'color: ##94a3b8;'\n          )) ||\n        n\n      )\n    },\n  })\n\n  return log\n}\n\nexport default logger\n\nexport let Log\n// review this pattern\nexport const initLog = () => {\n  Log = logger('Blits')\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default {\n  aliceblue: '0xf0f8ffff',\n  antiquewhite: '0xfaebd7ff',\n  aqua: '0xffffff00',\n  aquamarine: '0x7fffd4ff',\n  azure: '0xf0ffffff',\n  beige: '0xf5f5dcff',\n  bisque: '0xffe4c4ff',\n  black: '0x000000ff',\n  blanchedalmond: '0xffebcdff',\n  blue: '0x0000ffff',\n  blueviolet: '0x8a2be2ff',\n  brown: '0xa52a2aff',\n  burlywood: '0xdeb887ff',\n  cadetblue: '0x5f9ea0ff',\n  chartreuse: '0x7fff00ff',\n  chocolate: '0xd2691eff',\n  coral: '0xff7f50ff',\n  cornflowerblue: '0x6495edff',\n  cornsilk: '0xfff8dcff',\n  crimson: '0xdc143cff',\n  cyan: '0x00ffffff',\n  darkblue: '0x00008bff',\n  darkcyan: '0x008b8bff',\n  darkgoldenrod: '0xb8860bff',\n  darkgray: '0xa9a9a9ff',\n  darkgreen: '0x006400ff',\n  darkgrey: '0xa9a9a9ff',\n  darkkhaki: '0xbdb76bff',\n  darkmagenta: '0x8b008bff',\n  darkolivegreen: '0x556b2fff',\n  darkorange: '0xff8c00ff',\n  darkorchid: '0x9932ccff',\n  darkred: '0x8b0000ff',\n  darksalmon: '0xe9967aff',\n  darkseagreen: '0x8fbc8fff',\n  darkslateblue: '0x483d8bff',\n  darkslategray: '0x2f4f4fff',\n  darkslategrey: '0x2f4f4fff',\n  darkturquoise: '0x00ced1ff',\n  darkviolet: '0x9400d3ff',\n  deeppink: '0xff1493ff',\n  deepskyblue: '0x00bfffff',\n  dimgray: '0x696969ff',\n  dimgrey: '0x696969ff',\n  dodgerblue: '0x1e90ffff',\n  firebrick: '0xb22222ff',\n  floralwhite: '0xfffaf0ff',\n  forestgreen: '0x228b22ff',\n  fuchsia: '0xff00ffff',\n  gainsboro: '0xdcdcdcff',\n  ghostwhite: '0xf8f8ffff',\n  gold: '0xffd700ff',\n  goldenrod: '0xdaa520ff',\n  gray: '0x808080ff',\n  green: '0x008000ff',\n  greenyellow: '0xadff2fff',\n  grey: '0x808080ff',\n  honeydew: '0xf0fff0ff',\n  hotpink: '0xff69b4ff',\n  indianred: '0xcd5c5cff',\n  indigo: '0x4b0082ff',\n  ivory: '0xfffff0ff',\n  khaki: '0xf0e68cff',\n  lavender: '0xe6e6faff',\n  lavenderblush: '0xfff0f5ff',\n  lawngreen: '0x7cfc00ff',\n  lemonchiffon: '0xfffacdff',\n  lightblue: '0xadd8e6ff',\n  lightcoral: '0xf08080ff',\n  lightcyan: '0xe0ffffff',\n  lightgoldenrodyellow: '0xfafad2ff',\n  lightgray: '0xd3d3d3ff',\n  lightgreen: '0x90ee90ff',\n  lightgrey: '0xd3d3d3ff',\n  lightpink: '0xffb6c1ff',\n  lightsalmon: '0xffa07aff',\n  lightseagreen: '0x20b2aaff',\n  lightskyblue: '0x87cefaff',\n  lightslategray: '0x778899ff',\n  lightslategrey: '0x778899ff',\n  lightsteelblue: '0xb0c4deff',\n  lightyellow: '0xffffe0ff',\n  lime: '0x00ff00ff',\n  limegreen: '0x32cd32ff',\n  linen: '0xfaf0e6ff',\n  magenta: '0xff00ffff',\n  maroon: '0x800000ff',\n  mediumaquamarine: '0x66cdaaff',\n  mediumblue: '0x0000cdff',\n  mediumorchid: '0xba55d3ff',\n  mediumpurple: '0x9370dbff',\n  mediumseagreen: '0x3cb371ff',\n  mediumslateblue: '0x7b68eeff',\n  mediumspringgreen: '0x00fa9aff',\n  mediumturquoise: '0x48d1ccff',\n  mediumvioletred: '0xc71585ff',\n  midnightblue: '0x191970ff',\n  mintcream: '0xf5fffaff',\n  mistyrose: '0xffe4e1ff',\n  moccasin: '0xffe4b5ff',\n  navajowhite: '0xffdeadff',\n  navy: '0x000080ff',\n  oldlace: '0xfdf5e6ff',\n  olive: '0x808000ff',\n  olivedrab: '0x6b8e23ff',\n  orange: '0xffa500ff',\n  orangered: '0xff4500ff',\n  orchid: '0xda70d6ff',\n  palegoldenrod: '0xeee8aaff',\n  palegreen: '0x98fb98ff',\n  paleturquoise: '0xafeeeeff',\n  palevioletred: '0xdb7093ff',\n  papayawhip: '0xffefd5ff',\n  peachpuff: '0xffdab9ff',\n  peru: '0xcd853fff',\n  pink: '0xffc0cbff',\n  plum: '0xdda0ddff',\n  powderblue: '0xb0e0e6ff',\n  purple: '0x800080ff',\n  rebeccapurple: '0x663399ff',\n  red: '0xff0000ff',\n  rosybrown: '0xbc8f8fff',\n  royalblue: '0x4169e1ff',\n  saddlebrown: '0x8b4513ff',\n  salmon: '0xfa8072ff',\n  sandybrown: '0xf4a460ff',\n  seagreen: '0x2e8b57ff',\n  seashell: '0xfff5eeff',\n  sienna: '0xa0522dff',\n  silver: '0xc0c0c0ff',\n  skyblue: '0x87ceebff',\n  slateblue: '0x6a5acdff',\n  slategray: '0x708090ff',\n  slategrey: '0x708090ff',\n  snow: '0xfffafaff',\n  springgreen: '0x00ff7fff',\n  steelblue: '0x4682b4ff',\n  tan: '0xd2b48cff',\n  teal: '0x008080ff',\n  thistle: '0xd8bfd8ff',\n  tomato: '0xff6347ff',\n  transparent: '0x00000000',\n  turquoise: '0x40e0d0ff',\n  violet: '0xee82eeff',\n  wheat: '0xf5deb3ff',\n  white: '0xffffffff',\n  whitesmoke: '0xf5f5f5ff',\n  yellow: '0xffff00ff',\n  yellowgreen: '0x9acd32ff',\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport colorsMap from './htmlColors.js'\n\nconst hex = /^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i\nconst rgba =\n  /^(rgba?)\\((\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*),(\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*),(\\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\s*)(,(\\s*(-?\\d+(?:\\.\\d+)?)\\s*))?\\)$/\nconst hsla =\n  /^(hsla?)\\((\\s*(360|3[0-5][0-9]|[12]?[0-9]{1,2})\\s*),(\\s*(100|[1-9]?[0-9])\\s*)%,(\\s*(100|[1-9]?[0-9])\\s*)%(,(\\s*(1|0(?:\\.\\d+)?)\\s*))?\\)$/\n\nconst hexLookup = {}\n\nconst decimalToHex = (decimal) => {\n  if (hexLookup[decimal] !== undefined) {\n    return hexLookup[decimal]\n  }\n\n  const resp = parseInt(decimal).toString(16).padStart(2, '0')\n  hexLookup[decimal] = resp\n  return resp\n}\n\nexport default {\n  normalize: (color = '', defaultColor = '0xffffffff') => {\n    color = color.toString()\n\n    // it is a 0xRRGGBBAA color, return it\n    if (color.startsWith('0x') && color.length === 10) {\n      return color\n    }\n\n    // it is a previously mapped color, return it\n    if (colorsMap[color] !== undefined) {\n      return colorsMap[color]\n    }\n\n    // check for hex color\n    if (hex.test(color)) {\n      color = color.replace('#', '').toLowerCase()\n      if (color.length === 3) {\n        color = color\n          .split('')\n          .map((c) => c + c)\n          .join('')\n      }\n\n      const colorRGBA = '0x' + color.padEnd(8, 'f')\n      colorsMap[color] = colorRGBA\n      return colorRGBA\n    }\n\n    //rgb/a\n    const rgbaMatch = rgba.exec(color)\n    if (rgbaMatch) {\n      const r = decimalToHex(rgbaMatch[3])\n      const g = decimalToHex(rgbaMatch[5])\n      const b = decimalToHex(rgbaMatch[7])\n      let a = 'ff'\n\n      if (rgbaMatch[10] && rgbaMatch[1] === 'rgba') {\n        const alpha = Math.min(Math.max(Math.round(parseFloat(rgbaMatch[10]) * 255), 0), 255)\n        a = decimalToHex(alpha)\n      }\n\n      const resp = '0x' + r + g + b + a\n      colorsMap[color] = resp\n      return resp\n    }\n\n    if (hsla.test(color)) {\n      console.warn('HSL(A) color format is not supported yet')\n      return '0xffffffff'\n    }\n\n    return defaultColor\n  },\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../symbols.js'\nimport colors from '../colors/colors.js'\n\nexport default (template = '', componentName, parentComponent, filePath = null) => {\n  let cursor = 0\n  let prevCursor = 0\n  let tags = []\n  let currentTag = null\n  let currentLevel = 0\n\n  // regular expressions\n  const tagStartRegex = /^<\\/?([a-zA-Z0-9_\\-.]+)\\s*/\n  const tagEndRegex = /^\\s*(\\/?>)\\s*/\n  const attrNameRegex = /^([A-Za-z0-9:.\\-_@$]+)=\\s*([\"'])/\n  const emptyTagStartRegex = /^<>\\s*/\n  const emptyTagEndRegex = /^\\s*(<\\/>)\\s*/\n\n  // main functions\n  const parse = () => {\n    template = clean(template)\n    try {\n      parseLoop(parseEmptyTagStart)\n      return format(tags)\n    } catch (error) {\n      if (error.name == 'TemplateParseError' || error.name == 'TemplateStructureError') {\n        error.message = `${error.message}\\n${error.context}`\n      }\n      throw error\n    }\n  }\n\n  const parseLoop = (next) => {\n    if (cursor >= template.length) {\n      return\n    }\n    next()\n  }\n\n  // utils\n  const clean = (templateText) => {\n    // remove all unnecessary new lines and comments\n    return templateText\n      .replace(/<!--.*?-->/gms, '') // remove comments\n      .replace(/\\r?\\n\\s*\\r\\n/gm, ' ') // remove empty lines\n      .replace(/\\r?\\n\\s*(\\S)/gm, ' $1') // remove line endings & spacing\n      .replace(/\\r?\\n/g, '') // remove all line endings\n      .trim()\n  }\n\n  const moveCursorOnMatch = (regex) => {\n    const match = template.slice(cursor).match(regex)\n    if (match) {\n      prevCursor = cursor\n      cursor += match[0].length\n    }\n    return match\n  }\n\n  // parsers\n  const parseEmptyTagStart = () => {\n    const match = moveCursorOnMatch(emptyTagStartRegex)\n    if (match) {\n      tags.push({\n        [Symbol.for('componentType')]: null,\n        [symbols.type]: 'opening',\n        [symbols.level]: currentLevel,\n        [symbols.cursorTagStart]: prevCursor,\n      })\n      currentLevel++\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseEmptyTagEnd)\n    }\n  }\n\n  const parseEmptyTagEnd = () => {\n    const match = moveCursorOnMatch(emptyTagEndRegex)\n    if (match) {\n      currentLevel--\n      tags.push({\n        [Symbol.for('componentType')]: null,\n        [symbols.type]: 'closing',\n        [symbols.level]: currentLevel,\n      })\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseTag)\n    }\n  }\n\n  const parseTag = () => {\n    const match = moveCursorOnMatch(tagStartRegex)\n    if (match) {\n      currentTag = {\n        [Symbol.for('componentType')]: match[1],\n        [symbols.level]: currentLevel,\n        [symbols.cursorTagStart]: prevCursor,\n      }\n      if (match[0].startsWith('</')) {\n        currentLevel--\n        currentTag[symbols.type] = 'closing'\n        currentTag[symbols.level] = currentLevel\n      } else {\n        currentTag[symbols.type] = 'opening'\n        currentLevel++\n      }\n      parseLoop(parseTagEnd)\n    } else {\n      throw TemplateParseError('InvalidTag')\n    }\n  }\n\n  const parseTagEnd = () => {\n    const match = moveCursorOnMatch(tagEndRegex)\n    if (match) {\n      if (match[1] === '/>') {\n        if (currentTag[symbols.type] === 'closing') {\n          throw TemplateParseError('InvalidClosingTag')\n        }\n        currentTag[symbols.type] = 'self-closing'\n        currentLevel-- // because it was parsed as opening tag before\n      }\n\n      // parsing content in between tags\n      // rule: < char cannot be used in between tags even in escaped form\n      if (currentTag[symbols.type] === 'opening') {\n        const tagContent = template.slice(cursor, template.indexOf('<', cursor))\n        if (tagContent) {\n          currentTag.content = tagContent\n          cursor += tagContent.length\n        }\n      }\n\n      tags.push(currentTag)\n      parseLoop(parseEmptyTagStart)\n    } else {\n      parseLoop(parseAttributes)\n    }\n  }\n\n  //fixme: closing tags cannot have attributes\n  const parseAttributes = () => {\n    const attrNameMatch = moveCursorOnMatch(attrNameRegex)\n    if (attrNameMatch) {\n      if (currentTag[symbols.type] === 'closing') {\n        throw TemplateParseError('AttributesInClosingTag')\n      }\n\n      const delimiter = attrNameMatch[2]\n      const attrValueRegex = new RegExp(`^(.*?)${delimiter}\\\\s*`)\n      const attrValueMatch = moveCursorOnMatch(attrValueRegex)\n\n      if (attrValueMatch) {\n        // maybe this should be done while code generation step\n        const attr = formatAttribute(attrNameMatch[1], attrValueMatch[1])\n        currentTag[attr.name] = attr.value\n        parseLoop(parseTagEnd)\n      } else {\n        throw TemplateParseError('MissingOrInvalidAttributeValue')\n      }\n    } else {\n      throw TemplateParseError('InvalidAttribute')\n    }\n  }\n\n  const formatAttribute = (name, value) => {\n    // if name contains a dot then we need to add enclosing js object to the value\n    // example :x.transition=\"{v: $offset}\" must be formatted as { name: ':x', value: '{ transition: {v: $offset}' }\n    if (name.includes('.')) {\n      const [objectName, attributeName] = name.split('.')\n      return { name: objectName, value: `{${attributeName}: ${value}}` }\n    }\n\n    // process color values\n    if (['color', ':color', ':effects', 'effects'].includes(name)) {\n      return processColors(name, value)\n    }\n    return { name, value }\n  }\n\n  const processColors = (name, value) => {\n    let newValue = value //copy for processing\n    let normalized = colors.normalize(newValue, null)\n\n    if (normalized === null) {\n      const stringTokenRegex = /'([^']+)'/g\n      let match\n      let lastIndex = 0\n      let result = ''\n\n      while ((match = stringTokenRegex.exec(value)) !== null) {\n        const potentialColor = match[1]\n        const matchIndex = match.index\n        const matchLength = match[0].length\n\n        result += value.slice(lastIndex, matchIndex)\n        normalized = colors.normalize(potentialColor, null)\n\n        if (normalized === null) {\n          result += value.slice(matchIndex, matchIndex + matchLength)\n        } else {\n          result += `'${normalized}'`\n        }\n\n        lastIndex = matchIndex + matchLength\n      }\n\n      result += value.slice(lastIndex)\n      newValue = result\n    } else {\n      newValue = normalized\n    }\n\n    return { name, value: newValue }\n  }\n\n  /*\n  Formatting & validation rules:\n    #1: Every opening tag must have a corresponding closing tag at the same level. If a closing tag is encountered without\n        a preceding opening tag at the same level, or if an opening tag is not followed by a corresponding closing tag at\n        the same level, an error should be thrown.\n    #2: There must be exactly one top-level element (an element at level 0). This element may either be a self-closing\n        element or an opening tag followed by a closing tag. If more than one top-level element is encountered, an error\n        should be thrown.\n        But the top-level element can not have :for attribute.\n  */\n  const format = (parsedData) => {\n    let stack = []\n    let rootElementDefined = false\n    let output = { children: [] }\n    let currentParent = output\n\n    for (let i = 0; i < parsedData.length; i++) {\n      let element = parsedData[i]\n\n      // Rule #1\n      if (element[symbols.level] === 0 && element[symbols.type] !== 'closing') {\n        if (rootElementDefined) {\n          throw TemplateStructureError('MultipleTopLevelTags', element)\n        }\n        // Check for :for attribute on root level element\n        if (element[':for'] !== undefined) {\n          throw TemplateStructureError('ForAttributeOnRootElement', element)\n        }\n        rootElementDefined = true\n      }\n\n      // Rule #2\n      if (element[symbols.type] === 'opening') {\n        stack.push({\n          [symbols.level]: element[symbols.level],\n          [symbols.type]: element[symbols.type],\n          [symbols.cursorTagStart]: element[symbols.cursorTagStart],\n          [Symbol.for('componentType')]: element[Symbol.for('componentType')],\n          parent: currentParent, // helps getting the previous parent when closing tag is encountered\n        })\n      } else if (element[symbols.type] === 'closing') {\n        const isStackEmpty = stack.length === 0\n        let isLevelMismatch = false\n        let isTagMismatch = false\n        if (!isStackEmpty) {\n          isLevelMismatch = stack[stack.length - 1][symbols.level] !== element[symbols.level]\n          isTagMismatch =\n            stack[stack.length - 1][Symbol.for('componentType')] !==\n            element[Symbol.for('componentType')]\n        }\n\n        if (isStackEmpty || isLevelMismatch || isTagMismatch) {\n          throw TemplateStructureError('MismatchedClosingTag', element)\n        }\n\n        // when we remove the closing element from the stack, we should set\n        // the current parent to the parent of the closing element\n        const lastTag = stack.pop()\n        currentParent = lastTag.parent\n      }\n\n      const newItem = { ...element }\n      delete newItem[symbols.type]\n      delete newItem[symbols.level]\n      delete newItem[symbols.cursorTagStart]\n\n      // if it is an opening tag, add children[] to it and update current parent\n      if (element[symbols.type] === 'opening') {\n        // make sure the current opening tag has really a child element\n        if (i + 1 < parsedData.length && parsedData[i + 1][symbols.type] !== 'closing') {\n          newItem.children = []\n        }\n        currentParent.children.push(newItem)\n        currentParent = newItem\n      } else if (element[symbols.type] === 'self-closing') {\n        currentParent.children.push(newItem)\n      }\n    }\n\n    // Check if all tags are closed (so stack should be empty)[Rule #1]\n    if (stack.length > 0) {\n      throw TemplateStructureError('UnclosedTags', stack)\n    }\n\n    return output\n  }\n\n  // error reporting\n  const contextPaddingBefore = 10 // number of characters to show before the error location\n  const contextPaddingAfter = 50 // number of characters to show after the error location\n\n  const TemplateParseError = (message) => {\n    const location = getErrorLocation()\n    message = `${message} in ${location}`\n\n    const error = new Error(message)\n    error.name = 'TemplateParseError'\n\n    const start = Math.max(0, prevCursor - contextPaddingBefore)\n    const end = Math.min(template.length, cursor + contextPaddingAfter)\n    const contextText = template.slice(start, end)\n\n    // add ^ caret to show where the error is\n    const caretPosition = cursor - start\n    error.context = insertContextCaret(caretPosition, contextText)\n\n    return error\n  }\n\n  const TemplateStructureError = (message, context) => {\n    const location = getErrorLocation()\n    message = `${message} in ${location}`\n\n    const error = new Error(message)\n    error.name = 'TemplateStructureError'\n\n    // check if context is an array\n    if (Array.isArray(context)) {\n      error.context = context.map((tag) => generateContext(tag)).join('\\n')\n    } else {\n      error.context = generateContext(context)\n    }\n\n    function generateContext(element) {\n      const start = Math.max(0, element[symbols.cursorTagStart] - contextPaddingBefore)\n      const contextText = template.slice(start, start + contextPaddingAfter)\n      // add ^ caret to show where the error is\n      return insertContextCaret(contextPaddingBefore, contextText)\n    }\n    return error\n  }\n\n  const insertContextCaret = (position, contextText) => {\n    const caret = ' '.repeat(position) + '^'\n    return `\\n${contextText}\\n${caret}\\n`\n  }\n\n  const getErrorLocation = () => {\n    if (parentComponent) {\n      let hierarchy = componentName || ''\n      let currentParent = parentComponent\n\n      while (currentParent) {\n        hierarchy = `${currentParent[Symbol.for('componentType')]}/${hierarchy}`\n        currentParent = currentParent.parent\n      }\n      return hierarchy\n    }\n    return filePath ? filePath : 'Blits.Application'\n  }\n\n  return parse()\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nlet counter\nlet isDev\n\nexport default function (templateObject = { children: [] }, devMode = false) {\n  const ctx = {\n    renderCode: [\n      'const elms = []',\n      'const elementConfigs = []',\n      'const forloops = []',\n      'const props = []',\n      'const created = []',\n      'const effects = {}',\n      'const skips = []',\n      'let componentType',\n      'let rootComponent = component',\n      'let propData',\n      'let slotComponent',\n      'let inSlot = false',\n      'let slotChildCounter = 0',\n      'let cmps = []',\n    ],\n    effectsCode: [],\n    cleanupCode: [\n      'rootComponent = null',\n      'propData = null',\n      'slotComponent = null',\n      'parent = null',\n    ],\n    context: { props: [], components: this.components },\n  }\n\n  counter = -1\n  isDev = devMode\n  if (isDev === true) {\n    ctx.renderCode.push(`\n      function propInComponent(prop, kind=\"dynamic\") {\n        const property = prop.includes('.') ? prop.split('.')[0] : prop\n        if (kind === 'reactive' || prop.includes('.') === false) {\n          if (property in component === false) {\n            Log.warn('Property ' +  property + ' was accessed during render but is not defined on instance')\n          }\n        } else {\n          const nestedKeys = prop.split('.')\n          let base = component\n          for(let i =0; i<nestedKeys.length;i++){\n            if (base[nestedKeys[i]] === undefined) {\n              Log.warn('Property ' +  nestedKeys.slice(0,i+1).join('.') + ' was accessed during render but is not defined on instance')\n            }\n            base = base[nestedKeys[i]]\n          }\n        }\n      }\n    `)\n  }\n  generateCode.call(ctx, templateObject)\n  ctx.renderCode.push(`\n    return { elms, cleanup: () => {\n      ${ctx.cleanupCode.join('\\n')}\n      component = null\n      cmps.length = 0\n      elms.length = 0\n      components.length = 0\n      elementConfigs.length = 0\n      forloops.length = 0\n      props.length = 0\n      skips.length = 0\n    }}\n  `)\n\n  return {\n    render: new Function(\n      'parent',\n      'component',\n      'context',\n      'components',\n      'effect',\n      'getRaw',\n      'Log',\n      ctx.renderCode.join('\\n')\n    ),\n    effects: ctx.effectsCode.map(\n      (code) =>\n        new Function('component', 'elms', 'context', 'components', 'rootComponent', 'effect', code)\n    ),\n    context: ctx.context,\n  }\n}\n\n// This is used to get only variable from expression\nconst extractVariables = function (value) {\n  const regEx = /\\$\\$?\\w+(\\.\\w+)?/g\n  const matches = value.match(regEx)\n  if (matches !== null) {\n    const shaderRegex = /\\$shader/\n    return matches.filter((match) => !shaderRegex.test(match))\n  } else {\n    return false\n  }\n}\n\nconst verifyVariables = function (value, renderCode, type = 'dynamic') {\n  const variablesToBeVerified = extractVariables(value)\n  if (variablesToBeVerified !== false) {\n    for (let i = 0; i < variablesToBeVerified.length; i++) {\n      let variable = variablesToBeVerified[i]\n      if (type === 'reactive' && variable.includes('.')) {\n        variable = variable.split('.')[0]\n      }\n      renderCode.push(`propInComponent('${variable.replace('$', '')}', '${type}')`)\n    }\n  }\n}\n\nconst generateElementCode = function (\n  templateObject,\n  parent = false,\n  options = { key: false, component: 'component.', forceEffect: false, forloop: false }\n) {\n  const renderCode = options.forceEffect ? this.effectsCode : this.renderCode\n  if (parent) {\n    renderCode.push(`parent = ${parent}`)\n  }\n\n  if ('key' in templateObject) options.key = interpolate(templateObject.key, options.component)\n  const elm = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  if (options.key) {\n    renderCode.push(`\n      if(elms[${counter}] === undefined) {\n        elms[${counter}] = {}\n      }\n    `)\n  }\n\n  renderCode.push(`elementConfigs[${counter}] = {}`)\n\n  if (options.forloop) {\n    renderCode.push(`if(${elm} === undefined) {`)\n  }\n\n  renderCode.push(`\n    ${elm} = this.element({parent: parent || 'root'}, inSlot === true ? slotComponent : component)\n  `)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  const children = templateObject['children']\n  delete templateObject['children']\n\n  if (templateObject[Symbol.for('componentType')] === 'Slot') {\n    renderCode.push(`elementConfigs[${counter}][Symbol.for('isSlot')] = true`)\n  }\n\n  Object.keys(templateObject).forEach((key) => {\n    if (key === 'slot') {\n      renderCode.push(`\n        elementConfigs[${counter}]['parent'] = slotComponent[Symbol.for('slots')] !== undefined && Array.isArray(slotComponent[Symbol.for('slots')]) === true && slotComponent[Symbol.for('slots')].filter(slot => slot.ref === '${templateObject.slot}').shift() || parent\n      `)\n    }\n\n    if (key === 'key') return\n\n    // Skip inspector-data in production builds for performance optimization\n    if (key === 'inspector-data' && !isDev) return\n\n    const value = templateObject[key]\n\n    if (isReactiveKey(key)) {\n      if (options.holder && key === ':color') return\n      if (options.holder) {\n        this.effectsCode.push(`\n        if(typeof skips === 'undefined' || (typeof skips[${counter}] === 'undefined' ||\n          skips[${counter}].indexOf('${key.substring(1)}') === -1))\n          ${elm}.set('${key.substring(1)}', ${interpolate(templateObject[key], options.component)})\n        `)\n      } else {\n        this.effectsCode.push(`\n            ${elm}.set('${key.substring(1)}', ${interpolate(\n              templateObject[key],\n              options.component\n            )})\n          `)\n      }\n      // value.includes('.') === false &&\n      if (isDev === true && options.component !== 'scope.' && value.includes('$')) {\n        verifyVariables(value, renderCode, 'reactive')\n      }\n      renderCode.push(\n        `elementConfigs[${counter}]['${key.substring(1)}'] = ${interpolate(\n          value,\n          options.component\n        )}`\n      )\n    } else {\n      if (isDev === true && options.component !== 'scope.' && value.includes('$')) {\n        verifyVariables(value, renderCode)\n      }\n      renderCode.push(\n        `elementConfigs[${counter}]['${key}'] = ${cast(value, key, options.component)}`\n      )\n    }\n  })\n\n  if (options.holder === true) {\n    renderCode.push(`\n    skips[${counter}] = []\n    if(typeof cmps[${counter}] !== 'undefined') {\n      for(let key in cmps[${counter}][Symbol.for('config')].props) {\n        delete elementConfigs[${counter}][cmps[${counter}][Symbol.for('config')].props[key]]\n        skips[${counter}].push(cmps[${counter}][Symbol.for('config')].props[key])\n      }\n    }\n    `)\n  }\n\n  if (options.forloop) {\n    renderCode.push(`if(${elm}.nodeId === undefined) {`)\n  }\n\n  renderCode.push(`${elm}.populate(elementConfigs[${counter}])`)\n\n  renderCode.push(`\n    if(inSlot === true) {\n      slotChildCounter -= 1\n    }\n  `)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  if (children) {\n    generateCode.call(this, { children }, `${elm}`, options)\n  }\n}\n\nconst generateComponentCode = function (\n  templateObject,\n  parent = false,\n  options = {\n    key: false,\n    component: 'component.',\n    forceEffect: false,\n    holder: false,\n    forloop: false,\n  }\n) {\n  const renderCode = options.forceEffect ? this.effectsCode : this.renderCode\n\n  renderCode.push(`\n    cmps[${counter}] =\n      (context.components && context.components['${\n        templateObject[Symbol.for('componentType')]\n      }']) || components['${templateObject[Symbol.for('componentType')]}']\n  `)\n\n  this.cleanupCode.push(`\n    cmps[${counter}] = null\n  `)\n\n  if ('key' in templateObject) {\n    options.key = interpolate(templateObject.key, options.component)\n  }\n\n  const children = templateObject.children\n  delete templateObject.children\n  generateElementCode.call(this, templateObject, parent, { ...options, ...{ holder: true } })\n\n  parent = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  counter++\n\n  const elm = options.key ? `elms[${counter}][${options.key}]` : `elms[${counter}]`\n\n  if (options.key) {\n    renderCode.push(`\n      if(elms[${counter}] === undefined) {\n        elms[${counter}] = {}\n      }\n    `)\n  }\n\n  if (parent) {\n    renderCode.push(`parent = ${parent};`)\n  }\n\n  renderCode.push(`props[${counter}] = {}`)\n  this.cleanupCode.push(`props[${counter}] = null`)\n\n  if (options.forloop) {\n    renderCode.push(`if(${elm} === undefined) {`)\n  }\n\n  Object.keys(templateObject).forEach((key) => {\n    if (isReactiveKey(key)) {\n      this.effectsCode.push(`\n        ${elm}[Symbol.for('props')]['${key.substring(1)}'] = ${interpolate(\n          templateObject[key],\n          options.component\n        )}`)\n      renderCode.push(`\n        propData = ${interpolate(templateObject[key], options.component)}\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[${counter}]['${key.substring(1)}'] = propData`)\n    } else {\n      renderCode.push(\n        `props[${counter}]['${key}'] = ${cast(templateObject[key], key, options.component)}`\n      )\n    }\n  })\n\n  renderCode.push(`\n    componentType = props[${counter}]['is'] || '${templateObject[Symbol.for('componentType')]}'\n\n    components[${counter}]\n    if(typeof componentType === 'string') {\n      components[${counter}] = context.components && context.components[componentType] || components[componentType]\n      if(!components[${counter}]) {\n        throw new Error('Component \"${templateObject[Symbol.for('componentType')]}\" not found')\n      }\n    } else if(typeof componentType === 'function' && componentType[Symbol.for('isComponent')] === true) {\n      components[${counter}] = componentType\n    }\n\n    ${elm} = components[${counter}].call(null, {props: props[${counter}]}, ${parent}, component)\n\n    if (${elm}[Symbol.for('slots')][0]) {\n      parent = ${elm}[Symbol.for('slots')][0]\n      slotComponent = ${elm}\n      inSlot = true\n    } else {\n      parent = ${elm}[Symbol.for('children')][0]\n    }\n  `)\n\n  this.cleanupCode.push(`components[${counter}] = null`)\n\n  if (options.forloop) {\n    renderCode.push('}')\n  }\n\n  if (children) {\n    if (!options.forloop) {\n      renderCode.push(`\n        if(inSlot === true) {\n          slotChildCounter = ${children.length}  + 1\n        }\n      `)\n    }\n    counter++\n    generateElementCode.call(this, { children }, false, { ...options })\n  }\n\n  if (!options.forloop) {\n    renderCode.push(`\n      if (inSlot === true && slotChildCounter === 0) {\n        inSlot = false\n      }\n    `)\n  }\n}\n\nconst generateForLoopCode = function (templateObject, parent) {\n  const forLoop = templateObject[':for']\n  delete templateObject[':for']\n  const range = templateObject['range'] || templateObject[':range'] || '{}'\n  delete templateObject['range']\n  delete templateObject[':range']\n\n  const key = templateObject['key']\n  const forStartCounter = counter\n  const forKey = interpolate(key, 'scope.')\n\n  const shallow = !!!(\n    templateObject['$shallow'] && templateObject['$shallow'].toLowerCase() === 'false'\n  )\n  delete templateObject['$shallow']\n\n  delete templateObject['key']\n  const regex = /(.+)\\s+in\\s+(.+)/gi\n  //   const regex = /(:?\\(*)(.+)\\s+in\\s+(.+)/gi\n\n  const result = regex.exec(forLoop)\n\n  // can be improved with a smarter regex\n  const [item, index] = result[1]\n    .replace('(', '')\n    .replace(')', '')\n    .split(/\\s*,\\s*/)\n\n  const scopeRegex = new RegExp(`(scope\\\\.(?!${item}\\\\.|${index}|key)([\\\\w$]+))`, 'gi')\n\n  // local context\n  const ctx = {\n    renderCode: [],\n    effectsCode: [],\n    cleanupCode: [],\n    context: { props: [], components: this.components },\n  }\n\n  if (parent) {\n    ctx.renderCode.push(`parent = ${parent}`)\n  }\n\n  // If the index variable is not defined, the key attribute would not reference it.\n  if (index !== undefined) {\n    const indexRegex = new RegExp(`\\\\$${index}(?!['\\\\w])`)\n    const indexResult = indexRegex.exec(key)\n    if (Array.isArray(indexResult)) {\n      ctx.renderCode.push(\n        `console.warn(\" Using '${index}' in the key, like key=${key},  is not recommended\")`\n      )\n    }\n  }\n\n  ctx.renderCode.push(`\n    created[${forStartCounter}] = []\n    effects[${forStartCounter}] = []\n\n    let from${forStartCounter}\n    let to${forStartCounter}\n\n    forloops[${forStartCounter}] = (collection = [], elms, created) => {\n      const rawCollection = getRaw(collection)\n      const keys = new Set()\n      let l = rawCollection.length\n\n      const range = ${interpolate(range, 'component?.')} || {}\n      from${forStartCounter} = range['from'] || 0\n      to${forStartCounter} = 'to' in range ? range['to'] : rawCollection.length\n\n      while(l--) {\n        const ${item} = rawCollection[l]\n  `)\n\n  ctx.cleanupCode.push(`\n    created[${forStartCounter}].length = 0\n  `)\n\n  // push reference of index variable\n  if (index !== undefined) {\n    ctx.renderCode.push(`\n        const ${index} = l\n    `)\n  }\n  ctx.renderCode.push(`\n        if(l < to${forStartCounter} && l >= from${forStartCounter}) {\n          keys.add('' +  ${interpolate(key, '') || 'l'})\n        }\n      }\n  `)\n\n  // keep track of the index in the render code so we can inject\n  // the code that takes care of destroying elements (generated later on)\n  // in the right spot\n  const indexToInjectDestroyCode = ctx.renderCode.length\n\n  ctx.renderCode.push(`\n      created.length = 0\n      const length = rawCollection.length\n\n      component !== null && component[Symbol.for('removeGlobalEffects')](effects[${forStartCounter}])\n\n      for(let i = 0; i < effects[${forStartCounter}].length; i++) {\n        const value = effects[${forStartCounter}][i]\n        const index = component[Symbol.for('effects')].indexOf(value)\n        if (index > -1) component[Symbol.for('effects')].splice(index, 1)\n      }\n\n      effects[${forStartCounter}].length = 0\n      for(let __index = 0; __index < length; __index++) {\n        if(__index < from${forStartCounter} || __index >= to${forStartCounter}) continue\n        let scope = Object.create(component)\n        parent = ${parent}\n        scope['${item}'] = rawCollection[__index]\n  `)\n  // If the index variable is declared, include it in the scope object\n  if (index !== '') {\n    ctx.renderCode.push(`\n        scope['${index}'] = __index\n    `)\n  }\n  ctx.renderCode.push(`\n        scope['key'] = '' + ${forKey || '__index'}\n  `)\n  if ('ref' in templateObject && templateObject.ref.indexOf('$') === -1) {\n    // automatically map the ref for each item in the loop based on the given ref key\n    ctx.renderCode.push(`\n        scope['__ref'] = '${templateObject.ref}' + __index\n    `)\n    templateObject.ref = '$__ref'\n  }\n\n  ctx.renderCode.push(`\n        created.push(scope.key)\n  `)\n\n  if (\n    templateObject[Symbol.for('componentType')] === 'Element' ||\n    templateObject[Symbol.for('componentType')] === 'Slot' ||\n    templateObject[Symbol.for('componentType')] === 'Text'\n  ) {\n    if (templateObject[Symbol.for('componentType')] === 'Text') {\n      templateObject.__textnode = 'true'\n    }\n    generateElementCode.call(ctx, templateObject, parent, {\n      key: 'scope.key',\n      component: 'scope.',\n      forceEffect: false,\n      forloop: true,\n    })\n  } else {\n    generateComponentCode.call(ctx, templateObject, false, {\n      key: 'scope.key',\n      component: 'scope.',\n      forceEffect: false,\n      forloop: true,\n    })\n  }\n\n  // separate effects that only rely on variables in the itteration\n  const innerScopeEffects = ctx.effectsCode.filter(\n    (effect) => [...effect.matchAll(scopeRegex)].length === 0\n  )\n\n  // separate effects that (also) rely on variables in the outer scope\n  const outerScopeEffects = ctx.effectsCode.filter(\n    (effect) => [...effect.matchAll(scopeRegex)].length !== 0\n  )\n\n  if (shallow === false) {\n    ctx.renderCode.push(`\n      scope = Object.assign(collection[__index], scope)\n  `)\n  }\n\n  // inner scope variables are part of the main forloop\n  innerScopeEffects.forEach((effect, index) => {\n    const key = effect.indexOf(`scope.${index}`) > -1 ? `'${interpolate(result[2], '')}'` : null\n    if (effect.indexOf(\"Symbol.for('props')\") === -1) {\n      ctx.renderCode.push(`\n        let eff${index} = () => {\n          ${effect}\n        }\n        effect(eff${index}, ${key})\n        effects[${forStartCounter}].push(eff${index})\n        component[Symbol.for('effects')].push(eff${index})\n      `)\n    } else {\n      // props shouldn't be wrapped in an effect, but simply passed on\n      ctx.renderCode.push(`\n        ${effect}\n      `)\n    }\n  })\n  ctx.renderCode.push(`\n    }\n    return effects\n  }`)\n\n  // generate code that destroys items\n  const destroyCode = []\n  destroyCode.push(`\n      let i = created.length\n\n      while (i--) {\n        if (keys.has(created[i]) === false) {\n          const key = created[i]\n  `)\n  const forEndCounter = counter\n\n  for (let i = forStartCounter; i <= forEndCounter; i++) {\n    destroyCode.push(`\n        elms[${i}][key] && elms[${i}][key].destroy()\n        elms[${i}][key] = null\n        delete elms[${i}][key]\n    `)\n  }\n  destroyCode.push(`\n      }\n    }\n  `)\n\n  // inject the destroy code in the correct spot\n  ctx.renderCode.splice(indexToInjectDestroyCode, 0, ...destroyCode)\n\n  let effectKey = `${interpolate(result[2], '')}`\n\n  // Get the last property from nested path\n  if (effectKey && effectKey.includes('.')) {\n    effectKey = effectKey.match(/[^.]+$/)[0]\n  }\n\n  // get the reference to range from and to\n  const effectKeysRegex = /\\$([^,} ]+)/g\n  const effectKeys = [...range.matchAll(effectKeysRegex)].map((match) => `'${match[1]}'`)\n\n  ctx.renderCode.push(`\n    let eff${forStartCounter} = () => {\n      forloops[${forStartCounter}](${cast(result[2], ':for')}, elms, created[${forStartCounter}])\n    }\n\n    component[Symbol.for('effects')].push(eff${forStartCounter})\n\n    effect(eff${forStartCounter}, ['${effectKey}', ${effectKeys.join(',')}])\n  `)\n\n  ctx.cleanupCode.push(`\n    eff${forStartCounter} = null\n    // call loop with empty array\n    forloops[${forStartCounter}]([], elms, created[${forStartCounter}])\n    forloops[${forStartCounter}] = null\n  `)\n\n  outerScopeEffects.forEach((effect, outerScopeEffectsIndex) => {\n    const matches = [...effect.matchAll(scopeRegex)]\n\n    let l = matches.length\n    const refs = []\n    while (l--) {\n      const match = matches[l]\n      const ref = `component.${match[2]}`\n      refs.indexOf(ref) === -1 && refs.push(ref)\n      // don't update the effect to point to component, if we're referring to a scope item\n      if (match[2] !== item) {\n        effect =\n          effect.substring(0, match.index) + ref + effect.substring(match.index + match[1].length)\n      }\n    }\n\n    ctx.renderCode.push(`\n      let eff${forStartCounter}_${outerScopeEffectsIndex} = () => {\n        void ${refs.join(', ')}\n        for(let __index = 0; __index < ${interpolate(result[2])}.length; __index++) {\n          if(__index < from${forStartCounter} || __index >= to${forStartCounter}) continue\n          const scope = {}\n          scope['${index}'] = __index\n          scope['${item}'] = ${interpolate(result[2])}[__index]\n          scope['key'] = ${forKey || '__index'}\n    `)\n    ctx.cleanupCode.push(`eff${forStartCounter}_${outerScopeEffectsIndex} = null`)\n\n    ctx.renderCode.push(`\n          ${effect}\n        }\n      }\n      component[Symbol.for('effects')].push(eff${forStartCounter}_${outerScopeEffectsIndex})\n      effect(eff${forStartCounter}_${outerScopeEffectsIndex})\n    `)\n  })\n\n  this.renderCode.push(ctx.renderCode.join('\\n'))\n  this.cleanupCode.push(ctx.cleanupCode.join('\\n'))\n}\n\nconst generateCode = function (templateObject, parent = false, options = {}) {\n  templateObject.children &&\n    templateObject.children.forEach((childTemplateObject) => {\n      counter++\n\n      if (Object.keys(childTemplateObject).indexOf(':for') > -1) {\n        generateForLoopCode.call(this, childTemplateObject, parent)\n      } else {\n        if (\n          childTemplateObject[Symbol.for('componentType')] === 'Element' ||\n          childTemplateObject[Symbol.for('componentType')] === 'Slot' ||\n          childTemplateObject[Symbol.for('componentType')] === 'Text' ||\n          childTemplateObject[Symbol.for('componentType')] === 'Layout'\n        ) {\n          if (childTemplateObject[Symbol.for('componentType')] === 'Text') {\n            childTemplateObject.__textnode = 'true'\n          }\n          if (childTemplateObject[Symbol.for('componentType')] === 'Layout') {\n            childTemplateObject.__layout = 'true'\n          }\n          generateElementCode.call(this, childTemplateObject, parent, options)\n        } else {\n          generateComponentCode.call(this, childTemplateObject, parent, options)\n        }\n      }\n    })\n}\n\nconst interpolate = (val, component = 'component.') => {\n  if (val === undefined) return val\n  const replaceString = /('.*?')+/gi\n  const replaceDollar = /\\$(\\$(?=\\$)|\\$?)/g\n  const matches = val.matchAll(replaceString)\n  const restore = []\n\n  let i = 0\n\n  // replace string and store in temp\n  for (const match of matches) {\n    restore.push(match[0])\n    val = val.replace(match[0], `[@@REPLACEMENT${i}@@]`)\n    i++\n  }\n\n  // replace dollar signs using the regex and function\n  val = val.replace(replaceDollar, (match, group1) => {\n    // single dollar sign\n    if (group1 === '') {\n      return component\n    }\n    // consecutive dollar sign, replace only the first $\n    else if (group1 === '$') {\n      return component + '$'\n    }\n  })\n\n  // restore string replacement\n  restore.forEach((el, idx) => {\n    val = val.replace(`[@@REPLACEMENT${idx}@@]`, el)\n  })\n\n  return val\n}\n\nconst cast = (val = '', key = false, component = 'component.') => {\n  const dynamicArgumentRegex = /\\$\\w+/gi\n  let castedValue\n\n  // inline content\n  if (key === 'content') {\n    if (val.startsWith('$')) {\n      castedValue = `${component}${val.replace('$', '')}`\n    } else {\n      // unescaped single quotes must be escaped while preserving escaped backslashes\n      const escapedVal = val\n        .replace(/\\\\\\\\/g, '__DOUBLE_BACKSLASH__')\n        .replace(/(^|[^\\\\])'/g, \"$1\\\\'\")\n        .replace(/__DOUBLE_BACKSLASH__/g, '\\\\\\\\')\n      castedValue = `'${parseInlineContent(escapedVal, component)}'`\n    }\n  }\n  // numeric\n  else if (key !== 'color' && /[^0-9%\\s.eE]/.test(val) === false && !isNaN(parseFloat(val))) {\n    castedValue = parseFloat(val)\n    if (val.endsWith('%')) {\n      const map = {\n        w: 'width',\n        width: 'width',\n        x: 'width',\n        h: 'height',\n        height: 'height',\n        y: 'height',\n      }\n      const base = map[key]\n      if (base) {\n        castedValue = `parent.node.${base} * (${castedValue} / 100)`\n      }\n    }\n  }\n  // boolean true\n  else if (val.toLowerCase() === 'true') {\n    castedValue = true\n  }\n  // boolean false\n  else if (val.toLowerCase() === 'false') {\n    castedValue = false\n  }\n  // @-listener\n  else if (key.startsWith('@') && val) {\n    const c = component.slice(0, -1)\n    castedValue = `${c}['${val.replace('$', '')}'] && ${c}['${val.replace('$', '')}'].bind(${c})`\n  }\n  // dynamic value\n  else if (val.startsWith('$')) {\n    castedValue = `${component}${val.replace('$', '')}`\n  }\n  // dynamic value in object\n  else if (dynamicArgumentRegex.exec(val)) {\n    const rex = /\\w+\\s*:\\s*(?:[^\\s,}]+|\".*?\"|'.*?')/g\n    const results = val.match(rex)\n    castedValue = {}\n    if (results) {\n      for (let i = 0; i < results.length; i++) {\n        const members = results[i].split(/\\s*:\\s*/)\n        if (members) {\n          populateFields(members[0], members[1], component, castedValue)\n        }\n      }\n    }\n    return interpolateObject(castedValue)\n  }\n  // static string\n  else {\n    castedValue = `\"${val}\"`\n  }\n\n  return castedValue\n}\n\nconst isReactiveKey = (str) => str.startsWith(':')\n\nconst parseInlineContent = (val, component) => {\n  const dynamicParts = /\\{\\{\\s*(\\$\\S+)\\s*\\}\\}/g\n  const matches = [...val.matchAll(dynamicParts)]\n\n  if (matches.length) {\n    for (let [match, arg] of matches) {\n      val = val.replace(match, `${arg.replace('$', `'+${component}`)}+'`)\n    }\n  }\n  return val\n}\n\n// Populate value into target's prop\nconst populateFields = (prop, val, component, target) => {\n  if (val.startsWith('$')) {\n    target[prop] = `${component}${val.replace('$', '')}`\n  } else {\n    target[prop] = val\n  }\n}\n\nconst interpolateObject = (input) => {\n  const interpolatedResults = []\n  Object.keys(input).forEach((key) => {\n    interpolatedResults.push(`${key}: ${input[key]}`)\n  })\n\n  return ` { ${interpolatedResults.join(', ')} }`\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst counters = {}\nlet counter = 0\n\n/**\n * Creates a human-readable component ID string for a given component name.\n *\n * @param {string} name - The name of the component.\n * @returns {string} The generated human-readable component ID.\n */\nexport const createHumanReadableId = (name) => {\n  return `BlitsComponent::${name}_${(counters[name] = (counters[name] || 0) + 1)}`\n}\n\n/**\n * Generates a new unique internal numeric ID.\n *\n * @returns {number} The next unique internal ID.\n */\nexport const createInternalId = () => {\n  return ++counter\n}\n\n/**\n * Resets the internal counter value back to 0.\n * Used in automated tests to ensure consistent results, not intended\n * to be used in the actual framework code!\n *\n * @returns {void}\n */\nexport const resetCounter = () => {\n  counter = 0\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './symbols.js'\n\nconst cbs = {}\n\n/**\n * Emits a registered hook for a given identifier, calling the hook with the provided scope and data.\n *\n * @param {string|symbol} hook - The name or symbol of the hook to emit.\n * @param {string} identifier - The unique identifier for the hook set.\n * @param {object} scope - The value of `this` inside the hook function.\n * @param {Array} [data=[]] - Arguments to pass to the hook function.\n */\nexport const emit = (hook, identifier, scope, data = []) => {\n  cbs[identifier] && cbs[identifier][hook] && cbs[identifier][hook].apply(scope, data)\n}\n\n/**\n * Emits a registered symbol-based hook for a given identifier, calling the hook with the provided scope.\n *\n * @param {string|symbol} hook - The name or symbol of the hook to emit (will be mapped to a symbol).\n * @param {string} identifier - The unique identifier for the hook set.\n * @param {object} scope - The value of `this` inside the hook function.\n */\nexport const privateEmit = (hook, identifier, scope) => {\n  const symHook = symbols[hook]\n  cbs[identifier] && cbs[identifier][symHook] && cbs[identifier][symHook].apply(scope)\n}\n\n/**\n * Registers a set of hooks (functions) for a given identifier.\n *\n * @param {Object<string,Function>|Object<symbol,Function>} hooks - An object whose keys are hook names or symbols and values are functions.\n * @param {string} identifier - The unique identifier for the hook set.\n */\nexport const registerHooks = (hooks = {}, identifier) => {\n  cbs[identifier] = {}\n  // Combines enumerable keys and symbol properties of the 'hooks' object\n  const hookKeys = [...Object.keys(hooks), ...Object.getOwnPropertySymbols(hooks)]\n  hookKeys.forEach((hook) => {\n    if (typeof hooks[hook] === 'function') cbs[identifier][hook] = hooks[hook]\n  })\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nlet currentEffect = null\nlet currentKey = null\n\nlet paused = false\n\nexport const pauseTracking = () => {\n  paused = true\n}\n\nexport const resumeTracking = () => {\n  paused = false\n}\n\nconst objectMap = new WeakMap()\nconst globalEffectsMap = new Map()\n\nexport const removeGlobalEffects = (effectsToRemove) => {\n  if (globalEffectsMap.size === 0) return\n  for (const [effect, target] of globalEffectsMap) {\n    if (effectsToRemove.indexOf(effect) === -1) continue\n    const effectsSet = objectMap.get(target)\n    if (effectsSet === undefined) continue\n    for (const set of effectsSet.values()) {\n      set.delete(effect)\n      globalEffectsMap.delete(effect)\n    }\n  }\n}\n\nexport const track = (target, key, global = false) => {\n  if (currentEffect !== null) {\n    if (paused) {\n      return\n    }\n    // note: nesting the conditions like this seems to perform better ¯\\_(ツ)_/¯\n    if (Array.isArray(currentKey) === true) {\n      if (currentKey.includes(key) === false) return\n    } else if (currentKey !== null && key !== currentKey) return\n\n    let effectsMap = objectMap.get(target)\n    if (effectsMap === undefined) {\n      effectsMap = new Map()\n      objectMap.set(target, effectsMap)\n    }\n    let effects = effectsMap.get(key)\n    if (effects === undefined) {\n      effects = new Set()\n      effectsMap.set(key, effects)\n    }\n    effects.add(currentEffect)\n\n    if (global === true) globalEffectsMap.set(currentEffect, target)\n  }\n}\n\nexport const trigger = (target, key, force = false) => {\n  if (paused === true) return\n  const effectsMap = objectMap.get(target)\n  if (effectsMap === undefined) {\n    return\n  }\n  const effects = effectsMap.get(key)\n  if (effects !== undefined) {\n    for (let effect of effects) {\n      effect(force)\n    }\n  }\n}\n\nexport const effect = (effect, key = null) => {\n  currentEffect = effect\n  currentKey = key\n  currentEffect()\n  currentEffect = null\n  currentKey = null\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nconst deepEqualArray = (array1, array2) => {\n  if (array1 === array2) return true\n  if (array1.length !== array2.length) return false\n\n  let l = array1.length\n\n  while (l--) {\n    const value1 = array1[l]\n    const value2 = array2[l]\n\n    // values are arrays, deepEqual nested arrays\n    if (Array.isArray(value1) && Array.isArray(value2)) {\n      if (deepEqualArray(value1, value2) === false) return false\n    }\n    // values are objects, deepEqual nested objects\n    else if (\n      typeof value1 === 'object' &&\n      value1 !== null &&\n      typeof value2 === 'object' &&\n      value2 !== null\n    ) {\n      if (deepEqualArray(Object.entries(value1), Object.entries(value2)) === false) return false\n    }\n    // other type, do strict equal check\n    else if (value1 !== value2) {\n      return false\n    }\n  }\n\n  return true\n}\n\nexport default deepEqualArray\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { track, trigger, pauseTracking, resumeTracking } from './effect.js'\nimport symbols from '../symbols.js'\nimport deepEqualArray from '../../helpers/deepEqualArray.js'\n\nconst arrayPatchMethods = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort']\n\nconst proxyMap = new WeakMap()\n\nexport const getRaw = (value) => {\n  const raw = value && value[symbols.raw]\n  return raw ? getRaw(raw) : value\n}\n\nconst reactiveProxy = (original, _parent = null, _key, global) => {\n  // only create a proxy for plain objects. Other classes, Blits components, renderer textures etc\n  // are returned unmodified and will not become reactive\n  if (\n    typeof original === 'object' &&\n    Array.isArray(original) === false &&\n    Object.getPrototypeOf(original) !== Object.prototype\n  ) {\n    return original\n  }\n  // if original object is already a proxy, don't create a new one but return the existing one instead\n  const existingProxy = proxyMap.get(original)\n  if (existingProxy !== undefined) {\n    return existingProxy\n  }\n\n  const handler = {\n    get(target, key, receiver) {\n      // indicate that this is a proxy object\n      if (key === symbols.isProxy) {\n        return true\n      }\n      // return the original object instead of the proxied\n      if (key === symbols.raw) {\n        return original\n      }\n\n      // handling arrays\n      if (Array.isArray(target) === true) {\n        if (typeof target[key] === 'object' && target[key] !== null) {\n          if (Array.isArray(target[key]) === true) {\n            track(target, key, global)\n          }\n          // create a new reactive proxy\n          return reactiveProxy(getRaw(target[key]), target, key, global)\n        }\n        // augment array path methods (that change the length of the array)\n        if (arrayPatchMethods.indexOf(key) !== -1) {\n          return function (...args) {\n            pauseTracking()\n            const result = target[key].apply(this, args)\n            resumeTracking()\n            // trigger a change on the parent object and the key\n            // i.e. when pushing a new item to `obj.data`, _parent will equal `obj`\n            // and _key will equal `data`\n            trigger(_parent, _key)\n            return result\n          }\n        }\n        if (key === 'length') {\n          return original.length\n        }\n\n        return Reflect.get(target, key, receiver)\n      }\n\n      // handling objects (but not null values, which have object type in JS)\n      if (typeof target[key] === 'object' && target[key] !== null) {\n        if (Array.isArray(target[key]) === true) {\n          track(target, key, global)\n        }\n        // create a new reactive proxy\n        return reactiveProxy(getRaw(target[key]), target, key, global)\n      }\n\n      // handling all other types\n      // track the key on the target\n      track(target, key, global)\n      // return the reflected value\n      return Reflect.get(target, key, receiver)\n    },\n    set(target, key, value, receiver) {\n      // get the raw values (without proxy wrapper) so we can compare them\n      const oldRawValue = getRaw(target[key])\n      const rawValue = getRaw(value)\n\n      let result = true\n      let isEqual = false\n\n      // We need to check that the oldRawValue is also an array before we do the deep equal check\n      if (Array.isArray(rawValue) === true && Array.isArray(oldRawValue) === true) {\n        isEqual = deepEqualArray(oldRawValue, rawValue)\n      } else if (oldRawValue === rawValue) {\n        isEqual = true\n      }\n\n      if (isEqual === false) {\n        if (typeof value === 'object') {\n          if (Array.isArray(value) === true) {\n            value = getRaw(value).slice(0)\n          } else if (\n            value !== null &&\n            target[key] !== null &&\n            target[key] !== undefined &&\n            Array.isArray(target) === false &&\n            Object.getPrototypeOf(value) === Object.prototype\n          ) {\n            value = Object.assign(receiver[key], value)\n          }\n        }\n        result = Reflect.set(target, key, value, receiver)\n      }\n\n      if (result === true && isEqual === false) {\n        // if we're assigning an array key directly trigger reactivity on the parent key as well\n        if (Array.isArray(target) === true && key in target === true) {\n          trigger(_parent, _key, true)\n        }\n        trigger(target, key, true)\n      }\n      return result\n    },\n  }\n\n  const proxy = new Proxy(original, handler)\n  proxyMap.set(original, proxy)\n  return proxy\n}\n\nconst reactiveDefineProperty = (target, global) => {\n  Object.keys(target).forEach((key) => {\n    let internalValue = target[key]\n\n    if (target[key] !== null && typeof target[key] === 'object') {\n      if (Object.getPrototypeOf(target[key]) === Object.prototype) {\n        return reactiveDefineProperty(target[key])\n      } else if (Array.isArray(target[key]) === true) {\n        for (let i = 0; i < arrayPatchMethods.length; i++) {\n          target[key][arrayPatchMethods[i]] = function (v) {\n            Array.prototype[arrayPatchMethods[i]].call(this, v)\n            trigger(target, key)\n          }\n        }\n      }\n    }\n\n    Object.defineProperty(target, key, {\n      enumerable: true,\n      configurable: true,\n      get() {\n        track(target, key, global)\n        return internalValue\n      },\n      set(newValue) {\n        // todo: support assigning array (as we do with proxies)\n        let oldValue = internalValue\n        if (oldValue !== newValue) {\n          internalValue = newValue\n          trigger(target, key)\n        }\n      },\n    })\n  })\n\n  return target\n}\n\nconst hasProxySupport = typeof Proxy !== 'undefined'\n\nexport const reactive = (target, mode = 'Proxy', global = false) => {\n  // force defineProperty reactivity mode when no proxy support\n  if (hasProxySupport === false) {\n    mode = 'defineProperty'\n  }\n  return mode === 'defineProperty'\n    ? reactiveDefineProperty(target, global)\n    : reactiveProxy(target, undefined, undefined, global)\n}\n\nexport const memo = (raw) => {\n  const r = {\n    get value() {\n      track(r, 'value')\n      return raw\n    },\n    set value(v) {\n      raw = v\n      trigger(r, 'value')\n    },\n  }\n  return r\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from './log.js'\nimport { emit, privateEmit } from './hooks.js'\nimport symbols from './symbols.js'\n\n/**\n * List of valid lifecycle states for a component.\n * @type {Array<string>}\n */\nconst states = [\n  'init', // fired upon component instantiation\n  'ready', // fired when component instantiated, reactivity setup done and template spawned\n  'focus', // fired when receiving focus (can occur multiple times)\n  'unfocus', // fired when losing focus (can occur multiple times)\n  'destroy', // fired when component is destroyed and removed\n  'attach', // fired when entering the viewport margin and attached to the render tree\n  'detach', // fired when leaving the viewport margin and detached from the render tree\n  'enter', // fired when entering the visible viewport\n  'exit', // fired when leaving the visible viewport\n]\n\n/**\n * Lifecycle state manager for components.\n *\n * @typedef {Object} Lifecycle\n * @property {string|null} previous - The previous lifecycle state.\n * @property {string|null} current - The current lifecycle state.\n * @property {Object} [component] - The component instance this lifecycle belongs to.\n * @property {string|null} state - The current lifecycle state (getter/setter).\n */\n\n/**\n * Lifecycle state management object for components.\n * Handles state transitions and emits corresponding hooks.\n *\n * @type {Lifecycle}\n * @this {Lifecycle & {component: Object}}\n * The 'component' property is expected to be set by the component instance at runtime.\n */\nexport default {\n  previous: null,\n  current: null,\n  /**\n   * Gets the current lifecycle state.\n   * @this {Lifecycle & {component: Object}}\n   * @returns {string|null}\n   */\n  get state() {\n    return this.current\n  },\n  /**\n   * Sets the lifecycle state and emits hooks if the state is valid and changed.\n   * @this {Lifecycle & {component: Object}}\n   * @param {string} v - The new lifecycle state.\n   */\n  set state(v) {\n    if ((states.indexOf(v) > -1 && v !== this.current) || v === 'refocus') {\n      Log.debug(\n        `Setting lifecycle state from ${this.current} to ${v} for ${this.component.componentId}`\n      )\n      this.previous = this.current\n      this.current = v\n      if (v === 'refocus') return\n      // emit 'private' hook\n      privateEmit(v, this.component[symbols.identifier], this.component)\n      // emit 'public' hook\n      emit(v, this.component[symbols.identifier], this.component)\n      // update the built-in hasFocus state variable\n      if (v === 'focus') this.component[symbols.state].hasFocus = true\n      if (v === 'unfocus') this.component[symbols.state].hasFocus = false\n    }\n  },\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ContextSpy } from './core/lib/ContextSpy.js';\n\nexport function createWebGLContext(\n  canvas: HTMLCanvasElement | OffscreenCanvas,\n  forceWebGL2 = false,\n  contextSpy: ContextSpy | null,\n): WebGLRenderingContext {\n  const config: WebGLContextAttributes = {\n    alpha: true,\n    antialias: false,\n    depth: false,\n    stencil: true,\n    desynchronized: false,\n    // Disabled because it prevents Visual Regression Tests from working\n    // failIfMajorPerformanceCaveat: true,\n    powerPreference: 'high-performance',\n    premultipliedAlpha: true,\n    preserveDrawingBuffer: false,\n  };\n  const gl =\n    // TODO: Remove this assertion once this issue is fixed in TypeScript\n    // https://github.com/microsoft/TypeScript/issues/53614\n    (canvas.getContext(forceWebGL2 ? 'webgl2' : 'webgl', config) ||\n      canvas.getContext(\n        'experimental-webgl' as 'webgl',\n        config,\n      )) as unknown as WebGLRenderingContext | null;\n  if (!gl) {\n    throw new Error('Unable to create WebGL context');\n  }\n  if (contextSpy) {\n    // Proxy the GL context to log all GL calls\n    return new Proxy(gl, {\n      get(target, prop) {\n        const value = target[prop as never] as unknown;\n        if (typeof value === 'function') {\n          contextSpy.increment(String(prop));\n          return value.bind(target);\n        }\n        return value;\n      },\n    });\n  }\n\n  return gl;\n}\n\n/**\n * Asserts a condition is truthy, otherwise throws an error\n *\n * @remarks\n * Useful at the top of functions to ensure certain conditions, arguments and\n * properties are set/met before continuing. When using this function,\n * TypeScript will narrow away falsy types from the condition.\n *\n * @param condition\n * @param message\n * @returns\n */\nexport function assertTruthy(\n  condition: unknown,\n  message?: string,\n): asserts condition {\n  if (isProductionEnvironment) return;\n  if (!condition) {\n    throw new Error(message || 'Assertion failed');\n  }\n}\n\n/**\n * Merges two colors based on a given progress value.\n *\n * This function takes two colors (c1 and c2) represented as 32-bit integers\n * in RGBA format and blends them based on the provided progress value (p).\n * The result is a new color that is a weighted combination of the input colors,\n * where the weight is determined by the progress value.\n *\n * @param {number} c1 - The first color in RGBA format (32-bit integer).\n * @param {number} c2 - The second color in RGBA format (32-bit integer).\n * @param {number} p - The progress value between 0 and 1.\n * @returns {number} The merged color as a 32-bit integer in RGBA format.\n */\nexport function mergeColorProgress(\n  rgba1: number,\n  rgba2: number,\n  p: number,\n): number {\n  const r1 = Math.trunc(rgba1 >>> 24);\n  const g1 = Math.trunc((rgba1 >>> 16) & 0xff);\n  const b1 = Math.trunc((rgba1 >>> 8) & 0xff);\n  const a1 = Math.trunc(rgba1 & 0xff);\n\n  const r2 = Math.trunc(rgba2 >>> 24);\n  const g2 = Math.trunc((rgba2 >>> 16) & 0xff);\n  const b2 = Math.trunc((rgba2 >>> 8) & 0xff);\n  const a2 = Math.trunc(rgba2 & 0xff);\n\n  const r = Math.round(r2 * p + r1 * (1 - p));\n  const g = Math.round(g2 * p + g1 * (1 - p));\n  const b = Math.round(b2 * p + b1 * (1 - p));\n  const a = Math.round(a2 * p + a1 * (1 - p));\n\n  return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\n\n/**\n * Given an RGBA encoded number, returns back the RGBA number with it's alpha\n * component multiplied by the passed `alpha` parameter.\n *\n * @internalRemarks\n * This method does NOT premultiply the alpha into the color channels. If that\n * is required (for internal use only) use {@link mergeColorAlphaPremultiplied}\n * instead.\n *\n * @param rgba RGBA encoded number\n * @param alpha Normalized alpha value (Range: 0.0 - 1.0)\n * @returns\n */\nexport function mergeColorAlpha(rgba: number, alpha: number): number {\n  const r = rgba >>> 24;\n  const g = (rgba >>> 16) & 0xff;\n  const b = (rgba >>> 8) & 0xff;\n  const a = Math.trunc((rgba & 0xff) * alpha);\n\n  return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\n\nlet premultiplyRGB = true;\n\n/**\n * RGB components should not be premultiplied when using Canvas renderer\n * @param mode  Renderer mode\n */\nexport function setPremultiplyMode(mode: 'webgl' | 'canvas'): void {\n  premultiplyRGB = mode === 'webgl';\n}\n\n/**\n * Given an RGBA encoded number, returns back the RGBA number with it's alpha\n * component multiplied by the passed `alpha` parameter.\n *\n * For the webGl renderer, each color channel is premultiplied by the final alpha value.\n *\n * @remarks\n * If `flipEndianess` is set to true, the function will returned an ABGR encoded number\n * which is useful when the color value needs to be passed into a shader attribute.\n *\n * NOTE: Depending on the mode set by {@link setPremultiplyMode}, this method returns\n * a PREMULTIPLIED alpha color which is generally only useful in the context of the\n * internal rendering process. Use {@link mergeColorAlpha} if you need to blend an alpha\n * value into a color in the context of the Renderer's main API.\n *\n * @internalRemarks\n * Do not expose this method in the main API because Renderer users should instead use\n * {@link mergeColorAlpha} to manipulate the alpha value of a color.\n *\n * @internal\n * @param rgba RGBA encoded number\n * @param alpha Normalized alpha value (Range: 0.0 - 1.0)\n * @param flipEndianess Flip the endianess. RGBA becomes encoded as ABGR (for inserting colors into shader attributes)\n * @returns\n */\nexport function mergeColorAlphaPremultiplied(\n  rgba: number,\n  alpha: number,\n  flipEndianess = false,\n): number {\n  const newAlpha = ((rgba & 0xff) / 255) * alpha;\n  const rgbAlpha = premultiplyRGB ? newAlpha : 1;\n  const r = Math.trunc((rgba >>> 24) * rgbAlpha);\n  const g = Math.trunc(((rgba >>> 16) & 0xff) * rgbAlpha);\n  const b = Math.trunc(((rgba >>> 8) & 0xff) * rgbAlpha);\n  const a = Math.trunc(newAlpha * 255);\n\n  if (flipEndianess) {\n    return ((a << 24) | (b << 16) | (g << 8) | r) >>> 0;\n  }\n\n  return ((r << 24) | (g << 16) | (b << 8) | a) >>> 0;\n}\n\n/**\n * Returns true if the given object has the given \"own\" property.\n *\n * @param obj\n * @param prop\n * @returns\n */\nexport function hasOwn(obj: object, prop: string | number | symbol): boolean {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n/**\n * Converts degrees to radians\n *\n * @param degrees\n * @returns\n */\nexport function deg2Rad(degrees: number): number {\n  return (degrees * Math.PI) / 180;\n}\n\n/**\n * Returns image aspect ratio\n *\n * @param width\n * @param height\n * @returns\n */\nexport function getImageAspectRatio(width: number, height: number): number {\n  return width / height;\n}\n\n/**\n * Checks import.meta if env is production\n *\n * @returns\n */\ndeclare const __DEV__: boolean;\nexport const isProductionEnvironment =\n  typeof __DEV__ !== 'undefined' ? !__DEV__ : true;\n\n/**\n * Returns a new unique ID\n */\nlet nextId = 1;\nexport function getNewId(): number {\n  return nextId++;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { IEventEmitter } from './IEventEmitter.js';\n\n/**\n * EventEmitter base class\n */\nexport class EventEmitter implements IEventEmitter {\n  private eventListeners: { [eventName: string]: any } = {};\n\n  on(event: string, listener: (target: any, data: any) => void): void {\n    let listeners = this.eventListeners[event];\n    if (!listeners) {\n      listeners = [];\n    }\n    listeners.push(listener);\n    this.eventListeners[event] = listeners;\n  }\n\n  off(event: string, listener?: (target: any, data: any) => void): void {\n    const listeners = this.eventListeners[event];\n    if (!listeners) {\n      return;\n    }\n    if (!listener) {\n      delete this.eventListeners[event];\n      return;\n    }\n    const index = listeners.indexOf(listener);\n    if (index >= 0) {\n      listeners.splice(index, 1);\n    }\n  }\n\n  once(event: string, listener: (target: any, data: any) => void): void {\n    const onceListener = (target: any, data: any) => {\n      this.off(event, onceListener);\n      listener(target, data);\n    };\n    this.on(event, onceListener);\n  }\n\n  emit(event: string, data?: any): void {\n    const listeners = this.eventListeners[event];\n    if (!listeners) {\n      return;\n    }\n    [...listeners].forEach((listener) => {\n      listener(this, data);\n    });\n  }\n\n  removeAllListeners() {\n    this.eventListeners = {};\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport type { SubTextureProps } from './SubTexture.js';\nimport type { Dimensions } from '../../common/CommonTypes.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nimport type { CoreContextTexture } from '../renderers/CoreContextTexture.js';\nimport type { TextureError } from '../TextureError.js';\n\n/**\n * Event handler for when a Texture is freed\n */\nexport type TextureFreedEventHandler = (target: any) => void;\n\n/**\n * Event handler for when a Texture is loading\n */\nexport type TextureLoadingEventHandler = (target: any) => void;\n\n/**\n * Event handler for when a Texture is loaded\n */\nexport type TextureLoadedEventHandler = (\n  target: any,\n  dimensions: Readonly<Dimensions>,\n) => void;\n\n/**\n * Represents compressed texture data.\n */\nexport interface CompressedData {\n  /**\n   * GLenum spcifying compression format\n   */\n  glInternalFormat: number;\n\n  /**\n   * All mipmap levels\n   */\n  mipmaps: ArrayBuffer[];\n\n  /**\n   * Supported container types ('pvr', 'ktx', 'astc').\n   */\n  type: 'pvr' | 'ktx' | 'astc';\n\n  /**\n   * The width of the compressed texture in pixels. Defaults to 0.\n   *\n   * @default 0\n   */\n  width: number;\n\n  /**\n   * The height of the compressed texture in pixels.\n   **/\n  height: number;\n\n  /**\n   * block info\n   */\n  blockInfo: {\n    width: number;\n    height: number;\n    bytes: number;\n  };\n}\n\n/**\n * Event handler for when a Texture fails to load\n */\nexport type TextureFailedEventHandler = (target: any, error: Error) => void;\n\n/**\n * TextureData that is used to populate a CoreContextTexture\n */\nexport interface TextureData {\n  /**\n   * The texture data\n   */\n  data:\n    | ImageBitmap\n    | ImageData\n    | SubTextureProps\n    | CompressedData\n    | HTMLImageElement\n    | Uint8Array\n    | null;\n  /**\n   * Premultiply alpha when uploading texture data to the GPU\n   *\n   * @defaultValue `false`\n   */\n  premultiplyAlpha?: boolean | null;\n}\n\nexport type TextureState =\n  | 'initial' // Before anything is loaded\n  | 'loading' // Loading texture data and uploading to GPU\n  | 'loaded' // Fully loaded and usable\n  | 'failed' // Failed to load\n  | 'freed'; // Released and must be reloaded\n\nexport enum TextureType {\n  'generic' = 0,\n  'color' = 1,\n  'image' = 2,\n  'noise' = 3,\n  'renderToTexture' = 4,\n  'subTexture' = 5,\n}\n\n/**\n * Represents a source of texture data for a CoreContextTexture.\n *\n * @remarks\n * Texture sources are used to populate a CoreContextTexture when that texture\n * is loaded. Texture data retrieved by the CoreContextTexture by the\n * `getTextureData` method. It's the responsibility of the concerete `Texture`\n * subclass to implement this method appropriately.\n */\nexport abstract class Texture extends EventEmitter {\n  /**\n   * The dimensions of the texture\n   *\n   * @remarks\n   * Until the texture data is loaded for the first time the value will be\n   * `null`.\n   */\n  private _dimensions: Dimensions | null = null;\n  private _error: TextureError | null = null;\n\n  // aggregate state\n  public state: TextureState = 'initial';\n\n  readonly renderableOwners: any[] = [];\n\n  readonly renderable: boolean = false;\n\n  public type: TextureType = TextureType.generic;\n\n  public preventCleanup = false;\n\n  public ctxTexture: CoreContextTexture | undefined;\n\n  public textureData: TextureData | null = null;\n\n  /**\n   * Memory used by this texture in bytes\n   *\n   * @remarks\n   * This is tracked by the TextureMemoryManager and updated when the texture\n   * is loaded/freed. Set to 0 when texture is not loaded.\n   */\n  public memUsed = 0;\n\n  public retryCount = 0;\n  public maxRetryCount: number;\n\n  /**\n   * Timestamp when texture was created (for startup grace period)\n   */\n  private createdAt: number = Date.now();\n\n  /**\n   * Flag to track if grace period has expired to avoid repeated Date.now() calls\n   */\n  private gracePeriodExpired: boolean = false;\n\n  /**\n   * Grace period in milliseconds to prevent premature cleanup during app startup\n   * This helps prevent race conditions when bounds calculation is delayed\n   */\n  private static readonly STARTUP_GRACE_PERIOD = 2000; // 2 seconds\n\n  constructor(protected txManager: CoreTextureManager) {\n    super();\n    this.maxRetryCount = txManager.maxRetryCount;\n  }\n\n  get dimensions(): Dimensions | null {\n    return this._dimensions;\n  }\n\n  get error(): TextureError | null {\n    return this._error;\n  }\n\n  /**\n   * Checks if the texture is within the startup grace period.\n   * During this period, textures are protected from cleanup to prevent\n   * race conditions during app initialization.\n   */\n  isWithinStartupGracePeriod(): boolean {\n    // If grace period already expired, return false immediately\n    if (this.gracePeriodExpired) {\n      return false;\n    }\n\n    // Check if grace period has expired now\n    const hasExpired =\n      Date.now() - this.createdAt >= Texture.STARTUP_GRACE_PERIOD;\n\n    if (hasExpired) {\n      // Cache the result to avoid future Date.now() calls\n      this.gracePeriodExpired = true;\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Checks if the texture can be safely cleaned up.\n   * Considers the renderable state, startup grace period, and renderable owners.\n   */\n  canBeCleanedUp(): boolean {\n    // Never cleanup if explicitly prevented\n    if (this.preventCleanup) {\n      return false;\n    }\n\n    // Don't cleanup if still within startup grace period\n    if (this.isWithinStartupGracePeriod()) {\n      return false;\n    }\n\n    // Don't cleanup if not renderable\n    if (this.renderable === true) {\n      return false;\n    }\n\n    // Don't cleanup if there are still renderable owners\n    if (this.renderableOwners.length > 0) {\n      return false;\n    }\n\n    // Safe to cleanup\n    return true;\n  }\n\n  /**\n   * Add/remove an owner to/from the Texture based on its renderability.\n   *\n   * @remarks\n   * Any object can own a texture, be it a CoreNode or even the state object\n   * from a Text Renderer.\n   *\n   * When the reference to the texture that an owner object holds is replaced\n   * or cleared it must call this with `renderable=false` to release the owner\n   * association.\n   *\n   * @param owner\n   * @param renderable\n   */\n  setRenderableOwner(owner: string | number, renderable: boolean): void {\n    const oldSize = this.renderableOwners.length;\n    const hasOwnerIndex = this.renderableOwners.indexOf(owner);\n\n    if (renderable === true) {\n      if (hasOwnerIndex === -1) {\n        // Add the owner to the set\n        this.renderableOwners.push(owner);\n      }\n\n      const newSize = this.renderableOwners.length;\n      if (oldSize !== newSize && newSize === 1) {\n        (this.renderable as boolean) = true;\n        this.onChangeIsRenderable?.(true);\n        this.load();\n      }\n    } else {\n      if (hasOwnerIndex !== -1) {\n        this.renderableOwners.splice(hasOwnerIndex, 1);\n      }\n\n      const newSize = this.renderableOwners.length;\n      if (oldSize !== newSize && newSize === 0) {\n        (this.renderable as boolean) = false;\n        this.onChangeIsRenderable?.(false);\n\n        // note, not doing a cleanup here, cleanup is managed by the Stage/TextureMemoryManager\n        // when it deems appropriate based on memory pressure\n      }\n    }\n  }\n\n  load(): void {\n    if (this.retryCount > this.maxRetryCount) {\n      // We've exceeded the max retry count, do not attempt to load again\n      return;\n    }\n    this.txManager.loadTexture(this);\n  }\n\n  /**\n   * Event called when the Texture becomes renderable or unrenderable.\n   *\n   * @remarks\n   * Used by subclasses like SubTexture propogate then renderability of the\n   * Texture to other referenced Textures.\n   *\n   * @param isRenderable `true` if this Texture has renderable owners.\n   */\n  onChangeIsRenderable?(isRenderable: boolean): void;\n\n  /**\n   * Load the core context texture for this Texture.\n   * The ctxTexture is created by the renderer and lives on the GPU.\n   *\n   * @returns\n   */\n  loadCtxTexture(): CoreContextTexture {\n    if (this.ctxTexture === undefined) {\n      this.ctxTexture = this.txManager.renderer.createCtxTexture(this);\n    }\n\n    return this.ctxTexture;\n  }\n\n  /**\n   * Free the core context texture for this Texture.\n   *\n   * @remarks\n   * The ctxTexture is created by the renderer and lives on the GPU.\n   */\n  free(): void {\n    this.ctxTexture?.free();\n  }\n\n  /**\n   * Release the texture data and core context texture for this Texture without changing state.\n   *\n   * @remarks\n   * The ctxTexture is created by the renderer and lives on the GPU.\n   */\n  release(): void {\n    this.ctxTexture?.release();\n    this.ctxTexture = undefined;\n    this.freeTextureData();\n  }\n\n  /**\n   * Destroy the texture.\n   *\n   * @remarks\n   * This method is called when the texture is no longer needed and should be\n   * cleaned up.\n   */\n  destroy(): void {\n    // Only free GPU resources if we're in a state where they exist\n    if (this.state === 'loaded') {\n      this.free();\n    }\n\n    // Always free texture data regardless of state\n    this.freeTextureData();\n  }\n\n  /**\n   * Free the source texture data for this Texture.\n   *\n   * @remarks\n   * The texture data is the source data that is used to populate the CoreContextTexture.\n   * e.g. ImageData that is downloaded from a URL.\n   */\n  freeTextureData(): void {\n    queueMicrotask(() => {\n      this.textureData = null;\n    });\n  }\n\n  public setState(\n    state: TextureState,\n    errorOrDimensions?: Error | Dimensions,\n  ): void {\n    if (this.state === state) {\n      return;\n    }\n    let payload: Error | Dimensions | null = null;\n    if (state === 'loaded') {\n      // Clear any previous error when successfully loading\n      this._error = null;\n\n      if (\n        errorOrDimensions !== undefined &&\n        'width' in errorOrDimensions === true &&\n        'height' in errorOrDimensions === true &&\n        errorOrDimensions.width !== undefined &&\n        errorOrDimensions.height !== undefined\n      ) {\n        this._dimensions = errorOrDimensions;\n      }\n\n      payload = this._dimensions;\n    } else if (state === 'failed') {\n      this._error = errorOrDimensions as Error;\n      payload = this._error;\n\n      // increment the retry count for the texture\n      // this is used to compare against maxRetryCount, if set\n      // to determine if we should try loading again\n      this.retryCount += 1;\n\n      queueMicrotask(() => {\n        this.release();\n      });\n    } else if (state === 'loading') {\n      // Clear error and reset dimensions when starting to load\n      // This ensures stale dimensions from previous loads don't persist\n      this._error = null;\n      this._dimensions = null;\n    } else {\n      this._error = null;\n    }\n\n    // emit the new state\n    this.state = state;\n    this.emit(state, payload);\n  }\n\n  /**\n   * Get the texture data for this texture.\n   *\n   * @remarks\n   * This method is called by the CoreContextTexture when the texture is loaded.\n   * The texture data is then used to populate the CoreContextTexture.\n   *\n   * @returns\n   * The texture data for this texture.\n   */\n  async getTextureData(): Promise<TextureData> {\n    if (this.textureData === null) {\n      this.textureData = await this.getTextureSource();\n    }\n\n    return this.textureData;\n  }\n\n  /**\n   * Get the texture source for this texture.\n   *\n   * @remarks\n   * This method is called by the CoreContextTexture when the texture is loaded.\n   * The texture source is then used to populate the CoreContextTexture.\n   */\n  abstract getTextureSource(): Promise<TextureData>;\n\n  /**\n   * Make a cache key for this texture.\n   *\n   * @remarks\n   * Each concrete `Texture` subclass must implement this method to provide an\n   * appropriate cache key for the texture type including the texture's\n   * properties that uniquely identify a copy of the texture. If the texture\n   * type does not support caching, then this method should return `false`.\n   *\n   * @param props\n   * @returns\n   * A cache key for this texture or `false` if the texture type does not\n   * support caching.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static makeCacheKey(props: unknown): string | false {\n    return false;\n  }\n\n  /**\n   * Resolve the default values for the texture's properties.\n   *\n   * @remarks\n   * Each concrete `Texture` subclass must implement this method to provide\n   * default values for the texture's optional properties.\n   *\n   * @param props\n   * @returns\n   * The default values for the texture's properties.\n   */\n  static resolveDefaults(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    props: unknown,\n  ): Record<string, unknown> {\n    return {};\n  }\n\n  /**\n   * Retry the texture by resetting retryCount and setting state to 'initial'.\n   *\n   * @remarks\n   * This allows the texture to be loaded again.\n   */\n  public retry(): void {\n    this.release();\n    this.retryCount = 0;\n    this.load();\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PROTOCOL_REGEX = /^(data|ftps?|https?):/;\n\nexport type RGBA = [r: number, g: number, b: number, a: number];\n\nexport const getNormalizedRgbaComponents = (rgba: number): RGBA => {\n  const r = rgba >>> 24;\n  const g = (rgba >>> 16) & 0xff;\n  const b = (rgba >>> 8) & 0xff;\n  const a = rgba & 0xff;\n  return [r / 255, g / 255, b / 255, a / 255];\n};\n\nexport const getRgbaComponents = (rgba: number): RGBA => {\n  const r = rgba >>> 24;\n  const g = (rgba >>> 16) & 0xff;\n  const b = (rgba >>> 8) & 0xff;\n  const a = rgba & 0xff;\n  return [r, g, b, a];\n};\n\nexport const norm = (rgba: number): number => {\n  const r = rgba >>> 24;\n  const g = (rgba >>> 16) & 0xff;\n  const b = (rgba >>> 8) & 0xff;\n  const a = rgba & 0xff;\n  const rgbaArr: RGBA = [r / 255, g / 255, b / 255, a / 255];\n\n  rgbaArr[0] = Math.max(0, Math.min(255, rgbaArr[0]));\n  rgbaArr[1] = Math.max(0, Math.min(255, rgbaArr[1]));\n  rgbaArr[2] = Math.max(0, Math.min(255, rgbaArr[2]));\n  rgbaArr[3] = Math.max(0, Math.min(255, rgbaArr[3]));\n  let v =\n    ((rgbaArr[3] | 0) << 24) +\n    ((rgbaArr[0] | 0) << 16) +\n    ((rgbaArr[1] | 0) << 8) +\n    (rgbaArr[2] | 0);\n  if (v < 0) {\n    v = 0xffffffff + v + 1;\n  }\n  return v;\n};\n\nexport function getNormalizedAlphaComponent(rgba: number): number {\n  return (rgba & 0xff) / 255.0;\n}\n\n/**\n * Get a CSS color string from a RGBA color\n *\n * @param color\n * @returns\n */\nexport function getRgbaString(color: RGBA) {\n  const r = Math.floor(color[0] * 255.0);\n  const g = Math.floor(color[1] * 255.0);\n  const b = Math.floor(color[2] * 255.0);\n  const a = Math.floor(color[3] * 255.0);\n  return `rgba(${r},${g},${b},${a.toFixed(4)})`;\n}\n\nexport interface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface RectWithValid extends Rect {\n  valid: boolean;\n}\n\nexport interface Bound {\n  x1: number;\n  y1: number;\n  x2: number;\n  y2: number;\n}\n\nexport interface BoundWithValid extends Bound {\n  valid: boolean;\n}\n\nexport function createBound<T extends Bound = Bound>(\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  out?: T,\n): T {\n  if (out) {\n    out.x1 = x1;\n    out.y1 = y1;\n    out.x2 = x2;\n    out.y2 = y2;\n    return out;\n  }\n  return {\n    x1,\n    y1,\n    x2,\n    y2,\n  } as T;\n}\n\nexport function intersectBound<T extends Bound = Bound>(\n  a: Bound,\n  b: Bound,\n  out?: T,\n): T {\n  const intersection = createBound(\n    Math.max(a.x1, b.x1),\n    Math.max(a.y1, b.y1),\n    Math.min(a.x2, b.x2),\n    Math.min(a.y2, b.y2),\n    out,\n  );\n  if (intersection.x1 < intersection.x2 && intersection.y1 < intersection.y2) {\n    return intersection;\n  }\n  return createBound(0, 0, 0, 0, intersection);\n}\n\nexport function boundsOverlap(a: Bound, b: Bound): boolean {\n  return a.x1 < b.x2 && a.x2 > b.x1 && a.y1 < b.y2 && a.y2 > b.y1;\n}\n\nexport function convertBoundToRect(bound: Bound): Rect;\nexport function convertBoundToRect<T extends Rect = Rect>(\n  bound: Bound,\n  out: T,\n): T;\nexport function convertBoundToRect(bound: Bound, out?: Rect): Rect {\n  if (out) {\n    out.x = bound.x1;\n    out.y = bound.y1;\n    out.width = bound.x2 - bound.x1;\n    out.height = bound.y2 - bound.y1;\n    return out;\n  }\n  return {\n    x: bound.x1,\n    y: bound.y1,\n    width: bound.x2 - bound.x1,\n    height: bound.y2 - bound.y1,\n  };\n}\n\nexport function intersectRect(a: Rect, b: Rect): Rect;\nexport function intersectRect<T extends Rect = Rect>(\n  a: Rect,\n  b: Rect,\n  out: T,\n): T;\nexport function intersectRect(a: Rect, b: Rect, out?: Rect): Rect {\n  const x = Math.max(a.x, b.x);\n  const y = Math.max(a.y, b.y);\n  const width = Math.min(a.x + a.width, b.x + b.width) - x;\n  const height = Math.min(a.y + a.height, b.y + b.height) - y;\n  if (width > 0 && height > 0) {\n    if (out) {\n      out.x = x;\n      out.y = y;\n      out.width = width;\n      out.height = height;\n      return out;\n    }\n    return {\n      x,\n      y,\n      width,\n      height,\n    };\n  }\n  if (out) {\n    out.x = 0;\n    out.y = 0;\n    out.width = 0;\n    out.height = 0;\n    return out;\n  }\n  return {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n  };\n}\n\nexport function copyRect(a: Rect): Rect;\nexport function copyRect<T extends Rect = Rect>(a: Rect, out: T): T;\nexport function copyRect(a: Rect, out?: Rect): Rect {\n  if (out) {\n    out.x = a.x;\n    out.y = a.y;\n    out.width = a.width;\n    out.height = a.height;\n    return out;\n  }\n  return {\n    x: a.x,\n    y: a.y,\n    width: a.width,\n    height: a.height,\n  };\n}\n\nexport function compareRect(a: Rect | null, b: Rect | null): boolean {\n  if (a === b) {\n    return true;\n  }\n  if (a === null || b === null) {\n    return false;\n  }\n  return (\n    a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height\n  );\n}\n\nexport function boundInsideBound(bound1: Bound, bound2: Bound) {\n  return (\n    bound1.x1 <= bound2.x2 &&\n    bound1.y1 <= bound2.y2 &&\n    bound1.x2 >= bound2.x1 &&\n    bound1.y2 >= bound2.y1\n  );\n}\n\nexport function boundLargeThanBound(bound1: Bound, bound2: Bound) {\n  return (\n    bound1.x1 < bound2.x1 &&\n    bound1.x2 > bound2.x2 &&\n    bound1.y1 < bound2.y1 &&\n    bound1.y2 > bound2.y2\n  );\n}\n\nexport function pointInBound(x: number, y: number, bound: Bound) {\n  return !(x < bound.x1 || x > bound.x2 || y < bound.y1 || y > bound.y2);\n}\n\nexport function isBoundPositive(bound: Bound): boolean {\n  return bound.x1 < bound.x2 && bound.y1 < bound.y2;\n}\n\nexport function isRectPositive(rect: Rect): boolean {\n  return rect.width > 0 && rect.height > 0;\n}\n\n/**\n * Create a preload bounds from a strict bound\n *\n * @param strictBound The strict boundary of the node\n * @param boundsMargin Boundary margin to apply to the strictBound\n * @returns\n */\nexport function createPreloadBounds(\n  strictBound: Bound,\n  boundsMargin: [number, number, number, number],\n): Bound {\n  return createBound(\n    strictBound.x1 - boundsMargin[3],\n    strictBound.y1 - boundsMargin[0],\n    strictBound.x2 + boundsMargin[1],\n    strictBound.y2 + boundsMargin[2],\n  );\n}\n\nexport function convertUrlToAbsolute(url: string): string {\n  // handle local file imports if the url isn't remote resource or data blob\n  if (self.location.protocol === 'file:' && !PROTOCOL_REGEX.test(url)) {\n    const path = self.location.pathname.split('/');\n    path.pop();\n    const basePath = path.join('/');\n    const baseUrl = self.location.protocol + '//' + basePath;\n\n    // check if url has a leading dot\n    if (url.charAt(0) === '.') {\n      url = url.slice(1);\n    }\n\n    // check if url has a leading slash\n    if (url.charAt(0) === '/') {\n      url = url.slice(1);\n    }\n\n    return baseUrl + '/' + url;\n  }\n\n  const absoluteUrl = new URL(url, self.location.href);\n  return absoluteUrl.href;\n}\n\nexport function isBase64Image(src: string) {\n  return src.startsWith('data:') === true;\n}\n\nexport function calcFactoredRadius(\n  radius: number,\n  width: number,\n  height: number,\n): number {\n  return radius * Math.min(Math.min(width, height) / (2.0 * radius), 1);\n}\n\nexport function valuesAreEqual(values: number[]) {\n  let prevValue = values[0];\n  for (let i = 1; i < values.length; i++) {\n    if (prevValue !== values[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function calcFactoredRadiusArray(\n  radius: [number, number, number, number],\n  width: number,\n  height: number,\n): [number, number, number, number] {\n  const result: [number, number, number, number] = [\n    radius[0],\n    radius[1],\n    radius[2],\n    radius[3],\n  ];\n  const factor = Math.min(\n    Math.min(\n      Math.min(\n        width / Math.max(width, radius[0] + radius[1]),\n        width / Math.max(width, radius[2] + radius[3]),\n      ),\n      Math.min(\n        height / Math.max(height, radius[0] + radius[3]),\n        height / Math.max(height, radius[1] + radius[2]),\n      ),\n    ),\n    1,\n  );\n  result[0] *= factor;\n  result[1] *= factor;\n  result[2] *= factor;\n  result[3] *= factor;\n  return result;\n}\n\nexport function dataURIToBlob(dataURI: string): Blob {\n  dataURI = dataURI.replace(/^data:/, '');\n\n  const type = dataURI.match(/image\\/[^;]+/)?.[0] || '';\n  const base64 = dataURI.replace(/^[^,]+,/, '');\n\n  const sliceSize = 1024;\n  const byteCharacters = atob(base64);\n  const bytesLength = byteCharacters.length;\n  const slicesCount = Math.ceil(bytesLength / sliceSize);\n  const byteArrays = new Array(slicesCount);\n\n  for (let sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n    const begin = sliceIndex * sliceSize;\n    const end = Math.min(begin + sliceSize, bytesLength);\n\n    const bytes = new Array(end - begin);\n    for (let offset = begin, i = 0; offset < end; ++i, ++offset) {\n      bytes[i] = byteCharacters[offset]?.charCodeAt(0);\n    }\n    byteArrays[sliceIndex] = new Uint8Array(bytes);\n  }\n  return new Blob(byteArrays, { type });\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A 3D matrix representing a 2D graphics transformation\n *\n * @remarks\n * For convenience, entries in the first two rows can be accessed by the following\n * properties:\n * | ta tb tx |\n * | tc td ty |\n * | 0  0  1  |\n *\n * This matrix is optimized for 2D transformations and hence the last row will\n * always be considered [0, 0 ,1].\n *\n * To access a column major array for WebGL, use the {@link getFloatArr} method.\n */\nexport class Matrix3d {\n  public ta: number;\n  public tb: number;\n  public tx: number;\n  public tc: number;\n  public td: number;\n  public ty: number;\n  private _floatArr: Float32Array | null = null;\n  /**\n   * Potential Mutation Flag\n   *\n   * @remarks\n   * This flag is set to true whenever the matrix is potentially modified.\n   * We don't waste CPU trying to identify if each operation actually modifies\n   * the matrix. Instead, we set this flag to true whenever we think the matrix\n   * is modified. This signals that the `floatArr` should to be updated.\n   */\n  private mutation: boolean;\n\n  /**\n   * Creates a new 3x3 matrix.\n   *\n   * @param entries Row-major 3x3 matrix\n   */\n  public constructor() {\n    this.ta = 0;\n    this.tb = 0;\n    this.tx = 0;\n    this.tc = 0;\n    this.td = 0;\n    this.ty = 0;\n    this.mutation = true;\n  }\n\n  /**\n   * Returns a temporary matrix that can be used for calculations.\n   *\n   * @remarks\n   * This is useful for avoiding allocations in tight loops.\n   *\n   * The matrix is not guaranteed to be the same between calls.\n   *\n   * @returns\n   */\n  public static get temp(): Matrix3d {\n    return tempMatrix;\n  }\n\n  public static multiply(a: Matrix3d, b: Matrix3d, out?: Matrix3d): Matrix3d {\n    const e0 = a.ta * b.ta + a.tb * b.tc;\n    const e1 = a.ta * b.tb + a.tb * b.td;\n    const e2 = a.ta * b.tx + a.tb * b.ty + a.tx;\n    const e3 = a.tc * b.ta + a.td * b.tc;\n    const e4 = a.tc * b.tb + a.td * b.td;\n    const e5 = a.tc * b.tx + a.td * b.ty + a.ty;\n    if (!out) {\n      out = new Matrix3d();\n    }\n    out.ta = e0;\n    out.tb = e1;\n    out.tx = e2;\n    out.tc = e3;\n    out.td = e4;\n    out.ty = e5;\n    out.mutation = true;\n    return out;\n  }\n\n  public static identity(out?: Matrix3d): Matrix3d {\n    if (!out) {\n      out = new Matrix3d();\n    }\n    out.ta = 1;\n    out.tb = 0;\n    out.tx = 0;\n    out.tc = 0;\n    out.td = 1;\n    out.ty = 0;\n    out.mutation = true;\n    return out;\n  }\n\n  public static translate(x: number, y: number, out?: Matrix3d): Matrix3d {\n    if (!out) {\n      out = new Matrix3d();\n    }\n    out.ta = 1;\n    out.tb = 0;\n    out.tx = x;\n    out.tc = 0;\n    out.td = 1;\n    out.ty = y;\n    out.mutation = true;\n    return out;\n  }\n\n  public static scale(sx: number, sy: number, out?: Matrix3d): Matrix3d {\n    if (!out) {\n      out = new Matrix3d();\n    }\n    out.ta = sx;\n    out.tb = 0;\n    out.tx = 0;\n    out.tc = 0;\n    out.td = sy;\n    out.ty = 0;\n    out.mutation = true;\n    return out;\n  }\n\n  public static rotate(angle: number, out?: Matrix3d): Matrix3d {\n    const cos = Math.cos(angle);\n    const sin = Math.sin(angle);\n    if (!out) {\n      out = new Matrix3d();\n    }\n    out.ta = cos;\n    out.tb = -sin;\n    out.tx = 0;\n    out.tc = sin;\n    out.td = cos;\n    out.ty = 0;\n    out.mutation = true;\n    return out;\n  }\n\n  public static copy(src: Matrix3d, dst?: Matrix3d): Matrix3d {\n    if (!dst) {\n      dst = new Matrix3d();\n    }\n    dst.ta = src.ta;\n    dst.tc = src.tc;\n    dst.tb = src.tb;\n    dst.td = src.td;\n    dst.tx = src.tx;\n    dst.ty = src.ty;\n    dst.mutation = true;\n    return dst;\n  }\n\n  public translate(x: number, y: number): Matrix3d {\n    this.tx = this.ta * x + this.tb * y + this.tx;\n    this.ty = this.tc * x + this.td * y + this.ty;\n    this.mutation = true;\n    return this;\n  }\n\n  public scale(sx: number, sy: number): Matrix3d {\n    this.ta = this.ta * sx;\n    this.tb = this.tb * sy;\n    this.tc = this.tc * sx;\n    this.td = this.td * sy;\n    this.mutation = true;\n    return this;\n  }\n\n  public rotate(angle: number): Matrix3d {\n    if (angle === 0 || !((angle % Math.PI) * 2)) {\n      return this;\n    }\n    const cos = Math.cos(angle);\n    const sin = Math.sin(angle);\n    const e0 = this.ta * cos + this.tb * sin;\n    const e1 = this.tb * cos - this.ta * sin;\n    const e3 = this.tc * cos + this.td * sin;\n    const e4 = this.td * cos - this.tc * sin;\n    this.ta = e0;\n    this.tb = e1;\n    this.tc = e3;\n    this.td = e4;\n    this.mutation = true;\n    return this;\n  }\n\n  public multiply(other: Matrix3d): Matrix3d {\n    return Matrix3d.multiply(this, other, this);\n  }\n\n  /**\n   * Returns the matrix as a Float32Array in column-major order.\n   *\n   * @remarks\n   * This method is optimized to avoid unnecessary allocations. The same array\n   * is returned every time this method is called, and is updated in place.\n   *\n   * WARNING: Use the array only for passing directly to a WebGL shader uniform\n   * during a frame render. Do not modify or hold onto the array for longer than\n   * a frame.\n   */\n  getFloatArr(): Float32Array {\n    if (!this._floatArr) {\n      this._floatArr = new Float32Array(9);\n    }\n    if (this.mutation) {\n      this._floatArr[0] = this.ta;\n      this._floatArr[1] = this.tc;\n      this._floatArr[2] = 0;\n      this._floatArr[3] = this.tb;\n      this._floatArr[4] = this.td;\n      this._floatArr[5] = 0;\n      this._floatArr[6] = this.tx;\n      this._floatArr[7] = this.ty;\n      this._floatArr[8] = 1;\n      this.mutation = false;\n    }\n    return this._floatArr;\n  }\n}\n\nconst tempMatrix = new Matrix3d();\n", "const rx1 = 0;\nconst rx2 = 2;\nconst rx3 = 4;\nconst rx4 = 6;\nconst ry1 = 1;\nconst ry2 = 3;\nconst ry3 = 5;\nconst ry4 = 7;\n\nexport class RenderCoords {\n  public data: Float32Array;\n  constructor(\n    entries?:\n      | [number, number, number, number, number, number, number, number]\n      | Float32Array,\n  ) {\n    this.data = new Float32Array(8);\n    if (entries) {\n      this.data[rx1] = entries[rx1];\n      this.data[rx2] = entries[rx2];\n      this.data[rx3] = entries[rx3];\n      this.data[rx4] = entries[rx4];\n      this.data[ry1] = entries[ry1];\n      this.data[ry2] = entries[ry2];\n      this.data[ry3] = entries[ry3];\n      this.data[ry4] = entries[ry4];\n    }\n  }\n\n  public static translate(\n    x1: number,\n    y1: number,\n    x2: number,\n    y2: number,\n    x3: number,\n    y3: number,\n    x4: number,\n    y4: number,\n    out?: RenderCoords,\n  ): RenderCoords {\n    if (!out) {\n      out = new RenderCoords();\n    }\n    out.data[rx1] = x1;\n    out.data[rx2] = x2;\n    out.data[rx3] = x3;\n    out.data[rx4] = x4;\n    out.data[ry1] = y1;\n    out.data[ry2] = y2;\n    out.data[ry3] = y3;\n    out.data[ry4] = y4;\n    return out;\n  }\n\n  get x1(): number {\n    return this.data[rx1]!;\n  }\n\n  get x2(): number {\n    return this.data[rx2]!;\n  }\n\n  get x3(): number {\n    return this.data[rx3]!;\n  }\n\n  get x4(): number {\n    return this.data[rx4]!;\n  }\n\n  get y1(): number {\n    return this.data[ry1]!;\n  }\n\n  get y2(): number {\n    return this.data[ry2]!;\n  }\n\n  get y3(): number {\n    return this.data[ry3]!;\n  }\n\n  get y4(): number {\n    return this.data[ry4]!;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Core Utility Functions\n *\n * @module\n */\n\nexport const EPSILON = 0.000001;\nexport let ARRAY_TYPE =\n  typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport const RANDOM = Math.random;\nexport const ANGLE_ORDER = 'zyx';\nconst degree = Math.PI / 180;\n\nexport const setMatrixArrayType = (\n  type: Float32ArrayConstructor | ArrayConstructor,\n) => {\n  ARRAY_TYPE = type;\n};\n\nexport const toRadian = (a: number) => {\n  return a * degree;\n};\n\nexport const equals = (a: number, b: number) => {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n};\n\nexport const rand = (min: number, max: number) => {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n};\n\nexport const isPowerOfTwo = (value: number) => {\n  return value && !(value & (value - 1));\n};\n\nconst getTimingBezier = (\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n): ((time: number) => number | undefined) => {\n  const xc = 3.0 * a;\n  const xb = 3.0 * (c - a) - xc;\n  const xa = 1.0 - xc - xb;\n  const yc = 3.0 * b;\n  const yb = 3.0 * (d - b) - yc;\n  const ya = 1.0 - yc - yb;\n\n  return function (time: number): number | undefined {\n    if (time >= 1.0) {\n      return 1;\n    }\n    if (time <= 0) {\n      return 0;\n    }\n\n    let t = 0.5,\n      cbx,\n      cbxd,\n      dx;\n\n    for (let it = 0; it < 20; it++) {\n      cbx = t * (t * (t * xa + xb) + xc);\n      dx = time - cbx;\n      if (dx > -1e-8 && dx < 1e-8) {\n        return t * (t * (t * ya + yb) + yc);\n      }\n\n      // Cubic bezier derivative.\n      cbxd = t * (t * (3 * xa) + 2 * xb) + xc;\n\n      if (cbxd > 1e-10 && cbxd < 1e-10) {\n        // Problematic. Fall back to binary search method.\n        break;\n      }\n\n      t += dx / cbxd;\n    }\n\n    // Fallback: binary search method. This is more reliable when there are near-0 slopes.\n    let minT = 0;\n    let maxT = 1;\n    for (let it = 0; it < 20; it++) {\n      t = 0.5 * (minT + maxT);\n\n      cbx = t * (t * (t * xa + xb) + xc);\n\n      dx = time - cbx;\n      if (dx > -1e-8 && dx < 1e-8) {\n        // Solution found!\n        return t * (t * (t * ya + yb) + yc);\n      }\n\n      if (dx < 0) {\n        maxT = t;\n      } else {\n        minT = t;\n      }\n    }\n  };\n};\n\ninterface TimingFunctionMap {\n  [key: string]: (time: number) => number | undefined;\n}\n\ntype TimingLookupArray = number[];\ninterface TimingLookup {\n  [key: string]: TimingLookupArray;\n}\n\nconst timingMapping: TimingFunctionMap = {};\n\nconst timingLookup: TimingLookup = {\n  ease: [0.25, 0.1, 0.25, 1.0],\n  'ease-in': [0.42, 0, 1.0, 1.0],\n  'ease-out': [0, 0, 0.58, 1.0],\n  'ease-in-out': [0.42, 0, 0.58, 1.0],\n  'ease-in-sine': [0.12, 0, 0.39, 0],\n  'ease-out-sine': [0.12, 0, 0.39, 0],\n  'ease-in-out-sine': [0.37, 0, 0.63, 1],\n  'ease-in-cubic': [0.32, 0, 0.67, 0],\n  'ease-out-cubic': [0.33, 1, 0.68, 1],\n  'ease-in-out-cubic': [0.65, 0, 0.35, 1],\n  'ease-in-circ': [0.55, 0, 1, 0.45],\n  'ease-out-circ': [0, 0.55, 0.45, 1],\n  'ease-in-out-circ': [0.85, 0, 0.15, 1],\n  'ease-in-back': [0.36, 0, 0.66, -0.56],\n  'ease-out-back': [0.34, 1.56, 0.64, 1],\n  'ease-in-out-back': [0.68, -0.6, 0.32, 1.6],\n};\n\nconst defaultTiming = (t: number): number => t;\n\nconst parseCubicBezier = (str: string) => {\n  //cubic-bezier(0.84, 0.52, 0.56, 0.6)\n  const regex = /-?\\d*\\.?\\d+/g;\n  const match = str.match(regex);\n\n  if (match) {\n    const [num1, num2, num3, num4] = match;\n    const a = parseFloat(num1 || '0.42');\n    const b = parseFloat(num2 || '0');\n    const c = parseFloat(num3 || '1');\n    const d = parseFloat(num4 || '1');\n\n    const timing = getTimingBezier(a, b, c, d);\n    timingMapping[str] = timing;\n\n    return timing;\n  }\n\n  // parse failed, return linear\n  console.warn('Unknown cubic-bezier timing: ' + str);\n  return defaultTiming;\n};\n\nexport const getTimingFunction = (\n  str: string,\n): ((time: number) => number | undefined) => {\n  if (str === 'linear') {\n    return defaultTiming;\n  }\n\n  if (timingMapping[str] !== undefined) {\n    return timingMapping[str] || defaultTiming;\n  }\n\n  if (str === 'step-start') {\n    return () => {\n      return 1;\n    };\n  }\n\n  if (str === 'step-end') {\n    return (time: number) => {\n      return time === 1 ? 1 : 0;\n    };\n  }\n\n  const lookup = timingLookup[str];\n  if (lookup !== undefined) {\n    const [a, b, c, d] = lookup;\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore - TS doesn't understand that we've checked for undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    const timing = getTimingBezier(a, b, c, d);\n    timingMapping[str] = timing;\n    return timing;\n  }\n\n  if (str.startsWith('cubic-bezier')) {\n    return parseCubicBezier(str);\n  }\n\n  console.warn('Unknown timing function: ' + str);\n  return defaultTiming;\n};\n\n/**\n * Convert bytes to string of megabytes with 2 decimal points\n *\n * @param bytes\n * @returns\n */\nexport function bytesToMb(bytes: number) {\n  return (bytes / 1024 / 1024).toFixed(2);\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type CoreNode, type CoreNodeAnimateProps } from '../CoreNode.js';\nimport { getTimingFunction } from '../utils.js';\nimport { mergeColorProgress } from '../../utils.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\n\nexport interface AnimationSettings {\n  duration: number;\n  delay: number;\n  easing: string;\n  loop: boolean;\n  repeat: number;\n  repeatDelay: number;\n  stopMethod: 'reverse' | 'reset' | false;\n}\n\ntype PropValues = {\n  start: number;\n  target: number;\n};\ntype PropValuesMap = Record<string, Record<string, PropValues>>;\n\nexport class CoreAnimation extends EventEmitter {\n  public settings: AnimationSettings;\n  private progress = 0;\n  private delayFor = 0;\n  private delay = 0;\n  private timingFunction: (t: number) => number | undefined;\n\n  propValuesMap: PropValuesMap = {};\n  dynPropValuesMap: PropValuesMap | undefined = undefined;\n\n  constructor(\n    private node: CoreNode,\n    private props: Partial<CoreNodeAnimateProps>,\n    settings: Partial<AnimationSettings>,\n  ) {\n    super();\n\n    for (const key in props) {\n      if (key !== 'shaderProps') {\n        if (this.propValuesMap['props'] === undefined) {\n          this.propValuesMap['props'] = {};\n        }\n        this.propValuesMap['props'][key] = {\n          start:\n            node[key as keyof Omit<CoreNodeAnimateProps, 'shaderProps'>] || 0,\n          target: props[\n            key as keyof Omit<CoreNodeAnimateProps, 'shaderProps'>\n          ] as number,\n        };\n      } else if (node.shader.type !== 'DynamicShader') {\n        this.propValuesMap['shaderProps'] = {};\n        for (const key in props.shaderProps) {\n          this.propValuesMap['shaderProps'][key] = {\n            start: node.shader.props[key] as number,\n            target: props.shaderProps[key] as number,\n          };\n        }\n      } else {\n        const shaderPropKeys = Object.keys(props.shaderProps!);\n        const spLength = shaderPropKeys.length;\n        this.dynPropValuesMap = {};\n        for (let j = 0; j < spLength; j++) {\n          const effectName = shaderPropKeys[j]!;\n          const effect = props.shaderProps![effectName]!;\n          this.dynPropValuesMap[effectName] = {};\n          const effectProps = Object.entries(effect);\n          const eLength = effectProps.length;\n\n          for (let k = 0; k < eLength; k++) {\n            const [key, value] = effectProps[k]!;\n            this.dynPropValuesMap[effectName]![key] = {\n              start: node.shader.props[effectName][key],\n              target: value,\n            };\n          }\n        }\n      }\n    }\n\n    const easing = settings.easing || 'linear';\n    const delay = settings.delay ?? 0;\n    this.settings = {\n      duration: settings.duration ?? 0,\n      delay,\n      easing,\n      loop: settings.loop ?? false,\n      repeat: settings.repeat ?? 0,\n      repeatDelay: settings.repeatDelay ?? 0,\n      stopMethod: settings.stopMethod ?? false,\n    };\n    this.timingFunction = getTimingFunction(easing);\n    this.delayFor = delay;\n    this.delay = delay;\n  }\n\n  reset() {\n    this.progress = 0;\n    this.delayFor = this.settings.delay || 0;\n    this.update(0);\n  }\n\n  private restoreValues(\n    target: Record<string, number>,\n    valueMap: Record<string, PropValues>,\n  ) {\n    const entries = Object.entries(valueMap);\n    const eLength = entries.length;\n\n    for (let i = 0; i < eLength; i++) {\n      const [key, value] = entries[i]!;\n      target[key] = value.start;\n    }\n  }\n\n  restore() {\n    this.reset();\n    if (this.propValuesMap['props'] !== undefined) {\n      this.restoreValues(\n        this.node as unknown as Record<string, number>,\n        this.propValuesMap['props'],\n      );\n    }\n    if (this.propValuesMap['shaderProps'] !== undefined) {\n      this.restoreValues(\n        this.node.shader.props as Record<string, number>,\n        this.propValuesMap['shaderProps'],\n      );\n    }\n\n    if (this.dynPropValuesMap !== undefined) {\n      const dynEntries = Object.keys(this.dynPropValuesMap);\n      const dynEntriesL = dynEntries.length;\n      if (dynEntriesL > 0) {\n        for (let i = 0; i < dynEntriesL; i++) {\n          const key = dynEntries[i]!;\n          this.restoreValues(\n            this.node.shader.props[key],\n            this.dynPropValuesMap[key]!,\n          );\n        }\n      }\n    }\n  }\n\n  private reverseValues(valueMap: Record<string, PropValues>) {\n    const entries = Object.entries(valueMap);\n    const eLength = entries.length;\n\n    for (let i = 0; i < eLength; i++) {\n      const [key, value] = entries[i]!;\n      valueMap[key] = {\n        start: value.target,\n        target: value.start,\n      };\n    }\n  }\n\n  reverse() {\n    this.progress = 0;\n\n    if (this.propValuesMap['props'] !== undefined) {\n      this.reverseValues(this.propValuesMap['props']);\n    }\n    if (this.propValuesMap['shaderProps'] !== undefined) {\n      this.reverseValues(this.propValuesMap['shaderProps']);\n    }\n\n    if (this.dynPropValuesMap !== undefined) {\n      const dynEntries = Object.keys(this.dynPropValuesMap);\n      const dynEntriesL = dynEntries.length;\n      if (dynEntriesL > 0) {\n        for (let i = 0; i < dynEntriesL; i++) {\n          const key = dynEntries[i]!;\n          this.reverseValues(this.dynPropValuesMap[key]!);\n        }\n      }\n    }\n\n    // restore stop method if we are not looping\n    if (!this.settings.loop) {\n      this.settings.stopMethod = false;\n    }\n  }\n\n  private applyEasing(p: number, s: number, e: number): number {\n    return (this.timingFunction(p) || p) * (e - s) + s;\n  }\n\n  updateValue(\n    propName: string,\n    propValue: number,\n    startValue: number,\n    easing: string | undefined,\n  ): number {\n    if (this.progress === 1) {\n      return propValue;\n    }\n    if (this.progress === 0) {\n      return startValue;\n    }\n\n    const endValue = propValue;\n    if (propName.indexOf('color') !== -1) {\n      if (startValue === endValue) {\n        return startValue;\n      }\n\n      if (easing) {\n        const easingProgressValue =\n          this.timingFunction(this.progress) || this.progress;\n        return mergeColorProgress(startValue, endValue, easingProgressValue);\n      }\n      return mergeColorProgress(startValue, endValue, this.progress);\n    }\n\n    if (easing) {\n      return this.applyEasing(this.progress, startValue, endValue);\n    }\n    return startValue + (endValue - startValue) * this.progress;\n  }\n\n  private updateValues(\n    target: Record<string, number>,\n    valueMap: Record<string, PropValues>,\n    easing: string | undefined,\n  ) {\n    const entries = Object.entries(valueMap);\n    const eLength = entries.length;\n\n    for (let i = 0; i < eLength; i++) {\n      const [key, value] = entries[i]!;\n      target[key] = this.updateValue(key, value.target, value.start, easing);\n    }\n  }\n\n  update(dt: number) {\n    const { duration, loop, easing, stopMethod } = this.settings;\n    const { delayFor } = this;\n\n    if (this.node.destroyed) {\n      // cleanup\n      this.emit('destroyed', {});\n      return;\n    }\n\n    if (duration === 0 && delayFor === 0) {\n      this.emit('finished', {});\n      return;\n    }\n\n    if (this.delayFor > 0) {\n      this.delayFor -= dt;\n      if (this.delayFor >= 0) {\n        // Either no or more delay left. Exit.\n        return;\n      } else {\n        // We went beyond the delay time, add it back to dt so we can continue\n        // with the animation.\n        dt = -this.delayFor;\n        this.delayFor = 0;\n      }\n    }\n\n    if (duration === 0) {\n      // No duration, we are done.\n      this.emit('finished', {});\n      return;\n    }\n\n    if (this.progress === 0) {\n      // Progress is 0, we are starting the post-delay part of the animation.\n      this.emit('animating', {});\n    }\n\n    this.progress += dt / duration;\n\n    if (this.progress > 1) {\n      this.progress = loop ? 0 : 1;\n      this.delayFor = this.delay;\n      if (stopMethod) {\n        // If there's a stop method emit finished so the stop method can be applied.\n        // TODO: We should probably reevaluate how stopMethod is implemented as currently\n        // stop method 'reset' does not work when looping.\n        this.emit('finished', {});\n        return;\n      }\n    }\n\n    if (this.propValuesMap['props'] !== undefined) {\n      this.updateValues(\n        this.node as unknown as Record<string, number>,\n        this.propValuesMap['props'],\n        easing,\n      );\n    }\n    if (this.propValuesMap['shaderProps'] !== undefined) {\n      this.updateValues(\n        this.node.shader.props as Record<string, number>,\n        this.propValuesMap['shaderProps'],\n        easing,\n      );\n    }\n\n    if (this.dynPropValuesMap !== undefined) {\n      const dynEntries = Object.keys(this.dynPropValuesMap);\n      const dynEntriesL = dynEntries.length;\n      if (dynEntriesL > 0) {\n        for (let i = 0; i < dynEntriesL; i++) {\n          const key = dynEntries[i]!;\n          this.updateValues(\n            this.node.shader.props[key],\n            this.dynPropValuesMap[key]!,\n            easing,\n          );\n        }\n      }\n    }\n\n    if (this.progress < 1) {\n      this.emit('tick', { progress: this.progress });\n    }\n\n    if (this.progress === 1) {\n      this.emit('finished', {});\n    }\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  AnimationControllerState,\n  IAnimationController,\n} from '../../common/IAnimationController.js';\nimport type { AnimationManager } from './AnimationManager.js';\nimport type { CoreAnimation } from './CoreAnimation.js';\nimport { assertTruthy } from '../../utils.js';\nimport { EventEmitter } from '../../common/EventEmitter.js';\nimport type { AnimationTickPayload } from '../../common/CommonTypes.js';\n\nexport class CoreAnimationController\n  extends EventEmitter\n  implements IAnimationController\n{\n  stoppedPromise: Promise<void>;\n  /**\n   * If this is null, then the animation is in a finished / stopped state.\n   */\n  stoppedResolve: (() => void) | null = null;\n  state: AnimationControllerState;\n\n  constructor(\n    private manager: AnimationManager,\n    private animation: CoreAnimation,\n  ) {\n    super();\n    this.state = 'stopped';\n    // Initial stopped promise is resolved (since the animation is stopped)\n    this.stoppedPromise = Promise.resolve();\n\n    // Bind event handlers\n    this.onAnimating = this.onAnimating.bind(this);\n    this.onFinished = this.onFinished.bind(this);\n    this.onTick = this.onTick.bind(this);\n    this.onDestroy = this.onDestroy.bind(this);\n  }\n\n  start(): IAnimationController {\n    if (this.state !== 'running' && this.state !== 'scheduled') {\n      this.makeStoppedPromise();\n      this.registerAnimation();\n      this.state = 'scheduled';\n    }\n    return this;\n  }\n\n  stop(): IAnimationController {\n    this.unregisterAnimation();\n    if (this.stoppedResolve !== null) {\n      this.stoppedResolve();\n      this.stoppedResolve = null;\n      this.emit('stopped', this);\n    }\n    this.animation.reset();\n    this.state = 'stopped';\n    return this;\n  }\n\n  pause(): IAnimationController {\n    this.unregisterAnimation();\n    this.state = 'paused';\n    return this;\n  }\n\n  restore(): IAnimationController {\n    this.stoppedResolve = null;\n    this.animation.restore();\n    return this;\n  }\n\n  waitUntilStopped(): Promise<void> {\n    return this.stoppedPromise;\n  }\n\n  private registerAnimation(): void {\n    // Hook up event listeners\n    this.animation.once('finished', this.onFinished);\n    this.animation.on('animating', this.onAnimating);\n    this.animation.on('tick', this.onTick);\n    this.animation.on('destroyed', this.onDestroy);\n    // Then register the animation\n    this.manager.registerAnimation(this.animation);\n  }\n\n  private unregisterAnimation(): void {\n    // First unregister the animation\n    this.manager.unregisterAnimation(this.animation);\n    // Then unhook event listeners\n    this.animation.off('finished', this.onFinished);\n    this.animation.off('animating', this.onAnimating);\n    this.animation.off('tick', this.onTick);\n    this.animation.off('destroy', this.onDestroy);\n  }\n\n  private makeStoppedPromise(): void {\n    if (this.stoppedResolve === null) {\n      this.stoppedPromise = new Promise((resolve) => {\n        this.stoppedResolve = resolve;\n      });\n    }\n  }\n\n  private onDestroy(this: CoreAnimationController): void {\n    this.unregisterAnimation();\n    this.state = 'stopped';\n  }\n\n  private onFinished(this: CoreAnimationController): void {\n    // If the animation is looping, then we need to restart it.\n    const { loop, stopMethod } = this.animation.settings;\n\n    if (stopMethod === 'reverse') {\n      this.animation.once('finished', this.onFinished);\n      this.animation.reverse();\n      return;\n    }\n\n    if (loop) {\n      return;\n    }\n\n    // unregister animation\n    this.unregisterAnimation();\n\n    // resolve promise\n    if (this.stoppedResolve !== null) {\n      this.stoppedResolve();\n      this.stoppedResolve = null;\n    }\n\n    this.emit('stopped', this);\n    this.state = 'stopped';\n  }\n\n  private onAnimating(this: CoreAnimationController): void {\n    this.state = 'running';\n    this.emit('animating', this);\n  }\n\n  private onTick(\n    this: CoreAnimationController,\n    _animation: CoreAnimation,\n    data: AnimationTickPayload,\n  ): void {\n    this.emit('tick', data);\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assertTruthy,\n  getNewId,\n  isProductionEnvironment,\n  mergeColorAlphaPremultiplied,\n} from '../utils.js';\nimport type { TextureOptions } from './CoreTextureManager.js';\nimport type { CoreRenderer } from './renderers/CoreRenderer.js';\nimport type { Stage } from './Stage.js';\nimport {\n  TextureType,\n  type Texture,\n  type TextureFailedEventHandler,\n  type TextureFreedEventHandler,\n  type TextureLoadedEventHandler,\n} from './textures/Texture.js';\nimport type {\n  Dimensions,\n  NodeTextureFailedPayload,\n  NodeTextureFreedPayload,\n  NodeTextureLoadedPayload,\n  NodeRenderablePayload,\n} from '../common/CommonTypes.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport {\n  copyRect,\n  intersectRect,\n  type Bound,\n  type RectWithValid,\n  createBound,\n  boundInsideBound,\n  boundLargeThanBound,\n  createPreloadBounds,\n} from './lib/utils.js';\nimport { Matrix3d } from './lib/Matrix3d.js';\nimport { RenderCoords } from './lib/RenderCoords.js';\nimport type { AnimationSettings } from './animations/CoreAnimation.js';\nimport type { IAnimationController } from '../common/IAnimationController.js';\nimport { CoreAnimation } from './animations/CoreAnimation.js';\nimport { CoreAnimationController } from './animations/CoreAnimationController.js';\nimport type { BaseShaderController } from '../main-api/ShaderController.js';\n\nexport enum CoreNodeRenderState {\n  Init = 0,\n  OutOfBounds = 2,\n  InBounds = 4,\n  InViewport = 8,\n}\n\nconst CoreNodeRenderStateMap: Map<CoreNodeRenderState, string> = new Map();\nCoreNodeRenderStateMap.set(CoreNodeRenderState.Init, 'init');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.OutOfBounds, 'outOfBounds');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.InBounds, 'inBounds');\nCoreNodeRenderStateMap.set(CoreNodeRenderState.InViewport, 'inViewport');\n\nexport enum UpdateType {\n  /**\n   * Child updates\n   */\n  Children = 1,\n\n  /**\n   * Scale/Rotate transform update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `scaleRotateTransform`\n   */\n  ScaleRotate = 2,\n\n  /**\n   * Translate transform update (x/y/width/height/pivot/mount)\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `localTransform`\n   */\n  Local = 4,\n\n  /**\n   * Global Transform update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `globalTransform`\n   * - `renderCoords`\n   * - `renderBound`\n   */\n  Global = 8,\n\n  /**\n   * Clipping rect update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `clippingRect`\n   */\n  Clipping = 16,\n\n  /**\n   * Calculated ZIndex update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `calcZIndex`\n   */\n  CalculatedZIndex = 32,\n\n  /**\n   * Z-Index Sorted Children update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `children` (sorts children by their `calcZIndex`)\n   */\n  ZIndexSortedChildren = 64,\n\n  /**\n   * Premultiplied Colors update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `premultipliedColorTl`\n   * - `premultipliedColorTr`\n   * - `premultipliedColorBl`\n   * - `premultipliedColorBr`\n   */\n  PremultipliedColors = 128,\n\n  /**\n   * World Alpha update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `worldAlpha` = `parent.worldAlpha` * `alpha`\n   */\n  WorldAlpha = 256,\n\n  /**\n   * Render State update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `renderState`\n   */\n  RenderState = 512,\n\n  /**\n   * Is Renderable update\n   *\n   * @remarks\n   * CoreNode Properties Updated:\n   * - `isRenderable`\n   */\n  IsRenderable = 1024,\n\n  /**\n   * Render Texture update\n   */\n  RenderTexture = 2048,\n\n  /**\n   * Track if parent has render texture\n   */\n  ParentRenderTexture = 4096,\n\n  /**\n   * Render Bounds update\n   */\n  RenderBounds = 8192,\n\n  /**\n   * None\n   */\n  None = 0,\n\n  /**\n   * All\n   */\n  All = 14335,\n}\n\n/**\n * A custom data map which can be stored on an CoreNode\n *\n * @remarks\n * This is a map of key-value pairs that can be stored on an INode. It is used\n * to store custom data that can be used by the application.\n * The data stored can only be of type string, number or boolean.\n */\nexport type CustomDataMap = {\n  [key: string]: string | number | boolean | undefined;\n};\n\n/**\n * Writable properties of a Node.\n */\nexport interface CoreNodeProps {\n  /**\n   * The x coordinate of the Node's Mount Point.\n   *\n   * @remarks\n   * See {@link mountX} and {@link mountY} for more information about setting\n   * the Mount Point.\n   *\n   * @default `0`\n   */\n  x: number;\n  /**\n   * The y coordinate of the Node's Mount Point.\n   *\n   * @remarks\n   * See {@link mountX} and {@link mountY} for more information about setting\n   * the Mount Point.\n   *\n   * @default `0`\n   */\n  y: number;\n  /**\n   * The width of the Node.\n   *\n   * @default `0`\n   */\n  width: number;\n  /**\n   * The height of the Node.\n   *\n   * @default `0`\n   */\n  height: number;\n  /**\n   * The alpha opacity of the Node.\n   *\n   * @remarks\n   * The alpha value is a number between 0 and 1, where 0 is fully transparent\n   * and 1 is fully opaque.\n   *\n   * @default `1`\n   */\n  alpha: number;\n  /**\n   * Autosize mode\n   *\n   * @remarks\n   * When enabled, when a texture is loaded into the Node, the Node will\n   * automatically resize to the dimensions of the texture.\n   *\n   * Text Nodes are always autosized based on their text content regardless\n   * of this mode setting.\n   *\n   * @default `false`\n   */\n  autosize: boolean;\n  /**\n   * Margin around the Node's bounds for preloading\n   *\n   * @default `null`\n   */\n  boundsMargin: number | [number, number, number, number] | null;\n  /**\n   * Clipping Mode\n   *\n   * @remarks\n   * Enable Clipping Mode when you want to prevent the drawing of a Node and\n   * its descendants from overflowing outside of the Node's x/y/width/height\n   * bounds.\n   *\n   * For WebGL, clipping is implemented using the high-performance WebGL\n   * operation scissor. As a consequence, clipping does not work for\n   * non-rectangular areas. So, if the element is rotated\n   * (by itself or by any of its ancestors), clipping will not work as intended.\n   *\n   * TODO: Add support for non-rectangular clipping either automatically or\n   * via Render-To-Texture.\n   *\n   * @default `false`\n   */\n  clipping: boolean;\n  /**\n   * The color of the Node.\n   *\n   * @remarks\n   * The color value is a number in the format 0xRRGGBBAA, where RR is the red\n   * component, GG is the green component, BB is the blue component, and AA is\n   * the alpha component.\n   *\n   * Gradient colors may be set by setting the different color sub-properties:\n   * {@link colorTop}, {@link colorBottom}, {@link colorLeft}, {@link colorRight},\n   * {@link colorTl}, {@link colorTr}, {@link colorBr}, {@link colorBl} accordingly.\n   *\n   * @default `0xffffffff` (opaque white)\n   */\n  color: number;\n  /**\n   * The color of the top edge of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorTop: number;\n  /**\n   * The color of the bottom edge of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorBottom: number;\n  /**\n   * The color of the left edge of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorLeft: number;\n  /**\n   * The color of the right edge of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorRight: number;\n  /**\n   * The color of the top-left corner of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorTl: number;\n  /**\n   * The color of the top-right corner of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorTr: number;\n  /**\n   * The color of the bottom-right corner of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorBr: number;\n  /**\n   * The color of the bottom-left corner of the Node for gradient rendering.\n   *\n   * @remarks\n   * See {@link color} for more information about color values and gradient\n   * rendering.\n   */\n  colorBl: number;\n  /**\n   * The Node's parent Node.\n   *\n   * @remarks\n   * The value `null` indicates that the Node has no parent. This may either be\n   * because the Node is the root Node of the scene graph, or because the Node\n   * has been removed from the scene graph.\n   *\n   * In order to make sure that a Node can be rendered on the screen, it must\n   * be added to the scene graph by setting it's parent property to a Node that\n   * is already in the scene graph such as the root Node.\n   *\n   * @default `null`\n   */\n  parent: CoreNode | null;\n  /**\n   * The Node's z-index.\n   *\n   * @remarks\n   * TBD\n   */\n  zIndex: number;\n  /**\n   * The Node's Texture.\n   *\n   * @remarks\n   * The `texture` defines a rasterized image that is contained within the\n   * {@link width} and {@link height} dimensions of the Node. If null, the\n   * Node will use an opaque white {@link ColorTexture} when being drawn, which\n   * essentially enables colors (including gradients) to be drawn.\n   *\n   * If set, by default, the texture will be drawn, as is, stretched to the\n   * dimensions of the Node. This behavior can be modified by setting the TBD\n   * and TBD properties.\n   *\n   * To create a Texture in order to set it on this property, call\n   * {@link RendererMain.createTexture}.\n   *\n   * If the {@link src} is set on a Node, the Node will use the\n   * {@link ImageTexture} by default and the Node will simply load the image at\n   * the specified URL.\n   *\n   * Note: If this is a Text Node, the Texture will be managed by the Node's\n   * {@link TextRenderer} and should not be set explicitly.\n   */\n  texture: Texture | null;\n\n  /**\n   * [Deprecated]: Prevents the texture from being cleaned up when the Node is removed\n   *\n   * @remarks\n   * Please use the `preventCleanup` property on {@link TextureOptions} instead.\n   *\n   * @default false\n   */\n  preventCleanup: boolean;\n  /**\n   * Options to associate with the Node's Texture\n   */\n  textureOptions: TextureOptions;\n\n  /**\n   * The Node's shader\n   *\n   * @remarks\n   * The `shader` defines a {@link Shader} used to draw the Node. By default,\n   * the Default Shader is used which simply draws the defined {@link texture}\n   * or {@link color}(s) within the Node without any special effects.\n   *\n   * To create a Shader in order to set it on this property, call\n   * {@link RendererMain.createShader}.\n   *\n   * Note: If this is a Text Node, the Shader will be managed by the Node's\n   * {@link TextRenderer} and should not be set explicitly.\n   */\n  shader: BaseShaderController;\n  /**\n   * Image URL\n   *\n   * @remarks\n   * When set, the Node's {@link texture} is automatically set to an\n   * {@link ImageTexture} using the source image URL provided (with all other\n   * settings being defaults)\n   */\n  src: string | null;\n  zIndexLocked: number;\n  /**\n   * Scale to render the Node at\n   *\n   * @remarks\n   * The scale value multiplies the provided {@link width} and {@link height}\n   * of the Node around the Node's Pivot Point (defined by the {@link pivot}\n   * props).\n   *\n   * Behind the scenes, setting this property sets both the {@link scaleX} and\n   * {@link scaleY} props to the same value.\n   *\n   * NOTE: When the scaleX and scaleY props are explicitly set to different values,\n   * this property returns `null`. Setting `null` on this property will have no\n   * effect.\n   *\n   * @default 1.0\n   */\n  scale: number | null;\n  /**\n   * Scale to render the Node at (X-Axis)\n   *\n   * @remarks\n   * The scaleX value multiplies the provided {@link width} of the Node around\n   * the Node's Pivot Point (defined by the {@link pivot} props).\n   *\n   * @default 1.0\n   */\n  scaleX: number;\n  /**\n   * Scale to render the Node at (Y-Axis)\n   *\n   * @remarks\n   * The scaleY value multiplies the provided {@link height} of the Node around\n   * the Node's Pivot Point (defined by the {@link pivot} props).\n   *\n   * @default 1.0\n   */\n  scaleY: number;\n  /**\n   * Combined position of the Node's Mount Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Mount Point at the top-left corner of the Node.\n   * - `0.5` defines it at the center of the Node.\n   * - `1.0` defines it at the bottom-right corner of the node.\n   *\n   * Use the {@link mountX} and {@link mountY} props seperately for more control\n   * of the Mount Point.\n   *\n   * When assigned, the same value is also passed to both the {@link mountX} and\n   * {@link mountY} props.\n   *\n   * @default 0 (top-left)\n   */\n  mount: number;\n  /**\n   * X position of the Node's Mount Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Mount Point's X position as the left-most edge of the\n   *   Node\n   * - `0.5` defines it as the horizontal center of the Node\n   * - `1.0` defines it as the right-most edge of the Node.\n   *\n   * The combination of {@link mountX} and {@link mountY} define the Mount Point\n   *\n   * @default 0 (left-most edge)\n   */\n  mountX: number;\n  /**\n   * Y position of the Node's Mount Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Mount Point's Y position as the top-most edge of the\n   *   Node\n   * - `0.5` defines it as the vertical center of the Node\n   * - `1.0` defines it as the bottom-most edge of the Node.\n   *\n   * The combination of {@link mountX} and {@link mountY} define the Mount Point\n   *\n   * @default 0 (top-most edge)\n   */\n  mountY: number;\n  /**\n   * Combined position of the Node's Pivot Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Pivot Point at the top-left corner of the Node.\n   * - `0.5` defines it at the center of the Node.\n   * - `1.0` defines it at the bottom-right corner of the node.\n   *\n   * Use the {@link pivotX} and {@link pivotY} props seperately for more control\n   * of the Pivot Point.\n   *\n   * When assigned, the same value is also passed to both the {@link pivotX} and\n   * {@link pivotY} props.\n   *\n   * @default 0.5 (center)\n   */\n  pivot: number;\n  /**\n   * X position of the Node's Pivot Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Pivot Point's X position as the left-most edge of the\n   *   Node\n   * - `0.5` defines it as the horizontal center of the Node\n   * - `1.0` defines it as the right-most edge of the Node.\n   *\n   * The combination of {@link pivotX} and {@link pivotY} define the Pivot Point\n   *\n   * @default 0.5 (centered on x-axis)\n   */\n  pivotX: number;\n  /**\n   * Y position of the Node's Pivot Point\n   *\n   * @remarks\n   * The value can be any number between `0.0` and `1.0`:\n   * - `0.0` defines the Pivot Point's Y position as the top-most edge of the\n   *   Node\n   * - `0.5` defines it as the vertical center of the Node\n   * - `1.0` defines it as the bottom-most edge of the Node.\n   *\n   * The combination of {@link pivotX} and {@link pivotY} define the Pivot Point\n   *\n   * @default 0.5 (centered on y-axis)\n   */\n  pivotY: number;\n  /**\n   * Rotation of the Node (in Radians)\n   *\n   * @remarks\n   * Sets the amount to rotate the Node by around it's Pivot Point (defined by\n   * the {@link pivot} props). Positive values rotate the Node clockwise, while\n   * negative values rotate it counter-clockwise.\n   *\n   * Example values:\n   * - `-Math.PI / 2`: 90 degree rotation counter-clockwise\n   * - `0`: No rotation\n   * - `Math.PI / 2`: 90 degree rotation clockwise\n   * - `Math.PI`: 180 degree rotation clockwise\n   * - `3 * Math.PI / 2`: 270 degree rotation clockwise\n   * - `2 * Math.PI`: 360 rotation clockwise\n   */\n  rotation: number;\n\n  /**\n   * Whether the Node is rendered to a texture\n   *\n   * @remarks\n   * TBD\n   *\n   * @default false\n   */\n  rtt: boolean;\n\n  /**\n   * Node data element for custom data storage (optional)\n   *\n   * @remarks\n   * This property is used to store custom data on the Node as a key/value data store.\n   * Data values are limited to string, numbers, booleans. Strings will be truncated\n   * to a 2048 character limit for performance reasons.\n   *\n   * This is not a data storage mechanism for large amounts of data please use a\n   * dedicated data storage mechanism for that.\n   *\n   * The custom data will be reflected in the inspector as part of `data-*` attributes\n   *\n   * @default `undefined`\n   */\n  data?: CustomDataMap;\n\n  /**\n   * Image Type to explicitly set the image type that is being loaded\n   *\n   * @remarks\n   * This property must be used with a `src` that points at an image. In some cases\n   * the extension doesn't provide a reliable representation of the image type. In such\n   * cases set the ImageType explicitly.\n   *\n   * `regular` is used for normal images such as png, jpg, etc\n   * `compressed` is used for ETC1/ETC2 compressed images with a PVR or KTX container\n   * `svg` is used for scalable vector graphics\n   *\n   * @default `undefined`\n   */\n  imageType?: 'regular' | 'compressed' | 'svg' | null;\n\n  /**\n   * She width of the rectangle from which the Image Texture will be extracted.\n   * This value can be negative. If not provided, the image's source natural\n   * width will be used.\n   */\n  srcWidth?: number;\n  /**\n   * The height of the rectangle from which the Image Texture will be extracted.\n   * This value can be negative. If not provided, the image's source natural\n   * height will be used.\n   */\n  srcHeight?: number;\n  /**\n   * The x coordinate of the reference point of the rectangle from which the Texture\n   * will be extracted.  `width` and `height` are provided. And only works when\n   * createImageBitmap is available. Only works when createImageBitmap is supported on the browser.\n   */\n  srcX?: number;\n  /**\n   * The y coordinate of the reference point of the rectangle from which the Texture\n   * will be extracted. Only used when source `srcWidth` width and `srcHeight` height\n   * are provided. Only works when createImageBitmap is supported on the browser.\n   */\n  srcY?: number;\n  /**\n   * By enabling Strict bounds the renderer will not process & render child nodes of a node that is out of the visible area\n   *\n   * @remarks\n   * When enabled out of bound nodes, i.e. nodes that are out of the visible area, will\n   * **NOT** have their children processed and renderer anymore. This means the children of a out of bound\n   * node will not receive update processing such as positioning updates and will not be drawn on screen.\n   * As such the rest of the branch of the update tree that sits below this node will not be processed anymore\n   *\n   * This is a big performance gain but may be disabled in cases where the width of the parent node is\n   * unknown and the render must process the child nodes regardless of the viewport status of the parent node\n   *\n   * @default false\n   */\n  strictBounds: boolean;\n  /**\n   * Mark the node as interactive so we can perform hit tests on it\n   * when pointer events are registered.\n   * @default false\n   */\n  interactive?: boolean;\n}\n\n/**\n * Grab all the number properties of type T\n */\ntype NumberProps<T> = {\n  [Key in keyof T as NonNullable<T[Key]> extends number ? Key : never]: number;\n};\n\n/**\n * Properties of a Node used by the animate() function\n */\nexport interface CoreNodeAnimateProps extends NumberProps<CoreNodeProps> {\n  /**\n   * Shader properties to animate\n   */\n  shaderProps: Record<string, number>;\n  // TODO: textureProps: Record<string, number>;\n}\n\n/**\n * A visual Node in the Renderer scene graph.\n *\n * @remarks\n * CoreNode is an internally used class that represents a Renderer Node in the\n * scene graph. See INode.ts for the public APIs exposed to Renderer users\n * that include generic types for Shaders.\n */\nexport class CoreNode extends EventEmitter {\n  readonly children: CoreNode[] = [];\n  protected _id: number = getNewId();\n  readonly props: CoreNodeProps;\n\n  public updateType = UpdateType.All;\n  public childUpdateType = UpdateType.None;\n\n  public globalTransform?: Matrix3d;\n  public scaleRotateTransform?: Matrix3d;\n  public localTransform?: Matrix3d;\n  public sceneGlobalTransform?: Matrix3d;\n  public renderCoords?: RenderCoords;\n  public sceneRenderCoords?: RenderCoords;\n  public renderBound?: Bound;\n  public strictBound?: Bound;\n  public preloadBound?: Bound;\n  public clippingRect: RectWithValid = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    valid: false,\n  };\n  public isRenderable = false;\n  public renderState: CoreNodeRenderState = CoreNodeRenderState.Init;\n\n  public worldAlpha = 1;\n  public premultipliedColorTl = 0;\n  public premultipliedColorTr = 0;\n  public premultipliedColorBl = 0;\n  public premultipliedColorBr = 0;\n  public calcZIndex = 0;\n  public hasRTTupdates = false;\n  public parentHasRenderTexture = false;\n  public rttParent: CoreNode | null = null;\n\n  public destroyed = false;\n\n  constructor(readonly stage: Stage, props: CoreNodeProps) {\n    super();\n\n    this.props = {\n      ...props,\n      parent: null,\n      texture: null,\n      src: null,\n      rtt: false,\n    };\n\n    // Assign props to instance\n    this.parent = props.parent;\n    this.texture = props.texture;\n    this.src = props.src;\n    this.rtt = props.rtt;\n    this.interactive = props.interactive;\n\n    if (props.boundsMargin) {\n      this.boundsMargin = Array.isArray(props.boundsMargin)\n        ? props.boundsMargin\n        : [\n            props.boundsMargin,\n            props.boundsMargin,\n            props.boundsMargin,\n            props.boundsMargin,\n          ];\n    }\n\n    this.setUpdateType(\n      UpdateType.ScaleRotate |\n        UpdateType.Local |\n        UpdateType.RenderBounds |\n        UpdateType.RenderState,\n    );\n\n    if (isProductionEnvironment === false && props.preventCleanup === true) {\n      console.warn(\n        'CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead',\n      );\n    }\n\n    // if the default texture isn't loaded yet, wait for it to load\n    // this only happens when the node is created before the stage is ready\n    if (\n      this.stage.defaultTexture &&\n      this.stage.defaultTexture.state !== 'loaded'\n    ) {\n      this.stage.defaultTexture.once('loaded', () => {\n        this.setUpdateType(UpdateType.IsRenderable);\n      });\n    }\n  }\n\n  //#region Textures\n  loadTexture(): void {\n    const { texture } = this.props;\n    assertTruthy(texture);\n    // If texture is already loaded / failed, trigger loaded event manually\n    // so that users get a consistent event experience.\n    // We do this in a microtask to allow listeners to be attached in the same\n    // synchronous task after calling loadTexture()\n    queueMicrotask(() => {\n      if (this.textureOptions.preload === true) {\n        this.stage.txManager.loadTexture(texture);\n      }\n\n      texture.preventCleanup =\n        this.props.textureOptions?.preventCleanup ?? false;\n\n      texture.on('loaded', this.onTextureLoaded);\n      texture.on('failed', this.onTextureFailed);\n      texture.on('freed', this.onTextureFreed);\n\n      if (texture.state === 'loaded') {\n        assertTruthy(texture.dimensions);\n        this.onTextureLoaded(texture, texture.dimensions);\n      } else if (texture.state === 'failed') {\n        assertTruthy(texture.error);\n        this.onTextureFailed(texture, texture.error);\n      } else if (texture.state === 'freed') {\n        this.onTextureFreed(texture);\n      }\n\n      // If the parent is a render texture, the initial texture status\n      // will be set to freed until the texture is processed by the\n      // Render RTT nodes. So we only need to listen fo changes and\n      // no need to check the texture.state until we restructure how\n      // textures are being processed.\n      if (this.parentHasRenderTexture) {\n        this.notifyParentRTTOfUpdate();\n        return;\n      }\n    });\n  }\n\n  unloadTexture(): void {\n    if (this.texture !== null) {\n      this.texture.off('loaded', this.onTextureLoaded);\n      this.texture.off('failed', this.onTextureFailed);\n      this.texture.off('freed', this.onTextureFreed);\n      this.texture.setRenderableOwner(this._id, false);\n    }\n  }\n\n  autosizeNode(dimensions: Dimensions) {\n    if (this.autosize) {\n      this.width = dimensions.width;\n      this.height = dimensions.height;\n    }\n  }\n\n  private onTextureLoaded: TextureLoadedEventHandler = (_, dimensions) => {\n    this.autosizeNode(dimensions);\n    this.setUpdateType(UpdateType.IsRenderable);\n\n    // Texture was loaded. In case the RAF loop has already stopped, we request\n    // a render to ensure the texture is rendered.\n    this.stage.requestRender();\n\n    // If parent has a render texture, flag that we need to update\n    if (this.parentHasRenderTexture) {\n      this.notifyParentRTTOfUpdate();\n    }\n    // ignore 1x1 pixel textures\n    if (dimensions.width > 1 && dimensions.height > 1) {\n      this.emit('loaded', {\n        type: 'texture',\n        dimensions,\n      } satisfies NodeTextureLoadedPayload);\n    }\n\n    // Trigger a local update if the texture is loaded and the resizeMode is 'contain'\n    if (this.props.textureOptions?.resizeMode?.type === 'contain') {\n      this.setUpdateType(UpdateType.Local);\n    }\n  };\n\n  private onTextureFailed: TextureFailedEventHandler = (_, error) => {\n    // immediately set isRenderable to false, so that we handle the error\n    // without waiting for the next frame loop\n    this.isRenderable = false;\n    this.updateTextureOwnership(false);\n    this.setUpdateType(UpdateType.IsRenderable);\n\n    // If parent has a render texture, flag that we need to update\n    if (this.parentHasRenderTexture) {\n      this.notifyParentRTTOfUpdate();\n    }\n\n    // only emit failed outward if we've exhausted all retry attempts\n    if (\n      this.texture !== null &&\n      this.texture.retryCount > this.texture.maxRetryCount\n    ) {\n      this.emit('failed', {\n        type: 'texture',\n        error,\n      } satisfies NodeTextureFailedPayload);\n    }\n  };\n\n  private onTextureFreed: TextureFreedEventHandler = () => {\n    // immediately set isRenderable to false, so that we handle the error\n    // without waiting for the next frame loop\n    this.isRenderable = false;\n    this.updateTextureOwnership(false);\n    this.setUpdateType(UpdateType.IsRenderable);\n\n    // If parent has a render texture, flag that we need to update\n    if (this.parentHasRenderTexture) {\n      this.notifyParentRTTOfUpdate();\n    }\n\n    this.emit('freed', {\n      type: 'texture',\n    } satisfies NodeTextureFreedPayload);\n  };\n  //#endregion Textures\n\n  /**\n   * Change types types is used to determine the scope of the changes being applied\n   *\n   * @remarks\n   * See {@link UpdateType} for more information on each type\n   *\n   * @param type\n   */\n  setUpdateType(type: UpdateType): void {\n    this.updateType |= type;\n\n    const parent = this.props.parent;\n    if (!parent) return;\n\n    if ((parent.updateType & UpdateType.Children) === 0) {\n      // Inform the parent if it doesn’t already have a child update\n      parent.setUpdateType(UpdateType.Children);\n    }\n  }\n\n  sortChildren() {\n    this.children.sort((a, b) => a.calcZIndex - b.calcZIndex);\n  }\n\n  updateScaleRotateTransform() {\n    const { rotation, scaleX, scaleY } = this.props;\n\n    // optimize simple translation cases\n    if (rotation === 0 && scaleX === 1 && scaleY === 1) {\n      this.scaleRotateTransform = undefined;\n      return;\n    }\n\n    this.scaleRotateTransform = Matrix3d.rotate(\n      rotation,\n      this.scaleRotateTransform,\n    ).scale(scaleX, scaleY);\n  }\n\n  updateLocalTransform() {\n    const { x, y, width, height } = this.props;\n    const mountTranslateX = this.props.mountX * width;\n    const mountTranslateY = this.props.mountY * height;\n\n    if (this.scaleRotateTransform) {\n      const pivotTranslateX = this.props.pivotX * width;\n      const pivotTranslateY = this.props.pivotY * height;\n\n      this.localTransform = Matrix3d.translate(\n        x - mountTranslateX + pivotTranslateX,\n        y - mountTranslateY + pivotTranslateY,\n        this.localTransform,\n      )\n        .multiply(this.scaleRotateTransform)\n        .translate(-pivotTranslateX, -pivotTranslateY);\n    } else {\n      this.localTransform = Matrix3d.translate(\n        x - mountTranslateX,\n        y - mountTranslateY,\n        this.localTransform,\n      );\n    }\n\n    // Handle 'contain' resize mode\n    const texture = this.props.texture;\n    if (\n      texture &&\n      texture.dimensions &&\n      this.props.textureOptions?.resizeMode?.type === 'contain'\n    ) {\n      let resizeModeScaleX = 1;\n      let resizeModeScaleY = 1;\n      let extraX = 0;\n      let extraY = 0;\n      const { width: tw, height: th } = texture.dimensions;\n      const txAspectRatio = tw / th;\n      const nodeAspectRatio = width / height;\n      if (txAspectRatio > nodeAspectRatio) {\n        // Texture is wider than node\n        // Center the node vertically (shift down by extraY)\n        // Scale the node vertically to maintain original aspect ratio\n        const scaleX = width / tw;\n        const scaledTxHeight = th * scaleX;\n        extraY = (height - scaledTxHeight) / 2;\n        resizeModeScaleY = scaledTxHeight / height;\n      } else {\n        // Texture is taller than node (or equal)\n        // Center the node horizontally (shift right by extraX)\n        // Scale the node horizontally to maintain original aspect ratio\n        const scaleY = height / th;\n        const scaledTxWidth = tw * scaleY;\n        extraX = (width - scaledTxWidth) / 2;\n        resizeModeScaleX = scaledTxWidth / width;\n      }\n\n      // Apply the extra translation and scale to the local transform\n      this.localTransform\n        .translate(extraX, extraY)\n        .scale(resizeModeScaleX, resizeModeScaleY);\n    }\n\n    this.setUpdateType(UpdateType.Global);\n  }\n\n  /**\n   * @todo: test for correct calculation flag\n   * @param delta\n   */\n  update(delta: number, parentClippingRect: RectWithValid): void {\n    if (this.updateType & UpdateType.ScaleRotate) {\n      this.updateScaleRotateTransform();\n      this.setUpdateType(UpdateType.Local);\n    }\n\n    if (this.updateType & UpdateType.Local) {\n      this.updateLocalTransform();\n      this.setUpdateType(UpdateType.Global);\n    }\n\n    const parent = this.props.parent;\n    let renderState = null;\n\n    // Handle specific RTT updates at this node level\n    if (this.updateType & UpdateType.RenderTexture && this.rtt) {\n      this.hasRTTupdates = true;\n    }\n\n    if (this.updateType & UpdateType.Global) {\n      assertTruthy(this.localTransform);\n\n      if (this.parentHasRenderTexture === true && parent?.rtt === true) {\n        // we are at the start of the RTT chain, so we need to reset the globalTransform\n        // for correct RTT rendering\n        this.globalTransform = Matrix3d.identity();\n\n        // Maintain a full scene global transform for bounds detection\n        this.sceneGlobalTransform = Matrix3d.copy(\n          parent?.globalTransform || Matrix3d.identity(),\n        ).multiply(this.localTransform);\n      } else if (\n        this.parentHasRenderTexture === true &&\n        parent?.rtt === false\n      ) {\n        // we're part of an RTT chain but our parent is not the main RTT node\n        // so we need to propogate the sceneGlobalTransform of the parent\n        // to maintain a full scene global transform for bounds detection\n        this.sceneGlobalTransform = Matrix3d.copy(\n          parent?.sceneGlobalTransform || this.localTransform,\n        ).multiply(this.localTransform);\n\n        this.globalTransform = Matrix3d.copy(\n          parent?.globalTransform || this.localTransform,\n          this.globalTransform,\n        );\n      } else {\n        this.globalTransform = Matrix3d.copy(\n          parent?.globalTransform || this.localTransform,\n          this.globalTransform,\n        );\n      }\n\n      if (parent !== null) {\n        this.globalTransform.multiply(this.localTransform);\n      }\n      this.calculateRenderCoords();\n      this.updateBoundingRect();\n\n      this.setUpdateType(UpdateType.RenderState | UpdateType.Children);\n      this.childUpdateType |= UpdateType.Global;\n\n      if (this.clipping === true) {\n        this.setUpdateType(UpdateType.Clipping | UpdateType.RenderBounds);\n        this.childUpdateType |= UpdateType.RenderBounds;\n      }\n    }\n\n    if (this.updateType & UpdateType.RenderBounds) {\n      this.createRenderBounds();\n      this.setUpdateType(UpdateType.RenderState);\n      this.setUpdateType(UpdateType.Children);\n\n      this.childUpdateType |= UpdateType.RenderBounds;\n    }\n\n    if (this.updateType & UpdateType.RenderState) {\n      renderState = this.checkRenderBounds();\n      this.setUpdateType(UpdateType.IsRenderable);\n\n      // if we're not going out of bounds, update the render state\n      // this is done so the update loop can finish before we mark a node\n      // as out of bounds\n      if (renderState !== CoreNodeRenderState.OutOfBounds) {\n        this.updateRenderState(renderState);\n      }\n    }\n\n    if (this.updateType & UpdateType.WorldAlpha) {\n      if (parent) {\n        this.worldAlpha = parent.worldAlpha * this.props.alpha;\n      } else {\n        this.worldAlpha = this.props.alpha;\n      }\n      this.setUpdateType(\n        UpdateType.Children |\n          UpdateType.PremultipliedColors |\n          UpdateType.IsRenderable,\n      );\n      this.childUpdateType |= UpdateType.WorldAlpha;\n    }\n\n    if (this.updateType & UpdateType.IsRenderable) {\n      this.updateIsRenderable();\n    }\n\n    if (this.updateType & UpdateType.Clipping) {\n      this.calculateClippingRect(parentClippingRect);\n      this.setUpdateType(UpdateType.Children);\n\n      this.childUpdateType |= UpdateType.Clipping;\n      this.childUpdateType |= UpdateType.RenderBounds;\n    }\n\n    if (this.updateType & UpdateType.PremultipliedColors) {\n      this.premultipliedColorTl = mergeColorAlphaPremultiplied(\n        this.props.colorTl,\n        this.worldAlpha,\n        true,\n      );\n\n      // If all the colors are the same just sent them all to the same value\n      if (\n        this.props.colorTl === this.props.colorTr &&\n        this.props.colorBl === this.props.colorBr &&\n        this.props.colorTl === this.props.colorBl\n      ) {\n        this.premultipliedColorTr =\n          this.premultipliedColorBl =\n          this.premultipliedColorBr =\n            this.premultipliedColorTl;\n      } else {\n        this.premultipliedColorTr = mergeColorAlphaPremultiplied(\n          this.props.colorTr,\n          this.worldAlpha,\n          true,\n        );\n        this.premultipliedColorBl = mergeColorAlphaPremultiplied(\n          this.props.colorBl,\n          this.worldAlpha,\n          true,\n        );\n        this.premultipliedColorBr = mergeColorAlphaPremultiplied(\n          this.props.colorBr,\n          this.worldAlpha,\n          true,\n        );\n      }\n    }\n\n    // No need to update zIndex if there is no parent\n    if (parent !== null && this.updateType & UpdateType.CalculatedZIndex) {\n      this.calculateZIndex();\n      // Tell parent to re-sort children\n      parent.setUpdateType(UpdateType.ZIndexSortedChildren);\n    }\n\n    if (\n      this.props.strictBounds === true &&\n      this.renderState === CoreNodeRenderState.OutOfBounds\n    ) {\n      this.updateType &= ~UpdateType.RenderBounds; // remove render bounds update\n      return;\n    }\n\n    if (this.updateType & UpdateType.Children && this.children.length > 0) {\n      for (let i = 0, length = this.children.length; i < length; i++) {\n        const child = this.children[i] as CoreNode;\n\n        child.setUpdateType(this.childUpdateType);\n\n        if (child.updateType === 0) {\n          continue;\n        }\n\n        let childClippingRect = this.clippingRect;\n        if (this.rtt === true) {\n          childClippingRect = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            valid: false,\n          };\n        }\n\n        child.update(delta, childClippingRect);\n      }\n    }\n\n    // If the node has an RTT parent and requires a texture re-render, inform the RTT parent\n    // if (this.parentHasRenderTexture && this.updateType & UpdateType.RenderTexture) {\n    // @TODO have a more scoped down updateType for RTT updates\n    if (this.parentHasRenderTexture && this.updateType > 0) {\n      this.notifyParentRTTOfUpdate();\n    }\n\n    // Sorting children MUST happen after children have been updated so\n    // that they have the oppotunity to update their calculated zIndex.\n    if (this.updateType & UpdateType.ZIndexSortedChildren) {\n      // reorder z-index\n      this.sortChildren();\n    }\n\n    // If we're out of bounds, apply the render state now\n    // this is done so nodes can finish their entire update loop before\n    // being marked as out of bounds\n    if (renderState === CoreNodeRenderState.OutOfBounds) {\n      this.updateRenderState(renderState);\n      this.updateIsRenderable();\n\n      if (\n        this.rtt === true &&\n        renderState === CoreNodeRenderState.OutOfBounds\n      ) {\n        // notify children that we are going out of bounds\n        // we have to do this now before we stop processing the render tree\n        this.notifyChildrenRTTOfUpdate(renderState);\n        // this.childUpdateType |= UpdateType.RenderState;\n      }\n    }\n\n    // reset update type\n    this.updateType = 0;\n    this.childUpdateType = 0;\n  }\n\n  private findParentRTTNode(): CoreNode | null {\n    let rttNode: CoreNode | null = this.parent;\n    while (rttNode && !rttNode.rtt) {\n      rttNode = rttNode.parent;\n    }\n    return rttNode;\n  }\n\n  private getRTTParentRenderState(): CoreNodeRenderState | null {\n    const rttNode = this.rttParent || this.findParentRTTNode();\n    if (!rttNode) {\n      return null;\n    }\n\n    return rttNode.renderState;\n  }\n\n  private notifyChildrenRTTOfUpdate(renderState: CoreNodeRenderState) {\n    for (const child of this.children) {\n      // force child to update render state\n      child.updateRenderState(renderState);\n      child.updateIsRenderable();\n      child.notifyChildrenRTTOfUpdate(renderState);\n    }\n  }\n\n  private notifyParentRTTOfUpdate() {\n    if (this.parent === null) {\n      return;\n    }\n\n    const rttNode = this.rttParent || this.findParentRTTNode();\n    if (!rttNode) {\n      return;\n    }\n\n    // If an RTT node is found, mark it for re-rendering\n    rttNode.hasRTTupdates = true;\n    rttNode.setUpdateType(UpdateType.RenderTexture);\n\n    // if rttNode is nested, also make it update its RTT parent\n    if (rttNode.parentHasRenderTexture === true) {\n      rttNode.notifyParentRTTOfUpdate();\n    }\n  }\n\n  checkRenderBounds(): CoreNodeRenderState {\n    assertTruthy(this.renderBound);\n    assertTruthy(this.strictBound);\n    assertTruthy(this.preloadBound);\n\n    if (boundInsideBound(this.renderBound, this.strictBound)) {\n      return CoreNodeRenderState.InViewport;\n    }\n\n    if (boundInsideBound(this.renderBound, this.preloadBound)) {\n      return CoreNodeRenderState.InBounds;\n    }\n\n    // check if we're larger then our parent, we're definitely in the viewport\n    if (boundLargeThanBound(this.renderBound, this.strictBound)) {\n      return CoreNodeRenderState.InViewport;\n    }\n\n    // check if we dont have dimensions, take our parent's render state\n    if (\n      this.parent !== null &&\n      (this.props.width === 0 || this.props.height === 0)\n    ) {\n      return this.parent.renderState;\n    }\n\n    return CoreNodeRenderState.OutOfBounds;\n  }\n\n  updateBoundingRect() {\n    const transform = this.sceneGlobalTransform || this.globalTransform;\n    const renderCoords = this.sceneRenderCoords || this.renderCoords;\n\n    assertTruthy(transform);\n    assertTruthy(renderCoords);\n\n    const { tb, tc } = transform;\n    const { x1, y1, x3, y3 } = renderCoords;\n    if (tb === 0 || tc === 0) {\n      this.renderBound = createBound(x1, y1, x3, y3, this.renderBound);\n    } else {\n      const { x2, x4, y2, y4 } = renderCoords;\n      this.renderBound = createBound(\n        Math.min(x1, x2, x3, x4),\n        Math.min(y1, y2, y3, y4),\n        Math.max(x1, x2, x3, x4),\n        Math.max(y1, y2, y3, y4),\n        this.renderBound,\n      );\n    }\n  }\n\n  createRenderBounds(): void {\n    assertTruthy(this.stage);\n\n    if (this.parent !== null && this.parent.strictBound !== undefined) {\n      // we have a parent with a valid bound, copy it\n      const parentBound = this.parent.strictBound;\n      this.strictBound = createBound(\n        parentBound.x1,\n        parentBound.y1,\n        parentBound.x2,\n        parentBound.y2,\n      );\n\n      this.preloadBound = createPreloadBounds(\n        this.strictBound,\n        this.boundsMargin as [number, number, number, number],\n      );\n    } else {\n      // no parent or parent does not have a bound, take the stage boundaries\n      this.strictBound = this.stage.strictBound;\n      this.preloadBound = this.stage.preloadBound;\n    }\n\n    // if clipping is disabled, we're done\n    if (this.props.clipping === false) {\n      return;\n    }\n\n    // only create local clipping bounds if node itself is in bounds\n    // this can only be done if we have a render bound already\n    if (this.renderBound === undefined) {\n      return;\n    }\n\n    // if we're out of bounds, we're done\n    if (boundInsideBound(this.renderBound, this.strictBound) === false) {\n      return;\n    }\n\n    // clipping is enabled and we are in bounds create our own bounds\n    const { x, y, width, height } = this.props;\n\n    // Pick the global transform if available, otherwise use the local transform\n    // global transform is only available if the node in an RTT chain\n    const { tx, ty } = this.sceneGlobalTransform || this.globalTransform || {};\n    const _x = tx ?? x;\n    const _y = ty ?? y;\n    this.strictBound = createBound(\n      _x,\n      _y,\n      _x + width,\n      _y + height,\n      this.strictBound,\n    );\n\n    this.preloadBound = createPreloadBounds(\n      this.strictBound,\n      this.boundsMargin as [number, number, number, number],\n    );\n  }\n\n  updateRenderState(renderState: CoreNodeRenderState) {\n    if (renderState === this.renderState) {\n      return;\n    }\n\n    const previous = this.renderState;\n    this.renderState = renderState;\n    const event = CoreNodeRenderStateMap.get(renderState);\n    assertTruthy(event);\n    this.emit(event, {\n      previous,\n      current: renderState,\n    });\n  }\n\n  /**\n   * Updates the `isRenderable` property based on various conditions.\n   */\n  updateIsRenderable() {\n    let newIsRenderable = false;\n    let needsTextureOwnership = false;\n\n    // If the node is out of bounds or has an alpha of 0, it is not renderable\n    if (this.checkBasicRenderability() === false) {\n      this.updateTextureOwnership(false);\n      this.setRenderable(false);\n      return;\n    }\n\n    if (this.texture !== null) {\n      // preemptive check for failed textures this will mark the current node as non-renderable\n      // and will prevent further checks until the texture is reloaded or retry is reset on the texture\n      if (this.texture.retryCount > this.texture.maxRetryCount) {\n        // texture has failed to load, we cannot render\n        this.updateTextureOwnership(false);\n        this.setRenderable(false);\n        return;\n      }\n\n      needsTextureOwnership = true;\n      // we're only renderable if the texture state is loaded\n      newIsRenderable = this.texture.state === 'loaded';\n    } else if (\n      (this.hasShader() || this.hasColorProperties() === true) &&\n      this.hasDimensions() === true\n    ) {\n      // This mean we have dimensions and a color set, so we can render a ColorTexture\n      if (\n        this.stage.defaultTexture &&\n        this.stage.defaultTexture.state === 'loaded'\n      ) {\n        newIsRenderable = true;\n      }\n    }\n\n    this.updateTextureOwnership(needsTextureOwnership);\n    this.setRenderable(newIsRenderable);\n  }\n\n  /**\n   * Checks if the node is renderable based on world alpha, dimensions and out of bounds status.\n   */\n  checkBasicRenderability(): boolean {\n    if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  /**\n   * Sets the renderable state and triggers changes if necessary.\n   * @param isRenderable - The new renderable state\n   */\n  setRenderable(isRenderable: boolean) {\n    const previousIsRenderable = this.isRenderable;\n    this.isRenderable = isRenderable;\n\n    // Emit event if renderable status has changed\n    if (previousIsRenderable !== isRenderable) {\n      this.emit('renderable', {\n        type: 'renderable',\n        isRenderable,\n      } satisfies NodeRenderablePayload);\n    }\n  }\n\n  /**\n   * Changes the renderable state of the node.\n   */\n  updateTextureOwnership(isRenderable: boolean) {\n    this.texture?.setRenderableOwner(this._id, isRenderable);\n  }\n\n  /**\n   * Checks if the node is out of the viewport bounds.\n   */\n  isOutOfBounds(): boolean {\n    return this.renderState <= CoreNodeRenderState.OutOfBounds;\n  }\n\n  /**\n   * Checks if the node has dimensions (width/height)\n   */\n  hasDimensions(): boolean {\n    return this.props.width !== 0 && this.props.height !== 0;\n  }\n\n  /**\n   * Checks if the node has any color properties set.\n   */\n  hasColorProperties(): boolean {\n    return (\n      this.props.color !== 0 ||\n      this.props.colorTop !== 0 ||\n      this.props.colorBottom !== 0 ||\n      this.props.colorLeft !== 0 ||\n      this.props.colorRight !== 0 ||\n      this.props.colorTl !== 0 ||\n      this.props.colorTr !== 0 ||\n      this.props.colorBl !== 0 ||\n      this.props.colorBr !== 0\n    );\n  }\n\n  hasShader(): boolean {\n    return this.props.shader !== null;\n  }\n\n  calculateRenderCoords() {\n    const { width, height } = this;\n    const { tx, ty, ta, tb, tc, td } = this.globalTransform!;\n    if (tb === 0 && tc === 0) {\n      const minX = tx;\n      const maxX = tx + width * ta;\n      const minY = ty;\n      const maxY = ty + height * td;\n      this.renderCoords = RenderCoords.translate(\n        //top-left\n        minX,\n        minY,\n        //top-right\n        maxX,\n        minY,\n        //bottom-right\n        maxX,\n        maxY,\n        //bottom-left\n        minX,\n        maxY,\n        this.renderCoords,\n      );\n    } else {\n      this.renderCoords = RenderCoords.translate(\n        //top-left\n        tx,\n        ty,\n        //top-right\n        tx + width * ta,\n        ty + width * tc,\n        //bottom-right\n        tx + width * ta + height * tb,\n        ty + width * tc + height * td,\n        //bottom-left\n        tx + height * tb,\n        ty + height * td,\n        this.renderCoords,\n      );\n    }\n    if (this.sceneGlobalTransform === undefined) {\n      return;\n    }\n\n    const {\n      tx: stx,\n      ty: sty,\n      ta: sta,\n      tb: stb,\n      tc: stc,\n      td: std,\n    } = this.sceneGlobalTransform;\n    if (stb === 0 && stc === 0) {\n      const minX = stx;\n      const maxX = stx + width * sta;\n      const minY = sty;\n      const maxY = sty + height * std;\n      this.sceneRenderCoords = RenderCoords.translate(\n        //top-left\n        minX,\n        minY,\n        //top-right\n        maxX,\n        minY,\n        //bottom-right\n        maxX,\n        maxY,\n        //bottom-left\n        minX,\n        maxY,\n        this.sceneRenderCoords,\n      );\n    } else {\n      this.sceneRenderCoords = RenderCoords.translate(\n        //top-left\n        stx,\n        sty,\n        //top-right\n        stx + width * sta,\n        sty + width * stc,\n        //bottom-right\n        stx + width * sta + height * stb,\n        sty + width * stc + height * std,\n        //bottom-left\n        stx + height * stb,\n        sty + height * std,\n        this.sceneRenderCoords,\n      );\n    }\n  }\n\n  /**\n   * This function calculates the clipping rectangle for a node.\n   *\n   * The function then checks if the node is rotated. If the node requires clipping and is not rotated, a new clipping rectangle is created based on the node's global transform and dimensions.\n   * If a parent clipping rectangle exists, it is intersected with the node's clipping rectangle (if it exists), or replaces the node's clipping rectangle.\n   *\n   * Finally, the node's parentClippingRect and clippingRect properties are updated.\n   */\n  calculateClippingRect(parentClippingRect: RectWithValid) {\n    assertTruthy(this.globalTransform);\n    const { clippingRect, props, globalTransform: gt } = this;\n    const { clipping } = props;\n    const isRotated = gt.tb !== 0 || gt.tc !== 0;\n\n    if (clipping === true && isRotated === false) {\n      clippingRect.x = gt.tx;\n      clippingRect.y = gt.ty;\n      clippingRect.width = this.width * gt.ta;\n      clippingRect.height = this.height * gt.td;\n      clippingRect.valid = true;\n    } else {\n      clippingRect.valid = false;\n    }\n\n    if (parentClippingRect.valid === true && clippingRect.valid === true) {\n      // Intersect parent clipping rect with node clipping rect\n      intersectRect(parentClippingRect, clippingRect, clippingRect);\n    } else if (parentClippingRect.valid === true) {\n      // Copy parent clipping rect\n      copyRect(parentClippingRect, clippingRect);\n      clippingRect.valid = true;\n    }\n  }\n\n  calculateZIndex(): void {\n    const props = this.props;\n    const z = props.zIndex || 0;\n    const p = props.parent?.zIndex || 0;\n\n    let zIndex = z;\n    if (props.parent?.zIndexLocked) {\n      zIndex = z < p ? z : p;\n    }\n    this.calcZIndex = zIndex;\n  }\n\n  /**\n   * Destroy the node and cleanup all resources\n   */\n  destroy(): void {\n    if (this.destroyed === true) {\n      return;\n    }\n\n    this.destroyed = true;\n    this.unloadTexture();\n\n    this.clippingRect.valid = false;\n    this.isRenderable = false;\n\n    this.renderCoords = undefined;\n    this.renderBound = undefined;\n    this.strictBound = undefined;\n    this.preloadBound = undefined;\n    this.globalTransform = undefined;\n    this.scaleRotateTransform = undefined;\n    this.localTransform = undefined;\n\n    this.props.texture = null;\n    this.props.shader = this.stage.defShaderCtr;\n\n    while (this.children.length > 0) {\n      this.children[0]?.destroy();\n    }\n\n    // This very action will also remove the node from the parent's children array\n    this.parent = null;\n\n    if (this.rtt) {\n      this.stage.renderer.removeRTTNode(this);\n    }\n\n    this.removeAllListeners();\n  }\n\n  renderQuads(renderer: CoreRenderer): void {\n    // Prevent quad rendering if parent has a render texture\n    // and renderer is not currently rendering to a texture\n    if (this.parentHasRenderTexture) {\n      if (!renderer.renderToTextureActive) {\n        return;\n      }\n      // Prevent quad rendering if parent render texture is not the active render texture\n      if (this.parentRenderTexture !== renderer.activeRttNode) {\n        return;\n      }\n    }\n\n    assertTruthy(this.globalTransform);\n    assertTruthy(this.renderCoords);\n\n    // add to list of renderables to be sorted before rendering\n    renderer.addQuad({\n      width: this.props.width,\n      height: this.props.height,\n      colorTl: this.premultipliedColorTl,\n      colorTr: this.premultipliedColorTr,\n      colorBl: this.premultipliedColorBl,\n      colorBr: this.premultipliedColorBr,\n      // if we do not have a texture, use the default texture\n      // this assumes any renderable node is either a distinct texture or a ColorTexture\n      texture: this.texture || this.stage.defaultTexture,\n      textureOptions: this.textureOptions,\n      zIndex: this.zIndex,\n      shader: this.shader.shader,\n      shaderProps: this.shader.getResolvedProps(),\n      alpha: this.worldAlpha,\n      clippingRect: this.clippingRect,\n      tx: this.globalTransform.tx,\n      ty: this.globalTransform.ty,\n      ta: this.globalTransform.ta,\n      tb: this.globalTransform.tb,\n      tc: this.globalTransform.tc,\n      td: this.globalTransform.td,\n      renderCoords: this.renderCoords,\n      rtt: this.rtt,\n      parentHasRenderTexture: this.parentHasRenderTexture,\n      framebufferDimensions: this.framebufferDimensions,\n    });\n  }\n\n  //#region Properties\n  get id(): number {\n    return this._id;\n  }\n\n  get data(): CustomDataMap | undefined {\n    return this.props.data;\n  }\n\n  set data(d: CustomDataMap | undefined) {\n    this.props.data = d;\n  }\n\n  get x(): number {\n    return this.props.x;\n  }\n\n  set x(value: number) {\n    if (this.props.x !== value) {\n      this.props.x = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get absX(): number {\n    return (\n      this.props.x +\n      -this.props.width * this.props.mountX +\n      (this.props.parent?.absX || this.props.parent?.globalTransform?.tx || 0)\n    );\n  }\n\n  get absY(): number {\n    return (\n      this.props.y +\n      -this.props.height * this.props.mountY +\n      (this.props.parent?.absY ?? 0)\n    );\n  }\n\n  get y(): number {\n    return this.props.y;\n  }\n\n  set y(value: number) {\n    if (this.props.y !== value) {\n      this.props.y = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get width(): number {\n    return this.props.width;\n  }\n\n  set width(value: number) {\n    if (this.props.width !== value) {\n      this.props.width = value;\n      this.setUpdateType(UpdateType.Local);\n\n      if (this.props.rtt) {\n        this.texture = this.stage.txManager.createTexture('RenderTexture', {\n          width: this.width,\n          height: this.height,\n        });\n\n        this.setUpdateType(UpdateType.RenderTexture);\n      }\n    }\n  }\n\n  get height(): number {\n    return this.props.height;\n  }\n\n  set height(value: number) {\n    if (this.props.height !== value) {\n      this.props.height = value;\n      this.setUpdateType(UpdateType.Local);\n\n      if (this.props.rtt) {\n        this.texture = this.stage.txManager.createTexture('RenderTexture', {\n          width: this.width,\n          height: this.height,\n        });\n\n        this.setUpdateType(UpdateType.RenderTexture);\n      }\n    }\n  }\n\n  get scale(): number {\n    // The CoreNode `scale` property is only used by Animations.\n    // Unlike INode, `null` should never be possibility for Animations.\n    return this.scaleX;\n  }\n\n  set scale(value: number) {\n    // The CoreNode `scale` property is only used by Animations.\n    // Unlike INode, `null` should never be possibility for Animations.\n    this.scaleX = value;\n    this.scaleY = value;\n  }\n\n  get scaleX(): number {\n    return this.props.scaleX;\n  }\n\n  set scaleX(value: number) {\n    if (this.props.scaleX !== value) {\n      this.props.scaleX = value;\n      this.setUpdateType(UpdateType.ScaleRotate);\n    }\n  }\n\n  get scaleY(): number {\n    return this.props.scaleY;\n  }\n\n  set scaleY(value: number) {\n    if (this.props.scaleY !== value) {\n      this.props.scaleY = value;\n      this.setUpdateType(UpdateType.ScaleRotate);\n    }\n  }\n\n  get mount(): number {\n    return this.props.mount;\n  }\n\n  set mount(value: number) {\n    if (this.props.mountX !== value || this.props.mountY !== value) {\n      this.props.mountX = value;\n      this.props.mountY = value;\n      this.props.mount = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get mountX(): number {\n    return this.props.mountX;\n  }\n\n  set mountX(value: number) {\n    if (this.props.mountX !== value) {\n      this.props.mountX = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get mountY(): number {\n    return this.props.mountY;\n  }\n\n  set mountY(value: number) {\n    if (this.props.mountY !== value) {\n      this.props.mountY = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get pivot(): number {\n    return this.props.pivot;\n  }\n\n  set pivot(value: number) {\n    if (this.props.pivotX !== value || this.props.pivotY !== value) {\n      this.props.pivotX = value;\n      this.props.pivotY = value;\n      this.props.pivot = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get pivotX(): number {\n    return this.props.pivotX;\n  }\n\n  set pivotX(value: number) {\n    if (this.props.pivotX !== value) {\n      this.props.pivotX = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get pivotY(): number {\n    return this.props.pivotY;\n  }\n\n  set pivotY(value: number) {\n    if (this.props.pivotY !== value) {\n      this.props.pivotY = value;\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  get rotation(): number {\n    return this.props.rotation;\n  }\n\n  set rotation(value: number) {\n    if (this.props.rotation !== value) {\n      this.props.rotation = value;\n      this.setUpdateType(UpdateType.ScaleRotate);\n    }\n  }\n\n  get alpha(): number {\n    return this.props.alpha;\n  }\n\n  set alpha(value: number) {\n    this.props.alpha = value;\n    this.setUpdateType(\n      UpdateType.PremultipliedColors |\n        UpdateType.WorldAlpha |\n        UpdateType.Children |\n        UpdateType.IsRenderable,\n    );\n    this.childUpdateType |= UpdateType.WorldAlpha;\n  }\n\n  get autosize(): boolean {\n    return this.props.autosize;\n  }\n\n  set autosize(value: boolean) {\n    this.props.autosize = value;\n  }\n\n  get boundsMargin(): number | [number, number, number, number] | null {\n    return (\n      this.props.boundsMargin ??\n      this.parent?.boundsMargin ??\n      this.stage.boundsMargin\n    );\n  }\n\n  set boundsMargin(value: number | [number, number, number, number] | null) {\n    if (value === this.props.boundsMargin) {\n      return;\n    }\n\n    if (value === null) {\n      this.props.boundsMargin = value;\n    } else {\n      const bm: [number, number, number, number] = Array.isArray(value)\n        ? value\n        : [value, value, value, value];\n\n      this.props.boundsMargin = bm;\n    }\n    this.setUpdateType(UpdateType.RenderBounds);\n  }\n\n  get clipping(): boolean {\n    return this.props.clipping;\n  }\n\n  set clipping(value: boolean) {\n    this.props.clipping = value;\n    this.setUpdateType(\n      UpdateType.Clipping | UpdateType.RenderBounds | UpdateType.Children,\n    );\n    this.childUpdateType |= UpdateType.Global | UpdateType.Clipping;\n  }\n\n  get color(): number {\n    return this.props.color;\n  }\n\n  set color(value: number) {\n    this.colorTop = value;\n    this.colorBottom = value;\n    this.colorLeft = value;\n    this.colorRight = value;\n    this.props.color = value;\n\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorTop(): number {\n    return this.props.colorTop;\n  }\n\n  set colorTop(value: number) {\n    if (this.props.colorTl !== value || this.props.colorTr !== value) {\n      this.colorTl = value;\n      this.colorTr = value;\n    }\n    this.props.colorTop = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorBottom(): number {\n    return this.props.colorBottom;\n  }\n\n  set colorBottom(value: number) {\n    if (this.props.colorBl !== value || this.props.colorBr !== value) {\n      this.colorBl = value;\n      this.colorBr = value;\n    }\n    this.props.colorBottom = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorLeft(): number {\n    return this.props.colorLeft;\n  }\n\n  set colorLeft(value: number) {\n    if (this.props.colorTl !== value || this.props.colorBl !== value) {\n      this.colorTl = value;\n      this.colorBl = value;\n    }\n    this.props.colorLeft = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorRight(): number {\n    return this.props.colorRight;\n  }\n\n  set colorRight(value: number) {\n    if (this.props.colorTr !== value || this.props.colorBr !== value) {\n      this.colorTr = value;\n      this.colorBr = value;\n    }\n    this.props.colorRight = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorTl(): number {\n    return this.props.colorTl;\n  }\n\n  set colorTl(value: number) {\n    this.props.colorTl = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorTr(): number {\n    return this.props.colorTr;\n  }\n\n  set colorTr(value: number) {\n    this.props.colorTr = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorBl(): number {\n    return this.props.colorBl;\n  }\n\n  set colorBl(value: number) {\n    this.props.colorBl = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  get colorBr(): number {\n    return this.props.colorBr;\n  }\n\n  set colorBr(value: number) {\n    this.props.colorBr = value;\n    this.setUpdateType(UpdateType.PremultipliedColors);\n  }\n\n  // we're only interested in parent zIndex to test\n  // if we should use node zIndex is higher then parent zIndex\n  get zIndexLocked(): number {\n    return this.props.zIndexLocked || 0;\n  }\n\n  set zIndexLocked(value: number) {\n    this.props.zIndexLocked = value;\n    this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n    for (let i = 0, length = this.children.length; i < length; i++) {\n      this.children[i]!.setUpdateType(UpdateType.CalculatedZIndex);\n    }\n  }\n\n  get zIndex(): number {\n    return this.props.zIndex;\n  }\n\n  set zIndex(value: number) {\n    this.props.zIndex = value;\n    this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);\n    for (let i = 0, length = this.children.length; i < length; i++) {\n      this.children[i]!.setUpdateType(UpdateType.CalculatedZIndex);\n    }\n  }\n\n  get parent(): CoreNode | null {\n    return this.props.parent;\n  }\n\n  set parent(newParent: CoreNode | null) {\n    const oldParent = this.props.parent;\n    if (oldParent === newParent) {\n      return;\n    }\n    this.props.parent = newParent;\n    if (oldParent) {\n      const index = oldParent.children.indexOf(this);\n      assertTruthy(\n        index !== -1,\n        \"CoreNode.parent: Node not found in old parent's children!\",\n      );\n      oldParent.children.splice(index, 1);\n      oldParent.setUpdateType(\n        UpdateType.Children | UpdateType.ZIndexSortedChildren,\n      );\n    }\n    if (newParent) {\n      newParent.children.push(this);\n      // Since this node has a new parent, to be safe, have it do a full update.\n      this.setUpdateType(UpdateType.All);\n      // Tell parent that it's children need to be updated and sorted.\n      newParent.setUpdateType(\n        UpdateType.Children | UpdateType.ZIndexSortedChildren,\n      );\n\n      // If the new parent has an RTT enabled, apply RTT inheritance\n      if (newParent.rtt || newParent.parentHasRenderTexture) {\n        this.applyRTTInheritance(newParent);\n      }\n    }\n    this.updateScaleRotateTransform();\n\n    // fetch render bounds from parent\n    this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);\n  }\n\n  get preventCleanup(): boolean {\n    return this.props.textureOptions.preventCleanup || false;\n  }\n\n  set preventCleanup(value: boolean) {\n    if (isProductionEnvironment === false) {\n      console.warn(\n        'CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead',\n      );\n    }\n\n    this.props.textureOptions.preventCleanup = value;\n  }\n\n  get rtt(): boolean {\n    return this.props.rtt;\n  }\n\n  set rtt(value: boolean) {\n    if (this.props.rtt === value) {\n      return;\n    }\n    this.props.rtt = value;\n\n    if (value === true) {\n      this.initRenderTexture();\n      this.markChildrenWithRTT();\n    } else {\n      this.cleanupRenderTexture();\n    }\n\n    this.setUpdateType(UpdateType.RenderTexture);\n\n    if (this.parentHasRenderTexture === true) {\n      this.notifyParentRTTOfUpdate();\n    }\n  }\n  private initRenderTexture() {\n    this.texture = this.stage.txManager.createTexture('RenderTexture', {\n      width: this.width,\n      height: this.height,\n    });\n\n    this.stage.renderer.renderToTexture(this);\n  }\n\n  private cleanupRenderTexture() {\n    this.unloadTexture();\n    this.clearRTTInheritance();\n\n    this.hasRTTupdates = false;\n    this.texture = null;\n  }\n\n  private markChildrenWithRTT(node: CoreNode | null = null) {\n    const parent = node || this;\n\n    for (const child of parent.children) {\n      child.setUpdateType(UpdateType.All);\n      child.parentHasRenderTexture = true;\n      child.markChildrenWithRTT();\n    }\n  }\n\n  // Apply RTT inheritance when a node has an RTT-enabled parent\n  private applyRTTInheritance(parent: CoreNode) {\n    if (parent.rtt) {\n      // Only the RTT node should be added to `renderToTexture`\n      parent.setUpdateType(UpdateType.RenderTexture);\n    }\n\n    // Propagate `parentHasRenderTexture` downwards\n    this.markChildrenWithRTT(parent);\n  }\n\n  // Clear RTT inheritance when detaching from an RTT chain\n  private clearRTTInheritance() {\n    // if this node is RTT itself stop the propagation important for nested RTT nodes\n    // for the initial RTT node this is already handled in `set rtt`\n    if (this.rtt) {\n      return;\n    }\n\n    for (const child of this.children) {\n      // force child to update everything as the RTT inheritance has changed\n      child.parentHasRenderTexture = false;\n      child.rttParent = null;\n      child.setUpdateType(UpdateType.All);\n      child.clearRTTInheritance();\n    }\n  }\n\n  get shader(): BaseShaderController {\n    return this.props.shader;\n  }\n\n  set shader(value: BaseShaderController) {\n    if (this.props.shader === value) {\n      return;\n    }\n\n    this.props.shader = value;\n\n    this.setUpdateType(UpdateType.IsRenderable);\n  }\n\n  get src(): string | null {\n    return this.props.src;\n  }\n\n  set src(imageUrl: string | null) {\n    if (this.props.src === imageUrl) {\n      return;\n    }\n\n    this.props.src = imageUrl;\n\n    if (!imageUrl) {\n      this.texture = null;\n      return;\n    }\n\n    this.texture = this.stage.txManager.createTexture('ImageTexture', {\n      src: imageUrl,\n      width: this.props.width,\n      height: this.props.height,\n      type: this.props.imageType,\n      sx: this.props.srcX,\n      sy: this.props.srcY,\n      sw: this.props.srcWidth,\n      sh: this.props.srcHeight,\n      maxRetryCount: this.props.textureOptions.maxRetryCount,\n    });\n  }\n\n  set imageType(type: 'regular' | 'compressed' | 'svg' | null) {\n    if (this.props.imageType === type) {\n      return;\n    }\n\n    this.props.imageType = type;\n  }\n\n  get imageType() {\n    return this.props.imageType || null;\n  }\n\n  get srcHeight(): number | undefined {\n    return this.props.srcHeight;\n  }\n\n  set srcHeight(value: number) {\n    this.props.srcHeight = value;\n  }\n\n  get srcWidth(): number | undefined {\n    return this.props.srcWidth;\n  }\n\n  set srcWidth(value: number) {\n    this.props.srcWidth = value;\n  }\n\n  get srcX(): number | undefined {\n    return this.props.srcX;\n  }\n\n  set srcX(value: number) {\n    this.props.srcX = value;\n  }\n\n  get srcY(): number | undefined {\n    return this.props.srcY;\n  }\n\n  set srcY(value: number) {\n    this.props.srcY = value;\n  }\n\n  /**\n   * Returns the framebuffer dimensions of the node.\n   * If the node has a render texture, the dimensions are the same as the node's dimensions.\n   * If the node does not have a render texture, the dimensions are inherited from the parent.\n   * If the node parent has a render texture and the node is a render texture, the nodes dimensions are used.\n   */\n  get framebufferDimensions(): Dimensions {\n    if (this.parentHasRenderTexture && !this.rtt && this.parent) {\n      return this.parent.framebufferDimensions;\n    }\n    return { width: this.width, height: this.height };\n  }\n\n  /**\n   * Returns the parent render texture node if it exists.\n   */\n  get parentRenderTexture(): CoreNode | null {\n    let parent = this.parent;\n    while (parent) {\n      if (parent.rtt) {\n        return parent;\n      }\n      parent = parent.parent;\n    }\n    return null;\n  }\n\n  get texture(): Texture | null {\n    return this.props.texture;\n  }\n\n  set texture(value: Texture | null) {\n    if (this.props.texture === value) {\n      return;\n    }\n\n    const oldTexture = this.props.texture;\n    if (oldTexture) {\n      this.unloadTexture();\n    }\n\n    this.props.texture = value;\n    if (value !== null) {\n      value.setRenderableOwner(this._id, this.isRenderable);\n      this.loadTexture();\n    }\n\n    this.setUpdateType(UpdateType.IsRenderable);\n  }\n\n  set textureOptions(value: TextureOptions) {\n    this.props.textureOptions = value;\n  }\n\n  get textureOptions(): TextureOptions {\n    return this.props.textureOptions;\n  }\n\n  get strictBounds(): boolean {\n    return this.props.strictBounds;\n  }\n\n  set strictBounds(v) {\n    if (v === this.props.strictBounds) {\n      return;\n    }\n\n    this.props.strictBounds = v;\n    this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);\n    this.childUpdateType |= UpdateType.RenderBounds | UpdateType.Children;\n  }\n\n  set interactive(value: boolean | undefined) {\n    this.props.interactive = value;\n    // Update Stage's interactive Set\n    if (value === true) {\n      this.stage.interactiveNodes.add(this);\n    }\n  }\n\n  get interactive(): boolean | undefined {\n    return this.props.interactive;\n  }\n\n  animate(\n    props: Partial<CoreNodeAnimateProps>,\n    settings: Partial<AnimationSettings>,\n  ): IAnimationController {\n    const animation = new CoreAnimation(this, props, settings);\n\n    const controller = new CoreAnimationController(\n      this.stage.animationManager,\n      animation,\n    );\n\n    return controller;\n  }\n\n  flush() {\n    // no-op\n  }\n\n  //#endregion Properties\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Stage } from './Stage.js';\n\n/**\n * Platform render loop initiator\n */\nexport const startLoop = (stage: Stage) => {\n  let isIdle = false;\n  let lastFrameTime = 0;\n\n  const runLoop = (currentTime: number = 0) => {\n    const targetFrameTime = stage.targetFrameTime;\n\n    // Check if we should throttle this frame\n    if (targetFrameTime > 0 && currentTime - lastFrameTime < targetFrameTime) {\n      // Too early for next frame, schedule with setTimeout for precise timing\n      const delay = targetFrameTime - (currentTime - lastFrameTime);\n      setTimeout(() => requestAnimationFrame(runLoop), delay);\n      return;\n    }\n\n    lastFrameTime = currentTime;\n\n    stage.updateFrameTime();\n    stage.updateAnimations();\n\n    if (!stage.hasSceneUpdates()) {\n      // We still need to calculate the fps else it looks like the app is frozen\n      stage.calculateFps();\n\n      if (targetFrameTime > 0) {\n        // Use setTimeout for throttled idle frames\n        setTimeout(\n          () => requestAnimationFrame(runLoop),\n          Math.max(targetFrameTime, 16.666666666666668),\n        );\n      } else {\n        // Use standard idle timeout when not throttling\n        setTimeout(() => requestAnimationFrame(runLoop), 16.666666666666668);\n      }\n\n      if (!isIdle) {\n        stage.eventBus.emit('idle');\n        isIdle = true;\n      }\n\n      if (stage.txMemManager.checkCleanup() === true) {\n        stage.txMemManager.cleanup();\n      }\n\n      stage.flushFrameEvents();\n      return;\n    }\n\n    isIdle = false;\n    stage.drawFrame();\n    stage.flushFrameEvents();\n\n    // Schedule next frame\n    if (targetFrameTime > 0) {\n      // Use setTimeout + rAF combination for precise FPS control\n      const nextFrameDelay = Math.max(\n        0,\n        targetFrameTime - (performance.now() - currentTime),\n      );\n      setTimeout(() => requestAnimationFrame(runLoop), nextFrameDelay);\n    } else {\n      // Use standard rAF when not throttling\n      requestAnimationFrame(runLoop);\n    }\n  };\n\n  requestAnimationFrame(runLoop);\n};\n\n/**\n * Return unix timestamp\n * @return {number}\n */\nexport const getTimeStamp = () => {\n  return performance ? performance.now() : Date.now();\n};\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CoreAnimation } from './CoreAnimation.js';\n\nexport class AnimationManager {\n  activeAnimations: Set<CoreAnimation> = new Set();\n\n  registerAnimation(animation: CoreAnimation) {\n    this.activeAnimations.add(animation);\n  }\n\n  unregisterAnimation(animation: CoreAnimation) {\n    this.activeAnimations.delete(animation);\n  }\n\n  update(dt: number) {\n    this.activeAnimations.forEach((animation) => {\n      animation.update(dt);\n    });\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CreateImageBitmapSupport } from '../lib/validateImageBitmap.js';\nimport { type TextureData } from '../textures/Texture.js';\n\ntype MessageCallback = [(value: any) => void, (reason: any) => void];\ninterface getImageReturn {\n  data: ImageBitmap;\n  premultiplyAlpha: boolean | null;\n}\n\ninterface ImageWorkerMessage {\n  id: number;\n  src: string;\n  data: getImageReturn;\n  error: string;\n  sx: number | null;\n  sy: number | null;\n  sw: number | null;\n  sh: number | null;\n}\n\n/**\n * Note that, within the createImageWorker function, we must only use ES5 code to keep it ES5-valid after babelifying, as\n *  the converted code of this section is converted to a blob and used as the js of the web worker thread.\n *\n * The createImageWorker function is a web worker that fetches an image from a URL and returns an ImageBitmap object.\n * The eslint @typescript rule is disabled for the entire function because the function is converted to a blob and used as the\n * js of the web worker thread, so the typescript syntax is not valid in this context.\n */\n\n/* eslint-disable */\nfunction createImageWorker() {\n  function hasAlphaChannel(mimeType: string) {\n    return mimeType.indexOf('image/png') !== -1;\n  }\n\n  function getImage(\n    src: string,\n    premultiplyAlpha: boolean | null,\n    x: number | null,\n    y: number | null,\n    width: number | null,\n    height: number | null,\n    options: {\n      supportsOptionsCreateImageBitmap: boolean;\n      supportsFullCreateImageBitmap: boolean;\n    },\n  ): Promise<getImageReturn> {\n    return new Promise(function (resolve, reject) {\n      var supportsOptionsCreateImageBitmap =\n        options.supportsOptionsCreateImageBitmap;\n      var supportsFullCreateImageBitmap = options.supportsFullCreateImageBitmap;\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', src, true);\n      xhr.responseType = 'blob';\n\n      xhr.onload = function () {\n        // On most devices like WebOS and Tizen, the file protocol returns 0 while http(s) protocol returns 200\n        if (xhr.status !== 200 && xhr.status !== 0) {\n          return reject(new Error('Failed to load image: ' + xhr.statusText));\n        }\n\n        var blob = xhr.response;\n        var withAlphaChannel =\n          premultiplyAlpha !== undefined\n            ? premultiplyAlpha\n            : hasAlphaChannel(blob.type);\n\n        // createImageBitmap with crop and options\n        if (\n          supportsFullCreateImageBitmap === true &&\n          width !== null &&\n          height !== null\n        ) {\n          createImageBitmap(blob, x || 0, y || 0, width, height, {\n            premultiplyAlpha: withAlphaChannel ? 'premultiply' : 'none',\n            colorSpaceConversion: 'none',\n            imageOrientation: 'none',\n          })\n            .then(function (data) {\n              resolve({ data, premultiplyAlpha: premultiplyAlpha });\n            })\n            .catch(function (error) {\n              reject(error);\n            });\n          return;\n        } else if (\n          supportsOptionsCreateImageBitmap === false &&\n          supportsOptionsCreateImageBitmap === false\n        ) {\n          // Fallback for browsers that do not support createImageBitmap with options\n          // this is supported for Chrome v50 to v52/54 that doesn't support options\n          createImageBitmap(blob)\n            .then(function (data) {\n              resolve({ data, premultiplyAlpha: premultiplyAlpha });\n            })\n            .catch(function (error) {\n              reject(error);\n            });\n        } else {\n          createImageBitmap(blob, {\n            premultiplyAlpha: withAlphaChannel ? 'premultiply' : 'none',\n            colorSpaceConversion: 'none',\n            imageOrientation: 'none',\n          })\n            .then(function (data) {\n              resolve({ data, premultiplyAlpha: premultiplyAlpha });\n            })\n            .catch(function (error) {\n              reject(error);\n            });\n        }\n      };\n\n      xhr.onerror = function () {\n        reject(\n          new Error('Network error occurred while trying to fetch the image.'),\n        );\n      };\n\n      xhr.send();\n    });\n  }\n\n  self.onmessage = (event) => {\n    var src = event.data.src;\n    var id = event.data.id;\n    var premultiplyAlpha = event.data.premultiplyAlpha;\n    var x = event.data.sx;\n    var y = event.data.sy;\n    var width = event.data.sw;\n    var height = event.data.sh;\n\n    // these will be set to true if the browser supports the createImageBitmap options or full\n    var supportsOptionsCreateImageBitmap = false;\n    var supportsFullCreateImageBitmap = false;\n\n    getImage(src, premultiplyAlpha, x, y, width, height, {\n      supportsOptionsCreateImageBitmap,\n      supportsFullCreateImageBitmap,\n    })\n      .then(function (data) {\n        // @ts-ignore ts has wrong postMessage signature\n        self.postMessage({ id: id, src: src, data: data }, [data.data]);\n      })\n      .catch(function (error) {\n        self.postMessage({ id: id, src: src, error: error.message });\n      });\n  };\n}\n/* eslint-enable */\n\nexport class ImageWorkerManager {\n  imageWorkersEnabled = true;\n  messageManager: Record<number, MessageCallback> = {};\n  workers: Worker[] = [];\n  workerIndex = 0;\n  nextId = 0;\n\n  constructor(\n    numImageWorkers: number,\n    createImageBitmapSupport: CreateImageBitmapSupport,\n  ) {\n    this.workers = this.createWorkers(\n      numImageWorkers,\n      createImageBitmapSupport,\n    );\n    this.workers.forEach((worker) => {\n      worker.onmessage = this.handleMessage.bind(this);\n    });\n  }\n\n  private handleMessage(event: MessageEvent) {\n    const { id, data, error } = event.data as ImageWorkerMessage;\n    const msg = this.messageManager[id];\n    if (msg) {\n      const [resolve, reject] = msg;\n      delete this.messageManager[id];\n      if (error) {\n        reject(new Error(error));\n      } else {\n        resolve(data);\n      }\n    }\n  }\n\n  private createWorkers(\n    numWorkers = 1,\n    createImageBitmapSupport: CreateImageBitmapSupport,\n  ): Worker[] {\n    let workerCode = `(${createImageWorker.toString()})()`;\n\n    // Replace placeholders with actual initialization values\n    if (createImageBitmapSupport.options === true) {\n      workerCode = workerCode.replace(\n        'var supportsOptionsCreateImageBitmap = false;',\n        'var supportsOptionsCreateImageBitmap = true;',\n      );\n    }\n\n    if (createImageBitmapSupport.full === true) {\n      workerCode = workerCode.replace(\n        'var supportsOptionsCreateImageBitmap = false;',\n        'var supportsOptionsCreateImageBitmap = true;',\n      );\n\n      workerCode = workerCode.replace(\n        'var supportsFullCreateImageBitmap = false;',\n        'var supportsFullCreateImageBitmap = true;',\n      );\n    }\n\n    workerCode = workerCode.replace('\"use strict\";', '');\n    const blob: Blob = new Blob([workerCode], {\n      type: 'application/javascript',\n    });\n    const blobURL: string = (self.URL ? URL : webkitURL).createObjectURL(blob);\n    const workers: Worker[] = [];\n    for (let i = 0; i < numWorkers; i++) {\n      workers.push(new Worker(blobURL));\n    }\n    return workers;\n  }\n\n  private getNextWorker(): Worker | undefined {\n    const worker = this.workers[this.workerIndex];\n    this.workerIndex = (this.workerIndex + 1) % this.workers.length;\n    return worker;\n  }\n\n  getImage(\n    src: string,\n    premultiplyAlpha: boolean | null,\n    sx: number | null,\n    sy: number | null,\n    sw: number | null,\n    sh: number | null,\n  ): Promise<TextureData> {\n    return new Promise((resolve, reject) => {\n      try {\n        if (this.workers) {\n          const id = this.nextId++;\n          this.messageManager[id] = [resolve, reject];\n          const nextWorker = this.getNextWorker();\n          if (nextWorker) {\n            nextWorker.postMessage({\n              id,\n              src: src,\n              premultiplyAlpha,\n              sx,\n              sy,\n              sw,\n              sh,\n            });\n          }\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport { Texture, TextureType, type TextureData } from './Texture.js';\n\n/**\n * Properties of the {@link ColorTexture}\n */\nexport interface ColorTextureProps {\n  /**\n   * Color to use to generate the texture\n   *\n   * @default 0xffffffff (opaque white)\n   */\n  color?: number;\n}\n\n/**\n * Texture consisting of only a 1x1 color pixel\n *\n * @remarks\n * The pixel color is set with the {@link ColorTextureProps.color} prop.\n *\n * This is the default texture used for a Node if it's\n * {@link INodeProps.texture} prop is set to `null` (the default)\n *\n * Generally the 1x1 color pixel is stretched to whatever the set dimensions of\n * a Node are.\n */\nexport class ColorTexture extends Texture {\n  override readonly type = TextureType.color as const;\n  public props: Required<ColorTextureProps>;\n\n  constructor(txManager: CoreTextureManager, props: ColorTextureProps) {\n    super(txManager);\n    this.props = ColorTexture.resolveDefaults(props);\n  }\n\n  get color() {\n    return this.props.color;\n  }\n\n  set color(color: number) {\n    this.props.color = color;\n  }\n\n  override async getTextureSource(): Promise<TextureData> {\n    const pixelData = new Uint8Array(4);\n\n    if (this.color === 0xffffffff) {\n      pixelData[0] = 255;\n      pixelData[1] = 255;\n      pixelData[2] = 255;\n      pixelData[3] = 255;\n    } else {\n      pixelData[0] = (this.color >> 16) & 0xff; // Red\n      pixelData[1] = (this.color >> 8) & 0xff; // Green\n      pixelData[2] = this.color & 0xff; // Blue\n      pixelData[3] = (this.color >>> 24) & 0xff; // Alpha\n    }\n\n    return {\n      data: pixelData,\n      premultiplyAlpha: true,\n    };\n  }\n\n  static override makeCacheKey(props: ColorTextureProps): string {\n    const resolvedProps = ColorTexture.resolveDefaults(props);\n    return `ColorTexture,${resolvedProps.color}`;\n  }\n\n  static override resolveDefaults(\n    props: ColorTextureProps,\n  ): Required<ColorTextureProps> {\n    return {\n      color: props.color || 0xffffffff,\n    };\n  }\n\n  static z$__type__Props: ColorTextureProps;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { type CompressedData, type TextureData } from '../textures/Texture.js';\nimport type { WebGlContextWrapper } from './WebGlContextWrapper.js';\n\nexport type UploadCompressedTextureFunction = (\n  glw: WebGlContextWrapper,\n  texture: WebGLTexture,\n  data: CompressedData,\n) => void;\n\n/**\n * Tests if the given location is a compressed texture container\n * @param url\n * @remarks\n * This function is used to determine if the given image url is a compressed\n * and only supports the following extensions: .ktx and .pvr\n * @returns\n */\nexport function isCompressedTextureContainer(src: string): boolean {\n  return /\\.(ktx|pvr)$/.test(src);\n}\n\nconst PVR_MAGIC = 0x03525650; // 'PVR3' in little-endian\nconst PVR_TO_GL_INTERNAL_FORMAT: Record<string, number> = {\n  0: 0x8c01,\n  1: 0x8c03,\n  2: 0x8c00,\n  3: 0x8c02, // PVRTC1\n  6: 0x8d64, // ETC1\n  7: 0x83f0,\n  8: 0x83f2,\n  9: 0x83f2,\n  10: 0x83f3,\n  11: 0x83f3, // DXT variants\n};\nconst ASTC_MAGIC = 0x5ca1ab13;\n\nconst ASTC_TO_GL_INTERNAL_FORMAT: Record<string, number> = {\n  '4x4': 0x93b0, // COMPRESSED_RGBA_ASTC_4x4_KHR\n  '5x5': 0x93b1, // COMPRESSED_RGBA_ASTC_5x5_KHR\n  '6x6': 0x93b2, // COMPRESSED_RGBA_ASTC_6x6_KHR\n  '8x8': 0x93b3, // COMPRESSED_RGBA_ASTC_8x8_KHR\n  '10x10': 0x93b4, // COMPRESSED_RGBA_ASTC_10x10_KHR\n  '12x12': 0x93b5, // COMPRESSED_RGBA_ASTC_12x12_KHR\n};\n\n// KTX file identifier\nconst KTX_IDENTIFIER = [\n  0xab, 0x4b, 0x54, 0x58, 0x20, 0x31, 0x31, 0xbb, 0x0d, 0x0a, 0x1a, 0x0a,\n];\n/**\n * Loads a compressed texture container\n * @param url\n * @returns\n */\nexport const loadCompressedTexture = async (\n  url: string,\n): Promise<TextureData> => {\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(\n        `Failed to fetch compressed texture: ${response.status} ${response.statusText}`,\n      );\n    }\n\n    const arrayBuffer = await response.arrayBuffer();\n\n    // Ensure we have enough data to check magic numbers\n    if (arrayBuffer.byteLength < 16) {\n      throw new Error(\n        `File too small to be a valid compressed texture (${arrayBuffer.byteLength} bytes). Expected at least 16 bytes for header inspection.`,\n      );\n    }\n\n    const view = new DataView(arrayBuffer);\n    const magic = view.getUint32(0, true);\n\n    if (magic === PVR_MAGIC) {\n      return loadPVR(view);\n    }\n\n    if (magic === ASTC_MAGIC) {\n      return loadASTC(view);\n    }\n\n    let isKTX = true;\n\n    for (let i = 0; i < KTX_IDENTIFIER.length; i++) {\n      if (view.getUint8(i) !== KTX_IDENTIFIER[i]) {\n        isKTX = false;\n        break;\n      }\n    }\n\n    if (isKTX === true) {\n      return loadKTX(view);\n    } else {\n      throw new Error('Unrecognized compressed texture format');\n    }\n  } catch (error) {\n    throw new Error(`Failed to load compressed texture from ${url}: ${error}`);\n  }\n};\n\nfunction readUint24(view: DataView, offset: number) {\n  return (\n    view.getUint8(offset) +\n    (view.getUint8(offset + 1) << 8) +\n    (view.getUint8(offset + 2) << 16)\n  );\n}\n\n/**\n * Loads an ASTC texture container and returns the texture data\n * @param view\n * @returns\n */\nconst loadASTC = async function (view: DataView): Promise<TextureData> {\n  const blockX = view.getUint8(4);\n  const blockY = view.getUint8(5);\n  const sizeX = readUint24(view, 7);\n  const sizeY = readUint24(view, 10);\n\n  if (sizeX === 0 || sizeY === 0) {\n    throw new Error(`Invalid ASTC texture dimensions: ${sizeX}x${sizeY}`);\n  }\n  const expected = Math.ceil(sizeX / blockX) * Math.ceil(sizeY / blockY) * 16;\n  const dataSize = view.byteLength - 16;\n  if (expected !== dataSize) {\n    throw new Error(\n      `Invalid ASTC texture data size: expected ${expected}, got ${dataSize}`,\n    );\n  }\n\n  const internalFormat = ASTC_TO_GL_INTERNAL_FORMAT[`${blockX}x${blockY}`];\n  if (internalFormat === undefined) {\n    throw new Error(`Unsupported ASTC block size: ${blockX}x${blockY}`);\n  }\n\n  const buffer = view.buffer as ArrayBuffer;\n\n  const mipmaps: ArrayBuffer[] = [];\n  mipmaps.push(buffer.slice(16));\n\n  return {\n    data: {\n      blockInfo: blockInfoMap[internalFormat]!,\n      glInternalFormat: internalFormat,\n      mipmaps,\n      width: sizeX,\n      height: sizeY,\n      type: 'astc',\n    },\n    premultiplyAlpha: false,\n  };\n};\n\nconst uploadASTC = function (\n  glw: WebGlContextWrapper,\n  texture: WebGLTexture,\n  data: CompressedData,\n) {\n  if (glw.getExtension('WEBGL_compressed_texture_astc') === null) {\n    throw new Error('ASTC compressed textures not supported by this device');\n  }\n\n  glw.bindTexture(texture);\n\n  const { glInternalFormat, mipmaps, width, height } = data;\n\n  const view = new Uint8Array(mipmaps[0]!);\n\n  glw.compressedTexImage2D(0, glInternalFormat, width, height, 0, view);\n\n  // ASTC textures MUST use no mipmaps unless stored\n  glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n  glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);\n};\n/**\n * Loads a KTX texture container and returns the texture data\n * @param view\n * @returns\n */\nconst loadKTX = async function (view: DataView): Promise<TextureData> {\n  const endianness = view.getUint32(12, true);\n  const littleEndian = endianness === 0x04030201;\n  if (littleEndian === false && endianness !== 0x01020304) {\n    throw new Error('Invalid KTX endianness value');\n  }\n\n  const glType = view.getUint32(16, littleEndian);\n  const glFormat = view.getUint32(24, littleEndian);\n  if (glType !== 0 || glFormat !== 0) {\n    throw new Error(\n      `KTX texture is not compressed (glType: ${glType}, glFormat: ${glFormat})`,\n    );\n  }\n\n  const glInternalFormat = view.getUint32(28, littleEndian);\n  if (blockInfoMap[glInternalFormat] === undefined) {\n    throw new Error(\n      `Unsupported KTX compressed texture format: 0x${glInternalFormat.toString(\n        16,\n      )}`,\n    );\n  }\n\n  const width = view.getUint32(36, littleEndian);\n  const height = view.getUint32(40, littleEndian);\n  if (width === 0 || height === 0) {\n    throw new Error(`Invalid KTX texture dimensions: ${width}x${height}`);\n  }\n\n  const mipmapLevels = view.getUint32(56, littleEndian);\n  if (mipmapLevels === 0) {\n    throw new Error('KTX texture has no mipmap levels');\n  }\n\n  const bytesOfKeyValueData = view.getUint32(60, littleEndian);\n  const mipmaps: ArrayBuffer[] = [];\n  const buffer = view.buffer as ArrayBuffer;\n  let offset = 64 + bytesOfKeyValueData;\n\n  if (offset > view.byteLength) {\n    throw new Error('Invalid KTX file: key/value data exceeds file size');\n  }\n\n  for (let i = 0; i < mipmapLevels; i++) {\n    const imageSize = view.getUint32(offset, littleEndian);\n    offset += 4;\n\n    const end = offset + imageSize;\n\n    mipmaps.push(buffer.slice(offset, end));\n    offset = end;\n    if (offset % 4 !== 0) {\n      offset += 4 - (offset % 4);\n    }\n  }\n\n  return {\n    data: {\n      blockInfo: blockInfoMap[glInternalFormat]!,\n      glInternalFormat: glInternalFormat,\n      mipmaps,\n      width: width,\n      height: height,\n      type: 'ktx',\n    },\n    premultiplyAlpha: false,\n  };\n};\n\nconst uploadKTX = function (\n  glw: WebGlContextWrapper,\n  texture: WebGLTexture,\n  data: CompressedData,\n) {\n  const { glInternalFormat, mipmaps, width, height, blockInfo } = data;\n\n  glw.bindTexture(texture);\n\n  const blockWidth = blockInfo.width;\n  const blockHeight = blockInfo.height;\n  let w = width;\n  let h = height;\n\n  for (let i = 0; i < mipmaps.length; i++) {\n    let view = new Uint8Array(mipmaps[i]!);\n\n    const uploadW = Math.ceil(w / blockWidth) * blockWidth;\n    const uploadH = Math.ceil(h / blockHeight) * blockHeight;\n\n    const expectedBytes =\n      Math.ceil(w / blockWidth) * Math.ceil(h / blockHeight) * blockInfo.bytes;\n\n    if (view.byteLength < expectedBytes) {\n      const padded = new Uint8Array(expectedBytes);\n      padded.set(view);\n      view = padded;\n    }\n\n    glw.compressedTexImage2D(i, glInternalFormat, uploadW, uploadH, 0, view);\n\n    w = Math.max(1, w >> 1);\n    h = Math.max(1, h >> 1);\n  }\n\n  glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n  glw.texParameteri(\n    glw.TEXTURE_MIN_FILTER,\n    mipmaps.length > 1 ? glw.LINEAR_MIPMAP_LINEAR : glw.LINEAR,\n  );\n};\n\nfunction pvrtcMipSize(width: number, height: number, bpp: 2 | 4) {\n  const minW = bpp === 2 ? 16 : 8;\n  const minH = 8;\n  const w = Math.max(width, minW);\n  const h = Math.max(height, minH);\n  return (w * h * bpp) / 8;\n}\n\nconst loadPVR = async function (view: DataView): Promise<TextureData> {\n  const pixelFormatLow = view.getUint32(8, true);\n  const internalFormat = PVR_TO_GL_INTERNAL_FORMAT[pixelFormatLow];\n\n  if (internalFormat === undefined) {\n    throw new Error(\n      `Unsupported PVR pixel format: 0x${pixelFormatLow.toString(16)}`,\n    );\n  }\n\n  const height = view.getInt32(24, true);\n  const width = view.getInt32(28, true);\n\n  // validate dimensions\n  if (width === 0 || height === 0) {\n    throw new Error(`Invalid PVR texture dimensions: ${width}x${height}`);\n  }\n  const mipmapLevels = view.getInt32(44, true);\n  const metadataSize = view.getUint32(48, true);\n  const buffer = view.buffer as ArrayBuffer;\n\n  let offset = 52 + metadataSize;\n  if (offset > buffer.byteLength) {\n    throw new Error('Invalid PVR file: metadata exceeds file size');\n  }\n\n  const mipmaps: ArrayBuffer[] = [];\n\n  const block = blockInfoMap[internalFormat]!;\n\n  for (let i = 0; i < mipmapLevels; i++) {\n    const declaredSize = view.getUint32(offset, true);\n    const max = buffer.byteLength - (offset + 4);\n\n    if (declaredSize > 0 && declaredSize <= max) {\n      offset += 4;\n      const start = offset;\n      const end = offset + declaredSize;\n\n      mipmaps.push(buffer.slice(start, end));\n      offset = end;\n      offset = (offset + 3) & ~3; // align to 4 bytes\n      continue;\n    }\n\n    if (\n      pixelFormatLow === 0 ||\n      pixelFormatLow === 1 ||\n      pixelFormatLow === 2 ||\n      pixelFormatLow === 3\n    ) {\n      const bpp = pixelFormatLow === 0 || pixelFormatLow === 1 ? 2 : 4;\n      const computed = pvrtcMipSize(width >> i, height >> i, bpp);\n\n      mipmaps.push(buffer.slice(offset, offset + computed));\n      offset += computed;\n      offset = (offset + 3) & ~3; // align to 4 bytes\n      continue;\n    }\n\n    if (block !== undefined) {\n      const blockW = Math.ceil((width >> i) / block.width);\n      const blockH = Math.ceil((height >> i) / block.height);\n      const computed = blockW * blockH * block.bytes;\n\n      mipmaps.push(buffer.slice(offset, offset + computed));\n      offset += computed;\n      offset = (offset + 3) & ~3;\n    }\n  }\n\n  return {\n    data: {\n      blockInfo: blockInfoMap[internalFormat]!,\n      glInternalFormat: internalFormat,\n      mipmaps,\n      width: width,\n      height: height,\n      type: 'pvr',\n    },\n    premultiplyAlpha: false,\n  };\n};\n\nconst uploadPVR = function (\n  glw: WebGlContextWrapper,\n  texture: WebGLTexture,\n  data: CompressedData,\n) {\n  const { glInternalFormat, mipmaps, width, height } = data;\n\n  glw.bindTexture(texture);\n\n  let w = width;\n  let h = height;\n\n  for (let i = 0; i < mipmaps.length; i++) {\n    glw.compressedTexImage2D(\n      i,\n      glInternalFormat,\n      w,\n      h,\n      0,\n      new Uint8Array(mipmaps[i]!),\n    );\n\n    w = Math.max(1, w >> 1);\n    h = Math.max(1, h >> 1);\n  }\n\n  glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n  glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n  glw.texParameteri(\n    glw.TEXTURE_MIN_FILTER,\n    mipmaps.length > 1 ? glw.LINEAR_MIPMAP_LINEAR : glw.LINEAR,\n  );\n};\n\ntype BlockInfo = {\n  width: number;\n  height: number;\n  bytes: number;\n};\n\n// Predefined block info for common compressed texture formats\nconst BLOCK_4x4x8: BlockInfo = { width: 4, height: 4, bytes: 8 };\nconst BLOCK_4x4x16: BlockInfo = { width: 4, height: 4, bytes: 16 };\nconst BLOCK_5x5x16: BlockInfo = { width: 5, height: 5, bytes: 16 };\nconst BLOCK_6x6x16: BlockInfo = { width: 6, height: 6, bytes: 16 };\nconst BLOCK_8x4x8: BlockInfo = { width: 8, height: 4, bytes: 8 };\nconst BLOCK_8x8x16: BlockInfo = { width: 8, height: 8, bytes: 16 };\nconst BLOCK_10x10x16: BlockInfo = { width: 10, height: 10, bytes: 16 };\nconst BLOCK_12x12x16: BlockInfo = { width: 12, height: 12, bytes: 16 };\n\n// Map of GL internal formats to their corresponding block info\nexport const blockInfoMap: { [key: number]: BlockInfo } = {\n  // S3TC / DXTn (WEBGL_compressed_texture_s3tc, sRGB variants)\n  0x83f0: BLOCK_4x4x8, // COMPRESSED_RGB_S3TC_DXT1_EXT\n  0x83f1: BLOCK_4x4x8, // COMPRESSED_RGBA_S3TC_DXT1_EXT\n  0x83f2: BLOCK_4x4x16, // COMPRESSED_RGBA_S3TC_DXT3_EXT\n  0x83f3: BLOCK_4x4x16, // COMPRESSED_RGBA_S3TC_DXT5_EXT\n\n  // ETC1 / ETC2 / EAC\n  0x8d64: BLOCK_4x4x8, // COMPRESSED_RGB_ETC1_WEBGL\n  0x9274: BLOCK_4x4x8, // COMPRESSED_RGB8_ETC2\n  0x9275: BLOCK_4x4x8, // COMPRESSED_SRGB8_ETC2\n  0x9278: BLOCK_4x4x16, // COMPRESSED_RGBA8_ETC2_EAC\n  0x9279: BLOCK_4x4x16, // COMPRESSED_SRGB8_ALPHA8_ETC2_EAC\n\n  // PVRTC (WEBGL_compressed_texture_pvrtc)\n  0x8c00: BLOCK_4x4x8, // COMPRESSED_RGB_PVRTC_4BPPV1_IMG\n  0x8c02: BLOCK_4x4x8, // COMPRESSED_RGBA_PVRTC_4BPPV1_IMG\n  0x8c01: BLOCK_8x4x8, // COMPRESSED_RGB_PVRTC_2BPPV1_IMG\n  0x8c03: BLOCK_8x4x8,\n\n  // ASTC (WEBGL_compressed_texture_astc)\n  0x93b0: BLOCK_4x4x16, // COMPRESSED_RGBA_ASTC_4x4_KHR\n  0x93d0: BLOCK_4x4x16, // COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR\n  0x93b1: BLOCK_5x5x16, // 5x5\n  0x93d1: BLOCK_5x5x16,\n  0x93b2: BLOCK_6x6x16, // 6x6\n  0x93d2: BLOCK_6x6x16,\n  0x93b3: BLOCK_8x8x16, // 8x8\n  0x93d3: BLOCK_8x8x16,\n  0x93b4: BLOCK_10x10x16, // 10x10\n  0x93d4: BLOCK_10x10x16,\n  0x93b5: BLOCK_12x12x16, // 12x12\n  0x93d5: BLOCK_12x12x16,\n};\n\nexport const uploadCompressedTexture: Record<\n  string,\n  UploadCompressedTextureFunction\n> = {\n  ktx: uploadKTX,\n  pvr: uploadPVR,\n  astc: uploadASTC,\n};\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assertTruthy } from '../../utils.js';\nimport { type TextureData } from '../textures/Texture.js';\n\n/**\n * Tests if the given location is a SVG\n * @param url\n * @remarks\n * This function is used to determine if the given image url is a SVG\n * image\n * @returns\n */\nexport function isSvgImage(url: string): boolean {\n  return /\\.(svg)(\\?.*)?$/.test(url);\n}\n\n/**\n * Loads a SVG image\n * @param url\n * @returns\n */\nexport const loadSvg = (\n  url: string,\n  width: number | null,\n  height: number | null,\n  sx: number | null,\n  sy: number | null,\n  sw: number | null,\n  sh: number | null,\n): Promise<TextureData> => {\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    assertTruthy(ctx);\n\n    ctx.imageSmoothingEnabled = true;\n    const img = new Image();\n    img.onload = () => {\n      const x = sx ?? 0;\n      const y = sy ?? 0;\n      const w = width || img.width;\n      const h = height || img.height;\n\n      canvas.width = w;\n      canvas.height = h;\n      ctx.drawImage(img, 0, 0, w, h);\n\n      resolve({\n        data: ctx.getImageData(x, y, sw ?? w, sh ?? h),\n        premultiplyAlpha: false,\n      });\n    };\n\n    img.onerror = (err) => {\n      reject(err);\n    };\n\n    img.src = url;\n  });\n};\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2020 Metrological\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport function fetchJson(\n  url: string,\n  responseType: XMLHttpRequestResponseType = '',\n): Promise<unknown> {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    xhr.responseType = responseType;\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState == XMLHttpRequest.DONE) {\n        // On most devices like WebOS and Tizen, the file protocol returns 0 while http(s) protocol returns 200\n        if (xhr.status === 0 || xhr.status === 200) {\n          resolve(xhr.response);\n        } else {\n          reject(xhr.statusText);\n        }\n      }\n    };\n    xhr.open('GET', url, true);\n    xhr.send(null);\n  });\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport { Texture, TextureType, type TextureData } from './Texture.js';\nimport {\n  isCompressedTextureContainer,\n  loadCompressedTexture,\n} from '../lib/textureCompression.js';\nimport {\n  convertUrlToAbsolute,\n  dataURIToBlob,\n  isBase64Image,\n} from '../lib/utils.js';\nimport { isSvgImage, loadSvg } from '../lib/textureSvg.js';\nimport { fetchJson } from '../text-rendering/font-face-types/utils.js';\n\n/**\n * Properties of the {@link ImageTexture}\n */\nexport interface ImageTextureProps {\n  /**\n   * Source URL or ImageData for the image to be used as a texture.\n   *\n   * @remarks\n   * The ImageData type is currently only supported internally. End users should\n   * only set this property to a URL string.\n   *\n   * @default ''\n   */\n  src?: string | Blob | ImageData | (() => ImageData | null);\n  /**\n   * Whether to premultiply the alpha channel into the color channels of the\n   * image.\n   *\n   * @remarks\n   * Generally this should be set to `true` (the default). However, if the\n   * texture's associated Shader expects straight (non-premultiplied) colors,\n   * this should be set to `false`.\n   *\n   * @default true\n   */\n  premultiplyAlpha?: boolean | null;\n  /**\n   * `ImageData` textures are not cached unless a `key` is provided\n   */\n  key?: string | null;\n  /**\n   * Width of the image to be used as a texture. If not provided, the image's\n   * natural width will be used.\n   */\n  width?: number | null;\n  /**\n   * Height of the image to be used as a texture. If not provided, the image's\n   * natural height will be used.\n   */\n  height?: number | null;\n  /**\n   * Type, indicate an image type for overriding type detection\n   *\n   * @default null\n   */\n  type?: 'regular' | 'compressed' | 'svg' | null;\n  /**\n   * The width of the rectangle from which the ImageBitmap will be extracted. This value\n   * can be negative. Only works when createImageBitmap is supported on the browser.\n   *\n   * @default null\n   */\n  sw?: number | null;\n  /**\n   * The height of the rectangle from which the ImageBitmap will be extracted. This value\n   * can be negative. Only works when createImageBitmap is supported on the browser.\n   *\n   * @default null\n   */\n  sh?: number | null;\n  /**\n   * The y coordinate of the reference point of the rectangle from which the ImageBitmap\n   * will be extracted. Only used when `sw` and `sh` are provided. And only works when\n   * createImageBitmap is available.\n   *\n   * @default null\n   */\n  sx?: number | null;\n  /**\n   * The x coordinate of the reference point of the rectangle from which the\n   * ImageBitmap will be extracted. Only used when source `sw` width and `sh` height\n   * are provided. Only works when createImageBitmap is supported on the browser.\n   *\n   * @default null\n   */\n  sy?: number | null;\n\n  /**\n   * Maximum number of times to retry loading the image if it fails.\n   *\n   * @default 5\n   */\n  maxRetryCount?: number | null;\n}\n\n/**\n * Texture consisting of an image loaded from a URL\n *\n * @remarks\n * The ImageTexture's {@link ImageTextureProps.src} prop defines the image URL\n * to be downloaded.\n *\n * By default, the texture's alpha values will be premultiplied into its color\n * values which is generally the desired setting before they are sent to the\n * texture's associated {@link Shader}. However, in special cases you may want\n * the Shader to receive straight (non-premultiplied) values. In that case you\n * can disable the default behavior by setting the\n * {@link ImageTextureProps.premultiplyAlpha} prop to `false`.\n */\nexport class ImageTexture extends Texture {\n  override readonly type = TextureType.image as const;\n  public props: Required<ImageTextureProps>;\n\n  constructor(txManager: CoreTextureManager, props: ImageTextureProps) {\n    const resolvedProps = ImageTexture.resolveDefaults(props);\n    super(txManager);\n    this.props = resolvedProps;\n    this.maxRetryCount =\n      resolvedProps.maxRetryCount ?? this.txManager.maxRetryCount;\n  }\n\n  hasAlphaChannel(mimeType: string) {\n    return mimeType.indexOf('image/png') !== -1;\n  }\n\n  async loadImageFallback(src: string | Blob, hasAlpha: boolean) {\n    const img = new Image();\n\n    if (typeof src === 'string' && isBase64Image(src) === false) {\n      img.crossOrigin = 'anonymous';\n    }\n\n    return new Promise<{\n      data: HTMLImageElement | null;\n      premultiplyAlpha: boolean;\n    }>((resolve, reject) => {\n      img.onload = () => {\n        resolve({ data: img, premultiplyAlpha: hasAlpha });\n      };\n\n      img.onerror = (err) => {\n        const errorMessage =\n          err instanceof Error\n            ? err.message\n            : err instanceof Event\n            ? `Image loading failed for ${img.src}`\n            : 'Unknown image loading error';\n        reject(new Error(`Image loading failed: ${errorMessage}`));\n      };\n\n      if (src instanceof Blob) {\n        img.src = URL.createObjectURL(src);\n      } else {\n        img.src = src;\n      }\n    });\n  }\n\n  async createImageBitmap(\n    blob: Blob,\n    premultiplyAlpha: boolean | null,\n    sx: number | null,\n    sy: number | null,\n    sw: number | null,\n    sh: number | null,\n  ): Promise<{\n    data: ImageBitmap | HTMLImageElement;\n    premultiplyAlpha: boolean;\n  }> {\n    const hasAlphaChannel = premultiplyAlpha ?? blob.type.includes('image/png');\n    const imageBitmapSupported = this.txManager.imageBitmapSupported;\n\n    if (imageBitmapSupported.full === true && sw !== null && sh !== null) {\n      // createImageBitmap with crop\n      try {\n        const bitmap = await createImageBitmap(blob, sx || 0, sy || 0, sw, sh, {\n          premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',\n          colorSpaceConversion: 'none',\n          imageOrientation: 'none',\n        });\n        return { data: bitmap, premultiplyAlpha: hasAlphaChannel };\n      } catch (error) {\n        throw new Error(`Failed to create image bitmap with crop: ${error}`);\n      }\n    } else if (imageBitmapSupported.basic === true) {\n      // basic createImageBitmap without options or crop\n      // this is supported for Chrome v50 to v52/54 that doesn't support options\n      try {\n        return {\n          data: await createImageBitmap(blob),\n          premultiplyAlpha: hasAlphaChannel,\n        };\n      } catch (error) {\n        throw new Error(`Failed to create basic image bitmap: ${error}`);\n      }\n    }\n\n    // default createImageBitmap without crop but with options\n    try {\n      const bitmap = await createImageBitmap(blob, {\n        premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',\n        colorSpaceConversion: 'none',\n        imageOrientation: 'none',\n      });\n      return { data: bitmap, premultiplyAlpha: hasAlphaChannel };\n    } catch (error) {\n      throw new Error(`Failed to create image bitmap with options: ${error}`);\n    }\n  }\n\n  async loadImage(src: string) {\n    const { premultiplyAlpha, sx, sy, sw, sh } = this.props;\n\n    if (this.txManager.hasCreateImageBitmap === true) {\n      if (\n        isBase64Image(src) === false &&\n        this.txManager.hasWorker === true &&\n        this.txManager.imageWorkerManager !== null\n      ) {\n        try {\n          return this.txManager.imageWorkerManager.getImage(\n            src,\n            premultiplyAlpha,\n            sx,\n            sy,\n            sw,\n            sh,\n          );\n        } catch (error) {\n          throw new Error(`Failed to load image via worker: ${error}`);\n        }\n      }\n\n      let blob;\n\n      if (isBase64Image(src) === true) {\n        blob = dataURIToBlob(src);\n      } else {\n        try {\n          blob = (await fetchJson(src, 'blob')) as Blob;\n        } catch (error) {\n          throw new Error(`Failed to fetch image blob from ${src}: ${error}`);\n        }\n      }\n\n      return this.createImageBitmap(blob, premultiplyAlpha, sx, sy, sw, sh);\n    }\n\n    return this.loadImageFallback(src, premultiplyAlpha ?? true);\n  }\n\n  override async getTextureSource(): Promise<TextureData> {\n    let resp;\n    try {\n      resp = await this.determineImageTypeAndLoadImage();\n    } catch (e) {\n      this.setState('failed', e as Error);\n      return {\n        data: null,\n      };\n    }\n\n    if (resp.data === null) {\n      this.setState('failed', Error('ImageTexture: No image data'));\n      return {\n        data: null,\n      };\n    }\n\n    return {\n      data: resp.data,\n      premultiplyAlpha: this.props.premultiplyAlpha ?? true,\n    };\n  }\n\n  determineImageTypeAndLoadImage() {\n    const { src, premultiplyAlpha, type } = this.props;\n    if (src === null) {\n      return {\n        data: null,\n      };\n    }\n\n    if (typeof src !== 'string') {\n      if (src instanceof Blob) {\n        if (this.txManager.hasCreateImageBitmap === true) {\n          const { sx, sy, sw, sh } = this.props;\n          return this.createImageBitmap(src, premultiplyAlpha, sx, sy, sw, sh);\n        } else {\n          return this.loadImageFallback(src, premultiplyAlpha ?? true);\n        }\n      }\n      if (src instanceof ImageData) {\n        return {\n          data: src,\n          premultiplyAlpha,\n        };\n      }\n      return {\n        data: src(),\n        premultiplyAlpha,\n      };\n    }\n\n    const absoluteSrc = convertUrlToAbsolute(src);\n    if (type === 'regular') {\n      return this.loadImage(absoluteSrc);\n    }\n\n    if (type === 'svg') {\n      return loadSvg(\n        absoluteSrc,\n        this.props.width,\n        this.props.height,\n        this.props.sx,\n        this.props.sy,\n        this.props.sw,\n        this.props.sh,\n      );\n    }\n\n    if (isSvgImage(src) === true) {\n      return loadSvg(\n        absoluteSrc,\n        this.props.width,\n        this.props.height,\n        this.props.sx,\n        this.props.sy,\n        this.props.sw,\n        this.props.sh,\n      );\n    }\n\n    if (type === 'compressed') {\n      return loadCompressedTexture(absoluteSrc);\n    }\n\n    if (isCompressedTextureContainer(src) === true) {\n      return loadCompressedTexture(absoluteSrc);\n    }\n\n    // default\n    return this.loadImage(absoluteSrc);\n  }\n\n  /**\n   * Generates a cache key for the ImageTexture based on the provided props.\n   * @param props - The props used to generate the cache key.\n   * @returns The cache key as a string, or `false` if the key cannot be generated.\n   */\n  static override makeCacheKey(props: ImageTextureProps): string | false {\n    const resolvedProps = ImageTexture.resolveDefaults(props);\n    // Only cache key-able textures; prioritise key\n    const key = resolvedProps.key || resolvedProps.src;\n    if (typeof key !== 'string') {\n      return false;\n    }\n\n    // if we have source dimensions, cache the texture separately\n    let dimensionProps = '';\n    if (resolvedProps.sh !== null && resolvedProps.sw !== null) {\n      dimensionProps += ',';\n      dimensionProps += resolvedProps.sx ?? '';\n      dimensionProps += resolvedProps.sy ?? '';\n      dimensionProps += resolvedProps.sw || '';\n      dimensionProps += resolvedProps.sh || '';\n    }\n\n    return `ImageTexture,${key},${\n      resolvedProps.premultiplyAlpha ?? 'true'\n    }${dimensionProps}`;\n  }\n\n  static override resolveDefaults(\n    props: ImageTextureProps,\n  ): Required<ImageTextureProps> {\n    return {\n      src: props.src ?? '',\n      premultiplyAlpha: props.premultiplyAlpha ?? true, // null,\n      key: props.key ?? null,\n      type: props.type ?? null,\n      width: props.width ?? null,\n      height: props.height ?? null,\n      sx: props.sx ?? null,\n      sy: props.sy ?? null,\n      sw: props.sw ?? null,\n      sh: props.sh ?? null,\n      maxRetryCount: props.maxRetryCount ?? null,\n    };\n  }\n\n  static z$__type__Props: ImageTextureProps;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport { Texture, TextureType, type TextureData } from './Texture.js';\n\n/**\n * Properties of the {@link NoiseTexture}\n */\nexport interface NoiseTextureProps {\n  /**\n   * Width of texture\n   *\n   * @default 128\n   */\n  width?: number;\n  /**\n   * Height of texture\n   *\n   * @default 128\n   */\n  height?: number;\n  /**\n   * A number value that can be varied to force new textures to be generated\n   *\n   * @default 0\n   */\n  cacheId?: number;\n}\n\n/**\n * Texture consisting of a random grid of greyscale pixels\n *\n * @remarks\n * The width and height of the NoiseTexture are defined by it's\n * {@link NoiseTextureProps.width} and {@link NoiseTextureProps.height}\n * properties. The {@link NoiseTextureProps.cacheId} prop can be varied in order\n * to bypass cache and get newly randomized texture data.\n */\nexport class NoiseTexture extends Texture {\n  props: Required<NoiseTextureProps>;\n\n  public override type: TextureType = TextureType.noise;\n\n  constructor(txManager: CoreTextureManager, props: NoiseTextureProps) {\n    super(txManager);\n    this.props = NoiseTexture.resolveDefaults(props);\n  }\n\n  override async getTextureSource(): Promise<TextureData> {\n    const { width, height } = this.props;\n    const size = width * height * 4;\n    const pixelData8 = new Uint8ClampedArray(size);\n    for (let i = 0; i < size; i += 4) {\n      const v = Math.floor(Math.random() * 256);\n      pixelData8[i] = v;\n      pixelData8[i + 1] = v;\n      pixelData8[i + 2] = v;\n      pixelData8[i + 3] = 255;\n    }\n\n    // Noise texture data ready - dimensions will be set during upload\n\n    return {\n      data: new ImageData(pixelData8, width, height),\n    };\n  }\n\n  static override makeCacheKey(props: NoiseTextureProps): string | false {\n    if (props.cacheId === undefined) {\n      return false;\n    }\n    const resolvedProps = NoiseTexture.resolveDefaults(props);\n    return `NoiseTexture,${resolvedProps.width},${resolvedProps.height},${resolvedProps.cacheId}`;\n  }\n\n  static override resolveDefaults(\n    props: NoiseTextureProps,\n  ): Required<NoiseTextureProps> {\n    return {\n      width: props.width ?? 128,\n      height: props.height ?? 128,\n      cacheId: props.cacheId ?? 0,\n    };\n  }\n\n  static z$__type__Props: NoiseTextureProps;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../common/CommonTypes.js';\nimport { assertTruthy } from '../../utils.js';\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport { ImageTexture } from './ImageTexture.js';\nimport {\n  Texture,\n  TextureType,\n  type TextureData,\n  type TextureFailedEventHandler,\n  type TextureLoadedEventHandler,\n  type TextureState,\n} from './Texture.js';\n\nlet subTextureId = 0;\n\n/**\n * Properties of the {@link SubTexture}\n */\nexport interface SubTextureProps {\n  /**\n   * The texture that this sub-texture is a sub-region of.\n   */\n  texture: Texture;\n\n  /**\n   * The x pixel position of the top-left of the sub-texture within the parent\n   * texture.\n   *\n   * @default 0\n   */\n  x?: number;\n\n  /**\n   * The y pixel position of the top-left sub-texture within the parent\n   * texture.\n   *\n   * @default 0\n   **/\n  y?: number;\n\n  /**\n   * The width of the sub-texture in pixels.\n   *\n   * @default 0\n   */\n  width?: number;\n\n  /**\n   * The height of the sub-texture in pixels\n   **/\n  height?: number;\n}\n\n/**\n * A Texture that is a sub-region of another Texture.\n *\n * @remarks\n * The parent texture can be a Sprite Sheet/Texture Atlas and set using the\n * {@link SubTextureProps.texture} prop. The sub-region relative to the parent\n * texture is defined with the {@link SubTextureProps.x},\n * {@link SubTextureProps.y}, {@link SubTextureProps.width}, and\n * {@link SubTextureProps.height} pixel values.\n */\nexport class SubTexture extends Texture {\n  props: Required<SubTextureProps>;\n  parentTexture: Texture;\n\n  public override type: TextureType = TextureType.subTexture;\n  public subtextureId = `subtexture-${subTextureId++}`;\n\n  constructor(txManager: CoreTextureManager, props: SubTextureProps) {\n    super(txManager);\n    this.props = SubTexture.resolveDefaults(props || {});\n\n    assertTruthy(this.props.texture, 'SubTexture requires a parent texture');\n    assertTruthy(\n      this.props.texture instanceof ImageTexture,\n      'SubTexture requires an ImageTexture parent',\n    );\n\n    // Resolve parent texture from cache or fallback to provided texture\n    this.parentTexture = txManager.resolveParentTexture(this.props.texture);\n\n    if (this.renderableOwners.length > 0) {\n      this.parentTexture.setRenderableOwner(this.subtextureId, true);\n    }\n\n    // If parent texture is already loaded / failed, trigger loaded event manually\n    // so that users get a consistent event experience.\n    // We do this in a microtask to allow listeners to be attached in the same\n    // synchronous task after calling loadTexture()\n    queueMicrotask(() => {\n      const parentTx = this.parentTexture;\n      if (parentTx.state === 'loaded' && parentTx.dimensions) {\n        this.onParentTxLoaded(parentTx, parentTx.dimensions);\n      } else if (parentTx.state === 'loading') {\n        this.onParentTxLoading();\n      } else if (parentTx.state === 'failed' && parentTx.error) {\n        this.onParentTxFailed(parentTx, parentTx.error);\n      } else if (parentTx.state === 'freed') {\n        this.onParentTxFreed();\n      }\n\n      parentTx.on('loading', this.onParentTxLoading);\n      parentTx.on('loaded', this.onParentTxLoaded);\n      parentTx.on('failed', this.onParentTxFailed);\n      parentTx.on('freed', this.onParentTxFreed);\n    });\n  }\n\n  private onParentTxLoaded: TextureLoadedEventHandler = () => {\n    // We ignore the parent's passed dimensions, and simply use the SubTexture's\n    // configured dimensions (because that's all that matters here)\n    this.forwardParentTxState('loaded', {\n      width: this.props.width,\n      height: this.props.height,\n    });\n  };\n\n  private onParentTxFailed: TextureFailedEventHandler = (target, error) => {\n    //decrement with 1 because in the failed state it will do +1 again.\n    this.retryCount = this.parentTexture.retryCount - 1;\n    this.forwardParentTxState('failed', error);\n  };\n\n  private onParentTxLoading = () => {\n    this.forwardParentTxState('loading');\n  };\n\n  private onParentTxFreed = () => {\n    this.forwardParentTxState('freed');\n  };\n\n  private forwardParentTxState(\n    state: TextureState,\n    errorOrDimensions?: Error | Dimensions,\n  ) {\n    this.setState(state, errorOrDimensions);\n  }\n\n  override onChangeIsRenderable(isRenderable: boolean): void {\n    // Propagate the renderable owner change to the parent texture\n    this.parentTexture.setRenderableOwner(this.subtextureId, isRenderable);\n  }\n\n  override async getTextureSource(): Promise<TextureData> {\n    // SubTexture data ready - dimensions will be set during upload\n    return {\n      data: this.props,\n    };\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static override makeCacheKey(props: SubTextureProps): string | false {\n    return false;\n  }\n\n  static override resolveDefaults(\n    props: SubTextureProps,\n  ): Required<SubTextureProps> {\n    return {\n      texture: props.texture,\n      x: props.x || 0,\n      y: props.y || 0,\n      width: props.width || 0,\n      height: props.height || 0,\n    };\n  }\n\n  static z$__type__Props: SubTextureProps;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreTextureManager } from '../CoreTextureManager.js';\nimport { Texture, TextureType, type TextureData } from './Texture.js';\n\n/**\n * Properties of the {@link RenderTexture}\n */\nexport interface RenderTextureProps {\n  /**\n   * WebGL Texture width\n   * @default 256\n   */\n  width?: number;\n\n  /**\n   * WebGL Texture height\n   * @default 256\n   */\n  height?: number;\n}\n\nexport class RenderTexture extends Texture {\n  props: Required<RenderTextureProps>;\n\n  public override type: TextureType = TextureType.renderToTexture;\n\n  constructor(txManager: CoreTextureManager, props?: RenderTextureProps) {\n    super(txManager);\n    this.props = RenderTexture.resolveDefaults(props || {});\n  }\n\n  get width() {\n    return this.props.width;\n  }\n\n  set width(value: number) {\n    this.props.width = value;\n  }\n\n  get height() {\n    return this.props.height;\n  }\n\n  set height(value: number) {\n    this.props.height = value;\n  }\n\n  override async getTextureSource(): Promise<TextureData> {\n    // Render texture data ready - dimensions will be set during upload\n\n    return {\n      data: null,\n      premultiplyAlpha: null,\n    };\n  }\n\n  static override resolveDefaults(\n    props: RenderTextureProps,\n  ): Required<RenderTextureProps> {\n    return {\n      width: props.width || 256,\n      height: props.height || 256,\n    };\n  }\n\n  static z$__type__Props: RenderTextureProps;\n}\n", "export interface CreateImageBitmapSupport {\n  basic: boolean; // Supports createImageBitmap(image)\n  options: boolean; // Supports createImageBitmap(image, options)\n  full: boolean; // Supports createImageBitmap(image, sx, sy, sw, sh, options)\n}\n\nexport async function validateCreateImageBitmap(): Promise<CreateImageBitmapSupport> {\n  // Test if createImageBitmap is supported using a simple 1x1 PNG image\n  // prettier-ignore\n  const pngBinaryData = new Uint8Array([\n      0x89, 0x50, 0x4e, 0x47,\n      0x0d, 0x0a, 0x1a, 0x0a, // PNG signature\n      0x00, 0x00, 0x00, 0x0d, // IHDR chunk length\n      0x49, 0x48, 0x44, 0x52, // \"IHDR\" chunk type\n      0x00, 0x00, 0x00, 0x01, // Width: 1\n      0x00, 0x00, 0x00, 0x01, // Height: 1\n      0x01,                   // Bit depth: 1\n      0x03,                   // Color type: Indexed\n      0x00,                   // Compression method: Deflate\n      0x00,                   // Filter method: None\n      0x00,                   // Interlace method: None\n      0x25, 0xdb, 0x56, 0xca, // CRC for IHDR\n      0x00, 0x00, 0x00, 0x03, // PLTE chunk length\n      0x50, 0x4c, 0x54, 0x45, // \"PLTE\" chunk type\n      0x00, 0x00, 0x00,       // Palette entry: Black\n      0xa7, 0x7a, 0x3d, 0xda, // CRC for PLTE\n      0x00, 0x00, 0x00, 0x01, // tRNS chunk length\n      0x74, 0x52, 0x4e, 0x53, // \"tRNS\" chunk type\n      0x00,                   // Transparency for black: Fully transparent\n      0x40, 0xe6, 0xd8, 0x66, // CRC for tRNS\n      0x00, 0x00, 0x00, 0x0a, // IDAT chunk length\n      0x49, 0x44, 0x41, 0x54, // \"IDAT\" chunk type\n      0x08, 0xd7,             // Deflate header\n      0x63, 0x60, 0x00, 0x00,\n      0x00, 0x02, 0x00, 0x01, // Zlib-compressed data\n      0xe2, 0x21, 0xbc, 0x33, // CRC for IDAT\n      0x00, 0x00, 0x00, 0x00, // IEND chunk length\n      0x49, 0x45, 0x4e, 0x44, // \"IEND\" chunk type\n      0xae, 0x42, 0x60, 0x82, // CRC for IEND\n    ]);\n\n  const support: CreateImageBitmapSupport = {\n    basic: false,\n    options: false,\n    full: false,\n  };\n\n  // Test basic createImageBitmap support\n  const blob = new Blob([pngBinaryData], { type: 'image/png' });\n  const bitmap = await createImageBitmap(blob);\n  bitmap.close?.();\n  support.basic = true;\n\n  // Test createImageBitmap with options support\n  try {\n    const options = { premultiplyAlpha: 'none' as const };\n    const bitmapWithOptions = await createImageBitmap(blob, options);\n    bitmapWithOptions.close?.();\n    support.options = true;\n  } catch (e) {\n    /* ignore */\n  }\n\n  // Test createImageBitmap with full options support\n  try {\n    const bitmapWithFullOptions = await createImageBitmap(blob, 0, 0, 1, 1, {\n      premultiplyAlpha: 'none',\n    });\n    bitmapWithFullOptions.close?.();\n    support.full = true;\n  } catch (e) {\n    /* ignore */\n  }\n\n  return support;\n}\n", "export enum TextureErrorCode {\n  MEMORY_THRESHOLD_EXCEEDED = 'MEMORY_THRESHOLD_EXCEEDED',\n  TEXTURE_DATA_NULL = 'TEXTURE_DATA_NULL',\n  TEXTURE_TYPE_NOT_REGISTERED = 'TEXTURE_TYPE_NOT_REGISTERED',\n}\n\nconst defaultMessages: Record<TextureErrorCode, string> = {\n  [TextureErrorCode.MEMORY_THRESHOLD_EXCEEDED]: 'Memory threshold exceeded',\n  [TextureErrorCode.TEXTURE_DATA_NULL]: 'Texture data is null',\n  [TextureErrorCode.TEXTURE_TYPE_NOT_REGISTERED]:\n    'Texture type is not registered',\n};\n\nexport class TextureError extends Error {\n  code?: TextureErrorCode;\n\n  constructor(message: string);\n  constructor(code: TextureErrorCode, message?: string);\n  constructor(codeOrMessage: TextureErrorCode | string, maybeMessage?: string) {\n    const isCode = Object.values(TextureErrorCode).includes(\n      codeOrMessage as TextureErrorCode,\n    );\n\n    const code = isCode ? (codeOrMessage as TextureErrorCode) : undefined;\n    let message: string;\n    if (isCode && code) {\n      message = maybeMessage ?? defaultMessages[code];\n    } else {\n      message = String(codeOrMessage);\n    }\n\n    super(message);\n    this.name = new.target.name;\n    if (code) this.code = code;\n  }\n}\n\nexport function isTextureError(err: unknown): err is TextureError {\n  return (\n    err instanceof TextureError ||\n    (typeof err === 'object' &&\n      err !== null &&\n      (err as { name?: unknown }).name === 'TextureError' &&\n      typeof (err as { code?: unknown }).code === 'string')\n  );\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImageWorkerManager } from './lib/ImageWorker.js';\nimport type { CoreRenderer } from './renderers/CoreRenderer.js';\nimport { ColorTexture } from './textures/ColorTexture.js';\nimport { ImageTexture } from './textures/ImageTexture.js';\nimport { NoiseTexture } from './textures/NoiseTexture.js';\nimport { SubTexture } from './textures/SubTexture.js';\nimport { RenderTexture } from './textures/RenderTexture.js';\nimport { Texture, TextureType } from './textures/Texture.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { getTimeStamp } from './platform.js';\nimport type { Stage } from './Stage.js';\nimport {\n  validateCreateImageBitmap,\n  type CreateImageBitmapSupport,\n} from './lib/validateImageBitmap.js';\nimport { TextureError, TextureErrorCode } from './TextureError.js';\n\n/**\n * Augmentable map of texture class types\n *\n * @remarks\n * This interface can be augmented by other modules/apps to add additional\n * texture types. The ones included directly here are the ones that are\n * included in the core library.\n */\nexport interface TextureMap {\n  ColorTexture: typeof ColorTexture;\n  ImageTexture: typeof ImageTexture;\n  NoiseTexture: typeof NoiseTexture;\n  SubTexture: typeof SubTexture;\n  RenderTexture: typeof RenderTexture;\n}\n\nexport type ExtractProps<Type> = Type extends { z$__type__Props: infer Props }\n  ? Props\n  : never;\n\n/**\n * Contains information about the texture manager's internal state\n * for debugging purposes.\n */\nexport interface TextureManagerDebugInfo {\n  keyCacheSize: number;\n}\n\nexport interface TextureManagerSettings {\n  numImageWorkers: number;\n  createImageBitmapSupport: 'auto' | 'basic' | 'options' | 'full';\n  maxRetryCount: number;\n}\n\nexport type ResizeModeOptions =\n  | {\n      /**\n       * Specifies that the image should be resized to cover the specified dimensions.\n       */\n      type: 'cover';\n      /**\n       * The horizontal clipping position\n       * To clip the left, set clipX to 0. To clip the right, set clipX to 1.\n       * clipX 0.5 will clip a equal amount from left and right\n       *\n       * @defaultValue 0.5\n       */\n      clipX?: number;\n      /**\n       * The vertical clipping position\n       * To clip the top, set clipY to 0. To clip the bottom, set clipY to 1.\n       * clipY 0.5 will clip a equal amount from top and bottom\n       *\n       * @defaultValue 0.5\n       */\n      clipY?: number;\n    }\n  | {\n      /**\n       * Specifies that the image should be resized to fit within the specified dimensions.\n       */\n      type: 'contain';\n    };\n\n/**\n * Universal options for all texture types\n *\n * @remarks\n * Texture Options provide a way to specify options that are relevant to the\n * texture loading process (including caching) and specifically for how a\n * texture is rendered within a specific Node (or set of Nodes).\n *\n * They are not used in determining the cache key for a texture (except if\n * the `cacheKey` option is provided explicitly to oveerride the default\n * cache key for the texture instance) nor are they stored/referenced within\n * the texture instance itself. Instead, the options are stored/referenced\n * within individual Nodes. So a single texture instance can be used in\n * multiple Nodes each using a different set of options.\n */\nexport interface TextureOptions {\n  /**\n   * Preload the texture immediately even if it's not being rendered to the\n   * screen.\n   *\n   * @remarks\n   * This allows the texture to be used immediately without any delay when it\n   * is first needed for rendering. Otherwise the loading process will start\n   * when the texture is first rendered, which may cause a delay in that texture\n   * being shown properly.\n   *\n   * @defaultValue `false`\n   */\n  preload?: boolean;\n\n  /**\n   * Prevent clean up of the texture when it is no longer being used.\n   *\n   * @remarks\n   * This is useful when you want to keep the texture in memory for later use.\n   * Regardless of whether the texture is being used or not, it will not be\n   * cleaned up.\n   *\n   * @defaultValue `false`\n   */\n  preventCleanup?: boolean;\n\n  /**\n   * Number of times to retry loading a failed texture\n   *\n   * @remarks\n   * When a texture fails to load, Lightning will retry up to this many times\n   * before permanently giving up. Each retry will clear the texture ownership\n   * and then re-establish it to trigger a new load attempt.\n   *\n   * Set to null to disable retries. Set to 0 to always try once and never retry.\n   * This is typically only used on ImageTexture instances.\n   *\n   */\n  maxRetryCount?: number | null;\n\n  /**\n   * Flip the texture horizontally when rendering\n   *\n   * @defaultValue `false`\n   */\n  flipX?: boolean;\n\n  /**\n   * Flip the texture vertically when rendering\n   *\n   * @defaultValue `false`\n   */\n  flipY?: boolean;\n\n  /**\n   * You can use resizeMode to determine the clipping automatically from the width\n   * and height of the source texture. This can be convenient if you are unsure about\n   * the exact image sizes but want the image to cover a specific area.\n   *\n   * The resize modes cover and contain are supported\n   */\n  resizeMode?: ResizeModeOptions;\n}\n\nexport class CoreTextureManager extends EventEmitter {\n  /**\n   * Map of textures by cache key\n   */\n  keyCache: Map<string, Texture> = new Map();\n\n  /**\n   * Map of cache keys by texture\n   */\n  inverseKeyCache: WeakMap<Texture, string> = new WeakMap();\n\n  /**\n   * Map of texture constructors by their type name\n   */\n  txConstructors: Partial<TextureMap> = {};\n\n  public maxRetryCount: number;\n  private priorityQueue: Array<Texture> = [];\n  private uploadTextureQueue: Array<Texture> = [];\n  private initialized = false;\n  private stage: Stage;\n  private numImageWorkers: number;\n\n  imageWorkerManager: ImageWorkerManager | null = null;\n  hasCreateImageBitmap = !!self.createImageBitmap;\n  imageBitmapSupported = {\n    basic: false,\n    options: false,\n    full: false,\n  };\n\n  hasWorker = !!self.Worker;\n  /**\n   * Renderer that this texture manager is associated with\n   *\n   * @remarks\n   * This MUST be set before the texture manager is used. Otherwise errors\n   * will occur when using the texture manager.\n   */\n  renderer!: CoreRenderer;\n\n  /**\n   * The current frame time in milliseconds\n   *\n   * @remarks\n   * This is used to populate the `lastRenderableChangeTime` property of\n   * {@link Texture} instances when their renderable state changes.\n   *\n   * Set by stage via `updateFrameTime` method.\n   */\n  frameTime = 0;\n\n  constructor(stage: Stage, settings: TextureManagerSettings) {\n    super();\n\n    const { numImageWorkers, createImageBitmapSupport, maxRetryCount } =\n      settings;\n    this.stage = stage;\n    this.numImageWorkers = numImageWorkers;\n    this.maxRetryCount = maxRetryCount;\n\n    if (createImageBitmapSupport === 'auto') {\n      validateCreateImageBitmap()\n        .then((result) => {\n          this.initialize(result);\n        })\n        .catch(() => {\n          console.warn(\n            '[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.',\n          );\n\n          // initialized without image worker manager and createImageBitmap\n          this.initialized = true;\n          this.emit('initialized');\n        });\n    } else {\n      this.initialize({\n        basic: createImageBitmapSupport === 'basic',\n        options: createImageBitmapSupport === 'options',\n        full: createImageBitmapSupport === 'full',\n      });\n    }\n\n    this.registerTextureType('ImageTexture', ImageTexture);\n    this.registerTextureType('ColorTexture', ColorTexture);\n    this.registerTextureType('NoiseTexture', NoiseTexture);\n    this.registerTextureType('SubTexture', SubTexture);\n    this.registerTextureType('RenderTexture', RenderTexture);\n  }\n\n  registerTextureType<Type extends keyof TextureMap>(\n    textureType: Type,\n    textureClass: TextureMap[Type],\n  ): void {\n    this.txConstructors[textureType] = textureClass;\n  }\n\n  private initialize(support: CreateImageBitmapSupport) {\n    this.hasCreateImageBitmap =\n      support.basic || support.options || support.full;\n    this.imageBitmapSupported = support;\n\n    if (!this.hasCreateImageBitmap) {\n      console.warn(\n        '[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.',\n      );\n    }\n\n    if (\n      this.hasCreateImageBitmap &&\n      this.hasWorker &&\n      this.numImageWorkers > 0\n    ) {\n      this.imageWorkerManager = new ImageWorkerManager(\n        this.numImageWorkers,\n        support,\n      );\n    } else {\n      console.warn(\n        '[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower.',\n      );\n    }\n\n    this.initialized = true;\n    this.emit('initialized');\n  }\n\n  /**\n   * Enqueue a texture for uploading to the GPU.\n   *\n   * @param texture - The texture to upload\n   */\n  enqueueUploadTexture(texture: Texture): void {\n    if (this.uploadTextureQueue.includes(texture) === false) {\n      this.uploadTextureQueue.push(texture);\n    }\n  }\n\n  /**\n   * Create a texture\n   *\n   * @param textureType - The type of texture to create\n   * @param props - The properties to use for the texture\n   */\n  createTexture<Type extends keyof TextureMap>(\n    textureType: Type,\n    props: ExtractProps<TextureMap[Type]>,\n  ): InstanceType<TextureMap[Type]> {\n    let texture: Texture | undefined;\n    const TextureClass = this.txConstructors[textureType];\n    if (!TextureClass) {\n      throw new TextureError(\n        TextureErrorCode.TEXTURE_TYPE_NOT_REGISTERED,\n        `Texture type \"${textureType}\" is not registered`,\n      );\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-argument\n    const cacheKey = TextureClass.makeCacheKey(props as any);\n    if (cacheKey && this.keyCache.has(cacheKey)) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      texture = this.keyCache.get(cacheKey)!;\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any\n      texture = new TextureClass(this, props as any);\n\n      if (cacheKey) {\n        this.initTextureToCache(texture, cacheKey);\n      }\n    }\n\n    return texture as InstanceType<TextureMap[Type]>;\n  }\n\n  /**\n   * Override loadTexture to use the batched approach.\n   *\n   * @param texture - The texture to load\n   * @param immediate - Whether to prioritize the texture for immediate loading\n   */\n  async loadTexture(texture: Texture, priority?: boolean): Promise<void> {\n    if (texture.type === TextureType.subTexture) {\n      // ignore subtextures - they get loaded through their parent\n      return;\n    }\n\n    if (texture.state === 'loaded') {\n      // if the texture is already loaded, just return\n      return;\n    }\n\n    if (texture.state === 'loading') {\n      return;\n    }\n\n    // if we're not initialized, just queue the texture into the priority queue\n    if (this.initialized === false) {\n      this.priorityQueue.push(texture);\n      return;\n    }\n\n    texture.setState('loading');\n\n    // Get texture data - early return on failure\n    const textureDataResult = await texture.getTextureData().catch((err) => {\n      console.error(err);\n      texture.setState('failed');\n      return null;\n    });\n\n    // Early return if texture data fetch failed\n    if (textureDataResult === null || texture.state === 'failed') {\n      return;\n    }\n\n    // Handle non-image textures: upload immediately\n    const shouldUploadImmediately =\n      texture.type !== TextureType.image || priority === true;\n    if (shouldUploadImmediately === true) {\n      await this.uploadTexture(texture).catch((err) => {\n        console.error(`Failed to upload texture:`, err);\n        texture.setState('failed');\n      });\n      return;\n    }\n\n    // Queue image textures for throttled upload\n    this.enqueueUploadTexture(texture);\n  }\n\n  /**\n   * Upload a texture to the GPU\n   *\n   * @param texture Texture to upload\n   * @returns Promise that resolves when the texture is fully loaded\n   */\n  async uploadTexture(texture: Texture): Promise<void> {\n    if (\n      this.stage.txMemManager.doNotExceedCriticalThreshold === true &&\n      this.stage.txMemManager.criticalCleanupRequested === true\n    ) {\n      // we're at a critical memory threshold, don't upload textures\n      texture.setState(\n        'failed',\n        new TextureError(TextureErrorCode.MEMORY_THRESHOLD_EXCEEDED),\n      );\n      return;\n    }\n\n    if (texture.state === 'failed' || texture.state === 'freed') {\n      // don't upload failed or freed textures\n      return;\n    }\n\n    if (texture.state === 'loaded') {\n      // already loaded\n      return;\n    }\n\n    if (texture.textureData === null) {\n      texture.setState(\n        'failed',\n        new TextureError(\n          TextureErrorCode.TEXTURE_DATA_NULL,\n          'Texture data is null, cannot upload texture',\n        ),\n      );\n      return;\n    }\n\n    const coreContext = texture.loadCtxTexture();\n\n    if (coreContext !== null && coreContext.state === 'loaded') {\n      texture.setState('loaded');\n      return;\n    }\n\n    await coreContext.load();\n  }\n\n  /**\n   * Check if a texture is being processed\n   */\n  isProcessingTexture(texture: Texture): boolean {\n    return this.uploadTextureQueue.includes(texture) === true;\n  }\n\n  /**\n   * Process a limited number of uploads.\n   *\n   * @param maxProcessingTime - The maximum processing time in milliseconds\n   */\n  async processSome(maxProcessingTime: number): Promise<void> {\n    if (this.initialized === false) {\n      return;\n    }\n\n    const startTime = getTimeStamp();\n\n    // Process priority queue\n    while (\n      this.priorityQueue.length > 0 &&\n      getTimeStamp() - startTime < maxProcessingTime\n    ) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const texture = this.priorityQueue.pop()!;\n      try {\n        await texture.getTextureData();\n        await this.uploadTexture(texture);\n      } catch (error) {\n        console.error('Failed to process priority texture:', error);\n        // Continue with next texture instead of stopping entire queue\n      }\n    }\n\n    // Process uploads - await each upload to prevent GPU overload\n    while (\n      this.uploadTextureQueue.length > 0 &&\n      getTimeStamp() - startTime < maxProcessingTime\n    ) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const texture = this.uploadTextureQueue.shift()!;\n      try {\n        await this.uploadTexture(texture);\n      } catch (error) {\n        console.error('Failed to upload texture:', error);\n        // Continue with next texture instead of stopping entire queue\n      }\n    }\n  }\n\n  public hasUpdates(): boolean {\n    return this.uploadTextureQueue.length > 0;\n  }\n\n  /**\n   * Initialize a texture to the cache\n   *\n   * @param texture Texture to cache\n   * @param cacheKey Cache key for the texture\n   */\n  initTextureToCache(texture: Texture, cacheKey: string) {\n    const { keyCache, inverseKeyCache } = this;\n    keyCache.set(cacheKey, texture);\n    inverseKeyCache.set(texture, cacheKey);\n  }\n\n  /**\n   * Get a texture from the cache\n   *\n   * @param cacheKey\n   */\n  getTextureFromCache(cacheKey: string): Texture | undefined {\n    return this.keyCache.get(cacheKey);\n  }\n\n  /**\n   * Remove a texture from the cache\n   *\n   * @remarks\n   * Called by Texture Cleanup when a texture is freed.\n   *\n   * @param texture\n   */\n  removeTextureFromCache(texture: Texture) {\n    const { inverseKeyCache, keyCache } = this;\n    const cacheKey = inverseKeyCache.get(texture);\n    if (cacheKey) {\n      keyCache.delete(cacheKey);\n    }\n  }\n\n  /**\n   * Resolve a parent texture from the cache or fallback to the provided texture.\n   *\n   * @param texture - The provided texture to resolve.\n   * @returns The cached or provided texture.\n   */\n  resolveParentTexture(texture: ImageTexture): Texture {\n    if (!texture?.props) {\n      return texture;\n    }\n\n    const cacheKey = ImageTexture.makeCacheKey(texture.props);\n    const cachedTexture = cacheKey\n      ? this.getTextureFromCache(cacheKey)\n      : undefined;\n    return cachedTexture ?? texture;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { TrFontFace } from './font-face-types/TrFontFace.js';\nimport type { TextRendererMap, TrFontProps } from './renderers/TextRenderer.js';\n\nconst weightConversions: { [key: string]: number } = {\n  normal: 400,\n  bold: 700,\n  bolder: 900,\n  lighter: 100,\n};\n\nconst fontWeightToNumber = (weight: string | number): number => {\n  if (typeof weight === 'number') {\n    return weight;\n  }\n\n  return weightConversions[weight] || 400;\n};\n\nfunction resolveFontToUse(\n  familyMapsByPriority: FontFamilyMap[],\n  family: string,\n  weightIn: string | number,\n  style: string,\n  stretch: string,\n): TrFontFace | undefined {\n  let weight = fontWeightToNumber(weightIn);\n\n  for (const fontFamiles of familyMapsByPriority) {\n    const fontFaces = fontFamiles[family];\n\n    if (!fontFaces) {\n      continue;\n    }\n\n    if (fontFaces.size === 1) {\n      // No Exact match found, find nearest weight match\n      console.warn(\n        `TrFontManager: Only one font face found for family: '${family}' - will be used for all weights and styles`,\n      );\n\n      return fontFaces.values().next().value as TrFontFace;\n    }\n\n    const weightMap = new Map<number, TrFontFace>();\n    for (const fontFace of fontFaces) {\n      const fontFamilyWeight = fontWeightToNumber(fontFace.descriptors.weight);\n      if (\n        fontFamilyWeight === weight &&\n        fontFace.descriptors.style === style &&\n        fontFace.descriptors.stretch === stretch\n      ) {\n        return fontFace;\n      }\n\n      weightMap.set(fontFamilyWeight, fontFace);\n    }\n\n    // No Exact match found, find nearest weight match\n    const msg = `TrFontManager: No exact match: '${family} Weight: ${weight} Style: ${style} Stretch: ${stretch}'`;\n    console.error(msg);\n\n    // Follow the CSS font-weight algorithm to find the nearest weight match\n    // https://www.w3.org/TR/2018/REC-css-fonts-3-20180920/#font-matching-algorithm\n\n    if (weight === 400 && weightMap.has(500)) {\n      return weightMap.get(500);\n    }\n\n    if (weight === 500 && weightMap.has(400)) {\n      return weightMap.get(400);\n    }\n\n    if (weight < 400) {\n      while (weight > 0) {\n        if (weightMap.has(weight)) {\n          return weightMap.get(weight);\n        }\n        weight -= 100;\n      }\n      // reset back for the next loop\n      weight = 600;\n    }\n\n    while (weight < 1000) {\n      if (weightMap.has(weight)) {\n        return weightMap.get(weight);\n      }\n      weight += 100;\n    }\n\n    // finally check lower again\n    weight = 500;\n    while (weight > 0) {\n      if (weightMap.has(weight)) {\n        return weightMap.get(weight);\n      }\n      weight -= 100;\n    }\n  }\n\n  return;\n}\n\n/**\n * Structure mapping font family names to a set of font faces.\n */\nexport interface FontFamilyMap {\n  [familyName: string]: Set<TrFontFace>;\n}\n\nexport class TrFontManager {\n  private fontCache = new Map<string, TrFontFace>();\n\n  constructor(private textRenderers: Partial<TextRendererMap>) {\n    // Intentionally left blank\n  }\n\n  public addFontFace(font: TrFontFace): void {\n    // All the font face to all of the text renderers that support it\n    for (const trId in this.textRenderers) {\n      const tr = this.textRenderers[trId as keyof TextRendererMap];\n      if (tr && tr.isFontFaceSupported(font)) {\n        tr.addFontFace(font);\n      }\n    }\n  }\n\n  /**\n   * Utility method to resolve a single font face from a list of prioritized family maps based on\n   * a set of font properties.\n   *\n   * @remarks\n   * These are to be used by a text renderer to resolve a font face if needed.\n   *\n   * @param familyMapsByPriority\n   * @param props\n   * @returns\n   */\n  public resolveFontFace(\n    familyMapsByPriority: FontFamilyMap[],\n    props: TrFontProps,\n    rendererType: 'canvas' | 'sdf',\n  ): TrFontFace | undefined {\n    const { fontFamily, fontWeight, fontStyle, fontStretch } = props;\n    const fontCacheString = `${rendererType}_${fontFamily}_${fontStyle}_${fontWeight}_${fontStretch}`;\n\n    if (this.fontCache.has(fontCacheString) === true) {\n      return this.fontCache.get(fontCacheString);\n    }\n\n    const resolvedFont = resolveFontToUse(\n      familyMapsByPriority,\n      fontFamily,\n      fontWeight,\n      fontStyle,\n      fontStretch,\n    );\n    if (resolvedFont !== undefined) {\n      this.fontCache.set(fontCacheString, resolvedFont);\n    }\n\n    return resolvedFont;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CoreRenderOp } from './CoreRenderOp.js';\n\nexport abstract class CoreShader {\n  // abstract draw(): void;\n  static makeCacheKey(props: Record<string, unknown>): string | false {\n    return false;\n  }\n\n  static resolveDefaults(\n    props: Record<string, unknown>,\n  ): Record<string, unknown> {\n    return {};\n  }\n\n  abstract bindRenderOp(\n    renderOp: CoreRenderOp,\n    props: Record<string, unknown> | null,\n  ): void;\n  protected abstract bindProps(props: Record<string, unknown>): void;\n  abstract attach(): void;\n  abstract detach(): void;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { WebGlContextWrapper } from '../../../lib/WebGlContextWrapper.js';\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\n\n//#region Types\nexport interface AttributeInfo {\n  name: string;\n  size: number;\n  type: number;\n  normalized: boolean;\n  stride: number;\n  offset: number;\n}\n\nexport interface UniformInfo {\n  name: string;\n  uniform: keyof UniformMethodMap;\n}\n\nexport interface ShaderOptions {\n  renderer: WebGlCoreRenderer;\n  shaderSources?: ShaderProgramSources;\n  supportsIndexedTextures?: boolean;\n  webgl1Extensions?: string[];\n  webgl2Extensions?: string[];\n}\n\n// prettier-ignore\ntype IsUniformMethod<MethodName, MethodType> = MethodName extends `uniform${string}`\n  ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  MethodType extends (location: WebGLUniformLocation | null, ...args: any[]) => void\n  ? true\n  : false\n  : false;\n\n// prettier-ignore\nexport type UniformMethodMap = {\n  [Key in keyof WebGLRenderingContext as IsUniformMethod<Key, WebGLRenderingContext[Key]> extends true ? Key : never]: WebGLRenderingContext[Key] extends (\n    location: WebGLUniformLocation | null,\n    ...args: infer T\n  ) => void\n  ? T\n  : never;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype TupleToObject<T extends any[]> = Omit<T, keyof any[]>;\n\n// Why the below has to be so insane is beyond me\n// prettier-ignore\nexport type UniformTupleToMap<Uniforms extends [...UniformInfo[]]> = {\n  [Key in keyof TupleToObject<Uniforms> as TupleToObject<Uniforms>[Key] extends {\n    name: infer K extends string;\n  }\n  ? K\n  : never]: TupleToObject<Uniforms>[Key] extends {\n    uniform: infer T extends keyof UniformMethodMap;\n  }\n  ? UniformMethodMap[T]\n  : never;\n};\n\ntype ShaderSource = string | ((textureUnits: number) => string);\n\nexport interface ShaderProgramSources {\n  vertex: ShaderSource;\n  fragment: ShaderSource;\n  webGl2?: {\n    vertex: ShaderSource;\n    fragment: ShaderSource;\n  };\n}\n\n//#endregion Types\n\nexport function createShader(\n  glw: WebGlContextWrapper,\n  type: number,\n  source: string,\n) {\n  const shader = glw.createShader(type);\n  if (!shader) {\n    const glError = glw.getError();\n    throw new Error(\n      `Unable to create the shader: ${\n        type === glw.VERTEX_SHADER ? 'VERTEX_SHADER' : 'FRAGMENT_SHADER'\n      }.${glError ? ` WebGlContext Error: ${glError}` : ''}`,\n    );\n  }\n\n  glw.shaderSource(shader, source);\n  glw.compileShader(shader);\n  const success = !!glw.getShaderParameter(shader, glw.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  console.error(glw.getShaderInfoLog(shader));\n  glw.deleteShader(shader);\n}\n\nexport function createProgram(\n  glw: WebGlContextWrapper,\n  vertexShader: WebGLShader,\n  fragmentShader: WebGLShader,\n) {\n  const program = glw.createProgram();\n  if (!program) {\n    throw new Error('Unable to create program');\n  }\n\n  glw.attachShader(program, vertexShader);\n  glw.attachShader(program, fragmentShader);\n  glw.linkProgram(program);\n  const success = !!glw.getProgramParameter(program, glw.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  console.warn(glw.getProgramInfoLog(program));\n  glw.deleteProgram(program);\n  return undefined;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { assertTruthy, hasOwn } from '../../../utils.js';\nimport type { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport { CoreShader } from '../CoreShader.js';\nimport type { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nimport type { WebGlCoreRenderOp } from './WebGlCoreRenderOp.js';\nimport type { WebGlCoreRenderer } from './WebGlCoreRenderer.js';\nimport type { BufferCollection } from './internal/BufferCollection.js';\nimport {\n  createProgram,\n  createShader,\n  type AttributeInfo,\n  type ShaderOptions,\n  type UniformInfo,\n  type UniformMethodMap,\n  type ShaderProgramSources,\n} from './internal/ShaderUtils.js';\n\n/**\n * Automatic shader prop for the dimensions of the Node being rendered\n *\n * @remarks\n * Shader's who's rendering depends on the dimensions of the Node being rendered\n * should extend this interface from their Prop interface type.\n */\nexport interface DimensionsShaderProp {\n  /**\n   * Dimensions of the Node being rendered (Auto-set by the renderer)\n   *\n   * @remarks\n   * DO NOT SET THIS. It is set automatically by the renderer.\n   * Any values set here will be ignored.\n   */\n  $dimensions?: Dimensions;\n}\n\nexport interface AlphaShaderProp {\n  /**\n   * Alpha of the Node being rendered (Auto-set by the renderer)\n   *\n   * @remarks\n   * DO NOT SET THIS. It is set automatically by the renderer.\n   * Any values set here will be ignored.\n   */\n  $alpha?: number;\n}\n\nexport abstract class WebGlCoreShader extends CoreShader {\n  protected buffersBound = false;\n  protected program: WebGLProgram;\n  /**\n   * Vertex Array Object\n   *\n   * @remarks\n   * Used by WebGL2 Only\n   */\n  protected vao: WebGLVertexArrayObject | undefined;\n  protected renderer: WebGlCoreRenderer;\n  protected glw: WebGlContextWrapper;\n  protected attributeLocations: string[];\n  protected uniformLocations: Record<string, WebGLUniformLocation>;\n  readonly supportsIndexedTextures: boolean;\n\n  constructor(options: ShaderOptions) {\n    super();\n    const renderer = (this.renderer = options.renderer);\n    const glw = (this.glw = this.renderer.glw);\n    this.supportsIndexedTextures = options.supportsIndexedTextures || false;\n\n    // Check that extensions are supported\n    const webGl2 = glw.isWebGl2();\n    const requiredExtensions =\n      (webGl2 && options.webgl2Extensions) ||\n      (!webGl2 && options.webgl1Extensions) ||\n      [];\n    const glVersion = webGl2 ? '2.0' : '1.0';\n    requiredExtensions.forEach((extensionName) => {\n      if (!glw.getExtension(extensionName)) {\n        throw new Error(\n          `Shader \"${this.constructor.name}\" requires extension \"${extensionName}\" for WebGL ${glVersion} but wasn't found`,\n        );\n      }\n    });\n\n    // Gather shader sources\n    // - If WebGL 2 and special WebGL 2 sources are provided, we copy those sources and delete\n    // the extra copy of them to save memory.\n    // TODO: This could be further made optimal by just caching the compiled shaders and completely deleting\n    // the source code\n    const shaderSources =\n      options.shaderSources ||\n      (this.constructor as typeof WebGlCoreShader).shaderSources;\n    if (!shaderSources) {\n      throw new Error(\n        `Shader \"${this.constructor.name}\" is missing shaderSources.`,\n      );\n    } else if (webGl2 && shaderSources?.webGl2) {\n      shaderSources.fragment = shaderSources.webGl2.fragment;\n      shaderSources.vertex = shaderSources.webGl2.vertex;\n      delete shaderSources.webGl2;\n    }\n\n    const textureUnits =\n      renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n\n    const vertexSource =\n      shaderSources.vertex instanceof Function\n        ? shaderSources.vertex(textureUnits)\n        : shaderSources.vertex;\n\n    const fragmentSource =\n      shaderSources.fragment instanceof Function\n        ? shaderSources.fragment(textureUnits)\n        : shaderSources.fragment;\n\n    const vertexShader = createShader(glw, glw.VERTEX_SHADER, vertexSource);\n    const fragmentShader = createShader(\n      glw,\n      glw.FRAGMENT_SHADER,\n      fragmentSource,\n    );\n\n    if (!vertexShader || !fragmentShader) {\n      throw new Error(\n        `Unable to create the following shader(s): ${[\n          !vertexShader && 'VERTEX_SHADER',\n          !fragmentShader && 'FRAGMENT_SHADER',\n        ]\n          .filter(Boolean)\n          .join(' and ')}`,\n      );\n    }\n\n    const program = createProgram(glw, vertexShader, fragmentShader);\n    if (!program) {\n      throw new Error('Unable to create program');\n    }\n    this.program = program;\n\n    this.attributeLocations = glw.getAttributeLocations(this.program);\n    this.uniformLocations = glw.getUniformLocations(this.program);\n  }\n\n  disableAttribute(location: number) {\n    this.glw.disableVertexAttribArray(location);\n  }\n\n  disableAttributes() {\n    const glw = this.glw;\n    const attribLen = this.attributeLocations.length;\n    for (let i = 0; i < attribLen; i++) {\n      glw.disableVertexAttribArray(i);\n    }\n  }\n\n  /**\n   * Given two sets of Shader props destined for this Shader, determine if they can be batched together\n   * to reduce the number of draw calls.\n   *\n   * @remarks\n   * This is used by the {@link WebGlCoreRenderer} to determine if it can batch multiple consecutive draw\n   * calls into a single draw call.\n   *\n   * By default, this returns false (meaning no batching is allowed), but can be\n   * overridden by child classes to provide more efficient batching.\n   *\n   * @param propsA\n   * @param propsB\n   * @returns\n   */\n  canBatchShaderProps(\n    propsA: Record<string, unknown>,\n    propsB: Record<string, unknown>,\n  ): boolean {\n    return false;\n  }\n\n  bindRenderOp(\n    renderOp: WebGlCoreRenderOp,\n    props: Record<string, unknown> | null,\n  ) {\n    this.bindBufferCollection(renderOp.buffers);\n\n    // Since we're not using batched rendering yet we can safely test\n    // for first texture only\n    if (renderOp.textures.length > 0 && renderOp.textures[0]?.ctxTexture) {\n      this.bindTextures(renderOp.textures);\n    }\n\n    const { glw, parentHasRenderTexture, renderToTexture } = renderOp;\n\n    // Skip if the parent and current operation both have render textures\n    if (renderToTexture && parentHasRenderTexture) {\n      return;\n    }\n\n    // Bind render texture framebuffer dimensions as resolution\n    // if the parent has a render texture\n    if (parentHasRenderTexture) {\n      const { width, height } = renderOp.framebufferDimensions || {};\n      // Force pixel ratio to 1.0 for render textures since they are always 1:1\n      // the final render texture will be rendered to the screen with the correct pixel ratio\n      glw.uniform1f(this.getUniformLocation('u_pixelRatio'), 1.0);\n\n      // Set resolution to the framebuffer dimensions\n      glw.uniform2f(\n        this.getUniformLocation('u_resolution'),\n        width ?? 0,\n        height ?? 0,\n      );\n    } else {\n      glw.uniform1f(\n        this.getUniformLocation('u_pixelRatio'),\n        renderOp.options.pixelRatio,\n      );\n      glw.uniform2f(\n        this.getUniformLocation('u_resolution'),\n        glw.canvas.width,\n        glw.canvas.height,\n      );\n    }\n\n    if (props) {\n      // Bind optional automatic uniforms\n      // These are only bound if their keys are present in the props.\n      if (hasOwn(props, '$dimensions')) {\n        let dimensions = props.$dimensions as Dimensions | null;\n        if (!dimensions) {\n          dimensions = renderOp.dimensions;\n        }\n        glw.uniform2f(\n          this.getUniformLocation('u_dimensions'),\n          dimensions.width,\n          dimensions.height,\n        );\n      }\n      if (hasOwn(props, '$alpha')) {\n        let alpha = props.$alpha as number | null;\n        if (!alpha) {\n          alpha = renderOp.alpha;\n        }\n        glw.uniform1f(this.getUniformLocation('u_alpha'), alpha);\n      }\n      this.bindProps(props);\n    }\n  }\n\n  getUniformLocation(name: string): WebGLUniformLocation | null {\n    return this.uniformLocations[name] || null;\n  }\n\n  bindBufferCollection(buffer: BufferCollection) {\n    const { glw } = this;\n    const attribs = this.attributeLocations;\n    const attribLen = attribs.length;\n\n    for (let i = 0; i < attribLen; i++) {\n      const name = attribs[i]!;\n\n      const resolvedBuffer = buffer.getBuffer(name);\n      const resolvedInfo = buffer.getAttributeInfo(name);\n      if (resolvedBuffer === undefined || resolvedInfo === undefined) {\n        continue;\n      }\n      glw.enableVertexAttribArray(i);\n      glw.vertexAttribPointer(\n        resolvedBuffer,\n        i,\n        resolvedInfo.size,\n        resolvedInfo.type,\n        resolvedInfo.normalized,\n        resolvedInfo.stride,\n        resolvedInfo.offset,\n      );\n    }\n  }\n\n  protected override bindProps(props: Record<string, unknown>) {\n    // Implement in child class\n  }\n\n  bindTextures(textures: WebGlCoreCtxTexture[]) {\n    // no defaults\n  }\n\n  override attach(): void {\n    this.glw.useProgram(this.program);\n    if (this.glw.isWebGl2() && this.vao) {\n      this.glw.bindVertexArray(this.vao);\n    }\n  }\n\n  override detach(): void {\n    this.disableAttributes();\n  }\n\n  protected static shaderSources?: ShaderProgramSources;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nimport type { WebGlCoreCtxTexture } from '../WebGlCoreCtxTexture.js';\nimport type { ShaderProgramSources } from '../internal/ShaderUtils.js';\n\nexport class DefaultShader extends WebGlCoreShader {\n  constructor(renderer: WebGlCoreRenderer) {\n    super({\n      renderer,\n    });\n  }\n\n  override bindTextures(textures: WebGlCoreCtxTexture[]) {\n    const { glw } = this;\n    glw.activeTexture(0);\n    glw.bindTexture(textures[0]!.ctxTexture);\n  }\n\n  static override shaderSources: ShaderProgramSources = {\n    vertex: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_nodeCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_nodeCoordinate = a_nodeCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    `,\n    fragment: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    `,\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nimport type { WebGlCoreCtxTexture } from '../WebGlCoreCtxTexture.js';\nimport type { ShaderProgramSources } from '../internal/ShaderUtils.js';\n// import type { Texture } from '../textures/Texture';\n\nexport class DefaultShaderBatched extends WebGlCoreShader {\n  override supportsIndexedTextures = true;\n\n  constructor(renderer: WebGlCoreRenderer) {\n    super({\n      renderer,\n    });\n  }\n\n  override bindTextures(texture: WebGlCoreCtxTexture[]) {\n    const { renderer, glw } = this;\n    if (\n      texture.length > renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS\n    ) {\n      throw new Error(\n        `DefaultShaderBatched: Cannot bind more than ${renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`,\n      );\n    }\n    texture.forEach((t, i) => {\n      glw.activeTexture(i);\n      glw.bindTexture(t.ctxTexture);\n    });\n    const samplers = Array.from(Array(texture.length).keys());\n    this.glw.uniform1iv(this.getUniformLocation('u_textures[0]'), samplers);\n  }\n\n  static override shaderSources: ShaderProgramSources = {\n    vertex: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n    fragment: (textureUnits) => `\n      #define txUnits ${textureUnits}\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[${textureUnits}], int idx, vec2 uv) {\n        ${Array.from(Array(textureUnits).keys())\n          .map(\n            (idx) => `\n          ${idx !== 0 ? 'else ' : ''}if (idx == ${idx}) {\n            return texture2D(textures[${idx}], uv);\n          }\n        `,\n          )\n          .join('')}\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    `,\n  };\n}\n", "import type { EffectMap } from '../../../../CoreShaderManager.js';\nimport type { ExtractProps } from '../../../../CoreTextureManager.js';\nimport type {\n  AlphaShaderProp,\n  DimensionsShaderProp,\n} from '../../WebGlCoreShader.js';\nimport type {\n  UniformInfo,\n  UniformMethodMap,\n} from '../../internal/ShaderUtils.js';\n\nexport interface BaseEffectDesc {\n  name?: string;\n  type: keyof EffectMap;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  props: Record<string, any>;\n}\n\nexport interface EffectDesc<\n  T extends { name?: string; type: keyof EffectMap } = {\n    name?: string;\n    type: keyof EffectMap;\n  },\n> extends BaseEffectDesc {\n  name?: T['name'];\n  type: T['type'];\n  props: ExtractProps<EffectMap[T['type']]>;\n}\n\n/**\n * Allows the `keyof EffectMap` to be mapped over and form an discriminated\n * union of all the EffectDescs structures individually.\n *\n * @remarks\n * When used like the following:\n * ```\n * MapEffectDescs<keyof EffectMap>[]\n * ```\n * The resultant type will be a discriminated union like so:\n * ```\n * (\n *   {\n *     name: 'effect1',\n *     type: 'radius',\n *     props?: {\n *       radius?: number | number[];\n *     }\n *   } |\n *   {\n *     name: 'effect2',\n *     type: 'border',\n *     props?: {\n *       width?: number;\n *       color?: number;\n *     }\n *   } |\n *   // ...\n * )[]\n * ```\n * Which means TypeScript will now base its type checking on the `type` field\n * and will know exactly what the `props` field should be based on the `type`\n * field.\n */\ntype MapEffectDescs<T extends keyof EffectMap> = T extends keyof EffectMap\n  ? EffectDesc<{ type: T; name: string }>\n  : never;\n\nexport type EffectDescUnion = MapEffectDescs<keyof EffectMap>;\n\nexport interface ShaderEffectUniform {\n  value: number | number[] | boolean | string;\n  type: string;\n  method: keyof UniformMethodMap;\n  name?: string;\n  size?: (value: Record<string, unknown>) => number;\n  updateOnBind?: boolean;\n  updateProgramValue?: (\n    programValues: ShaderEffectValueMap,\n    shaderProps?: Record<string, unknown>,\n  ) => void;\n  validator?: (\n    value: any,\n    props: Record<string, unknown>,\n  ) => number | number[] | number[][];\n}\n\nexport interface ShaderEffectValueMap\n  extends DimensionsShaderProp,\n    AlphaShaderProp {\n  value: ShaderEffectUniform['value'];\n  programValue: number | Float32Array | undefined;\n  method: keyof UniformMethodMap;\n  setUniformValue?: () => void | null;\n  hasValidator: boolean;\n  hasProgramValueUpdater: boolean;\n  updateOnBind: boolean;\n  validatedValue?: number | number[];\n}\n\nexport interface ShaderEffectUniforms {\n  [key: string]: ShaderEffectUniform;\n}\n\nexport interface DefaultEffectProps {\n  [key: string]: unknown;\n}\n\nexport interface ShaderEffectOptions {\n  ref: string;\n  target: string;\n  props?: Record<string, unknown>;\n  uniforms?: ShaderEffectUniforms;\n  methods?: Record<string, string>;\n  onShaderMask?: ((value: Record<string, unknown>) => string) | string;\n  onColorize?: ((value: Record<string, unknown>) => string) | string;\n  onEffectMask?: ((value: Record<string, unknown>) => string) | string;\n}\n\nexport abstract class ShaderEffect {\n  readonly priority = 1;\n  readonly name: string = '';\n\n  ref: string;\n  target: string;\n\n  passParameters = '';\n  declaredUniforms = '';\n  uniformInfo: Record<string, UniformInfo> = {};\n\n  static uniforms: ShaderEffectUniforms = {};\n  static methods?: Record<string, string>;\n\n  static onShaderMask?: ((value: Record<string, unknown>) => string) | string;\n\n  static onColorize?: ((value: Record<string, unknown>) => string) | string;\n  static onEffectMask?: ((value: Record<string, unknown>) => string) | string;\n\n  static getEffectKey(props: Record<string, unknown>): string {\n    return '';\n  }\n\n  static getMethodParameters(\n    uniforms: ShaderEffectUniforms,\n    props: Record<string, unknown>,\n  ): string {\n    const res: string[] = [];\n    for (const u in uniforms) {\n      const uni = uniforms[u]!;\n      let define = '';\n      if (uni.size) {\n        define = `[${uni.size(props)}]`;\n      }\n      res.push(`${uni.type} ${u}${define}`);\n    }\n    return res.join(',');\n  }\n\n  constructor(options: ShaderEffectOptions) {\n    const { ref, target, props = {} } = options;\n    this.ref = ref;\n    this.target = target;\n\n    const uniformInfo: Record<string, UniformInfo> = {};\n    const passParameters: string[] = [];\n    let declaredUniforms = '';\n    const uniforms = (this.constructor as typeof ShaderEffect).uniforms || {};\n\n    for (const u in uniforms) {\n      const unif = uniforms[u]!;\n      const uniType = unif.type;\n      //make unique uniform name\n      const uniformName = `${ref}_${u}`;\n      let define = '';\n      if (unif.size) {\n        define = `[${unif.size(props)}]`;\n      }\n      passParameters.push(uniformName);\n      declaredUniforms += `uniform ${uniType} ${uniformName}${define};`;\n      uniformInfo[u] = { name: uniformName, uniform: uniforms[u]!.method };\n    }\n\n    this.passParameters = passParameters.join(',');\n    this.declaredUniforms = declaredUniforms;\n    this.uniformInfo = uniformInfo;\n  }\n\n  static resolveDefaults(\n    props: Record<string, unknown>,\n  ): Record<string, unknown> {\n    return {};\n  }\n\n  static makeEffectKey(props: Record<string, unknown>): string | false {\n    return false;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\nimport {\n  WebGlCoreShader,\n  type DimensionsShaderProp,\n  type AlphaShaderProp,\n} from '../WebGlCoreShader.js';\nimport { type UniformInfo } from '../internal/ShaderUtils.js';\nimport type { WebGlCoreCtxTexture } from '../WebGlCoreCtxTexture.js';\nimport {\n  ShaderEffect,\n  type EffectDescUnion,\n  type ShaderEffectUniform,\n  type ShaderEffectValueMap,\n  type BaseEffectDesc,\n} from './effects/ShaderEffect.js';\nimport type { EffectMap } from '../../../CoreShaderManager.js';\nimport { assertTruthy } from '../../../../utils.js';\nimport type { UniformMethodMap } from '../../../lib/WebGlContextWrapper.js';\n\nexport interface DynamicShaderProps\n  extends DimensionsShaderProp,\n    AlphaShaderProp {\n  effects?: EffectDescUnion[];\n}\n\nconst effectCache = new Map<string, BaseEffectDesc[]>();\nconst getResolvedEffect = (\n  effects: BaseEffectDesc[],\n  effectContructors: Partial<EffectMap>,\n): BaseEffectDesc[] => {\n  const key = JSON.stringify(effects);\n  if (effectCache.has(key)) {\n    return effectCache.get(key)!;\n  }\n  effects = effects ?? [];\n  const resolvedEffects = [];\n  const effectsLength = effects.length;\n  let i = 0;\n  for (; i < effectsLength; i++) {\n    const { name, type, props } = effects[i] as BaseEffectDesc;\n    const resolvedEffect = {\n      name,\n      type,\n      props: {} as Record<string, any>,\n    };\n\n    const effectConstructor = effectContructors[type]!;\n    const defaultPropValues = effectConstructor.resolveDefaults(props);\n    const uniforms = effectConstructor.uniforms;\n    const uniformKeys = Object.keys(uniforms);\n    const uniformsLength = uniformKeys.length;\n    let j = 0;\n    for (; j < uniformsLength; j++) {\n      const key = uniformKeys[j]!;\n      const uniform = uniforms[key]!;\n\n      const result: ShaderEffectValueMap = {\n        value: defaultPropValues[key] as ShaderEffectUniform['value'],\n        programValue: undefined,\n        method: uniform.method,\n        updateOnBind: uniform.updateOnBind || false,\n        hasValidator: uniform.validator !== undefined,\n        hasProgramValueUpdater: uniform.updateProgramValue !== undefined,\n      };\n\n      const validatedValue =\n        (result.hasValidator &&\n          uniform.validator!(defaultPropValues[key], defaultPropValues)) ||\n        defaultPropValues[key];\n\n      if (defaultPropValues[key] !== validatedValue) {\n        result.validatedValue = validatedValue as number | number[];\n      }\n\n      if (result.hasProgramValueUpdater) {\n        uniform.updateProgramValue!(result);\n      }\n\n      if (result.programValue === undefined) {\n        result.programValue = result.value as number;\n      }\n\n      resolvedEffect.props[key] = result;\n    }\n    resolvedEffects.push(resolvedEffect);\n  }\n\n  effectCache.set(key, resolvedEffects);\n  return resolvedEffects;\n};\n\nexport class DynamicShader extends WebGlCoreShader {\n  effects: Array<InstanceType<EffectMap[keyof EffectMap]>> = [];\n\n  constructor(\n    renderer: WebGlCoreRenderer,\n    props: DynamicShaderProps,\n    effectContructors: Partial<EffectMap>,\n  ) {\n    const shader = DynamicShader.createShader(props, effectContructors);\n    super({\n      renderer,\n      shaderSources: {\n        vertex: shader.vertex,\n        fragment: shader.fragment,\n      },\n    });\n\n    this.effects = shader.effects as Array<\n      InstanceType<EffectMap[keyof EffectMap]>\n    >;\n  }\n\n  override bindTextures(textures: WebGlCoreCtxTexture[]) {\n    const { glw } = this;\n    glw.activeTexture(0);\n    glw.bindTexture(textures[0]!.ctxTexture);\n  }\n\n  bindUniformMethods(props: DynamicShaderProps): void {\n    const glw = this.glw;\n    const effects = props.effects;\n    const effectsL = effects!.length;\n    for (let i = 0; i < effectsL; i++) {\n      const uniformInfo = this.effects[i]!.uniformInfo;\n      const effect = effects![i]! as Record<string, any>;\n      const propKeys = Object.keys(effect.props);\n      const propsLength = propKeys.length;\n      for (let j = 0; j < propsLength; j++) {\n        const key = propKeys[j]!;\n        const method = effect.props[key].method as keyof UniformMethodMap;\n        const location = this.getUniformLocation(uniformInfo[key]!.name);\n\n        if (\n          method === 'uniform2fv' ||\n          method === 'uniform2iv' ||\n          //uniform === 'uniform3fv\t' || <--- check why this isnt recognized\n          method === 'uniform3iv' ||\n          method === 'uniform4fv' ||\n          method === 'uniform4iv' ||\n          method === 'uniformMatrix2fv' ||\n          method === 'uniformMatrix3fv' ||\n          method === 'uniformMatrix4fv' ||\n          method === 'uniform1f' ||\n          method === 'uniform1fv' ||\n          method === 'uniform1i' ||\n          method === 'uniform1iv'\n        ) {\n          effect.props[key].setUniformValue = function () {\n            glw[method](location, this.programValue);\n          };\n          continue;\n        }\n\n        if (method === 'uniform2f' || method === 'uniform2i') {\n          effect.props[key].setUniformValue = function () {\n            glw[method](location, this.programValue[0]!, this.programValue[1]!);\n          };\n          continue;\n        }\n\n        if (method === 'uniform3f' || method === 'uniform3i') {\n          effect.props[key].setUniformValue = function () {\n            glw[method](\n              location,\n              this.programValue[0]!,\n              this.programValue[1]!,\n              this.programValue[2]!,\n            );\n          };\n          continue;\n        }\n\n        if (method === 'uniform4f' || method === 'uniform4i') {\n          effect.props[key].setUniformValue = function () {\n            glw[method](\n              location,\n              this.programValue[0]!,\n              this.programValue[1]!,\n              this.programValue[2]!,\n              this.programValue[3]!,\n            );\n          };\n          continue;\n        }\n      }\n    }\n  }\n\n  protected override bindProps(props: Required<DynamicShaderProps>): void {\n    const effects = props.effects;\n    const effectsL = effects.length;\n    let i = 0;\n    for (; i < effectsL; i++) {\n      const effect = effects[i]! as Record<string, any>;\n      const propKeys = Object.keys(effect.props);\n      const propsLength = propKeys.length;\n      let j = 0;\n      for (; j < propsLength; j++) {\n        const key = propKeys[j]!;\n        const prop = effect.props[key]!;\n        if (prop.updateOnBind === true) {\n          const uniform =\n            this.renderer.shManager.getRegisteredEffects()[\n              effect.type as keyof EffectMap\n            ]?.uniforms[key];\n          uniform?.updateProgramValue!(effect.props[key], props);\n        }\n\n        prop.setUniformValue();\n      }\n    }\n  }\n\n  override canBatchShaderProps(\n    propsA: Required<DynamicShaderProps>,\n    propsB: Required<DynamicShaderProps>,\n  ): boolean {\n    if (\n      propsA.$alpha !== propsB.$alpha ||\n      propsA.$dimensions.width !== propsB.$dimensions.width ||\n      propsA.$dimensions.height !== propsB.$dimensions.height ||\n      propsA.effects.length !== propsB.effects.length\n    ) {\n      return false;\n    }\n    const propsEffectsLen = propsA.effects.length;\n    let i = 0;\n    for (; i < propsEffectsLen; i++) {\n      const effectA = propsA.effects[i]!;\n      const effectB = propsB.effects[i]!;\n      if (effectA.type !== effectB.type) {\n        return false;\n      }\n      for (const key in effectA.props) {\n        if (\n          (effectB.props && !effectB.props[key]) ||\n          (effectA.props[key] as ShaderEffectValueMap).value !==\n            (effectB.props[key] as ShaderEffectValueMap).value\n        ) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  static createShader(\n    props: DynamicShaderProps,\n    effectContructors: Partial<EffectMap>,\n  ) {\n    //counts duplicate effects\n    const effectNameCount: Record<string, number> = {};\n    const methods: Record<string, string> = {};\n\n    let declareUniforms = '';\n    const uniforms: UniformInfo[] = [];\n\n    const uFx: Record<string, unknown>[] = [];\n\n    const effects = props.effects!.map((effect) => {\n      const baseClass = effectContructors[effect.type]!;\n      const key = baseClass.getEffectKey(effect.props || {});\n\n      effectNameCount[key] = effectNameCount[key] ? ++effectNameCount[key] : 1;\n\n      const nr = effectNameCount[key]!;\n\n      if (nr === 1) {\n        uFx.push({ key, type: effect.type, props: effect.props });\n      }\n\n      //initialize new effect class;\n      const fxClass = new baseClass({\n        ref: `${key}${nr === 1 ? '' : nr}`,\n        target: key,\n        props: effect.props,\n      }) as ShaderEffect;\n\n      declareUniforms += fxClass.declaredUniforms;\n      uniforms.push(...Object.values(fxClass.uniformInfo));\n      return fxClass;\n    });\n\n    //build source\n    let effectMethods = '';\n\n    uFx?.forEach((fx) => {\n      const fxClass = effectContructors[fx.type as keyof EffectMap]!;\n      const fxProps = fxClass.resolveDefaults(\n        (fx.props ?? {}) as Record<string, unknown>,\n      );\n\n      const remap: Record<string, string>[] = [];\n      for (const m in fxClass.methods) {\n        let cm = m;\n        const fxMethod = fxClass.methods[m]!;\n        if (methods[m] && methods[m] !== fxMethod) {\n          cm = DynamicShader.resolveMethodDuplicate(m, fxMethod, methods);\n        }\n        methods[cm] = fxMethod.replace('function', cm);\n        remap.push({ m, cm });\n      }\n\n      let onShaderMask =\n        fxClass.onShaderMask instanceof Function\n          ? fxClass.onShaderMask(fxProps)\n          : fxClass.onShaderMask;\n\n      let onColorize =\n        fxClass.onColorize instanceof Function\n          ? fxClass.onColorize(fxProps)\n          : fxClass.onColorize;\n\n      let onEffectMask =\n        fxClass.onEffectMask instanceof Function\n          ? fxClass.onEffectMask(fxProps)\n          : fxClass.onEffectMask;\n\n      remap.forEach((r) => {\n        const { m, cm } = r;\n        const reg = new RegExp(`\\\\$${m!}`, 'g');\n        if (onShaderMask) {\n          onShaderMask = onShaderMask.replace(reg, cm!);\n        }\n        if (onColorize) {\n          onColorize = onColorize.replace(reg, cm!);\n        }\n        if (onEffectMask) {\n          onEffectMask = onEffectMask.replace(reg, cm!);\n        }\n      });\n\n      const methodParameters = fxClass.getMethodParameters(\n        fxClass.uniforms,\n        fxProps,\n      );\n      const pm = methodParameters.length > 0 ? `, ${methodParameters}` : '';\n      if (onShaderMask) {\n        effectMethods += `\n        float fx_${fx.key as string}_onShaderMask(float shaderMask ${pm}) {\n          ${onShaderMask}\n        }\n        `;\n      }\n      if (onColorize) {\n        effectMethods += `\n          vec4 fx_${\n            fx.key as string\n          }_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onColorize}\n          }\n        `;\n      }\n\n      if (onEffectMask) {\n        effectMethods += `\n          vec4 fx_${\n            fx.key as string\n          }_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${pm}) {\n            ${onEffectMask}\n          }\n        `;\n      }\n    });\n\n    let sharedMethods = '';\n    for (const m in methods) {\n      sharedMethods += methods[m];\n    }\n\n    //fill main functions\n    let currentMask = `mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))`;\n    let drawEffects = `\n\n    `;\n    for (let i = 0; i < effects.length; i++) {\n      const current = effects[i]!;\n      const pm =\n        current.passParameters.length > 0 ? `, ${current.passParameters}` : '';\n      const currentClass = effectContructors[current.name as keyof EffectMap]!;\n\n      if (currentClass.onShaderMask) {\n        drawEffects += `\n        shaderMask = fx_${current.target}_onShaderMask(shaderMask ${pm});\n        `;\n      }\n      if (currentClass.onColorize) {\n        drawEffects += `\n        maskColor = fx_${current.target}_onColorize(shaderMask, maskColor, shaderColor${pm});\n        `;\n      }\n      if (currentClass.onEffectMask) {\n        currentMask = `fx_${current.target}_onEffectMask(shaderMask, maskColor, shaderColor${pm})`;\n      }\n\n      const next = effects[i + 1]!;\n      if (\n        next === undefined ||\n        effectContructors[next.name as keyof EffectMap]!.onEffectMask\n      ) {\n        drawEffects += `\n          shaderColor = ${currentMask};\n        `;\n      }\n    }\n\n    return {\n      effects,\n      uniforms,\n      fragment: DynamicShader.fragment(\n        declareUniforms,\n        sharedMethods,\n        effectMethods,\n        drawEffects,\n      ),\n      vertex: DynamicShader.vertex(),\n    };\n  }\n\n  static resolveMethodDuplicate(\n    key: string,\n    effectMethod: string,\n    methodCollection: Record<string, string>,\n    increment = 0,\n  ): string {\n    const m = key + (increment > 0 ? (increment as unknown as string) : '');\n    if (methodCollection[m] && methodCollection[m] !== effectMethod) {\n      return this.resolveMethodDuplicate(\n        key,\n        effectMethod,\n        methodCollection,\n        ++increment,\n      );\n    }\n    return m;\n  }\n\n  static override resolveDefaults(\n    props: DynamicShaderProps,\n    effectContructors?: Partial<EffectMap>,\n  ): Required<DynamicShaderProps> {\n    assertTruthy(effectContructors);\n    return {\n      effects: getResolvedEffect(\n        props.effects ?? [],\n        effectContructors,\n      ) as EffectDescUnion[],\n      $dimensions: {\n        width: 0,\n        height: 0,\n      },\n      $alpha: 0,\n    };\n  }\n\n  static override makeCacheKey(\n    props: DynamicShaderProps,\n    effectContructors?: Partial<EffectMap>,\n  ): string {\n    let fx = '';\n    props.effects?.forEach((effect) => {\n      const baseClass = effectContructors![effect.type]!;\n      const key = baseClass.getEffectKey(effect.props || {});\n      fx += `,${key}`;\n    });\n    return `DynamicShader${fx}`;\n  }\n\n  static z$__type__Props: DynamicShaderProps;\n\n  static vertex = () => `\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_nodeCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n    varying vec2 v_nodeCoordinate;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n      v_nodeCoordinate = a_nodeCoordinate;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  `;\n\n  static fragment = (\n    uniforms: string,\n    methods: string,\n    effectMethods: string,\n    drawEffects: string,\n  ) => `\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ${uniforms}\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying vec2 v_nodeCoordinate;\n\n    ${methods}\n\n    ${effectMethods}\n\n    void main() {\n      vec2 p = v_nodeCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ${drawEffects}\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\nimport {\n  WebGlCoreShader,\n  type DimensionsShaderProp,\n} from '../WebGlCoreShader.js';\nimport type { WebGlCoreCtxTexture } from '../WebGlCoreCtxTexture.js';\nimport type { ShaderProgramSources } from '../internal/ShaderUtils.js';\n\n/**\n * Properties of the {@link RoundedRectangle} shader\n */\nexport interface RoundedRectangleProps extends DimensionsShaderProp {\n  /**\n   * Corner radius, in pixels, to cut out of the corners\n   *\n   * @defaultValue 10\n   */\n  radius?: number;\n}\n\n/**\n * Similar to the {@link DefaultShader} but cuts out 4 rounded rectangle corners\n * as defined by the specified corner {@link RoundedRectangleProps.radius}\n */\nexport class RoundedRectangle extends WebGlCoreShader {\n  constructor(renderer: WebGlCoreRenderer) {\n    super({\n      renderer,\n    });\n  }\n\n  static z$__type__Props: RoundedRectangleProps;\n\n  static override resolveDefaults(\n    props: RoundedRectangleProps,\n  ): Required<RoundedRectangleProps> {\n    return {\n      radius: props.radius || 10,\n      $dimensions: {\n        width: 0,\n        height: 0,\n      },\n    };\n  }\n\n  override bindTextures(textures: WebGlCoreCtxTexture[]) {\n    const { glw } = this;\n    glw.activeTexture(0);\n    glw.bindTexture(textures[0]!.ctxTexture);\n  }\n\n  protected override bindProps(props: Required<RoundedRectangleProps>): void {\n    const radiusFactor =\n      Math.min(props.$dimensions.width, props.$dimensions.height) /\n      (2.0 * props.radius);\n    this.glw.uniform1f(\n      this.getUniformLocation('u_radius'),\n      props.radius * Math.min(radiusFactor, 1),\n    );\n  }\n\n  override canBatchShaderProps(\n    propsA: Required<RoundedRectangleProps>,\n    propsB: Required<RoundedRectangleProps>,\n  ): boolean {\n    return (\n      propsA.radius === propsB.radius &&\n      propsA.$dimensions.width === propsB.$dimensions.width &&\n      propsA.$dimensions.height === propsB.$dimensions.height\n    );\n  }\n\n  static override shaderSources: ShaderProgramSources = {\n    vertex: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute vec2 a_nodeCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_nodeCoordinate = a_nodeCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    `,\n    fragment: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_nodeCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    `,\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../lib/utils.js';\nimport type { WebGlCoreCtxTexture } from '../WebGlCoreCtxTexture.js';\nimport type { WebGlCoreRenderer } from '../WebGlCoreRenderer.js';\nimport { WebGlCoreShader } from '../WebGlCoreShader.js';\nimport type { ShaderProgramSources } from '../internal/ShaderUtils.js';\n\nconst IDENTITY_MATRIX_3x3 = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n\ndeclare module '../../../CoreShaderManager.js' {\n  interface ShaderMap {\n    SdfShader: typeof SdfShader;\n  }\n}\n\n/**\n * Properties of the {@link SdfShader}\n */\nexport interface SdfShaderProps {\n  transform?: Float32Array;\n  scrollY?: number;\n  /**\n   * Color in RGBA format\n   *\n   * @remarks\n   * Color channels must NOT be premultiplied by alpha for best blending results.\n   */\n  color?: number;\n  size?: number;\n  distanceRange?: number;\n  debug?: boolean;\n}\n/**\n * SdfShader supports multi-channel and single-channel signed distance field textures.\n *\n * @remarks\n * This Shader is used by the {@link SdfTextRenderer}. Do not use thie Shader\n * directly. Instead create a Text Node and assign a SDF font family to it.\n *\n * @internalRemarks\n * The only thing this shader does to support multi-channel SDFs is to\n * add a median function to the fragment shader. If this one function call\n * ends up being a performance bottleneck we can always look at ways to\n * remove it.\n */\nexport class SdfShader extends WebGlCoreShader {\n  constructor(renderer: WebGlCoreRenderer) {\n    super({\n      renderer,\n    });\n  }\n\n  static z$__type__Props: SdfShaderProps;\n\n  override bindTextures(textures: WebGlCoreCtxTexture[]) {\n    const { glw } = this;\n    glw.activeTexture(0);\n    glw.bindTexture(textures[0]!.ctxTexture);\n  }\n\n  protected override bindProps(props: SdfShaderProps): void {\n    const resolvedProps = SdfShader.resolveDefaults(props);\n    for (const key in resolvedProps) {\n      if (key === 'transform') {\n        this.glw.uniformMatrix3fv(\n          this.getUniformLocation('u_transform'),\n          resolvedProps[key],\n        );\n      } else if (key === 'scrollY') {\n        this.glw.uniform1f(\n          this.getUniformLocation('u_scrollY'),\n          resolvedProps[key],\n        );\n      } else if (key === 'color') {\n        const components = getNormalizedRgbaComponents(resolvedProps.color);\n        this.glw.uniform4fv(this.getUniformLocation('u_color'), components);\n      } else if (key === 'size') {\n        this.glw.uniform1f(\n          this.getUniformLocation('u_size'),\n          resolvedProps[key],\n        );\n      } else if (key === 'distanceRange') {\n        this.glw.uniform1f(\n          this.getUniformLocation('u_distanceRange'),\n          resolvedProps[key],\n        );\n      } else if (key === 'debug') {\n        this.glw.uniform1i(\n          this.getUniformLocation('u_debug'),\n          resolvedProps[key] ? 1 : 0,\n        );\n      }\n    }\n  }\n\n  static override resolveDefaults(\n    props: SdfShaderProps = {},\n  ): Required<SdfShaderProps> {\n    return {\n      transform: props.transform ?? IDENTITY_MATRIX_3x3,\n      scrollY: props.scrollY ?? 0,\n      color: props.color ?? 0xffffffff,\n      size: props.size ?? 16,\n      distanceRange: props.distanceRange ?? 1.0,\n      debug: props.debug ?? false,\n    };\n  }\n\n  static override shaderSources: ShaderProgramSources = {\n    vertex: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    `,\n    fragment: `\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    `,\n  };\n}\n", "import type { DynamicShaderProps } from '../DynamicShader.js';\nimport type { ShaderEffectValueMap } from './ShaderEffect.js';\n\n/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const colorToFloat32Array = (argb: number) => {\n  const col = getRgbaComponentsNormalized(argb);\n  /* eslint-disable @typescript-eslint/no-non-null-assertion -- getRgbaComponentsNormalized has a constant array size */\n  col[0]! *= col[3]!;\n  col[1]! *= col[3]!;\n  col[2]! *= col[3]!;\n  /* eslint-enable */\n  return col;\n};\n\nconst getRgbaComponentsNormalized = (argb: number): number[] => {\n  const r = ((argb / 65536) | 0) % 256;\n  const g = ((argb / 256) | 0) % 256;\n  const b = argb % 256;\n  const a = (argb / 16777216) | 0;\n  return [r / 255, g / 255, b / 255, a / 255];\n};\n\nexport const updateShaderEffectColor = (values: ShaderEffectValueMap) => {\n  if (values.programValue === undefined) {\n    values.programValue = new Float32Array(4);\n  }\n  const rgba = values.value as number;\n  const floatArray = values.programValue as Float32Array;\n  floatArray[0] = (rgba >>> 24) / 255;\n  floatArray[1] = ((rgba >>> 16) & 0xff) / 255;\n  floatArray[2] = ((rgba >>> 8) & 0xff) / 255;\n  floatArray[3] = (rgba & 0xff) / 255;\n};\n\nexport const updateFloat32ArrayLength2 = (values: ShaderEffectValueMap) => {\n  const validatedValue = (values.validatedValue || values.value) as number[];\n  if (values.programValue instanceof Float32Array) {\n    const floatArray = values.programValue;\n    floatArray[0] = validatedValue[0]!;\n    floatArray[1] = validatedValue[1]!;\n  } else {\n    values.programValue = new Float32Array(validatedValue);\n  }\n};\n\nexport const updateFloat32ArrayLength4 = (values: ShaderEffectValueMap) => {\n  const validatedValue = (values.validatedValue || values.value) as number[];\n  if (values.programValue instanceof Float32Array) {\n    const floatArray = values.programValue;\n    floatArray[0] = validatedValue[0]!;\n    floatArray[1] = validatedValue[1]!;\n    floatArray[2] = validatedValue[2]!;\n    floatArray[3] = validatedValue[3]!;\n  } else {\n    values.programValue = new Float32Array(validatedValue);\n  }\n};\n\nexport const updateFloat32ArrayLengthN = (values: ShaderEffectValueMap) => {\n  const validatedValue = (values.validatedValue || values.value) as number[];\n  if (values.programValue instanceof Float32Array) {\n    const len = validatedValue.length;\n    const programValue = values.programValue;\n    for (let i = 0; i < len; i++) {\n      programValue[i] = validatedValue[i]!;\n    }\n  } else {\n    values.programValue = new Float32Array(validatedValue);\n  }\n};\n\nexport const validateArrayLength4 = (value: number | number[]): number[] => {\n  const isArray = Array.isArray(value);\n  if (!isArray) {\n    return [value, value, value, value];\n  } else if (isArray && value.length === 4) {\n    return value;\n  } else if (isArray && value.length === 2) {\n    return [value[0]!, value[1]!, value[0]!, value[1]!];\n  } else if (isArray && value.length === 3) {\n    return [value[0]!, value[1]!, value[2]!, value[0]!];\n  }\n  return [value[0]!, value[0]!, value[0]!, value[0]!];\n};\n\nexport const updateWebSafeRadius = (\n  values: ShaderEffectValueMap,\n  shaderProps?: DynamicShaderProps,\n) => {\n  if (values.programValue === undefined) {\n    values.programValue = new Float32Array(4);\n  }\n  const programValue = values.programValue as Float32Array;\n  const validatedValue = (values.validatedValue || values.value) as number[];\n  if (shaderProps === undefined && values.$dimensions === undefined) {\n    programValue[0] = validatedValue[0]!;\n    programValue[1] = validatedValue[1]!;\n    programValue[2] = validatedValue[2]!;\n    programValue[3] = validatedValue[3]!;\n    return;\n  }\n\n  let storedDimensions = values.$dimensions;\n  if (shaderProps !== undefined) {\n    const { $dimensions } = shaderProps;\n    if (\n      storedDimensions !== undefined &&\n      (storedDimensions.width === $dimensions!.width ||\n        storedDimensions.height === $dimensions!.height)\n    ) {\n      return;\n    }\n    if (storedDimensions === undefined) {\n      storedDimensions = {\n        width: $dimensions?.width as number,\n        height: $dimensions?.height as number,\n      };\n      values.$dimensions = storedDimensions;\n    }\n  }\n\n  const { width, height } = storedDimensions!;\n  const [r0, r1, r2, r3] = validatedValue;\n  const factor = Math.min(\n    Math.min(\n      Math.min(\n        width / Math.max(width, r0! + r1!),\n        width / Math.max(width, r2! + r3!),\n      ),\n      Math.min(\n        height / Math.max(height, r0! + r2!),\n        height / Math.max(height, r1! + r3!),\n      ),\n    ),\n    1,\n  );\n\n  programValue[0] = r0! * factor;\n  programValue[1] = r1! * factor;\n  programValue[2] = r2! * factor;\n  programValue[3] = r3! * factor;\n};\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateWebSafeRadius, validateArrayLength4 } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link RadiusEffect} shader\n */\nexport interface RadiusEffectProps extends DefaultEffectProps {\n  /**\n   * Corner radius, in pixels, to cut out of the corners\n   *\n   * @remarks\n   * You can input an array with a length of up to four or a number.\n   *\n   * array length 4:\n   * [topLeft, topRight, bottomRight, bottomLeft]\n   *\n   * array length 2:\n   * [20, 40] -> [20(topLeft), 40(topRight), 20(bottomRight), 40(bottomLeft)]\n   *\n   * array length 3:\n   * [20, 40, 60] -> [20(topLeft), 40(topRight), 60(bottomRight), 20(bottomLeft)]\n   *\n   * number:\n   * 30 -> [30, 30, 30, 30]\n   *\n   * @default 10\n   */\n  radius?: number | number[];\n}\n\n/**\n * Masks the current maskcolor with rounded corners similar to {@link RoundedRectangle}\n */\nexport class RadiusEffect extends ShaderEffect {\n  static z$__type__Props: RadiusEffectProps;\n  override readonly name = 'radius';\n\n  static override getEffectKey(): string {\n    return `radius`;\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    radius: {\n      value: 0,\n      method: 'uniform4fv',\n      type: 'vec4',\n      updateOnBind: true,\n      validator: validateArrayLength4,\n      updateProgramValue: updateWebSafeRadius,\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    boxDist: `\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    `,\n  };\n\n  static override resolveDefaults(\n    props: RadiusEffectProps,\n  ): Required<RadiusEffectProps> {\n    return {\n      radius: props.radius ?? 10,\n    };\n  }\n\n  static override onShaderMask = `\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 p = v_nodeCoordinate.xy * u_dimensions - halfDimensions;\n  vec4 r = radius;\n  r.xy = (p.x > 0.0) ? r.yz : r.xw;\n  float cornerRadius = (p.y > 0.0) ? r.y : r.x;\n  return $boxDist(p, halfDimensions, cornerRadius);\n  `;\n\n  static override onEffectMask = `\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link BorderEffect} effect\n */\nexport interface BorderEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The BorderEffect renders a border along all edges of an element\n */\nexport class BorderEffect extends ShaderEffect {\n  static z$__type__Props: BorderEffectProps;\n  override readonly name = 'border';\n\n  static override getEffectKey(): string {\n    return `border`;\n  }\n\n  static override resolveDefaults(\n    props: BorderEffectProps,\n  ): Required<BorderEffectProps> {\n    return {\n      width: props.width ?? 10,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override onEffectMask = `\n  float intR = shaderMask + 1.0;\n  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { updateFloat32ArrayLengthN } from './EffectUtils.js';\nimport {\n  type DefaultEffectProps,\n  ShaderEffect,\n  type ShaderEffectUniforms,\n  type ShaderEffectValueMap,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link LinearGradientEffect} effect\n */\nexport interface LinearGradientEffectProps extends DefaultEffectProps {\n  /**\n   * Array of colors to be used in the LinearGradientEffect\n   *\n   * @default [0xff000000, 0xffffffff]\n   */\n  colors?: number[];\n  /**\n   * Angle of the LinearGradientEffect, Angle in Radians\n   *\n   * @default 0\n   */\n  angle?: number;\n  /**\n   * Array of color stops\n   */\n  stops?: number[];\n}\n\n/**\n * Linear Gradient effect over a effect mask\n */\nexport class LinearGradientEffect extends ShaderEffect {\n  static z$__type__Props: LinearGradientEffectProps;\n  override readonly name = 'linearGradient';\n\n  static override getEffectKey(props: LinearGradientEffectProps): string {\n    if ((props.colors as unknown as ShaderEffectValueMap).value as number[]) {\n      return `linearGradient${\n        ((props.colors as unknown as ShaderEffectValueMap).value as number[])\n          .length\n      }`;\n    }\n    return `linearGradient${props.colors!.length}`;\n  }\n\n  static override resolveDefaults(\n    props: LinearGradientEffectProps,\n  ): Required<LinearGradientEffectProps> {\n    const colors = props.colors ?? [0xff000000, 0xffffffff];\n\n    let stops = props.stops || [];\n    if (stops.length === 0 || stops.length !== colors.length) {\n      const colorsL = colors.length;\n      let i = 0;\n      const tmp = stops;\n      for (; i < colorsL; i++) {\n        if (stops[i]) {\n          tmp[i] = stops[i]!;\n          if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n            tmp[i - 1] = tmp[i - 2]! + (stops[i]! - tmp[i - 2]!) / 2;\n          }\n        } else {\n          tmp[i] = i * (1 / (colors.length - 1));\n        }\n      }\n      stops = tmp;\n    }\n    return {\n      colors,\n      stops,\n      angle: props.angle ?? 0,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    angle: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    colors: {\n      value: 0xffffffff,\n      validator: (rgbas: number[]): number[] => {\n        return rgbas.reduce(\n          (acc, val) => acc.concat(getNormalizedRgbaComponents(val)),\n          [] as number[],\n        );\n      },\n      updateProgramValue: updateFloat32ArrayLengthN,\n      size: (props: LinearGradientEffectProps) => props.colors!.length,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n    stops: {\n      value: [],\n      size: (props: LinearGradientEffectProps) => props.colors!.length,\n      method: 'uniform1fv',\n      type: 'float',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    calcPoint: `\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    `,\n  };\n\n  static ColorLoop = (amount: number): string => {\n    let loop = '';\n    for (let i = 2; i < amount; i++) {\n      loop += `colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${\n        i - 1\n      }]) / (stops[${i}] - stops[${i - 1}]), 0.0, 1.0));`;\n    }\n    return loop;\n  };\n\n  static override onColorize = (props: LinearGradientEffectProps) => {\n    const colors = props.colors!.length || 1;\n    return `\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_nodeCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      //return early if dist is lower or equal to first stop\n      if(dist <= stops[0]) {\n        return mix(maskColor, colors[0], clamp(colors[0].a, 0.0, 1.0));\n      }\n      const int amount = ${colors};\n      const int last = amount - 1;\n\n      if(dist >= stops[last]) {\n        return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n      }\n\n      for(int i = 0; i < last; i++) {\n        float left = stops[i];\n        float right = stops[i + 1];\n        if(dist >= left && dist <= right) {\n          float localDist = smoothstep(left, right, dist);\n          vec4 colorOut = mix(colors[i], colors[i + 1], localDist);\n          return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n        }\n      }\n\n      //final fallback\n      return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n    `;\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link GrayscaleEffect} effect\n */\nexport interface GrayscaleEffectProps extends DefaultEffectProps {\n  /**\n   * Grey scale amount between 0 - 1.\n   *\n   * @default 1\n   */\n  amount?: number;\n}\n\n/**\n * Grayscale effect grayscales the color values of the current mask color\n */\nexport class GrayscaleEffect extends ShaderEffect {\n  override readonly name = 'grayscale';\n\n  static override getEffectKey(): string {\n    return `grayscale`;\n  }\n\n  static override resolveDefaults(\n    props: GrayscaleEffectProps,\n  ): Required<GrayscaleEffectProps> {\n    return {\n      amount: props.amount ?? 1,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    amount: {\n      value: 1,\n      method: 'uniform1f',\n      type: 'float',\n    },\n  };\n\n  static override onColorize = `\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link BorderRightEffect} effect\n */\nexport interface BorderRightEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The BorderBottomEffect renders a border on the right side of an element\n */\nexport class BorderRightEffect extends ShaderEffect {\n  static z$__type__Props: BorderRightEffectProps;\n  override readonly name = 'borderRight';\n\n  static override getEffectKey(): string {\n    return `borderRight`;\n  }\n\n  static override resolveDefaults(\n    props: BorderRightEffectProps,\n  ): Required<BorderRightEffectProps> {\n    return {\n      width: props.width ?? 10,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n  };\n\n  static override onEffectMask = `\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link BorderTopEffect} effect\n */\nexport interface BorderTopEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The BorderBottomEffect renders a border on the top side of an element\n */\nexport class BorderTopEffect extends ShaderEffect {\n  static z$__type__Props: BorderTopEffectProps;\n  override readonly name = 'borderTop';\n\n  static override getEffectKey(): string {\n    return `borderTop`;\n  }\n\n  static override resolveDefaults(\n    props: BorderTopEffectProps,\n  ): Required<BorderTopEffectProps> {\n    return {\n      width: props.width ?? 10,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n  };\n\n  static override onEffectMask = `\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link BorderBottomEffect} effect\n */\nexport interface BorderBottomEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The BorderBottomEffect renders a border on the bottom side of an element\n */\nexport class BorderBottomEffect extends ShaderEffect {\n  static z$__type__Props: BorderBottomEffectProps;\n  override readonly name = 'borderBottom';\n\n  static override getEffectKey(): string {\n    return `borderBottom`;\n  }\n\n  static override resolveDefaults(\n    props: BorderBottomEffectProps,\n  ): Required<BorderBottomEffectProps> {\n    return {\n      width: props.width ?? 10,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n  };\n\n  static override onEffectMask = `\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link BorderLeftEffect} effect\n */\nexport interface BorderLeftEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The BorderBottomEffect renders a border on the left of an element\n */\nexport class BorderLeftEffect extends ShaderEffect {\n  static z$__type__Props: BorderLeftEffectProps;\n  override readonly name = 'borderLeft';\n\n  static override getEffectKey(): string {\n    return `borderLeft`;\n  }\n\n  static override resolveDefaults(\n    props: BorderLeftEffectProps,\n  ): Required<BorderLeftEffectProps> {\n    return {\n      width: props.width ?? 10,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    rectDist: `\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    `,\n  };\n\n  static override onEffectMask = `\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "import {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\nexport interface GlitchEffectProps extends DefaultEffectProps {\n  /**\n   * Amplitude determines the intensity of the horizontal shift that happens in the glitch effect.\n   *\n   * @default 0.2\n   */\n  amplitude?: number;\n  /**\n   * Narrowness of the horizontal shift\n   *\n   * @default 4.0\n   */\n  narrowness?: number;\n  /**\n   * Blockiness of the horizontal shift\n   *\n   * @default 2.0\n   */\n  blockiness?: number;\n  /**\n   * Minimzer of the horizontal shift\n   *\n   * @default 8.0\n   */\n  minimizer?: number;\n  /**\n   * Used for the time loop of the horizontal shift\n   *\n   * @default Date.now()\n   */\n  time?: number;\n}\n\n/**\n * Renders a Glitch effect using the incoming texture\n */\nexport class GlitchEffect extends ShaderEffect {\n  static z$__type__Props: GlitchEffectProps;\n  override readonly name = 'glitch';\n\n  static override getEffectKey(props: GlitchEffectProps): string {\n    return `glitch`;\n  }\n\n  static override resolveDefaults(\n    props: GlitchEffectProps,\n  ): Required<GlitchEffectProps> {\n    return {\n      amplitude: props.amplitude ?? 0.2,\n      narrowness: props.narrowness ?? 4.0,\n      blockiness: props.blockiness ?? 2.0,\n      minimizer: props.minimizer ?? 8.0,\n      time: props.time ?? Date.now(),\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    amplitude: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    narrowness: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    blockiness: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    minimizer: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    time: {\n      value: 0,\n      method: 'uniform1f',\n      updateOnBind: true,\n      updateProgramValue: (values) => {\n        const value = (values.value =\n          (Date.now() - (values.value as number)) % 1000);\n        values.programValue = value;\n      },\n      type: 'float',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    rand: `\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    `,\n    noise: `\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    `,\n    fbm: `\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    `,\n  };\n\n  static override onColorize = `\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  updateFloat32ArrayLength4,\n  validateArrayLength4,\n} from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n  type ShaderEffectValueMap,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link FadeOutEffect}\n *\n */\nexport interface FadeOutEffectProps extends DefaultEffectProps {\n  /**\n   * Fade around the edges of the node\n   *\n   * @remarks\n   * You can input an array with a length of up to four or a number.\n   *\n   * array length 4:\n   * [top, right, bottom, left]\n   *\n   * array length 2:\n   * [20, 40] -> [20(top), 40(right), 20(bottom), 40(left)]\n   *\n   * array length 3:\n   * [20, 40, 60] -> [20(top), 40(right), 60(bottom), 20(left)]\n   *\n   * number:\n   * 30 -> [30, 30, 30, 30]\n   *\n   * @default 10\n   */\n  fade?: number | number[];\n}\n\nexport class FadeOutEffect extends ShaderEffect {\n  static z$__type__Props: FadeOutEffectProps;\n  override readonly name = 'fadeOut';\n\n  static override getEffectKey(): string {\n    return `fadeOut`;\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    fade: {\n      value: 0,\n      method: 'uniform4fv',\n      type: 'vec4',\n      validator: validateArrayLength4,\n      updateProgramValue: updateFloat32ArrayLength4,\n    },\n  };\n\n  static override resolveDefaults(\n    props: FadeOutEffectProps,\n  ): Required<FadeOutEffectProps> {\n    return {\n      fade: props.fade ?? 10,\n    };\n  }\n\n  static override onColorize = `\n  vec2 point = v_nodeCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_nodeCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_nodeCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_nodeCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_nodeCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport {\n  updateFloat32ArrayLength2,\n  updateFloat32ArrayLengthN,\n} from './EffectUtils.js';\nimport {\n  type DefaultEffectProps,\n  ShaderEffect,\n  type ShaderEffectUniforms,\n  type ShaderEffectValueMap,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link RadialGradientEffect} effect\n */\nexport interface RadialGradientEffectProps extends DefaultEffectProps {\n  /**\n   * Array of colors to be used in the RadialGradientEffect\n   *\n   * @default [0xff000000, 0xffffffff]\n   */\n  colors?: number[];\n  /**\n   * Array of color stops\n   */\n  stops?: number[];\n  /**\n   * Width of the RadialGradientEffect\n   */\n  width?: number;\n  /**\n   * height of the RadialGradientEffect\n   *\n   * @remarks if not defined uses the width value\n   */\n  height?: number;\n  /**\n   * center point of where the RadialGradientEffect is drawn\n   */\n  pivot?: number[];\n}\n\nexport class RadialGradientEffect extends ShaderEffect {\n  static z$__type__Props: RadialGradientEffectProps;\n  override readonly name = 'radialGradient';\n\n  static override getEffectKey(props: RadialGradientEffectProps): string {\n    if ((props.colors as unknown as ShaderEffectValueMap).value as number[]) {\n      return `radialGradient${\n        ((props.colors as unknown as ShaderEffectValueMap).value as number[])\n          .length\n      }`;\n    }\n    return `radialGradient${props.colors!.length}`;\n  }\n\n  static override resolveDefaults(\n    props: RadialGradientEffectProps,\n  ): Required<RadialGradientEffectProps> {\n    const colors = props.colors ?? [0xff000000, 0xffffffff];\n\n    let stops = props.stops || [];\n    if (stops.length === 0 || stops.length !== colors.length) {\n      const colorsL = colors.length;\n      let i = 0;\n      const tmp = stops;\n      for (; i < colorsL; i++) {\n        if (stops[i]) {\n          tmp[i] = stops[i]!;\n          if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {\n            tmp[i - 1] = tmp[i - 2]! + (stops[i]! - tmp[i - 2]!) / 2;\n          }\n        } else {\n          tmp[i] = i * (1 / (colors.length - 1));\n        }\n      }\n      stops = tmp;\n    }\n    return {\n      colors,\n      stops,\n      width: props.width ?? 0,\n      height: props.height ?? props.width ?? 0,\n      pivot: props.pivot ?? [0.5, 0.5],\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    height: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    pivot: {\n      value: [0.5, 0.5],\n      updateProgramValue: updateFloat32ArrayLength2,\n      method: 'uniform2fv',\n      type: 'vec2',\n    },\n    colors: {\n      value: 0xffffffff,\n      validator: (rgbas: number[]): number[] => {\n        return rgbas.reduce(\n          (acc, val) => acc.concat(getNormalizedRgbaComponents(val)),\n          [] as number[],\n        );\n      },\n      updateProgramValue: updateFloat32ArrayLengthN,\n      size: (props: RadialGradientEffectProps) => props.colors!.length,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n    stops: {\n      value: [],\n      size: (props: RadialGradientEffectProps) => props.colors!.length,\n      method: 'uniform1fv',\n      type: 'float',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    getGradientColor: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n  };\n\n  static ColorLoop = (amount: number): string => {\n    let loop = '';\n    for (let i = 2; i < amount; i++) {\n      loop += `colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${\n        i - 1\n      }]) / (stops[${i}] - stops[${i - 1}]), 0.0, 1.0));`;\n    }\n    return loop;\n  };\n\n  static override onColorize = (props: RadialGradientEffectProps) => {\n    const colors = props.colors!.length || 1;\n    return `\n      vec2 point = v_nodeCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      dist = clamp(dist, 0.0, 1.0);\n      //return early if dist is lower or equal to first stop\n      if(dist <= stops[0]) {\n        return mix(maskColor, colors[0], clamp(colors[0].a, 0.0, 1.0));\n      }\n      const int amount = ${colors};\n      const int last = amount - 1;\n\n      if(dist >= stops[last]) {\n        return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n      }\n\n      for(int i = 0; i < last; i++) {\n        float left = stops[i];\n        float right = stops[i + 1];\n        if(dist >= left && dist <= right) {\n          float localDist = smoothstep(left, right, dist);\n          vec4 colorOut = mix(colors[i], colors[i + 1], localDist);\n          return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n        }\n      }\n\n      //final fallback\n      return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n    `;\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getNormalizedRgbaComponents } from '../../../../lib/utils.js';\nimport { updateShaderEffectColor } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link RadialProgressEffect} effect\n */\nexport interface RadialProgressEffectProps extends DefaultEffectProps {\n  /**\n   * Width of the border in pixels\n   *\n   * @default 10\n   */\n  width?: number;\n  /**\n   * progress from 0 to 1 in floats\n   *\n   * @default 0.5;\n   */\n  progress?: number;\n  /**\n   * offset where the radial progress starts drawing.\n   *\n   * @default 0;\n   */\n  offset?: number;\n  /**\n   * maximum range of the radial progress in radians\n   *\n   * @default Math.PI * 2\n   */\n  range?: number;\n  /**\n   * rounded ends of the progress bar;\n   *\n   * @default false\n   */\n  rounded?: boolean;\n  /**\n   * radius from center to outer edge from 0 to 1 in floats;\n   *\n   * @default 1\n   */\n  radius?: number;\n  /**\n   * Color of the border in 0xRRGGBBAA\n   *\n   * @default 0xffffffff\n   */\n  color?: number;\n}\n\n/**\n * The RadialProgressEffect renders a border along all edges of an element\n */\nexport class RadialProgressEffect extends ShaderEffect {\n  static z$__type__Props: RadialProgressEffectProps;\n  override readonly name = 'radialProgress';\n\n  static override getEffectKey(): string {\n    return `radialProgress`;\n  }\n\n  static override resolveDefaults(\n    props: RadialProgressEffectProps,\n  ): Required<RadialProgressEffectProps> {\n    return {\n      width: props.width ?? 10,\n      progress: props.progress ?? 0.5,\n      offset: props.offset ?? 0,\n      range: props.range ?? Math.PI * 2,\n      rounded: props.rounded ?? false,\n      radius: props.radius ?? 1,\n      color: props.color ?? 0xffffffff,\n    };\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    progress: {\n      value: 0.5,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    offset: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    range: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    rounded: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n      validator: (value: boolean): number => {\n        return value ? 1 : 0;\n      },\n    },\n    radius: {\n      value: 1,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    color: {\n      value: 0xffffffff,\n      updateProgramValue: updateShaderEffectColor,\n      method: 'uniform4fv',\n      type: 'vec4',\n    },\n  };\n\n  static override methods: Record<string, string> = {\n    rotateUV: `\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    `,\n    drawDot: `\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    `,\n  };\n\n  static override onEffectMask = `\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_nodeCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  `;\n\n  static override onColorize = `\n    return color;\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { DynamicShaderProps } from '../DynamicShader.js';\nimport { updateWebSafeRadius, validateArrayLength4 } from './EffectUtils.js';\nimport {\n  ShaderEffect,\n  type DefaultEffectProps,\n  type ShaderEffectUniforms,\n  type ShaderEffectValueMap,\n} from './ShaderEffect.js';\n\n/**\n * Properties of the {@link RadiusEffect} shader\n */\nexport interface HolePunchEffectProps extends DefaultEffectProps {\n  /**\n   * X position where the hole punch starts\n   */\n  x?: number;\n  /**\n   * Y position where the hole punch starts\n   */\n  y?: number;\n  /**\n   * Width of the hole punch\n   */\n  width?: number;\n  /**\n   * height of the hole punch\n   *\n   * @remarks if not defined uses the width value\n   */\n  height?: number;\n  /**\n   * Corner radius in pixels, to cut out of the corners of the hole punch\n   *\n   * @remarks\n   * You can input an array with a length of up to four or a number.\n   *\n   * array length 4:\n   * [topLeft, topRight, bottomRight, bottomLeft]\n   *\n   * array length 2:\n   * [20, 40] -> [20(topLeft), 40(topRight), 20(bottomRight), 40(bottomLeft)]\n   *\n   * array length 3:\n   * [20, 40, 60] -> [20(topLeft), 40(topRight), 60(bottomRight), 20(bottomLeft)]\n   *\n   * number:\n   * 30 -> [30, 30, 30, 30]\n   *\n   * @default 0\n   */\n  radius?: number | number[];\n}\n\n/**\n * Masks the current maskcolor a holepunch effect with rounded corners similar to {@link RoundedRectangle}\n */\nexport class HolePunchEffect extends ShaderEffect {\n  static z$__type__Props: HolePunchEffectProps;\n  override readonly name = 'holePunch';\n\n  static override getEffectKey(): string {\n    return `holePunch`;\n  }\n\n  static override uniforms: ShaderEffectUniforms = {\n    x: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    y: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    width: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    height: {\n      value: 0,\n      method: 'uniform1f',\n      type: 'float',\n    },\n    radius: {\n      value: 0,\n      method: 'uniform4fv',\n      type: 'vec4',\n      updateOnBind: true,\n      validator: validateArrayLength4,\n      updateProgramValue: updateWebSafeRadius,\n    },\n  };\n\n  static override resolveDefaults(\n    props: HolePunchEffectProps,\n  ): Required<HolePunchEffectProps> {\n    return {\n      x: props.x || 0,\n      y: props.y || 0,\n      width: props.width || 50,\n      height: props.height || 50,\n      radius: props.radius ?? 0,\n    };\n  }\n\n  static override methods: Record<string, string> = {\n    fillMask: `\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    `,\n    boxDist: `\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    `,\n  };\n\n  static override onShaderMask = `\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_nodeCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  `;\n\n  static override onEffectMask = `\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  `;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CoreShader } from '../../CoreShader.js';\n\nexport const ROUNDED_RECTANGLE_SHADER_TYPE = 'RoundedRectangle';\n\nexport class UnsupportedShader extends CoreShader {\n  public shType: string;\n\n  constructor(shType: string) {\n    super();\n    this.shType = shType;\n    // if (shType !== ROUNDED_RECTANGLE_SHADER_TYPE) {\n    //   console.warn('Unsupported shader:', shType);\n    // }\n  }\n\n  bindRenderOp(): void {\n    // noop\n  }\n  protected bindProps(): void {\n    // noop\n  }\n\n  attach(): void {\n    // noop\n  }\n  detach(): void {\n    // noop\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { ShaderMap } from '../core/CoreShaderManager.js';\nimport type { ExtractProps } from '../core/CoreTextureManager.js';\nimport type { Stage } from '../core/Stage.js';\nimport type { CoreShader } from '../core/renderers/CoreShader.js';\n\n/**\n * Shader Controller Base Interface\n *\n * @remarks\n * Used directly this interface is like an `any` type for Shader Controllers.\n * But it is also used as a base for more specific Shader Controller interfaces.\n */\nexport interface BaseShaderController {\n  type: keyof ShaderMap;\n  shader: CoreShader;\n  props: Record<string, any>;\n  getResolvedProps: () => Record<string, any>;\n}\n\n/**\n * Shader Controller Class\n *\n * @remarks\n * This class is used to control shader props.\n */\n\nexport class ShaderController<S extends keyof ShaderMap>\n  implements BaseShaderController\n{\n  private resolvedProps: ExtractProps<ShaderMap[S]>;\n  props: ExtractProps<ShaderMap[S]>;\n  constructor(\n    readonly type: S,\n    readonly shader: InstanceType<ShaderMap[S]>,\n    props: ExtractProps<ShaderMap[S]>,\n    stage: Stage,\n  ) {\n    this.resolvedProps = props;\n    const keys = Object.keys(props);\n    const l = keys.length;\n\n    const definedProps = {};\n    for (let i = 0; i < l; i++) {\n      const name = keys[i]!;\n      Object.defineProperty(definedProps, name, {\n        get: () => {\n          return this.resolvedProps[name as keyof ExtractProps<ShaderMap[S]>];\n        },\n        set: (value) => {\n          this.resolvedProps[name as keyof ExtractProps<ShaderMap[S]>] = value;\n          stage.requestRender();\n        },\n      });\n    }\n    this.props = definedProps as ExtractProps<ShaderMap[S]>;\n  }\n\n  getResolvedProps() {\n    return this.resolvedProps;\n  }\n}\n", "import type { ShaderEffectValueMap } from '../../exports/index.js';\nimport type {\n  CoreShaderManager,\n  EffectMap,\n  ShaderMap,\n} from '../core/CoreShaderManager.js';\nimport type { ExtractProps } from '../core/CoreTextureManager.js';\nimport type { EffectDesc } from '../core/renderers/webgl/shaders/effects/ShaderEffect.js';\nimport type { BaseShaderController } from './ShaderController.js';\n\ntype OptionalName<T> = T extends string ? T : never;\n\ntype MapEffectProps<\n  Effects extends [...{ name?: string; type: keyof EffectMap }[]],\n> = {\n  [K in Effects[number] as OptionalName<K['name']>]: ExtractProps<\n    EffectMap[K['type']]\n  >;\n};\n\nexport type DynamicEffects<\n  T extends [...{ name?: string; type: keyof EffectMap }[]],\n> = {\n  [K in keyof T]: EffectDesc<T[K]>;\n};\n\nexport class DynamicShaderController<\n  Effects extends [...{ name?: string; type: keyof EffectMap }[]],\n> implements BaseShaderController\n{\n  private resolvedProps: ExtractProps<ShaderMap['DynamicShader']>;\n  props: MapEffectProps<Effects>;\n  type: 'DynamicShader';\n\n  constructor(\n    readonly shader: InstanceType<ShaderMap['DynamicShader']>,\n    props: ExtractProps<ShaderMap['DynamicShader']>,\n    shManager: CoreShaderManager,\n  ) {\n    this.type = 'DynamicShader';\n    this.resolvedProps = props;\n    const effectConstructors = shManager.getRegisteredEffects();\n    const definedProps = {};\n\n    const effects = props.effects!;\n    const effectsLength = effects.length;\n\n    for (let i = 0; i < effectsLength; i++) {\n      const {\n        name: effectName,\n        props: effectProps,\n        type: effectType,\n      } = effects[i]!;\n      if (effectName === undefined) {\n        continue;\n      }\n      const definedEffectProps = {};\n      const propEntries = Object.keys(effectProps);\n      const propEntriesLength = propEntries.length;\n      for (let j = 0; j < propEntriesLength; j++) {\n        const propName = propEntries[j]!;\n        Object.defineProperty(definedEffectProps, propName, {\n          get: () => {\n            return (\n              this.resolvedProps.effects![i]!.props[propName] as Record<\n                string,\n                any\n              >\n            ).value;\n          },\n          set: (value) => {\n            const target = this.resolvedProps.effects![i]!.props[\n              propName\n            ] as Record<string, any>;\n            target.value = value;\n            if (target.hasValidator) {\n              value = target.validatedValue = effectConstructors[effectType]!\n                .uniforms[propName]?.validator!(value, effectProps);\n            }\n            if (target.hasProgramValueUpdater) {\n              effectConstructors[effectType]!.uniforms[propName]\n                ?.updateProgramValue!(target as ShaderEffectValueMap);\n            } else {\n              target.programValue = value;\n            }\n            shManager.renderer.stage.requestRender();\n          },\n        });\n      }\n\n      Object.defineProperty(definedProps, effectName, {\n        get: () => {\n          return definedEffectProps;\n        },\n      });\n    }\n\n    this.props = definedProps as MapEffectProps<Effects>;\n  }\n\n  getResolvedProps() {\n    return this.resolvedProps;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { ExtractProps } from './CoreTextureManager.js';\nimport type { CoreRenderer } from './renderers/CoreRenderer.js';\nimport type { CoreShader } from './renderers/CoreShader.js';\n\nimport { DefaultShader } from './renderers/webgl/shaders/DefaultShader.js';\nimport { DefaultShaderBatched } from './renderers/webgl/shaders/DefaultShaderBatched.js';\nimport {\n  DynamicShader,\n  type DynamicShaderProps,\n} from './renderers/webgl/shaders/DynamicShader.js';\nimport { RoundedRectangle } from './renderers/webgl/shaders/RoundedRectangle.js';\nimport { SdfShader } from './renderers/webgl/shaders/SdfShader.js';\n\nimport { RadiusEffect } from './renderers/webgl/shaders/effects/RadiusEffect.js';\nimport { BorderEffect } from './renderers/webgl/shaders/effects/BorderEffect.js';\nimport {\n  LinearGradientEffect,\n  type LinearGradientEffectProps,\n} from './renderers/webgl/shaders/effects/LinearGradientEffect.js';\nimport {\n  GrayscaleEffect,\n  type GrayscaleEffectProps,\n} from './renderers/webgl/shaders/effects/GrayscaleEffect.js';\nimport { BorderRightEffect } from './renderers/webgl/shaders/effects/BorderRightEffect.js';\nimport { BorderTopEffect } from './renderers/webgl/shaders/effects/BorderTopEffect.js';\nimport { BorderBottomEffect } from './renderers/webgl/shaders/effects/BorderBottomEffect.js';\nimport { BorderLeftEffect } from './renderers/webgl/shaders/effects/BorderLeftEffect.js';\nimport {\n  GlitchEffect,\n  type GlitchEffectProps,\n} from './renderers/webgl/shaders/effects/GlitchEffect.js';\nimport {\n  FadeOutEffect,\n  type FadeOutEffectProps,\n} from './renderers/webgl/shaders/effects/FadeOutEffect.js';\nimport {\n  RadialGradientEffect,\n  type RadialGradientEffectProps,\n} from './renderers/webgl/shaders/effects/RadialGradientEffect.js';\nimport type { WebGlCoreRenderer } from './renderers/webgl/WebGlCoreRenderer.js';\nimport {\n  RadialProgressEffect,\n  type RadialProgressEffectProps,\n} from './renderers/webgl/shaders/effects/RadialProgressEffect.js';\nimport {\n  HolePunchEffect,\n  type HolePunchEffectProps,\n} from './renderers/webgl/shaders/effects/HolePunchEffect.js';\nimport { WebGlCoreShader } from './renderers/webgl/WebGlCoreShader.js';\nimport { UnsupportedShader } from './renderers/canvas/shaders/UnsupportedShader.js';\nimport { ShaderController } from '../main-api/ShaderController.js';\nimport {\n  DynamicShaderController,\n  type DynamicEffects,\n} from '../main-api/DynamicShaderController.js';\n\nexport type { FadeOutEffectProps };\nexport type { LinearGradientEffectProps };\nexport type { RadialGradientEffectProps };\nexport type { GrayscaleEffectProps };\nexport type { GlitchEffectProps };\nexport type { RadialProgressEffectProps };\nexport type { HolePunchEffectProps };\n\nexport interface ShaderMap {\n  DefaultShader: typeof DefaultShader;\n  DefaultShaderBatched: typeof DefaultShaderBatched;\n  RoundedRectangle: typeof RoundedRectangle;\n  DynamicShader: typeof DynamicShader;\n  SdfShader: typeof SdfShader;\n  UnsupportedShader: typeof UnsupportedShader;\n}\n\nexport interface EffectMap {\n  radius: typeof RadiusEffect;\n  border: typeof BorderEffect;\n  borderBottom: typeof BorderBottomEffect;\n  borderLeft: typeof BorderLeftEffect;\n  borderRight: typeof BorderRightEffect;\n  borderTop: typeof BorderTopEffect;\n  fadeOut: typeof FadeOutEffect;\n  linearGradient: typeof LinearGradientEffect;\n  radialGradient: typeof RadialGradientEffect;\n  grayscale: typeof GrayscaleEffect;\n  glitch: typeof GlitchEffect;\n  radialProgress: typeof RadialProgressEffect;\n  holePunch: typeof HolePunchEffect;\n}\n\nexport type EffectProps =\n  | FadeOutEffectProps\n  | LinearGradientEffectProps\n  | RadialGradientEffectProps\n  | GrayscaleEffectProps\n  | GlitchEffectProps\n  | RadialProgressEffectProps\n  | HolePunchEffectProps;\n\nexport class CoreShaderManager {\n  protected shCache: Map<string, InstanceType<ShaderMap[keyof ShaderMap]>> =\n    new Map();\n  protected shConstructors: Partial<ShaderMap> = {};\n  protected attachedShader: CoreShader | null = null;\n  protected effectConstructors: Partial<EffectMap> = {};\n  renderer!: CoreRenderer;\n\n  constructor() {\n    this.registerShaderType('DefaultShader', DefaultShader);\n    this.registerShaderType('DefaultShaderBatched', DefaultShaderBatched);\n    this.registerShaderType('RoundedRectangle', RoundedRectangle);\n    this.registerShaderType('DynamicShader', DynamicShader);\n    this.registerShaderType('SdfShader', SdfShader);\n\n    this.registerEffectType('border', BorderEffect);\n    this.registerEffectType('borderBottom', BorderBottomEffect);\n    this.registerEffectType('borderLeft', BorderLeftEffect);\n    this.registerEffectType('borderRight', BorderRightEffect);\n    this.registerEffectType('borderTop', BorderTopEffect);\n    this.registerEffectType('fadeOut', FadeOutEffect);\n    this.registerEffectType('linearGradient', LinearGradientEffect);\n    this.registerEffectType('radialGradient', RadialGradientEffect);\n    this.registerEffectType('grayscale', GrayscaleEffect);\n    this.registerEffectType('glitch', GlitchEffect);\n    this.registerEffectType('radius', RadiusEffect);\n    this.registerEffectType('radialProgress', RadialProgressEffect);\n    this.registerEffectType('holePunch', HolePunchEffect);\n  }\n\n  registerShaderType<Type extends keyof ShaderMap>(\n    shType: Type,\n    shClass: ShaderMap[Type],\n  ): void {\n    this.shConstructors[shType] = shClass;\n  }\n\n  registerEffectType<Type extends keyof EffectMap>(\n    effectType: Type,\n    effectClass: EffectMap[Type],\n  ): void {\n    this.effectConstructors[effectType] = effectClass;\n  }\n\n  getRegisteredEffects(): Partial<EffectMap> {\n    return this.effectConstructors;\n  }\n\n  getRegisteredShaders(): Partial<ShaderMap> {\n    return this.shConstructors;\n  }\n\n  /**\n   * Loads a shader (if not already loaded) and returns a controller for it.\n   *\n   * @param shType\n   * @param props\n   * @returns\n   */\n  loadShader<Type extends keyof ShaderMap>(\n    shType: Type,\n    props?: ExtractProps<ShaderMap[Type]>,\n  ): ShaderController<Type> {\n    if (!this.renderer) {\n      throw new Error(`Renderer is not been defined`);\n    }\n    const ShaderClass = this.shConstructors[shType];\n    if (!ShaderClass) {\n      throw new Error(`Shader type \"${shType as string}\" is not registered`);\n    }\n\n    if (\n      this.renderer.mode === 'canvas' &&\n      ShaderClass.prototype instanceof WebGlCoreShader\n    ) {\n      return this._createShaderCtr(\n        shType,\n        new UnsupportedShader(shType) as InstanceType<ShaderMap[Type]>,\n        props as ExtractProps<ShaderMap[Type]>,\n      );\n    }\n\n    if (shType === 'DynamicShader') {\n      return this.loadDynamicShader(\n        props as DynamicShaderProps,\n      ) as unknown as ShaderController<Type>;\n    }\n\n    const resolvedProps = ShaderClass.resolveDefaults(\n      props as Record<string, unknown>,\n    );\n    const cacheKey =\n      ShaderClass.makeCacheKey(resolvedProps) || ShaderClass.name;\n    if (cacheKey && this.shCache.has(cacheKey)) {\n      return this._createShaderCtr(\n        shType,\n        this.shCache.get(cacheKey) as InstanceType<ShaderMap[Type]>,\n        resolvedProps as ExtractProps<ShaderMap[Type]>,\n      );\n    }\n\n    // @ts-expect-error ShaderClass WILL accept a Renderer\n    const shader = new ShaderClass(this.renderer, props) as InstanceType<\n      ShaderMap[Type]\n    >;\n    if (cacheKey) {\n      this.shCache.set(cacheKey, shader);\n    }\n    return this._createShaderCtr(\n      shType,\n      shader,\n      resolvedProps as ExtractProps<ShaderMap[Type]>,\n    );\n  }\n\n  loadDynamicShader<\n    T extends DynamicEffects<[...{ name?: string; type: keyof EffectMap }[]]>,\n  >(props: DynamicShaderProps): DynamicShaderController<T> {\n    if (!this.renderer) {\n      throw new Error(`Renderer is not been defined`);\n    }\n    const resolvedProps = DynamicShader.resolveDefaults(\n      props as Record<string, unknown>,\n      this.effectConstructors,\n    );\n    const cacheKey = DynamicShader.makeCacheKey(\n      resolvedProps,\n      this.effectConstructors,\n    );\n    if (cacheKey && this.shCache.has(cacheKey)) {\n      return this._createDynShaderCtr(\n        this.shCache.get(cacheKey) as InstanceType<ShaderMap['DynamicShader']>,\n        resolvedProps,\n      );\n    }\n    const shader = new DynamicShader(\n      this.renderer as WebGlCoreRenderer,\n      props,\n      this.effectConstructors,\n    );\n    if (cacheKey) {\n      this.shCache.set(cacheKey, shader);\n    }\n\n    return this._createDynShaderCtr(shader, resolvedProps);\n  }\n\n  private _createShaderCtr<Type extends keyof ShaderMap>(\n    type: Type,\n    shader: InstanceType<ShaderMap[Type]>,\n    props: ExtractProps<ShaderMap[Type]>,\n  ): ShaderController<Type> {\n    return new ShaderController(type, shader, props, this.renderer.stage);\n  }\n\n  private _createDynShaderCtr<\n    T extends DynamicEffects<[...{ name?: string; type: keyof EffectMap }[]]>,\n  >(\n    shader: InstanceType<ShaderMap['DynamicShader']>,\n    props: ExtractProps<ShaderMap['DynamicShader']>,\n  ): DynamicShaderController<T> {\n    shader.bindUniformMethods(props);\n    return new DynamicShaderController(shader, props, this);\n  }\n\n  useShader(shader: CoreShader): void {\n    if (this.attachedShader === shader) {\n      return;\n    }\n    if (this.attachedShader) {\n      this.attachedShader.detach();\n    }\n    shader.attach();\n    this.attachedShader = shader;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport type { EventEmitter } from '../../../common/EventEmitter.js';\nimport type { CoreTextNode } from '../../CoreTextNode.js';\nimport type { Stage } from '../../Stage.js';\nimport type { Matrix3d } from '../../lib/Matrix3d.js';\nimport type { Rect, RectWithValid } from '../../lib/utils.js';\nimport type {\n  TrFontFace,\n  TrFontFaceDescriptors,\n} from '../font-face-types/TrFontFace.js';\nimport type {\n  TextBaseline,\n  TextVerticalAlign,\n} from './LightningTextTextureRenderer.js';\n\n/**\n * Augmentable map of text renderer type IDs to text renderer types.\n *\n * @example\n * ```ts\n * declare module './TextRenderer' {\n *   interface TextRendererMap {\n *     canvas: CanvasTextRenderer;\n *   }\n * }\n * ```\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface TextRendererMap {}\n\nexport interface TextRendererState {\n  props: TrProps;\n  /**\n   * Whether or not the text renderer state is scheduled to be updated\n   * via queueMicrotask.\n   */\n  updateScheduled: boolean;\n  status: 'initialState' | 'loading' | 'loaded' | 'failed' | 'destroyed';\n  /**\n   * Event emitter for the text renderer\n   */\n  emitter: EventEmitter;\n\n  /**\n   * Force a full layout pass for the calculation of the\n   * total dimensions of the text\n   */\n  forceFullLayoutCalc: boolean;\n  textW: number | undefined;\n  textH: number | undefined;\n\n  isRenderable: boolean;\n\n  debugData: {\n    updateCount: number;\n    layoutCount: number;\n    drawCount: number;\n    lastLayoutNumCharacters: number;\n    layoutSum: number;\n    drawSum: number;\n    bufferSize: number;\n  };\n}\n\nexport interface TextRendererDebugProps {\n  showRenderWindow: boolean;\n  showVisibleRect: boolean;\n  showElementRect: boolean;\n  disableScissor: boolean;\n  printLayoutTime: boolean;\n}\n\n/**\n * Text renderer properties that are used in resolving appropriate font faces\n *\n * @remarks\n * Extended by {@link TrProps}\n */\nexport interface TrFontProps {\n  /**\n   * Font Family\n   *\n   * @internalRemarks\n   * `fontFamily` is defined currently as single string, but in the future we may want to\n   * support multiple font family fallbacks, as this is supported by CSS / Canvas2d. We can\n   * do this in a backwards compatible way by unioning an array of strings to the\n   * `fontFamily` property.\n   */\n  fontFamily: string;\n  /**\n   * Font Weight\n   *\n   * @remarks\n   * The font weight to use when looking up the font face. This can be a numeric\n   * value between 1 and 1000, or one of the following strings:\n   * - `'normal'` - same as 400\n   * - `'bold'` - same as 700\n   * - `'bolder'` - (Not yet properly supported)\n   */\n  fontWeight: TrFontFaceDescriptors['weight'] | 'bolder' | 'lighter';\n  /**\n   * Font Style\n   *\n   * @remarks\n   * The font style to use when looking up the font face. This can be one of the\n   * following strings:\n   * - `'normal'`\n   * - `'italic'`\n   * - `'oblique'`\n   */\n  fontStyle: TrFontFaceDescriptors['style'];\n  /**\n   * Font Stretch\n   *\n   * @remarks\n   * The font stretch to use when looking up the font face. This can be one of the\n   * following strings:\n   * - `'normal'`\n   * - `'ultra-condensed'`\n   * - `'extra-condensed'`\n   * - `'condensed'`\n   * - `'semi-condensed'`\n   * - `'semi-expanded'`\n   * - `'expanded'`\n   * - `'extra-expanded'`\n   * - `'ultra-expanded'`\n   *\n   * @default 'normal'\n   */\n  fontStretch: TrFontFaceDescriptors['stretch'];\n  /**\n   * Font Size\n   *\n   * @remarks\n   * The font size to use when looking up the font face.\n   *\n   * The font size is specified in pixels and is the height of the font's\n   * em-square. The em-square is essentially the height of the capital letters\n   * for the font. The actual height of the text can be larger than the\n   * specified font size, as the font may have ascenders and descenders that\n   * extend beyond the em-square.\n   *\n   * @default 16\n   */\n  fontSize: number;\n}\n\nexport interface TrProps extends TrFontProps {\n  /**\n   * Text to display\n   *\n   * @default ''\n   */\n  text: string;\n  /**\n   * Text alignment\n   *\n   * @remarks\n   * Alignment of the text relative to it's contained bounds. For best results,\n   * use {@link contain} mode `'width'` or `'both'` and a set an explicit\n   * {@link width} for the text to be aligned within.\n   *\n   * @default 'left'\n   */\n  textAlign: 'left' | 'center' | 'right';\n  /**\n   * Color of text\n   *\n   * @remarks\n   * The color value is a number in the format 0xRRGGBBAA, where RR is the red\n   * component, GG is the green component, BB is the blue component, and AA is\n   * the alpha component.\n   *\n   * @default 0xffffffff (opaque white)\n   */\n  color: number;\n  x: number;\n  y: number;\n  /**\n   * Contain mode for text\n   *\n   * @remarks\n   * The contain mode determines how the text is contained within the bounds\n   * of the Text Node. The default value is `'none'`, which means that the\n   * Text Renderer will not constrain the text in any way. `'width'` mode will\n   * constrain the text to the set width wrapping lines as necessary, and\n   * `'both'` mode will constrain the text to both the set width and height\n   * wrapping lines and truncating text as necessary.\n   *\n   * ## Text Auto-size Behavior\n   * Depending on the set contain mode, after the text 'loaded' event is emitted,\n   * the text node may have either its {@link width} and {@link height} updated\n   * to match the rendered size of the text.\n   *\n   * When contain mode is 'none', both the {@link width} and {@link height}\n   * properties are updated.\n   *\n   * When contain mode is 'width', only the {@link height} property is updated.\n   *\n   * When contain mode is 'both', neither property is updated.\n   *\n   * @default 'none'\n   */\n  contain: 'none' | 'width' | 'both';\n  width: number;\n  height: number;\n  /**\n   * Whether or not the text is scrollable\n   *\n   * @remarks\n   * If `scrollable` is `true`, the text can be scrolled vertically within the\n   * bounds of the Text Node. You can set the scroll position using the\n   * {@link scrollY} property.\n   *\n   * @default false\n   */\n  scrollable: boolean;\n  /**\n   * Vertical scroll position for text\n   *\n   * @remarks\n   * The vertical scroll position of the text. This property is only used if\n   * {@link scrollable} is `true`.\n   *\n   * @default 0\n   */\n  scrollY: number;\n  /**\n   * Vertical offset for text\n   *\n   * @remarks\n   * The vertical offset of the text. This property is only used if\n   * {@link scrollable} is `true`.\n   *\n   * @default 0\n   */\n  offsetY: number;\n  /**\n   * Letter spacing for text (in pixels)\n   *\n   * @remarks\n   * This property sets additional (or reduced, if value is negative) spacing\n   * between characters in the text.\n   *\n   * @default 0\n   */\n  letterSpacing: number;\n  /**\n   * Line height for text (in pixels)\n   *\n   * @remarks\n   * This property sets the height of each line. If set to `undefined`, the\n   * line height will be calculated based on the font and font size to be the\n   * minimal height required to completely contain a line of text.\n   *\n   * See: https://github.com/lightning-js/renderer/issues/170\n   *\n   * @default `undefined`\n   */\n  lineHeight: number | undefined;\n  /**\n   * Max lines for text\n   *\n   * @remarks\n   * This property sets max number of lines of a text paragraph.\n   * Not yet implemented in the SDF renderer.\n   *\n   * @default 0\n   */\n  maxLines: number;\n  /**\n   * Baseline for text\n   *\n   * @remarks\n   * This property sets the text baseline used when drawing text.\n   * Not yet implemented in the SDF renderer.\n   *\n   * @default alphabetic\n   */\n  textBaseline: TextBaseline;\n  /**\n   * Vertical Align for text when lineHeight > fontSize\n   *\n   * @remarks\n   * This property sets the vertical align of the text.\n   * Not yet implemented in the SDF renderer.\n   *\n   * @default middle\n   */\n  verticalAlign: TextVerticalAlign;\n  /**\n   * Overflow Suffix for text\n   *\n   * @remarks\n   * The suffix to be added when text is cropped due to overflow.\n   * Not yet implemented in the SDF renderer.\n   *\n   * @default \"...\"\n   */\n  overflowSuffix: string;\n\n  zIndex: number;\n\n  debug: Partial<TextRendererDebugProps>;\n}\n\nexport type TrPropSetters<StateT = TextRendererState> = {\n  [key in keyof TrProps]: (state: StateT, value: TrProps[key]) => void;\n};\n\nconst trPropSetterDefaults: TrPropSetters = {\n  x: (state, value) => {\n    state.props.x = value;\n  },\n  y: (state, value) => {\n    state.props.y = value;\n  },\n  width: (state, value) => {\n    state.props.width = value;\n  },\n  height: (state, value) => {\n    state.props.height = value;\n  },\n  color: (state, value) => {\n    state.props.color = value;\n  },\n  zIndex: (state, value) => {\n    state.props.zIndex = value;\n  },\n  fontFamily: (state, value) => {\n    state.props.fontFamily = value;\n  },\n  fontWeight: (state, value) => {\n    state.props.fontWeight = value;\n  },\n  fontStyle: (state, value) => {\n    state.props.fontStyle = value;\n  },\n  fontStretch: (state, value) => {\n    state.props.fontStretch = value;\n  },\n  fontSize: (state, value) => {\n    state.props.fontSize = value;\n  },\n  text: (state, value) => {\n    state.props.text = value;\n  },\n  textAlign: (state, value) => {\n    state.props.textAlign = value;\n  },\n  contain: (state, value) => {\n    state.props.contain = value;\n  },\n  offsetY: (state, value) => {\n    state.props.offsetY = value;\n  },\n  scrollable: (state, value) => {\n    state.props.scrollable = value;\n  },\n  scrollY: (state, value) => {\n    state.props.scrollY = value;\n  },\n  letterSpacing: (state, value) => {\n    state.props.letterSpacing = value;\n  },\n  lineHeight: (state, value) => {\n    state.props.lineHeight = value;\n  },\n  maxLines: (state, value) => {\n    state.props.maxLines = value;\n  },\n  textBaseline: (state, value) => {\n    state.props.textBaseline = value;\n  },\n  verticalAlign: (state, value) => {\n    state.props.verticalAlign = value;\n  },\n  overflowSuffix: (state, value) => {\n    state.props.overflowSuffix = value;\n  },\n  debug: (state, value) => {\n    state.props.debug = value;\n  },\n};\n\n/**\n * Event handler for when text is loaded\n *\n * @remarks\n * Emitted by state.emitter\n */\nexport type TrLoadedEventHandler = (target: any) => void;\n\n/**\n * Event handler for when text failed to load\n *\n * @remarks\n * Emitted by state.emitter\n */\nexport type TrFailedEventHandler = (target: any, error: Error) => void;\n\nexport abstract class TextRenderer<\n  StateT extends TextRendererState = TextRendererState,\n> {\n  readonly set: Readonly<TrPropSetters<StateT>>;\n  abstract type: 'canvas' | 'sdf';\n\n  constructor(protected stage: Stage) {\n    const propSetters = {\n      ...trPropSetterDefaults,\n      ...this.getPropertySetters(),\n    };\n    // For each prop setter add a wrapper method that checks if the prop is\n    // different before calling the setter\n    const propSet = {};\n    Object.keys(propSetters).forEach((key) => {\n      Object.defineProperty(propSet, key, {\n        value: (state: StateT, value: TrProps[keyof TrProps]) => {\n          // Check if the current prop value is different before calling the setter\n          if (state.props[key as keyof TrProps] !== value) {\n            propSetters[key as keyof TrPropSetters](state, value as never);\n\n            // Assume any prop change will require a render\n            // This ensures that renders are triggered appropriately even with RAF paused\n            this.stage.requestRender();\n          }\n        },\n        writable: false, // Prevents property from being changed\n        configurable: false, // Prevents property from being deleted\n      });\n    });\n    this.set = propSet as Readonly<TrPropSetters<StateT>>;\n  }\n\n  setStatus(state: StateT, status: StateT['status'], error?: Error) {\n    // Don't emit the same status twice\n    if (state.status === status) {\n      return;\n    }\n    state.status = status;\n    state.emitter.emit(status, error);\n  }\n\n  /**\n   * Allows the CoreTextNode to communicate changes to the isRenderable state of\n   * the itself.\n   *\n   * @param state\n   * @param renderable\n   */\n  setIsRenderable(state: StateT, renderable: boolean) {\n    state.isRenderable = renderable;\n  }\n\n  /**\n   * Called by constructor to get a map of property setter functions for this renderer.\n   */\n  abstract getPropertySetters(): Partial<TrPropSetters<StateT>>;\n\n  /**\n   * Given text renderer properties (particularly the specific properties related to font selection)\n   * returns whether or not the renderer can render it.\n   *\n   * @param props\n   */\n  abstract canRenderFont(props: TrFontProps): boolean;\n\n  /**\n   * Called by the TrFontManager to find out if a newly added font face is supported\n   * by this renderer.\n   *\n   * @param fontFace\n   */\n  abstract isFontFaceSupported(fontFace: TrFontFace): boolean;\n\n  /**\n   * Called by the TrFontManager to add a font face to the renderer's font registry.\n   *\n   * @remarks\n   * This method MUST ONLY be called for a fontFace that previously passed the\n   * {@link isFontFaceSupported} check.\n   *\n   * @param fontFace\n   */\n  abstract addFontFace(fontFace: TrFontFace): void;\n\n  abstract createState(props: TrProps, node: CoreTextNode): StateT;\n\n  /**\n   * Destroy/Clean up the state object\n   *\n   * @remarks\n   * Opposite of createState(). Frees any event listeners / resources held by\n   * the state that may not reliably get garbage collected.\n   *\n   * @param state\n   */\n  destroyState(state: StateT) {\n    this.setStatus(state, 'destroyed');\n    state.emitter.removeAllListeners();\n  }\n\n  /**\n   * Schedule a state update via queueMicrotask\n   *\n   * @remarks\n   * This method is used to schedule a state update via queueMicrotask. This\n   * method should be called whenever a state update is needed, and it will\n   * ensure that the state is only updated once per microtask.\n   * @param state\n   * @returns\n   */\n  scheduleUpdateState(state: StateT): void {\n    if (state.updateScheduled) {\n      return;\n    }\n    state.updateScheduled = true;\n    queueMicrotask(() => {\n      // If the state has been destroyed, don't update it\n      if (state.status === 'destroyed') {\n        return;\n      }\n      state.updateScheduled = false;\n      this.updateState(state);\n    });\n  }\n\n  abstract updateState(state: StateT): void;\n\n  renderQuads?(\n    state: StateT,\n    transform: Matrix3d,\n    clippingRect: RectWithValid,\n    alpha: number,\n    parentHasRenderTexture: boolean,\n    framebufferDimensions: Dimensions | undefined,\n  ): void;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Class that keeps track of the invocations of Context methods when\n * the `enableContextSpy` renderer option is enabled.\n */\nexport class ContextSpy {\n  private data: Record<string, number> = {};\n\n  reset() {\n    this.data = {};\n  }\n\n  increment(name: string) {\n    if (!this.data[name]) {\n      this.data[name] = 0;\n    }\n    this.data[name]++;\n  }\n\n  getData() {\n    return { ...this.data };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { isProductionEnvironment } from '../utils.js';\nimport type { Stage } from './Stage.js';\nimport { Texture, TextureType } from './textures/Texture.js';\nimport { bytesToMb } from './utils.js';\n\nexport interface TextureMemoryManagerSettings {\n  /**\n   * Critical Threshold (in bytes)\n   *\n   * @remarks\n   * When the amount of memory used by textures exceeds this threshold,\n   * the Renderer will immediately trigger a Texture Cleanup towards the\n   * Target Threshold Level.\n   *\n   * When set to `0`, the Texture Memory Manager is disabled.\n   *\n   * @defaultValue `124e6` (118 MB)\n   */\n  criticalThreshold: number;\n\n  /**\n   * Target Threshold Level (as fraction of Critical Threshold)\n   *\n   * @remarks\n   * This value is the fractional level of the Critical Threshold that the\n   * Texture Memory Manager will attempt to maintain by cleaning up textures.\n   * The Texture Memory Manager will attempt to keep the memory usage below\n   * this level by freeing up non-renderable textures.\n   *\n   * Valid Range: 0.0 - 1.0\n   *\n   * @defaultValue `0.5`\n   */\n  targetThresholdLevel: number;\n\n  /**\n   * Interval between non-aggressive Texture Cleanups (in milliseconds)\n   *\n   * @remarks\n   * Texture Memory Manager will perform a non aggressive Texture Cleanup no more\n   * frequently than this interval when the scene becomes idle.\n   *\n   * @defaultValue `5,000` (5 seconds)\n   */\n  cleanupInterval: number;\n\n  /**\n   * Whether or not to log debug information\n   *\n   * @defaultValue `false`\n   */\n  debugLogging: boolean;\n\n  /**\n   * Baseline memory allocation for the Texture Memory Manager\n   *\n   * @remarks\n   * Baseline texture memory is an allocation of memory by simply having a 1080p WebGL context.\n   * This will be used on top of the memory used by textures to determine when to trigger a cleanup.\n   *\n   * @defaultValue `25e6` (25 MB)\n   */\n  baselineMemoryAllocation: number;\n\n  /**\n   * Do not exceed critical threshold\n   *\n   * @defaultValue `false`\n   */\n  doNotExceedCriticalThreshold: boolean;\n}\n\nexport interface MemoryInfo {\n  criticalThreshold: number;\n  targetThreshold: number;\n  renderableMemUsed: number;\n  memUsed: number;\n  renderableTexturesLoaded: number;\n  loadedTextures: number;\n  baselineMemoryAllocation: number;\n}\n\n/**\n * LRU (Least Recently Used) style memory manager for textures\n *\n * @remarks\n * This class is responsible for managing the memory usage of textures\n * in the Renderer. It keeps track of the memory used by each texture\n * and triggers a cleanup when the memory usage exceeds a critical\n * threshold (`criticalThreshold`).\n *\n * The cleanup process will free up non-renderable textures until the\n * memory usage is below a target threshold (`targetThresholdLevel`).\n *\n * The memory manager's clean up process will also be triggered when the\n * scene is idle for a certain amount of time (`cleanupInterval`).\n */\nexport class TextureMemoryManager {\n  private memUsed = 0;\n  private loadedTextures: (Texture | null)[] = [];\n  private criticalThreshold: number;\n  private targetThreshold: number;\n  private cleanupInterval: number;\n  private debugLogging: boolean;\n  private lastCleanupTime = 0;\n  private baselineMemoryAllocation: number;\n  private hasWarnedAboveCritical = false;\n\n  public criticalCleanupRequested = false;\n  public doNotExceedCriticalThreshold: boolean;\n\n  /**\n   * The current frame time in milliseconds\n   *\n   * @remarks\n   * This is used to determine when to perform Idle Texture Cleanups.\n   *\n   * Set by stage via `updateFrameTime` method.\n   */\n  public frameTime = 0;\n\n  constructor(private stage: Stage, settings: TextureMemoryManagerSettings) {\n    const { criticalThreshold, doNotExceedCriticalThreshold } = settings;\n    this.doNotExceedCriticalThreshold = doNotExceedCriticalThreshold || false;\n    this.criticalThreshold = Math.round(criticalThreshold);\n    const targetFraction = Math.max(\n      0,\n      Math.min(1, settings.targetThresholdLevel),\n    );\n    this.cleanupInterval = settings.cleanupInterval;\n    this.debugLogging = settings.debugLogging;\n    this.baselineMemoryAllocation = Math.round(\n      settings.baselineMemoryAllocation,\n    );\n    this.targetThreshold = Math.max(\n      Math.round(criticalThreshold * targetFraction),\n      this.baselineMemoryAllocation,\n    );\n    this.memUsed = Math.round(settings.baselineMemoryAllocation);\n\n    if (settings.debugLogging) {\n      let lastMemUse = 0;\n      setInterval(() => {\n        if (lastMemUse !== this.memUsed) {\n          lastMemUse = this.memUsed;\n          console.log(\n            `[TextureMemoryManager] Memory used: ${bytesToMb(\n              this.memUsed,\n            )} mb / ${bytesToMb(this.criticalThreshold)} mb (${(\n              (this.memUsed / this.criticalThreshold) *\n              100\n            ).toFixed(1)}%)`,\n          );\n        }\n      }, 1000);\n    }\n\n    // If the threshold is 0, we disable the memory manager by replacing the\n    // setTextureMemUse method with a no-op function.\n    if (criticalThreshold === 0) {\n      this.setTextureMemUse = () => {};\n    }\n  }\n\n  /**\n   * Set the memory usage of a texture\n   *\n   * @param texture - The texture to set memory usage for\n   * @param byteSize - The size of the texture in bytes\n   */\n  setTextureMemUse(texture: Texture, byteSize: number) {\n    // Update global memory counter by subtracting old value\n    this.memUsed -= texture.memUsed;\n\n    if (byteSize === 0) {\n      // PERFORMANCE: Mark for deletion, slot will be reused later\n      const index = this.loadedTextures.indexOf(texture);\n      if (index !== -1) {\n        this.loadedTextures[index] = null;\n      }\n      texture.memUsed = 0;\n      return;\n    } else {\n      // Update texture memory and add to tracking if not already present\n      texture.memUsed = byteSize;\n      this.memUsed += byteSize;\n      if (this.loadedTextures.indexOf(texture) === -1) {\n        // PERFORMANCE: Reuse empty slots before appending\n        const emptyIndex = this.loadedTextures.indexOf(null);\n        if (emptyIndex !== -1) {\n          this.loadedTextures[emptyIndex] = texture;\n        } else {\n          this.loadedTextures.push(texture);\n        }\n      }\n    }\n\n    if (this.memUsed > this.criticalThreshold) {\n      this.criticalCleanupRequested = true;\n    }\n  }\n\n  checkCleanup() {\n    return (\n      this.criticalCleanupRequested ||\n      (this.memUsed > this.targetThreshold &&\n        this.frameTime - this.lastCleanupTime >= this.cleanupInterval)\n    );\n  }\n\n  checkCriticalCleanup() {\n    return this.memUsed > this.criticalThreshold;\n  }\n\n  /**\n   * Destroy a texture and null out its array position\n   *\n   * @param texture - The texture to destroy\n   */\n  destroyTexture(texture: Texture) {\n    if (this.debugLogging === true) {\n      console.log(\n        `[TextureMemoryManager] Destroying texture. State: ${texture.state}`,\n      );\n    }\n\n    // PERFORMANCE: Null out array position, slot will be reused later\n    const index = this.loadedTextures.indexOf(texture);\n    if (index !== -1) {\n      this.loadedTextures[index] = null;\n    }\n\n    // Destroy texture and update memory counters\n    const txManager = this.stage.txManager;\n    txManager.removeTextureFromCache(texture);\n\n    texture.destroy();\n\n    // Update memory counters\n    this.memUsed -= texture.memUsed;\n    texture.memUsed = 0;\n  }\n\n  cleanup() {\n    const critical = this.criticalCleanupRequested;\n    this.lastCleanupTime = this.frameTime;\n\n    if (critical === true) {\n      this.stage.queueFrameEvent('criticalCleanup', {\n        memUsed: this.memUsed,\n        criticalThreshold: this.criticalThreshold,\n      });\n    }\n\n    if (this.debugLogging === true) {\n      console.log(\n        `[TextureMemoryManager] Cleaning up textures. Critical: ${critical}.`,\n      );\n    }\n\n    // Free non-renderable textures until we reach the target threshold\n    const memTarget = critical ? this.criticalThreshold : this.targetThreshold;\n\n    // PERFORMANCE: Zero-overhead cleanup with null marking\n    // Skip null entries, mark cleaned textures as null for later defrag\n    let currentMemUsed = this.memUsed;\n\n    for (let i = 0; i < this.loadedTextures.length; i++) {\n      // Early exit: target memory reached\n      if (currentMemUsed < memTarget) {\n        break;\n      }\n\n      const texture = this.loadedTextures[i];\n      if (!texture) continue; // Skip null entries from previous deletions\n\n      // Fast type check for cleanable textures\n      const isCleanableType =\n        texture.type === TextureType.image ||\n        texture.type === TextureType.noise ||\n        texture.type === TextureType.renderToTexture;\n\n      // Immediate cleanup if eligible\n      if (isCleanableType && texture.canBeCleanedUp() === true) {\n        // Get memory before destroying\n        const textureMemory = texture.memUsed;\n\n        // Destroy texture (which will null out the array position)\n        this.destroyTexture(texture);\n        currentMemUsed -= textureMemory;\n      }\n    }\n\n    if (this.memUsed >= this.criticalThreshold) {\n      this.stage.queueFrameEvent('criticalCleanupFailed', {\n        memUsed: this.memUsed,\n        criticalThreshold: this.criticalThreshold,\n      });\n      // Only emit the warning once per over-threshold period\n      if (\n        !this.hasWarnedAboveCritical &&\n        (this.debugLogging === true || isProductionEnvironment === false)\n      ) {\n        console.warn(\n          `[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`,\n        );\n\n        this.hasWarnedAboveCritical = true;\n      }\n    } else {\n      this.criticalCleanupRequested = false;\n      this.hasWarnedAboveCritical = false;\n    }\n  }\n\n  /**\n   * Get the current texture memory usage information\n   *\n   * @remarks\n   * This method is for debugging purposes and returns information about the\n   * current memory usage of the textures in the Renderer.\n   */\n  getMemoryInfo(): MemoryInfo {\n    let renderableTexturesLoaded = 0;\n    let renderableMemUsed = this.baselineMemoryAllocation;\n\n    for (const texture of this.loadedTextures) {\n      if (texture && texture.renderable) {\n        renderableTexturesLoaded += 1;\n        renderableMemUsed += texture.memUsed;\n      }\n    }\n\n    // Count non-null entries for accurate loaded texture count\n    const actualLoadedTextures = this.loadedTextures.filter(\n      (t) => t !== null,\n    ).length;\n\n    return {\n      criticalThreshold: this.criticalThreshold,\n      targetThreshold: this.targetThreshold,\n      renderableMemUsed,\n      memUsed: this.memUsed,\n      renderableTexturesLoaded,\n      loadedTextures: actualLoadedTextures,\n      baselineMemoryAllocation: this.baselineMemoryAllocation,\n    };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { TextureMemoryManager } from '../TextureMemoryManager.js';\nimport type { Texture } from '../textures/Texture.js';\n\nexport abstract class CoreContextTexture {\n  readonly textureSource: Texture;\n  private memManager: TextureMemoryManager;\n  public state: 'freed' | 'loading' | 'loaded' | 'failed' = 'freed';\n\n  constructor(memManager: TextureMemoryManager, textureSource: Texture) {\n    this.memManager = memManager;\n    this.textureSource = textureSource;\n  }\n\n  protected setTextureMemUse(byteSize: number): void {\n    this.memManager.setTextureMemUse(this.textureSource, byteSize);\n  }\n\n  abstract load(): Promise<void>;\n  abstract release(): void;\n  abstract free(): void;\n\n  get renderable(): boolean {\n    return this.textureSource.renderable;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../common/CommonTypes.js';\nimport type { BaseShaderController } from '../../main-api/ShaderController.js';\nimport type { CoreNode } from '../CoreNode.js';\nimport type { CoreShaderManager } from '../CoreShaderManager.js';\nimport type {\n  CoreTextureManager,\n  TextureOptions,\n} from '../CoreTextureManager.js';\nimport type { Stage } from '../Stage.js';\nimport type { TextureMemoryManager } from '../TextureMemoryManager.js';\nimport type { ContextSpy } from '../lib/ContextSpy.js';\nimport type { RenderCoords } from '../lib/RenderCoords.js';\nimport type { RectWithValid } from '../lib/utils.js';\nimport type { Texture } from '../textures/Texture.js';\nimport { CoreContextTexture } from './CoreContextTexture.js';\nimport type { CoreShader } from './CoreShader.js';\n\nexport interface QuadOptions {\n  width: number;\n  height: number;\n  colorTl: number;\n  colorTr: number;\n  colorBl: number;\n  colorBr: number;\n  texture: Texture | null;\n  textureOptions: TextureOptions | null;\n  zIndex: number;\n  shader: CoreShader;\n  shaderProps: Record<string, unknown>;\n  alpha: number;\n  clippingRect: RectWithValid;\n  tx: number;\n  ty: number;\n  ta: number;\n  tb: number;\n  tc: number;\n  td: number;\n  renderCoords?: RenderCoords;\n  rtt?: boolean;\n  parentHasRenderTexture?: boolean;\n  framebufferDimensions?: Dimensions;\n}\n\nexport interface CoreRendererOptions {\n  stage: Stage;\n  canvas: HTMLCanvasElement | OffscreenCanvas;\n  pixelRatio: number;\n  txManager: CoreTextureManager;\n  txMemManager: TextureMemoryManager;\n  shManager: CoreShaderManager;\n  clearColor: number;\n  bufferMemory: number;\n  contextSpy: ContextSpy | null;\n  forceWebGL2: boolean;\n}\n\nexport interface BufferInfo {\n  totalUsed: number;\n  totalAvailable: number;\n}\n\nexport abstract class CoreRenderer {\n  public options: CoreRendererOptions;\n  public mode: 'webgl' | 'canvas' | undefined;\n\n  readonly stage: Stage;\n\n  //// Core Managers\n  txManager: CoreTextureManager;\n  txMemManager: TextureMemoryManager;\n  shManager: CoreShaderManager;\n  rttNodes: CoreNode[] = [];\n\n  constructor(options: CoreRendererOptions) {\n    this.options = options;\n    this.stage = options.stage;\n    this.txManager = options.txManager;\n    this.txMemManager = options.txMemManager;\n    this.shManager = options.shManager;\n  }\n\n  abstract reset(): void;\n  abstract render(surface?: 'screen' | CoreContextTexture): void;\n  abstract addQuad(quad: QuadOptions): void;\n  abstract createCtxTexture(textureSource: Texture): CoreContextTexture;\n  abstract getShaderManager(): CoreShaderManager;\n  abstract get renderToTextureActive(): boolean;\n  abstract get activeRttNode(): CoreNode | null;\n  abstract renderRTTNodes(): void;\n  abstract removeRTTNode(node: CoreNode): void;\n  abstract renderToTexture(node: CoreNode): void;\n  abstract getBufferInfo(): BufferInfo | null;\n  abstract getQuadCount(): number | null;\n  abstract getDefShaderCtr(): BaseShaderController;\n  abstract updateClearColor(color: number): void;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  TextRenderer,\n  TextRendererMap,\n  TrProps,\n  TextRendererState,\n  TrFailedEventHandler,\n  TrLoadedEventHandler,\n} from './text-rendering/renderers/TextRenderer.js';\nimport { CoreNode, UpdateType, type CoreNodeProps } from './CoreNode.js';\nimport type { Stage } from './Stage.js';\nimport type { CoreRenderer } from './renderers/CoreRenderer.js';\nimport type {\n  NodeTextFailedPayload,\n  NodeTextLoadedPayload,\n} from '../common/CommonTypes.js';\nimport type { RectWithValid } from './lib/utils.js';\nimport { assertTruthy } from '../utils.js';\nimport { Matrix3d } from './lib/Matrix3d.js';\n\nexport interface CoreTextNodeProps extends CoreNodeProps, TrProps {\n  /**\n   * Force Text Node to use a specific Text Renderer\n   *\n   * @remarks\n   * By default, Text Nodes resolve the Text Renderer to use based on the font\n   * that is matched using the font family and other font selection properties.\n   *\n   * If two fonts supported by two separate Text Renderers are matched setting\n   * this override forces the Text Node to resolve to the Text Renderer defined\n   * here.\n   *\n   * @default null\n   */\n  textRendererOverride: keyof TextRendererMap | null;\n}\n\n/**\n * An CoreNode in the Renderer scene graph that renders text.\n *\n * @remarks\n * A Text Node is the second graphical building block of the Renderer scene\n * graph. It renders text using a specific text renderer that is automatically\n * chosen based on the font requested and what type of fonts are installed\n * into an app.\n *\n * The text renderer can be overridden by setting the `textRendererOverride`\n *\n * The `texture` and `shader` properties are managed by loaded text renderer and\n * should not be set directly.\n *\n * For non-text rendering, see {@link CoreNode}.\n */\nexport class CoreTextNode extends CoreNode implements CoreTextNodeProps {\n  textRenderer: TextRenderer;\n  trState: TextRendererState;\n  private _textRendererOverride: CoreTextNodeProps['textRendererOverride'] =\n    null;\n\n  constructor(\n    stage: Stage,\n    props: CoreTextNodeProps,\n    textRenderer: TextRenderer,\n  ) {\n    super(stage, props);\n    this._textRendererOverride = props.textRendererOverride;\n    this.textRenderer = textRenderer;\n    const textRendererState = this.createState({\n      x: 0,\n      y: 0,\n      width: props.width,\n      height: props.height,\n      textAlign: props.textAlign,\n      color: props.color,\n      zIndex: props.zIndex,\n      contain: props.contain,\n      scrollable: props.scrollable,\n      scrollY: props.scrollY,\n      offsetY: props.offsetY,\n      letterSpacing: props.letterSpacing,\n      debug: props.debug,\n      fontFamily: props.fontFamily,\n      fontSize: props.fontSize,\n      fontStretch: props.fontStretch,\n      fontStyle: props.fontStyle,\n      fontWeight: props.fontWeight,\n      text: props.text,\n      lineHeight: props.lineHeight,\n      maxLines: props.maxLines,\n      textBaseline: props.textBaseline,\n      verticalAlign: props.verticalAlign,\n      overflowSuffix: props.overflowSuffix,\n    });\n\n    this.trState = textRendererState;\n  }\n\n  private onTextLoaded: TrLoadedEventHandler = () => {\n    const { contain } = this;\n    const setWidth = this.trState.props.width;\n    const setHeight = this.trState.props.height;\n    const calcWidth = this.trState.textW || 0;\n    const calcHeight = this.trState.textH || 0;\n\n    if (contain === 'both') {\n      this.props.width = setWidth;\n      this.props.height = setHeight;\n    } else if (contain === 'width') {\n      this.props.width = setWidth;\n      this.props.height = calcHeight;\n    } else if (contain === 'none') {\n      this.props.width = calcWidth;\n      this.props.height = calcHeight;\n    }\n    this.updateLocalTransform();\n\n    // Incase the RAF loop has been stopped already before text was loaded,\n    // we request a render so it can be drawn.\n    this.stage.requestRender();\n    this.emit('loaded', {\n      type: 'text',\n      dimensions: {\n        width: this.trState.textW || 0,\n        height: this.trState.textH || 0,\n      },\n    } satisfies NodeTextLoadedPayload);\n  };\n\n  private onTextFailed: TrFailedEventHandler = (target, error) => {\n    this.emit('failed', {\n      type: 'text',\n      error,\n    } satisfies NodeTextFailedPayload);\n  };\n\n  override get width(): number {\n    return this.props.width;\n  }\n\n  override set width(value: number) {\n    this.props.width = value;\n    this.textRenderer.set.width(this.trState, value);\n\n    // If not containing, we must update the local transform to account for the\n    // new width\n    if (this.contain === 'none') {\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  override get height(): number {\n    return this.props.height;\n  }\n\n  override set height(value: number) {\n    this.props.height = value;\n    this.textRenderer.set.height(this.trState, value);\n\n    // If not containing in the horizontal direction, we must update the local\n    // transform to account for the new height\n    if (this.contain !== 'both') {\n      this.setUpdateType(UpdateType.Local);\n    }\n  }\n\n  override get color(): number {\n    return this.trState.props.color;\n  }\n\n  override set color(value: number) {\n    this.textRenderer.set.color(this.trState, value);\n  }\n\n  get text(): string {\n    return this.trState.props.text;\n  }\n\n  set text(value: string) {\n    this.textRenderer.set.text(this.trState, value);\n  }\n\n  get textRendererOverride(): CoreTextNodeProps['textRendererOverride'] {\n    return this._textRendererOverride;\n  }\n\n  set textRendererOverride(value: CoreTextNodeProps['textRendererOverride']) {\n    this._textRendererOverride = value;\n    this.textRenderer.destroyState(this.trState);\n\n    const textRenderer = this.stage.resolveTextRenderer(\n      this.trState.props,\n      this._textRendererOverride,\n    );\n\n    if (!textRenderer) {\n      console.warn(\n        'Text Renderer not found for font',\n        this.trState.props.fontFamily,\n      );\n      return;\n    }\n\n    this.textRenderer = textRenderer;\n    this.trState = this.createState(this.trState.props);\n  }\n\n  get fontSize(): CoreTextNodeProps['fontSize'] {\n    return this.trState.props.fontSize;\n  }\n\n  set fontSize(value: CoreTextNodeProps['fontSize']) {\n    this.textRenderer.set.fontSize(this.trState, value);\n  }\n\n  get fontFamily(): CoreTextNodeProps['fontFamily'] {\n    return this.trState.props.fontFamily;\n  }\n\n  set fontFamily(value: CoreTextNodeProps['fontFamily']) {\n    this.textRenderer.set.fontFamily(this.trState, value);\n  }\n\n  get fontStretch(): CoreTextNodeProps['fontStretch'] {\n    return this.trState.props.fontStretch;\n  }\n\n  set fontStretch(value: CoreTextNodeProps['fontStretch']) {\n    this.textRenderer.set.fontStretch(this.trState, value);\n  }\n\n  get fontStyle(): CoreTextNodeProps['fontStyle'] {\n    return this.trState.props.fontStyle;\n  }\n\n  set fontStyle(value: CoreTextNodeProps['fontStyle']) {\n    this.textRenderer.set.fontStyle(this.trState, value);\n  }\n\n  get fontWeight(): CoreTextNodeProps['fontWeight'] {\n    return this.trState.props.fontWeight;\n  }\n\n  set fontWeight(value: CoreTextNodeProps['fontWeight']) {\n    this.textRenderer.set.fontWeight(this.trState, value);\n  }\n\n  get textAlign(): CoreTextNodeProps['textAlign'] {\n    return this.trState.props.textAlign;\n  }\n\n  set textAlign(value: CoreTextNodeProps['textAlign']) {\n    this.textRenderer.set.textAlign(this.trState, value);\n  }\n\n  get contain(): CoreTextNodeProps['contain'] {\n    return this.trState.props.contain;\n  }\n\n  set contain(value: CoreTextNodeProps['contain']) {\n    this.textRenderer.set.contain(this.trState, value);\n  }\n\n  get scrollable(): CoreTextNodeProps['scrollable'] {\n    return this.trState.props.scrollable;\n  }\n\n  set scrollable(value: CoreTextNodeProps['scrollable']) {\n    this.textRenderer.set.scrollable(this.trState, value);\n  }\n\n  get scrollY(): CoreTextNodeProps['scrollY'] {\n    return this.trState.props.scrollY;\n  }\n\n  set scrollY(value: CoreTextNodeProps['scrollY']) {\n    this.textRenderer.set.scrollY(this.trState, value);\n  }\n\n  get offsetY(): CoreTextNodeProps['offsetY'] {\n    return this.trState.props.offsetY;\n  }\n\n  set offsetY(value: CoreTextNodeProps['offsetY']) {\n    this.textRenderer.set.offsetY(this.trState, value);\n  }\n\n  get letterSpacing(): CoreTextNodeProps['letterSpacing'] {\n    return this.trState.props.letterSpacing;\n  }\n\n  set letterSpacing(value: CoreTextNodeProps['letterSpacing']) {\n    this.textRenderer.set.letterSpacing(this.trState, value);\n  }\n\n  get lineHeight(): CoreTextNodeProps['lineHeight'] {\n    return this.trState.props.lineHeight;\n  }\n\n  set lineHeight(value: CoreTextNodeProps['lineHeight']) {\n    this.textRenderer.set.lineHeight(this.trState, value);\n  }\n\n  get maxLines(): CoreTextNodeProps['maxLines'] {\n    return this.trState.props.maxLines;\n  }\n\n  set maxLines(value: CoreTextNodeProps['maxLines']) {\n    this.textRenderer.set.maxLines(this.trState, value);\n  }\n\n  get textBaseline(): CoreTextNodeProps['textBaseline'] {\n    return this.trState.props.textBaseline;\n  }\n\n  set textBaseline(value: CoreTextNodeProps['textBaseline']) {\n    this.textRenderer.set.textBaseline(this.trState, value);\n  }\n\n  get verticalAlign(): CoreTextNodeProps['verticalAlign'] {\n    return this.trState.props.verticalAlign;\n  }\n\n  set verticalAlign(value: CoreTextNodeProps['verticalAlign']) {\n    this.textRenderer.set.verticalAlign(this.trState, value);\n  }\n\n  get overflowSuffix(): CoreTextNodeProps['overflowSuffix'] {\n    return this.trState.props.overflowSuffix;\n  }\n\n  set overflowSuffix(value: CoreTextNodeProps['overflowSuffix']) {\n    this.textRenderer.set.overflowSuffix(this.trState, value);\n  }\n\n  get debug(): CoreTextNodeProps['debug'] {\n    return this.trState.props.debug;\n  }\n\n  set debug(value: CoreTextNodeProps['debug']) {\n    this.textRenderer.set.debug(this.trState, value);\n  }\n\n  override update(delta: number, parentClippingRect: RectWithValid) {\n    super.update(delta, parentClippingRect);\n\n    assertTruthy(this.globalTransform);\n\n    // globalTransform is updated in super.update(delta)\n    this.textRenderer.set.x(this.trState, this.globalTransform.tx);\n    this.textRenderer.set.y(this.trState, this.globalTransform.ty);\n  }\n\n  override checkBasicRenderability() {\n    if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {\n      return false;\n    }\n\n    if (this.trState && this.trState.props.text !== '') {\n      return true;\n    }\n\n    return false;\n  }\n\n  override setRenderable(isRenderable: boolean) {\n    super.setRenderable(isRenderable);\n    this.textRenderer.setIsRenderable(this.trState, isRenderable);\n  }\n\n  override renderQuads(renderer: CoreRenderer) {\n    assertTruthy(this.globalTransform);\n\n    // If the text renderer does not support rendering quads, fallback to the\n    // default renderQuads method\n    if (!this.textRenderer.renderQuads) {\n      super.renderQuads(renderer);\n      return;\n    }\n\n    // If the text renderer does support rendering quads, use it...\n\n    // Prevent quad rendering if parent has a render texture\n    // and this node is not the render texture\n    if (this.parentHasRenderTexture) {\n      if (!renderer.renderToTextureActive) {\n        return;\n      }\n      // Prevent quad rendering if parent render texture is not the active render texture\n      if (this.parentRenderTexture !== renderer.activeRttNode) {\n        return;\n      }\n    }\n\n    if (this.parentHasRenderTexture && this.props.parent?.rtt) {\n      this.globalTransform = Matrix3d.identity();\n      if (this.localTransform) {\n        this.globalTransform.multiply(this.localTransform);\n      }\n    }\n\n    assertTruthy(this.globalTransform);\n\n    this.textRenderer.renderQuads(\n      this.trState,\n      this.globalTransform,\n      this.clippingRect,\n      this.worldAlpha,\n      this.parentHasRenderTexture,\n      this.framebufferDimensions,\n    );\n  }\n\n  /**\n   * Destroy the node and cleanup all resources\n   */\n  override destroy(): void {\n    super.destroy();\n\n    this.textRenderer.destroyState(this.trState);\n  }\n\n  /**\n   * Resolve a text renderer and a new state based on the current text renderer props provided\n   * @param props\n   * @returns\n   */\n  private createState(props: TrProps) {\n    const textRendererState = this.textRenderer.createState(props, this);\n\n    textRendererState.emitter.on('loaded', this.onTextLoaded);\n    textRendererState.emitter.on('failed', this.onTextFailed);\n\n    this.textRenderer.scheduleUpdateState(textRendererState);\n\n    return textRendererState;\n  }\n}\n", "import type { CustomDataMap } from '../core/CoreNode.js';\n\nexport function santizeCustomDataMap(d: CustomDataMap): CustomDataMap {\n  const validTypes = {\n    boolean: true,\n    string: true,\n    number: true,\n    undefined: true,\n  };\n\n  const keys = Object.keys(d);\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    if (!key) {\n      continue;\n    }\n\n    const value = d[key];\n    const valueType = typeof value;\n\n    // Typescript doesn't understand the above const valueType ¯\\_(ツ)_/¯\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore-next-line\n    if (valueType === 'string' && value.length > 2048) {\n      console.warn(\n        `Custom Data value for ${key} is too long, it will be truncated to 2048 characters`,\n      );\n\n      // same here, see above comment, this can only be a string at this point\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore-next-line\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n      d[key] = value.substring(0, 2048);\n    }\n\n    if (!validTypes[valueType as keyof typeof validTypes]) {\n      console.warn(\n        `Custom Data value for ${key} is not a boolean, string, or number, it will be ignored`,\n      );\n      delete d[key];\n    }\n  }\n\n  return d;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { startLoop, getTimeStamp } from './platform.js';\nimport { assertTruthy, setPremultiplyMode } from '../utils.js';\nimport { AnimationManager } from './animations/AnimationManager.js';\nimport {\n  UpdateType,\n  CoreNode,\n  CoreNodeRenderState,\n  type CoreNodeProps,\n} from './CoreNode.js';\nimport { CoreTextureManager } from './CoreTextureManager.js';\nimport { TrFontManager } from './text-rendering/TrFontManager.js';\nimport { CoreShaderManager, type ShaderMap } from './CoreShaderManager.js';\nimport {\n  TextRenderer,\n  type TextRendererMap,\n  type TrProps,\n} from './text-rendering/renderers/TextRenderer.js';\n\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { ContextSpy } from './lib/ContextSpy.js';\nimport type {\n  FpsUpdatePayload,\n  FrameTickPayload,\n  QuadsUpdatePayload,\n} from '../common/CommonTypes.js';\nimport {\n  TextureMemoryManager,\n  type TextureMemoryManagerSettings,\n} from './TextureMemoryManager.js';\nimport type { CoreRendererOptions } from './renderers/CoreRenderer.js';\nimport { CoreRenderer } from './renderers/CoreRenderer.js';\nimport type { WebGlCoreRenderer } from './renderers/webgl/WebGlCoreRenderer.js';\nimport type { CanvasCoreRenderer } from './renderers/canvas/CanvasCoreRenderer.js';\nimport type { BaseShaderController } from '../main-api/ShaderController.js';\nimport { CoreTextNode, type CoreTextNodeProps } from './CoreTextNode.js';\nimport { santizeCustomDataMap } from '../main-api/utils.js';\nimport type { SdfTextRenderer } from './text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js';\nimport type { CanvasTextRenderer } from './text-rendering/renderers/CanvasTextRenderer.js';\nimport {\n  createBound,\n  createPreloadBounds,\n  pointInBound,\n  type Bound,\n} from './lib/utils.js';\nimport type { Texture } from './textures/Texture.js';\nimport { ColorTexture } from './textures/ColorTexture.js';\n\nexport interface StageOptions {\n  appWidth: number;\n  appHeight: number;\n  textureMemory: TextureMemoryManagerSettings;\n  boundsMargin: number | [number, number, number, number];\n  deviceLogicalPixelRatio: number;\n  devicePhysicalPixelRatio: number;\n  canvas: HTMLCanvasElement | OffscreenCanvas;\n  clearColor: number;\n  fpsUpdateInterval: number;\n  targetFPS: number;\n  enableContextSpy: boolean;\n  forceWebGL2: boolean;\n  numImageWorkers: number;\n  renderEngine: typeof WebGlCoreRenderer | typeof CanvasCoreRenderer;\n  eventBus: EventEmitter;\n  quadBufferSize: number;\n  fontEngines: (typeof CanvasTextRenderer | typeof SdfTextRenderer)[];\n  inspector: boolean;\n  strictBounds: boolean;\n  textureProcessingTimeLimit: number;\n  createImageBitmapSupport: 'auto' | 'basic' | 'options' | 'full';\n  maxRetryCount: number;\n}\n\nexport type StageFpsUpdateHandler = (\n  stage: Stage,\n  fpsData: FpsUpdatePayload,\n) => void;\n\nexport type StageFrameTickHandler = (\n  stage: Stage,\n  frameTickData: FrameTickPayload,\n) => void;\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nconst bufferMemory = 2e6;\nconst autoStart = true;\n\nexport class Stage {\n  /// Module Instances\n  public readonly animationManager: AnimationManager;\n  public readonly txManager: CoreTextureManager;\n  public readonly txMemManager: TextureMemoryManager;\n  public readonly fontManager: TrFontManager;\n  public readonly textRenderers: Partial<TextRendererMap>;\n  public readonly shManager: CoreShaderManager;\n  public readonly renderer: CoreRenderer;\n  public readonly root: CoreNode;\n  public readonly interactiveNodes: Set<CoreNode> = new Set();\n  public boundsMargin: [number, number, number, number];\n  public readonly defShaderCtr: BaseShaderController;\n  public readonly strictBound: Bound;\n  public readonly preloadBound: Bound;\n  public readonly strictBounds: boolean;\n  public readonly defaultTexture: Texture | null = null;\n\n  /**\n   * Target frame time in milliseconds (calculated from targetFPS)\n   *\n   * @remarks\n   * This is pre-calculated to avoid recalculating on every frame.\n   * - 0 means no throttling (use display refresh rate)\n   * - >0 means throttle to this frame time (1000 / targetFPS)\n   */\n  public targetFrameTime: number = 0;\n\n  /**\n   * Renderer Event Bus for the Stage to emit events onto\n   *\n   * @remarks\n   * In reality this is just the RendererMain instance, which is an EventEmitter.\n   * this allows us to directly emit events from the Stage to RendererMain\n   * without having to set up forwarding handlers.\n   */\n  public readonly eventBus: EventEmitter;\n\n  /// State\n  deltaTime = 0;\n  lastFrameTime = 0;\n  currentFrameTime = 0;\n  private fpsNumFrames = 0;\n  private fpsElapsedTime = 0;\n  private numQuadsRendered = 0;\n  private renderRequested = false;\n  private frameEventQueue: [name: string, payload: unknown][] = [];\n  private fontResolveMap: Record<string, CanvasTextRenderer | SdfTextRenderer> =\n    {};\n\n  /// Debug data\n  contextSpy: ContextSpy | null = null;\n\n  /**\n   * Stage constructor\n   */\n  constructor(readonly options: StageOptions) {\n    const {\n      canvas,\n      clearColor,\n      appWidth,\n      appHeight,\n      boundsMargin,\n      enableContextSpy,\n      forceWebGL2,\n      numImageWorkers,\n      textureMemory,\n      renderEngine,\n      fontEngines,\n      createImageBitmapSupport,\n      maxRetryCount,\n    } = options;\n\n    this.eventBus = options.eventBus;\n\n    // Calculate target frame time from targetFPS option\n    this.targetFrameTime = options.targetFPS > 0 ? 1000 / options.targetFPS : 0;\n\n    this.txManager = new CoreTextureManager(this, {\n      numImageWorkers,\n      createImageBitmapSupport,\n      maxRetryCount,\n    });\n\n    // Wait for the Texture Manager to initialize\n    // once it does, request a render\n    this.txManager.on('initialized', () => {\n      this.requestRender();\n    });\n\n    this.txMemManager = new TextureMemoryManager(this, textureMemory);\n    this.shManager = new CoreShaderManager();\n    this.animationManager = new AnimationManager();\n    this.contextSpy = enableContextSpy ? new ContextSpy() : null;\n    this.strictBounds = options.strictBounds;\n\n    let bm = [0, 0, 0, 0] as [number, number, number, number];\n    if (boundsMargin) {\n      bm = Array.isArray(boundsMargin)\n        ? boundsMargin\n        : [boundsMargin, boundsMargin, boundsMargin, boundsMargin];\n    }\n    this.boundsMargin = bm;\n\n    // precalculate our viewport bounds\n    this.strictBound = createBound(0, 0, appWidth, appHeight);\n    this.preloadBound = createPreloadBounds(this.strictBound, bm);\n\n    const rendererOptions: CoreRendererOptions = {\n      stage: this,\n      canvas,\n      pixelRatio:\n        options.devicePhysicalPixelRatio * options.deviceLogicalPixelRatio,\n      clearColor: clearColor ?? 0xff000000,\n      bufferMemory,\n      txManager: this.txManager,\n      txMemManager: this.txMemManager,\n      shManager: this.shManager,\n      contextSpy: this.contextSpy,\n      forceWebGL2,\n    };\n\n    this.renderer = new renderEngine(rendererOptions);\n    const renderMode = this.renderer.mode || 'webgl';\n\n    this.createDefaultTexture();\n    this.defShaderCtr = this.renderer.getDefShaderCtr();\n    setPremultiplyMode(renderMode);\n\n    // Must do this after renderer is created\n    this.txManager.renderer = this.renderer;\n\n    // Create text renderers\n    this.textRenderers = {};\n    fontEngines.forEach((fontEngineConstructor) => {\n      const fontEngineInstance = new fontEngineConstructor(this);\n      const className = fontEngineInstance.type;\n\n      if (className === 'sdf' && renderMode === 'canvas') {\n        console.warn(\n          'SdfTextRenderer is not compatible with Canvas renderer. Skipping...',\n        );\n        return;\n      }\n\n      if (fontEngineInstance instanceof TextRenderer) {\n        if (className === 'canvas') {\n          this.textRenderers['canvas'] =\n            fontEngineInstance as CanvasTextRenderer;\n        } else if (className === 'sdf') {\n          this.textRenderers['sdf'] = fontEngineInstance as SdfTextRenderer;\n        }\n      }\n    });\n\n    if (Object.keys(this.textRenderers).length === 0) {\n      console.warn('No text renderers available. Your text will not render.');\n    }\n\n    this.fontManager = new TrFontManager(this.textRenderers);\n\n    // create root node\n    const rootNode = new CoreNode(this, {\n      x: 0,\n      y: 0,\n      width: appWidth,\n      height: appHeight,\n      alpha: 1,\n      autosize: false,\n      boundsMargin: null,\n      clipping: false,\n      color: 0x00000000,\n      colorTop: 0x00000000,\n      colorBottom: 0x00000000,\n      colorLeft: 0x00000000,\n      colorRight: 0x00000000,\n      colorTl: 0x00000000,\n      colorTr: 0x00000000,\n      colorBl: 0x00000000,\n      colorBr: 0x00000000,\n      zIndex: 0,\n      zIndexLocked: 0,\n      scaleX: 1,\n      scaleY: 1,\n      mountX: 0,\n      mountY: 0,\n      mount: 0,\n      pivot: 0.5,\n      pivotX: 0.5,\n      pivotY: 0.5,\n      rotation: 0,\n      parent: null,\n      texture: null,\n      textureOptions: {},\n      shader: this.defShaderCtr,\n      rtt: false,\n      src: null,\n      scale: 1,\n      preventCleanup: false,\n      strictBounds: this.strictBounds,\n    });\n\n    this.root = rootNode;\n\n    // execute platform start loop\n    if (autoStart) {\n      startLoop(this);\n    }\n  }\n\n  setClearColor(color: number) {\n    this.renderer.updateClearColor(color);\n    this.renderRequested = true;\n  }\n\n  /**\n   * Update the target frame time based on the current targetFPS setting\n   *\n   * @remarks\n   * This should be called whenever the targetFPS option is changed\n   * to ensure targetFrameTime stays in sync.\n   * targetFPS of 0 means no throttling (targetFrameTime = 0)\n   * targetFPS > 0 means throttle to 1000/targetFPS milliseconds\n   */\n  updateTargetFrameTime() {\n    this.targetFrameTime =\n      this.options.targetFPS > 0 ? 1000 / this.options.targetFPS : 0;\n  }\n\n  updateFrameTime() {\n    const newFrameTime = getTimeStamp();\n    this.lastFrameTime = this.currentFrameTime;\n    this.currentFrameTime = newFrameTime;\n    this.deltaTime = !this.lastFrameTime\n      ? 100 / 6\n      : newFrameTime - this.lastFrameTime;\n    this.txManager.frameTime = newFrameTime;\n    this.txMemManager.frameTime = newFrameTime;\n\n    // This event is emitted at the beginning of the frame (before any updates\n    // or rendering), so no need to to use `stage.queueFrameEvent` here.\n    this.eventBus.emit('frameTick', {\n      time: this.currentFrameTime,\n      delta: this.deltaTime,\n    });\n  }\n\n  /**\n   * Create default PixelTexture\n   */\n  createDefaultTexture() {\n    (this.defaultTexture as ColorTexture) = this.txManager.createTexture(\n      'ColorTexture',\n      {\n        color: 0xffffffff,\n      },\n    );\n\n    assertTruthy(this.defaultTexture instanceof ColorTexture);\n    this.txManager.loadTexture(this.defaultTexture, true);\n\n    // Mark the default texture as ALWAYS renderable\n    // This prevents it from ever being cleaned up.\n    // Fixes https://github.com/lightning-js/renderer/issues/262\n    this.defaultTexture.setRenderableOwner('stage', true);\n\n    // When the default texture is loaded, request a render in case the\n    // RAF is paused. Fixes: https://github.com/lightning-js/renderer/issues/123\n    this.defaultTexture.once('loaded', () => {\n      this.requestRender();\n    });\n  }\n\n  /**\n   * Update animations\n   */\n  updateAnimations() {\n    const { animationManager } = this;\n    if (!this.root) {\n      return;\n    }\n    // step animation\n    animationManager.update(this.deltaTime);\n  }\n\n  /**\n   * Check if the scene has updates\n   */\n  hasSceneUpdates() {\n    return (\n      !!this.root.updateType ||\n      this.renderRequested ||\n      this.txManager.hasUpdates()\n    );\n  }\n\n  /**\n   * Start a new frame draw\n   */\n  drawFrame() {\n    const { renderer, renderRequested } = this;\n    assertTruthy(renderer);\n\n    // Update tree if needed\n    if (this.root.updateType !== 0) {\n      this.root.update(this.deltaTime, this.root.clippingRect);\n    }\n\n    // Process some textures asynchronously but don't block the frame\n    // Use a background task to prevent frame drops\n    this.txManager\n      .processSome(this.options.textureProcessingTimeLimit)\n      .catch((err) => {\n        console.error('Error processing textures:', err);\n      });\n\n    // Reset render operations and clear the canvas\n    renderer.reset();\n\n    // If we have RTT nodes draw them first\n    // So we can use them as textures in the main scene\n    if (renderer.rttNodes.length > 0) {\n      renderer.renderRTTNodes();\n    }\n\n    // Fill quads buffer\n    this.addQuads(this.root);\n\n    // Perform render pass\n    renderer?.render();\n\n    this.calculateFps();\n    this.calculateQuads();\n\n    // Reset renderRequested flag if it was set\n    if (renderRequested) {\n      this.renderRequested = false;\n    }\n\n    // Check if we need to cleanup textures\n    if (this.txMemManager.criticalCleanupRequested === true) {\n      this.txMemManager.cleanup();\n    }\n  }\n\n  /**\n   * Queue an event to be emitted after the current/next frame is rendered\n   *\n   * @remarks\n   * When we are operating in the context of the render loop, we may want to\n   * emit events that are related to the current frame. However, we generally do\n   * NOT want to emit events directly in the middle of the render loop, since\n   * this could enable event handlers to modify the scene graph and cause\n   * unexpected behavior. Instead, we queue up events to be emitted and then\n   * flush the queue after the frame has been rendered.\n   *\n   * @param name\n   * @param data\n   */\n  queueFrameEvent(name: string, data: unknown) {\n    this.frameEventQueue.push([name, data]);\n  }\n\n  /**\n   * Emit all queued frame events\n   *\n   * @remarks\n   * This method should be called after the frame has been rendered to emit\n   * all events that were queued during the frame.\n   *\n   * See {@link queueFrameEvent} for more information.\n   */\n  flushFrameEvents() {\n    for (const [name, data] of this.frameEventQueue) {\n      this.eventBus.emit(name, data);\n    }\n    this.frameEventQueue = [];\n  }\n\n  calculateFps() {\n    // If there's an FPS update interval, emit the FPS update event\n    // when the specified interval has elapsed.\n    const { fpsUpdateInterval } = this.options;\n    if (fpsUpdateInterval) {\n      this.fpsNumFrames++;\n      this.fpsElapsedTime += this.deltaTime;\n      if (this.fpsElapsedTime >= fpsUpdateInterval) {\n        const fps = Math.round(\n          (this.fpsNumFrames * 1000) / this.fpsElapsedTime,\n        );\n        this.fpsNumFrames = 0;\n        this.fpsElapsedTime = 0;\n        this.queueFrameEvent('fpsUpdate', {\n          fps,\n          contextSpyData: this.contextSpy?.getData() ?? null,\n        } satisfies FpsUpdatePayload);\n        this.contextSpy?.reset();\n      }\n    }\n  }\n\n  calculateQuads() {\n    const quads = this.renderer.getQuadCount();\n    if (quads && quads !== this.numQuadsRendered) {\n      this.numQuadsRendered = quads;\n      this.queueFrameEvent('quadsUpdate', {\n        quads,\n      } satisfies QuadsUpdatePayload);\n    }\n  }\n\n  addQuads(node: CoreNode) {\n    assertTruthy(this.renderer);\n\n    // If the node is renderable and has a loaded texture, render it\n    if (node.isRenderable === true) {\n      node.renderQuads(this.renderer);\n    }\n\n    for (let i = 0; i < node.children.length; i++) {\n      const child = node.children[i];\n\n      if (child === undefined) {\n        continue;\n      }\n\n      if (\n        child.worldAlpha === 0 ||\n        (child.strictBounds === true &&\n          child.renderState === CoreNodeRenderState.OutOfBounds)\n      ) {\n        continue;\n      }\n\n      this.addQuads(child);\n    }\n  }\n\n  /**\n   * Request a render pass without forcing an update\n   */\n  requestRender() {\n    this.renderRequested = true;\n  }\n\n  /**\n   * Find all nodes at a given point\n   * @param data\n   */\n  findNodesAtPoint(data: Point): CoreNode[] {\n    const x = data.x / this.options.deviceLogicalPixelRatio;\n    const y = data.y / this.options.deviceLogicalPixelRatio;\n    const nodes: CoreNode[] = [];\n    for (const node of this.interactiveNodes) {\n      if (node.isRenderable === false) {\n        continue;\n      }\n      if (pointInBound(x, y, node.renderBound!) === true) {\n        nodes.push(node);\n      }\n    }\n    return nodes;\n  }\n\n  /**\n   * Find the top node at a given point\n   * @param data\n   * @returns\n   */\n  getNodeFromPosition(data: Point): CoreNode | null {\n    const nodes: CoreNode[] = this.findNodesAtPoint(data);\n    if (nodes.length === 0) {\n      return null;\n    }\n\n    //get last node in array (as top node)\n    let topNode = nodes[nodes.length - 1] as CoreNode;\n    for (let i = 0; i < nodes.length; i++) {\n      if (nodes[i]!.zIndex > topNode.zIndex) {\n        topNode = nodes[i]!;\n      }\n    }\n    return topNode || null;\n  }\n\n  /**\n   * Given a font name, and possible renderer override, return the best compatible text renderer.\n   *\n   * @remarks\n   * Will try to return a canvas renderer if no other suitable renderer can be resolved.\n   *\n   * @param fontFamily\n   * @param textRendererOverride\n   * @returns\n   */\n  resolveTextRenderer(\n    trProps: TrProps,\n    textRendererOverride: keyof TextRendererMap | null = null,\n  ): TextRenderer | null {\n    const fontCacheString = `${trProps.fontFamily}${trProps.fontStyle}${\n      trProps.fontWeight\n    }${trProps.fontStretch}${textRendererOverride ? textRendererOverride : ''}`;\n\n    // check our resolve cache first\n    if (this.fontResolveMap[fontCacheString] !== undefined) {\n      return this.fontResolveMap[fontCacheString] as unknown as TextRenderer;\n    }\n\n    // Resolve the text renderer\n    let rendererId = textRendererOverride;\n    let overrideFallback = false;\n\n    // Check if the override is valid (if one is provided)\n    if (rendererId) {\n      const possibleRenderer = this.textRenderers[rendererId];\n      if (!possibleRenderer) {\n        console.warn(`Text renderer override '${rendererId}' not found.`);\n        rendererId = null;\n        overrideFallback = true;\n      } else if (!possibleRenderer.canRenderFont(trProps)) {\n        console.warn(\n          `Cannot use override text renderer '${rendererId}' for font`,\n          trProps,\n        );\n        rendererId = null;\n        overrideFallback = true;\n      }\n    }\n\n    if (!rendererId) {\n      // Iterate through the text renderers and find the first one that can render the font\n      for (const [trId, tr] of Object.entries(this.textRenderers)) {\n        if (tr.canRenderFont(trProps)) {\n          rendererId = trId as keyof TextRendererMap;\n          break;\n        }\n      }\n      if (!rendererId && this.textRenderers.canvas !== undefined) {\n        // If no renderer can be found, use the canvas renderer\n        rendererId = 'canvas';\n      }\n    }\n\n    if (overrideFallback) {\n      console.warn(`Falling back to text renderer ${String(rendererId)}`);\n    }\n\n    if (!rendererId) {\n      // silently fail if no renderer can be found, the error is already created\n      // at the constructor level\n      return null;\n    }\n\n    // By now we are guaranteed to have a valid rendererId (at least Canvas);\n    const resolvedTextRenderer = this.textRenderers[rendererId];\n    assertTruthy(resolvedTextRenderer, 'resolvedTextRenderer undefined');\n\n    // cache the resolved renderer for future use with these trProps\n    this.fontResolveMap[fontCacheString] = resolvedTextRenderer;\n\n    // Need to explicitly cast to TextRenderer because TS doesn't like\n    // the covariant state argument in the setter method map\n    return resolvedTextRenderer as unknown as TextRenderer;\n  }\n\n  /**\n   * Create a shader controller instance\n   *\n   * @param type\n   * @param props\n   * @returns\n   */\n  createShaderCtr(\n    type: keyof ShaderMap,\n    props: Record<string, unknown>,\n  ): BaseShaderController {\n    return this.shManager.loadShader(type, props);\n  }\n\n  createNode(props: Partial<CoreNodeProps>) {\n    const resolvedProps = this.resolveNodeDefaults(props);\n    return new CoreNode(this, resolvedProps);\n  }\n\n  createTextNode(props: Partial<CoreTextNodeProps>) {\n    const fontSize = props.fontSize ?? 16;\n    const resolvedProps = {\n      ...this.resolveNodeDefaults(props),\n      text: props.text ?? '',\n      textRendererOverride: props.textRendererOverride ?? null,\n      fontSize,\n      fontFamily: props.fontFamily ?? 'sans-serif',\n      fontStyle: props.fontStyle ?? 'normal',\n      fontWeight: props.fontWeight ?? 'normal',\n      fontStretch: props.fontStretch ?? 'normal',\n      textAlign: props.textAlign ?? 'left',\n      contain: props.contain ?? 'none',\n      scrollable: props.scrollable ?? false,\n      scrollY: props.scrollY ?? 0,\n      offsetY: props.offsetY ?? 0,\n      letterSpacing: props.letterSpacing ?? 0,\n      lineHeight: props.lineHeight, // `undefined` is a valid value\n      maxLines: props.maxLines ?? 0,\n      textBaseline: props.textBaseline ?? 'alphabetic',\n      verticalAlign: props.verticalAlign ?? 'middle',\n      overflowSuffix: props.overflowSuffix ?? '...',\n      debug: props.debug ?? {},\n      shaderProps: null,\n    };\n\n    const resolvedTextRenderer = this.resolveTextRenderer(\n      resolvedProps,\n      props.textRendererOverride,\n    );\n\n    if (!resolvedTextRenderer) {\n      throw new Error(\n        `No compatible text renderer found for ${resolvedProps.fontFamily}`,\n      );\n    }\n\n    return new CoreTextNode(this, resolvedProps, resolvedTextRenderer);\n  }\n\n  setBoundsMargin(value: number | [number, number, number, number]) {\n    this.boundsMargin = Array.isArray(value)\n      ? value\n      : [value, value, value, value];\n\n    this.root.setUpdateType(UpdateType.RenderBounds);\n  }\n\n  /**\n   * Resolves the default property values for a Node\n   *\n   * @remarks\n   * This method is used internally by the RendererMain to resolve the default\n   * property values for a Node. It is exposed publicly so that it can be used\n   * by Core Driver implementations.\n   *\n   * @param props\n   * @returns\n   */\n  protected resolveNodeDefaults(props: Partial<CoreNodeProps>): CoreNodeProps {\n    const color = props.color ?? 0xffffffff;\n    const colorTl = props.colorTl ?? props.colorTop ?? props.colorLeft ?? color;\n    const colorTr =\n      props.colorTr ?? props.colorTop ?? props.colorRight ?? color;\n    const colorBl =\n      props.colorBl ?? props.colorBottom ?? props.colorLeft ?? color;\n    const colorBr =\n      props.colorBr ?? props.colorBottom ?? props.colorRight ?? color;\n\n    let data = {};\n    if (this.options.inspector === true) {\n      data = santizeCustomDataMap(props.data ?? {});\n    }\n\n    return {\n      x: props.x ?? 0,\n      y: props.y ?? 0,\n      width: props.width ?? 0,\n      height: props.height ?? 0,\n      alpha: props.alpha ?? 1,\n      autosize: props.autosize ?? false,\n      boundsMargin: props.boundsMargin ?? null,\n      clipping: props.clipping ?? false,\n      color,\n      colorTop: props.colorTop ?? color,\n      colorBottom: props.colorBottom ?? color,\n      colorLeft: props.colorLeft ?? color,\n      colorRight: props.colorRight ?? color,\n      colorBl,\n      colorBr,\n      colorTl,\n      colorTr,\n      zIndex: props.zIndex ?? 0,\n      zIndexLocked: props.zIndexLocked ?? 0,\n      parent: props.parent ?? null,\n      texture: props.texture ?? null,\n      textureOptions: props.textureOptions ?? {},\n      shader: props.shader ?? this.defShaderCtr,\n      // Since setting the `src` will trigger a texture load, we need to set it after\n      // we set the texture. Otherwise, problems happen.\n      src: props.src ?? null,\n      srcHeight: props.srcHeight,\n      srcWidth: props.srcWidth,\n      srcX: props.srcX,\n      srcY: props.srcY,\n      scale: props.scale ?? null,\n      scaleX: props.scaleX ?? props.scale ?? 1,\n      scaleY: props.scaleY ?? props.scale ?? 1,\n      mount: props.mount ?? 0,\n      mountX: props.mountX ?? props.mount ?? 0,\n      mountY: props.mountY ?? props.mount ?? 0,\n      pivot: props.pivot ?? 0.5,\n      pivotX: props.pivotX ?? props.pivot ?? 0.5,\n      pivotY: props.pivotY ?? props.pivot ?? 0.5,\n      rotation: props.rotation ?? 0,\n      rtt: props.rtt ?? false,\n      data: data,\n      preventCleanup: props.preventCleanup ?? false,\n      imageType: props.imageType,\n      interactive: props.interactive ?? false,\n      strictBounds: props.strictBounds ?? this.strictBounds,\n    };\n  }\n\n  /**\n   * Cleanup Unused Textures\n   *\n   * @remarks\n   * This method is used to cleanup unused textures that are no longer in use.\n   */\n  cleanup() {\n    this.txMemManager.cleanup();\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport type { EffectMap, ShaderMap } from '../core/CoreShaderManager.js';\nimport type { ExtractProps, TextureMap } from '../core/CoreTextureManager.js';\nimport { EventEmitter } from '../common/EventEmitter.js';\nimport { assertTruthy, isProductionEnvironment } from '../utils.js';\nimport { Stage } from '../core/Stage.js';\nimport { CoreNode, type CoreNodeProps } from '../core/CoreNode.js';\nimport { type CoreTextNodeProps } from '../core/CoreTextNode.js';\nimport type {\n  BaseShaderController,\n  ShaderController,\n} from './ShaderController.js';\nimport type { INode, INodeProps, ITextNode, ITextNodeProps } from './INode.js';\nimport type {\n  DynamicEffects,\n  DynamicShaderController,\n} from './DynamicShaderController.js';\nimport type {\n  EffectDesc,\n  EffectDescUnion,\n} from '../core/renderers/webgl/shaders/effects/ShaderEffect.js';\nimport type { TextureMemoryManagerSettings } from '../core/TextureMemoryManager.js';\nimport type { CanvasTextRenderer } from '../core/text-rendering/renderers/CanvasTextRenderer.js';\nimport type { SdfTextRenderer } from '../core/text-rendering/renderers/SdfTextRenderer/SdfTextRenderer.js';\nimport type { WebGlCoreRenderer } from '../core/renderers/webgl/WebGlCoreRenderer.js';\nimport type { CanvasCoreRenderer } from '../core/renderers/canvas/CanvasCoreRenderer.js';\nimport type { Inspector } from './Inspector.js';\n\n/**\n * An immutable reference to a specific Shader type\n *\n * @remarks\n * See {@link ShaderRef} for more details.\n */\nexport interface SpecificShaderRef<ShType extends keyof ShaderMap> {\n  readonly descType: 'shader';\n  readonly shType: ShType;\n  readonly props: ExtractProps<ShaderMap[ShType]>;\n}\n\ntype MapShaderRefs<ShType extends keyof ShaderMap> =\n  ShType extends keyof ShaderMap ? SpecificShaderRef<ShType> : never;\n\n/**\n * An immutable reference to a Shader\n *\n * @remarks\n * This structure should only be created by the RendererMain's `createShader`\n * method. The structure is immutable and should not be modified once created.\n *\n * A `ShaderRef` exists in the Main API Space and is used to point to an actual\n * `Shader` instance in the Core API Space. The `ShaderRef` is used to\n * communicate with the Core API Space to create, load, and destroy the\n * `Shader` instance.\n *\n * This type is technically a discriminated union of all possible shader types.\n * If you'd like to represent a specific shader type, you can use the\n * `SpecificShaderRef` generic type.\n */\nexport type ShaderRef = MapShaderRefs<keyof ShaderMap>;\n\n/**\n * Configuration settings for {@link RendererMain}\n */\nexport interface RendererMainSettings {\n  /**\n   * Authored logical pixel width of the application\n   *\n   * @defaultValue `1920`\n   */\n  appWidth?: number;\n\n  /**\n   * Authored logical pixel height of the application\n   *\n   * @defaultValue `1080`\n   */\n  appHeight?: number;\n\n  /**\n   * Texture Memory Manager Settings\n   */\n  textureMemory?: Partial<TextureMemoryManagerSettings>;\n\n  /**\n   * Bounds margin to extend the boundary in which a Node is added as Quad.\n   */\n  boundsMargin?: number | [number, number, number, number];\n\n  /**\n   * Factor to convert app-authored logical coorindates to device logical coordinates\n   *\n   * @remarks\n   * This value allows auto-scaling to support larger/small resolutions than the\n   * app was authored for.\n   *\n   * If the app was authored for 1920x1080 and this value is 2, the app's canvas\n   * will be rendered at 3840x2160 logical pixels.\n   *\n   * Likewise, if the app was authored for 1920x1080 and this value is 0.66667,\n   * the app's canvas will be rendered at 1280x720 logical pixels.\n   *\n   * @defaultValue `1`\n   */\n  deviceLogicalPixelRatio?: number;\n\n  /**\n   * Factor to convert device logical coordinates to device physical coordinates\n   *\n   * @remarks\n   * This value allows auto-scaling to support devices with different pixel densities.\n   *\n   * This controls the number of physical pixels that are used to render each logical\n   * pixel. For example, if the device has a pixel density of 2, each logical pixel\n   * will be rendered using 2x2 physical pixels.\n   *\n   * By default, it will be set to `window.devicePixelRatio` which is the pixel\n   * density of the device the app is running on reported by the browser.\n   *\n   * @defaultValue `window.devicePixelRatio`\n   */\n  devicePhysicalPixelRatio?: number;\n\n  /**\n   * RGBA encoded number of the background to use\n   *\n   * @defaultValue `0x00000000`\n   */\n  clearColor?: number;\n\n  /**\n   * Interval in milliseconds to receive FPS updates\n   *\n   * @remarks\n   * If set to `0`, FPS updates will be disabled.\n   *\n   * @defaultValue `0` (disabled)\n   */\n  fpsUpdateInterval?: number;\n\n  /**\n   * Target FPS for the global render loop\n   *\n   * @remarks\n   * Controls the maximum frame rate of the entire rendering system.\n   * When set to 0, no throttling is applied (use display refresh rate).\n   * When set to a positive number, the global requestAnimationFrame loop\n   * will be throttled to this target FPS, affecting all animations and rendering.\n   *\n   * This provides global performance control for the entire application,\n   * useful for managing performance on lower-end devices.\n   *\n   * @defaultValue `0` (no throttling, use display refresh rate)\n   */\n  targetFPS?: number;\n\n  /**\n   * Include context call (i.e. WebGL) information in FPS updates\n   *\n   * @remarks\n   * When enabled the number of calls to each context method over the\n   * `fpsUpdateInterval` will be included in the FPS update payload's\n   * `contextSpyData` property.\n   *\n   * Enabling the context spy has a serious impact on performance so only use it\n   * when you need to extract context call information.\n   *\n   * @defaultValue `false` (disabled)\n   */\n  enableContextSpy?: boolean;\n\n  /**\n   * Number or Image Workers to use\n   *\n   * @remarks\n   * On devices with multiple cores, this can be used to improve image loading\n   * as well as reduce the impact of image loading on the main thread.\n   * Set to 0 to disable image workers.\n   *\n   * @defaultValue `2`\n   */\n  numImageWorkers?: number;\n\n  /**\n   * DOM Inspector\n   *\n   * @remarks\n   * The inspector will replicate the state of the Nodes created\n   * in the renderer and allow inspection of the state of the nodes.\n   *\n   */\n  inspector?: typeof Inspector | false;\n\n  /**\n   * Renderer Engine\n   *\n   * @remarks\n   * The renderer engine to use. Spawns a WebGL or Canvas renderer.\n   * WebGL is more performant and supports more features. Canvas is\n   * supported on most platforms.\n   *\n   * Note: When using CanvasCoreRenderer you can only use\n   * CanvasTextRenderer. The WebGLCoreRenderer supports\n   * both CanvasTextRenderer and SdfTextRenderer for Text Rendering.\n   *\n   */\n  renderEngine: typeof CanvasCoreRenderer | typeof WebGlCoreRenderer;\n\n  /**\n   * Quad buffer size in bytes\n   *\n   * @defaultValue 4 * 1024 * 1024\n   */\n  quadBufferSize?: number;\n\n  /**\n   * Font Engines\n   *\n   * @remarks\n   * The font engines to use for text rendering. CanvasTextRenderer is supported\n   * on all platforms. SdfTextRenderer is a more performant renderer.\n   * When using `renderEngine=CanvasCoreRenderer` you can only use `CanvasTextRenderer`.\n   * The `renderEngine=WebGLCoreRenderer` supports both `CanvasTextRenderer` and `SdfTextRenderer`.\n   *\n   * This setting is used to enable tree shaking of unused font engines. Please\n   * import your font engine(s) as follows:\n   * ```\n   * import { CanvasTextRenderer } from '@lightning/renderer/canvas';\n   * import { SdfTextRenderer } from '@lightning/renderer/webgl';\n   * ```\n   *\n   * If both CanvasTextRenderer and SdfTextRenderer are provided, the first renderer\n   * provided will be asked first if it can render the font. If it cannot render the\n   * font, the next renderer will be asked. If no renderer can render the font, the\n   * text will not be rendered.\n   *\n   * **Note** that if you have fonts available in both engines the second font engine\n   * will not be used. This is because the first font engine will always be asked first.\n   *\n   * @defaultValue '[]'\n   *\n   *\n   */\n  fontEngines: (typeof SdfTextRenderer | typeof CanvasTextRenderer)[];\n\n  /**\n   * Force WebGL2\n   *\n   * @remarks\n   * Force the renderer to use WebGL2. This can be used to force the renderer to\n   * use WebGL2 even if the browser supports WebGL1.\n   *\n   * @defaultValue `false`\n   */\n  forceWebGL2?: boolean;\n\n  /**\n   * Enable strictBounds\n   *\n   * @remarks\n   * Enable strict bounds for the renderer. This will ensure that the renderer\n   * will not render outside the bounds of the canvas.\n   *\n   * @defaultValue `true`\n   */\n  strictBounds?: boolean;\n\n  /**\n   * Texture Processing Limit (in milliseconds)\n   *\n   * @remarks\n   * The maximum amount of time the renderer is allowed to process textures in a\n   * single frame. If the processing time exceeds this limit, the renderer will\n   * skip processing the remaining textures and continue rendering the frame.\n   *\n   * @defaultValue `10`\n   */\n  textureProcessingTimeLimit?: number;\n\n  /**\n   * Canvas object to use for rendering\n   *\n   * @remarks\n   * This is used to render the scene graph. If not provided, a new canvas\n   * element will be created and appended to the target element.\n   */\n  canvas?: HTMLCanvasElement;\n\n  /**\n   * createImageBitmap support for the runtime\n   *\n   * @remarks\n   * This is used to determine if and which version of the createImageBitmap API\n   * is supported by the runtime. This is used to determine if the renderer can\n   * use createImageBitmap to load images.\n   *\n   * Options supported\n   * - Auto - Automatically determine the supported version\n   * - Basic - Supports createImageBitmap(image)\n   * - Options - Supports createImageBitmap(image, options)\n   * - Full - Supports createImageBitmap(image, sx, sy, sw, sh, options)\n   *\n   * Note with auto detection, the renderer will attempt to use the most advanced\n   * version of the API available. If the API is not available, the renderer will\n   * fall back to the next available version.\n   *\n   * This will affect startup performance as the renderer will need to determine\n   * the supported version of the API.\n   *\n   * @defaultValue `full`\n   */\n  createImageBitmapSupport?: 'auto' | 'basic' | 'options' | 'full';\n\n  /**\n   * Number of times to retry loading a failed texture\n   *\n   * @remarks\n   * When a texture fails to load, Lightning will retry up to this many times\n   * before permanently giving up. Each retry will clear the texture ownership\n   * and then re-establish it to trigger a new load attempt.\n   *\n   * Set to null to disable retries. Set to 0 to always try once and never retry.\n   * This is typically only used on ImageTexture instances.\n   *\n   */\n  maxRetryCount?: number;\n}\n\n/**\n * The Renderer Main API\n *\n * @remarks\n * This is the primary class used to configure and operate the Renderer.\n *\n * It is used to create and destroy Nodes, as well as Texture and Shader\n * references.\n *\n * Example:\n * ```ts\n * import { RendererMain, MainCoreDriver } from '@lightningjs/renderer';\n *\n * // Initialize the Renderer\n * const renderer = new RendererMain(\n *   {\n *     appWidth: 1920,\n *     appHeight: 1080\n *   },\n *   'app',\n *   new MainCoreDriver(),\n * );\n * ```\n *\n * ## Events\n * - `fpsUpdate`\n *   - Emitted every `fpsUpdateInterval` milliseconds with the current FPS\n * - `frameTick`\n *   - Emitted every frame tick\n * - `quadsUpdate`\n *  - Emitted when number of quads rendered is updated\n * - `idle`\n *   - Emitted when the renderer is idle (no changes to the scene\n *     graph/animations running)\n * - `criticalCleanup`\n *  - Emitted when the Texture Memory Manager Cleanup process is triggered\n *  - Payload: { memUsed: number, criticalThreshold: number }\n *    - `memUsed` - The amount of memory (in bytes) used by textures before the\n *       cleanup process\n *    - `criticalThreshold` - The critical threshold (in bytes)\n * - `criticalCleanupFailed`\n *   - Emitted when the Texture Memory Manager Cleanup process is unable to free\n *     up enough texture memory to reach below the critical threshold.\n *     This can happen when there is not enough non-renderable textures to\n *     free up.\n *   - Payload (object with keys):\n *     - `memUsed` - The amount of memory (in bytes) used by textures after\n *       the cleanup process\n *     - `criticalThreshold` - The critical threshold (in bytes)\n */\nexport class RendererMain extends EventEmitter {\n  readonly root: INode<ShaderController<'DefaultShader'>>;\n  readonly canvas: HTMLCanvasElement;\n  readonly settings: Readonly<Required<RendererMainSettings>>;\n  readonly stage: Stage;\n  private inspector: Inspector | null = null;\n\n  /**\n   * Constructs a new Renderer instance\n   *\n   * @param settings Renderer settings\n   * @param target Element ID or HTMLElement to insert the canvas into\n   * @param driver Core Driver to use\n   */\n  constructor(settings: RendererMainSettings, target: string | HTMLElement) {\n    super();\n\n    const resolvedTxSettings: TextureMemoryManagerSettings = {\n      criticalThreshold: settings.textureMemory?.criticalThreshold || 124e6,\n      targetThresholdLevel: settings.textureMemory?.targetThresholdLevel || 0.5,\n      cleanupInterval: settings.textureMemory?.cleanupInterval || 5000,\n      debugLogging: settings.textureMemory?.debugLogging || false,\n      baselineMemoryAllocation:\n        settings.textureMemory?.baselineMemoryAllocation || 26e6,\n      doNotExceedCriticalThreshold:\n        settings.textureMemory?.doNotExceedCriticalThreshold || false,\n    };\n\n    const resolvedSettings: Required<RendererMainSettings> = {\n      appWidth: settings.appWidth || 1920,\n      appHeight: settings.appHeight || 1080,\n      textureMemory: resolvedTxSettings,\n      boundsMargin: settings.boundsMargin || 0,\n      deviceLogicalPixelRatio: settings.deviceLogicalPixelRatio || 1,\n      devicePhysicalPixelRatio:\n        settings.devicePhysicalPixelRatio || window.devicePixelRatio,\n      clearColor: settings.clearColor ?? 0x00000000,\n      fpsUpdateInterval: settings.fpsUpdateInterval || 0,\n      targetFPS: settings.targetFPS || 0,\n      numImageWorkers:\n        settings.numImageWorkers !== undefined ? settings.numImageWorkers : 2,\n      enableContextSpy: settings.enableContextSpy ?? false,\n      forceWebGL2: settings.forceWebGL2 ?? false,\n      inspector: settings.inspector ?? false,\n      renderEngine: settings.renderEngine,\n      quadBufferSize: settings.quadBufferSize ?? 4 * 1024 * 1024,\n      fontEngines: settings.fontEngines,\n      strictBounds: settings.strictBounds ?? true,\n      textureProcessingTimeLimit: settings.textureProcessingTimeLimit || 42,\n      canvas: settings.canvas || document.createElement('canvas'),\n      createImageBitmapSupport: settings.createImageBitmapSupport || 'full',\n      maxRetryCount: settings.maxRetryCount ?? 5,\n    };\n    this.settings = resolvedSettings;\n\n    const {\n      appWidth,\n      appHeight,\n      deviceLogicalPixelRatio,\n      devicePhysicalPixelRatio,\n      inspector,\n      canvas,\n    } = resolvedSettings;\n\n    const deviceLogicalWidth = appWidth * deviceLogicalPixelRatio;\n    const deviceLogicalHeight = appHeight * deviceLogicalPixelRatio;\n\n    this.canvas = canvas;\n    canvas.width = deviceLogicalWidth * devicePhysicalPixelRatio;\n    canvas.height = deviceLogicalHeight * devicePhysicalPixelRatio;\n\n    canvas.style.width = `${deviceLogicalWidth}px`;\n    canvas.style.height = `${deviceLogicalHeight}px`;\n\n    // Initialize the stage\n    this.stage = new Stage({\n      appWidth: this.settings.appWidth,\n      appHeight: this.settings.appHeight,\n      boundsMargin: this.settings.boundsMargin,\n      clearColor: this.settings.clearColor,\n      canvas: this.canvas,\n      deviceLogicalPixelRatio: this.settings.deviceLogicalPixelRatio,\n      devicePhysicalPixelRatio: this.settings.devicePhysicalPixelRatio,\n      enableContextSpy: this.settings.enableContextSpy,\n      forceWebGL2: this.settings.forceWebGL2,\n      fpsUpdateInterval: this.settings.fpsUpdateInterval,\n      targetFPS: this.settings.targetFPS,\n      numImageWorkers: this.settings.numImageWorkers,\n      renderEngine: this.settings.renderEngine,\n      textureMemory: resolvedTxSettings,\n      eventBus: this,\n      quadBufferSize: this.settings.quadBufferSize,\n      fontEngines: this.settings.fontEngines,\n      inspector: this.settings.inspector !== null,\n      strictBounds: this.settings.strictBounds,\n      textureProcessingTimeLimit: this.settings.textureProcessingTimeLimit,\n      createImageBitmapSupport: this.settings.createImageBitmapSupport,\n      maxRetryCount: this.settings.maxRetryCount,\n    });\n\n    // Extract the root node\n    this.root = this.stage.root as unknown as INode<\n      ShaderController<'DefaultShader'>\n    >;\n\n    // Get the target element and attach the canvas to it\n    let targetEl: HTMLElement | null;\n    if (typeof target === 'string') {\n      targetEl = document.getElementById(target);\n    } else {\n      targetEl = target;\n    }\n\n    if (!targetEl) {\n      throw new Error('Could not find target element');\n    }\n\n    targetEl.appendChild(canvas);\n\n    // Initialize inspector (if enabled)\n    if (inspector && !isProductionEnvironment) {\n      this.inspector = new inspector(canvas, resolvedSettings);\n    }\n  }\n\n  /**\n   * Create a new scene graph node\n   *\n   * @remarks\n   * A node is the main graphical building block of the Renderer scene graph. It\n   * can be a container for other nodes, or it can be a leaf node that renders a\n   * solid color, gradient, image, or specific texture, using a specific shader.\n   *\n   * To create a text node, see {@link createTextNode}.\n   *\n   * See {@link CoreNode} for more details.\n   *\n   * @param props\n   * @returns\n   */\n  createNode<\n    ShCtr extends BaseShaderController = ShaderController<'DefaultShader'>,\n  >(props: Partial<INodeProps<ShCtr>>): INode<ShCtr> {\n    const node = this.stage.createNode(props as Partial<CoreNodeProps>);\n\n    if (this.inspector) {\n      return this.inspector.createNode(node) as unknown as INode<ShCtr>;\n    }\n\n    // FIXME onDestroy event? node.once('beforeDestroy'\n    // FIXME onCreate event?\n    return node as unknown as INode<ShCtr>;\n  }\n\n  /**\n   * Create a new scene graph text node\n   *\n   * @remarks\n   * A text node is the second graphical building block of the Renderer scene\n   * graph. It renders text using a specific text renderer that is automatically\n   * chosen based on the font requested and what type of fonts are installed\n   * into an app.\n   *\n   * See {@link ITextNode} for more details.\n   *\n   * @param props\n   * @returns\n   */\n  createTextNode(props: Partial<ITextNodeProps>): ITextNode {\n    const textNode = this.stage.createTextNode(props as CoreTextNodeProps);\n\n    if (this.inspector) {\n      return this.inspector.createTextNode(textNode);\n    }\n\n    return textNode as unknown as ITextNode;\n  }\n\n  /**\n   * Destroy a node\n   *\n   * @remarks\n   * This method destroys a node\n   *\n   * @param node\n   * @returns\n   */\n  destroyNode(node: INode) {\n    if (this.inspector) {\n      this.inspector.destroyNode(node.id);\n    }\n\n    return node.destroy();\n  }\n\n  /**\n   * Create a new texture reference\n   *\n   * @remarks\n   * This method creates a new reference to a texture. The texture is not\n   * loaded until it is used on a node.\n   *\n   * It can be assigned to a node's `texture` property, or it can be used\n   * when creating a SubTexture.\n   *\n   * @param textureType\n   * @param props\n   * @param options\n   * @returns\n   */\n  createTexture<TxType extends keyof TextureMap>(\n    textureType: TxType,\n    props: ExtractProps<TextureMap[TxType]>,\n  ): InstanceType<TextureMap[TxType]> {\n    return this.stage.txManager.createTexture(textureType, props);\n  }\n\n  /**\n   * Create a new shader controller for a shader type\n   *\n   * @remarks\n   * This method creates a new Shader Controller for a specific shader type.\n   *\n   * If the shader has not been loaded yet, it will be loaded. Otherwise, the\n   * existing shader will be reused.\n   *\n   * It can be assigned to a Node's `shader` property.\n   *\n   * @param shaderType\n   * @param props\n   * @returns\n   */\n  createShader<ShType extends keyof ShaderMap>(\n    shaderType: ShType,\n    props?: ExtractProps<ShaderMap[ShType]>,\n  ): ShaderController<ShType> {\n    return this.stage.shManager.loadShader(shaderType, props);\n  }\n\n  /**\n   * Create a new Dynamic Shader controller\n   *\n   * @remarks\n   * A Dynamic Shader is a shader that can be composed of an array of mulitple\n   * effects. Each effect can be animated or changed after creation (provided\n   * the effect is given a name).\n   *\n   * Example:\n   * ```ts\n   * renderer.createNode({\n   *   shader: renderer.createDynamicShader([\n   *     renderer.createEffect('radius', {\n   *       radius: 0\n   *     }, 'effect1'),\n   *     renderer.createEffect('border', {\n   *       color: 0xff00ffff,\n   *       width: 10,\n   *     }, 'effect2'),\n   *   ]),\n   * });\n   * ```\n   *\n   * @param effects\n   * @returns\n   */\n  createDynamicShader<\n    T extends DynamicEffects<[...{ name?: string; type: keyof EffectMap }[]]>,\n  >(effects: [...T]): DynamicShaderController<T> {\n    return this.stage.shManager.loadDynamicShader({\n      effects: effects as EffectDescUnion[],\n    });\n  }\n\n  /**\n   * Create an effect to be used in a Dynamic Shader\n   *\n   * @remark\n   * The {name} parameter is optional but required if you want to animate the effect\n   * or change the effect's properties after creation.\n   *\n   * See {@link createDynamicShader} for an example.\n   *\n   * @param type\n   * @param props\n   * @param name\n   * @returns\n   */\n  createEffect<\n    Type extends keyof EffectMap,\n    Name extends string | undefined = undefined,\n  >(\n    type: Type,\n    props: EffectDesc<{ name: Name; type: Type }>['props'],\n    name?: Name,\n  ): EffectDesc<{ name: Name; type: Type }> {\n    return {\n      name,\n      type,\n      props,\n    };\n  }\n\n  /**\n   * Get a Node by its ID\n   *\n   * @param id\n   * @returns\n   */\n  getNodeById(id: number): CoreNode | null {\n    const root = this.stage?.root;\n    if (!root) {\n      return null;\n    }\n\n    const findNode = (node: CoreNode): CoreNode | null => {\n      if (node.id === id) {\n        return node;\n      }\n\n      for (const child of node.children) {\n        const found = findNode(child);\n        if (found) {\n          return found;\n        }\n      }\n\n      return null;\n    };\n\n    return findNode(root);\n  }\n\n  toggleFreeze() {\n    throw new Error('Not implemented');\n  }\n\n  advanceFrame() {\n    throw new Error('Not implemented');\n  }\n\n  getBufferInfo() {\n    return this.stage.renderer.getBufferInfo();\n  }\n\n  /**\n   * Re-render the current frame without advancing any running animations.\n   *\n   * @remarks\n   * Any state changes will be reflected in the re-rendered frame. Useful for\n   * debugging.\n   *\n   * May not do anything if the render loop is running on a separate worker.\n   */\n  rerender() {\n    this.stage.requestRender();\n  }\n\n  /**\n   * Cleanup textures that are not being used\n   *\n   * @remarks\n   * This can be used to free up GFX memory used by textures that are no longer\n   * being displayed.\n   *\n   * This routine is also called automatically when the memory used by textures\n   * exceeds the critical threshold on frame generation **OR** when the renderer\n   * is idle and the memory used by textures exceeds the target threshold.\n   *\n   * **NOTE**: This is a heavy operation and should be used sparingly.\n   * **NOTE2**: This will not cleanup textures that are currently being displayed.\n   * **NOTE3**: This will not cleanup textures that are marked as `preventCleanup`.\n   * **NOTE4**: This has nothing to do with the garbage collection of JavaScript.\n   */\n  cleanup() {\n    this.stage.cleanup();\n  }\n\n  /**\n   * Sets the clear color for the stage.\n   *\n   * @param color - The color to set as the clear color.\n   */\n  setClearColor(color: number) {\n    this.stage.setClearColor(color);\n  }\n\n  /**\n   * Gets the target FPS for the global render loop\n   *\n   * @returns The current target FPS (0 means no throttling)\n   *\n   * @remarks\n   * This controls the maximum frame rate of the entire rendering system.\n   * When 0, the system runs at display refresh rate.\n   */\n  get targetFPS(): number {\n    return this.stage.options.targetFPS;\n  }\n\n  /**\n   * Sets the target FPS for the global render loop\n   *\n   * @param fps - The target FPS to set for the global render loop.\n   *              Set to 0 or a negative value to disable throttling.\n   *\n   * @remarks\n   * This setting affects the entire rendering system immediately.\n   * All animations, rendering, and frame updates will be throttled\n   * to this target FPS. Provides global performance control.\n   *\n   * @example\n   * ```typescript\n   * // Set global target to 30fps for better performance\n   * renderer.targetFPS = 30;\n   *\n   * // Disable global throttling (use display refresh rate)\n   * renderer.targetFPS = 0;\n   * ```\n   */\n  set targetFPS(fps: number) {\n    this.stage.options.targetFPS = fps > 0 ? fps : 0;\n    this.stage.updateTargetFrameTime();\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from '../../../common/EventEmitter.js';\n\n/**\n * Augmentable map of font type IDs to font types\n *\n * @example\n * ```ts\n * declare module './TrFontFace' {\n *   interface TrFontFaceMap {\n *     canvas: CanvasTrFontFace;\n *   }\n * }\n * ```\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface TrFontFaceMap {}\n\n/**\n * Descriptors defining a font face.\n *\n * Used when selecting a font face from a font family.\n *\n * @remarks\n * Based on the `@font-face` CSS rule. Not all descriptors are supported by all\n * text renderers.\n *\n * @see https://www.w3.org/TR/css-fonts-3/#font-face-rule\n */\nexport interface TrFontFaceDescriptors {\n  style: 'normal' | 'italic' | 'oblique';\n  weight: 'normal' | 'bold' | number;\n  stretch:\n    | 'normal'\n    | 'ultra-condensed'\n    | 'extra-condensed'\n    | 'condensed'\n    | 'semi-condensed'\n    | 'semi-expanded'\n    | 'expanded'\n    | 'extra-expanded'\n    | 'ultra-expanded';\n  unicodeRange?: string;\n  display?: FontDisplay;\n  featureSettings?: string;\n}\n\nexport interface FontMetrics {\n  /**\n   * The distance, in font units, from the baseline to the highest point of the font.\n   */\n  ascender: number;\n  /**\n   * The distance, in font units, from the baseline to the lowest point of the font.\n   */\n  descender: number;\n  /**\n   * The additional space used in the calculation of the default line height in font units.\n   */\n  lineGap: number;\n  /**\n   * The number of font units per 1 EM.\n   */\n  unitsPerEm: number;\n}\n\nexport interface NormalizedFontMetrics {\n  /**\n   * The distance, as a fraction of 1 EM, from the baseline to the highest point of the font.\n   *\n   * @remarks\n   * This value should be positive.\n   */\n  ascender: number;\n  /**\n   * The distance, as a fraction of 1 EM, from the baseline to the lowest point of the font.\n   *\n   * @remarks\n   * This value should be positive.\n   */\n  descender: number;\n  /**\n   * The additional space used in the calculation of the default line height as a fraction of 1 EM\n   *\n   * @remarks\n   * This value should be positive.\n   */\n  lineGap: number;\n}\n\nexport interface TrFontFaceOptions {\n  fontFamily: string;\n  descriptors: Partial<TrFontFaceDescriptors>;\n  /**\n   * Font metrics used for layout and default line height calculations.\n   *\n   * @remarks\n   * Provides the font metrics in order to ensure consistent text layout across\n   * different font types (Canvas/Web, SDF, etc.).\n   *\n   * **Important**: We HIGHLY recommend providing these metrics for both SDF\n   * and Web/Canvas fonts. You can use the Lightning 3 [msdf-generator](https://github.com/lightning-js/msdf-generator/)\n   * tool to generate these metrics from a font file. The metrics generated by\n   * this tool can be used with both SDF and Web/Canvas fonts.\n   *\n   * If not provided, a warning will be logged and the text layout may not be\n   * consistent across different font types.\n   *\n   * If not provided, the metrics will be gathered depending on the font type.\n   * - For SDF fonts, the metrics will be gathered from the font atlas data.\n   *   If the font is generated using Lightning 3's msdf-generator tool, the\n   *   metrics will be the most accurate.\n   * - For Web/Canvas fonts, the metrics will be gathered from the\n   *   CanvasRenderingContext2D.measureText() method. The accuracy/consistency\n   *   of these metrics depends on the browser implementation. And will not\n   *   guarantee the line-by-line alignment of text with SDF fonts.\n   */\n  metrics?: FontMetrics;\n}\n\nexport class TrFontFace extends EventEmitter {\n  public readonly fontFamily: string;\n  public readonly descriptors: TrFontFaceDescriptors;\n  public readonly loaded: boolean = false;\n  public readonly metrics: NormalizedFontMetrics | null = null;\n\n  constructor(options: TrFontFaceOptions) {\n    super();\n    const { fontFamily, descriptors, metrics } = options;\n\n    if (metrics) {\n      // Normalize metrics to be in the range of 0 to 1\n      this.metrics = {\n        ascender: metrics.ascender / metrics.unitsPerEm,\n        descender: metrics.descender / metrics.unitsPerEm,\n        lineGap: metrics.lineGap / metrics.unitsPerEm,\n      };\n    }\n    this.fontFamily = fontFamily;\n    this.descriptors = {\n      style: 'normal',\n      weight: 'normal',\n      stretch: 'normal',\n      ...descriptors,\n    };\n  }\n\n  /**\n   * Convert a TrFontFaceDescriptors to a FontFaceDescriptors which differ slightly\n   *\n   * @param descriptors\n   * @returns\n   */\n  public static convertToCssFontFaceDescriptors(\n    descriptors: TrFontFaceDescriptors,\n  ): FontFaceDescriptors {\n    return {\n      style: descriptors.style,\n      weight:\n        typeof descriptors.weight === 'number'\n          ? `${descriptors.weight}`\n          : descriptors.weight,\n      stretch: descriptors.stretch,\n      unicodeRange: descriptors.unicodeRange,\n      featureSettings: descriptors.featureSettings,\n      display: descriptors.display,\n    };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  TrFontFace,\n  type TrFontFaceDescriptors,\n  type TrFontFaceOptions,\n} from './TrFontFace.js';\n\ndeclare module './TrFontFace.js' {\n  interface TrFontFaceMap {\n    web: WebTrFontFace;\n  }\n}\n\nexport interface WebTrFontFaceOptions extends TrFontFaceOptions {\n  fontUrl: string;\n}\n\nexport class WebTrFontFace extends TrFontFace {\n  public readonly fontFace: FontFace;\n  public readonly fontUrl: string;\n\n  constructor(options: WebTrFontFaceOptions) {\n    super(options);\n\n    const { fontFamily, fontUrl } = options;\n\n    // Filter out parentheses from fontUrl\n    const fontUrlWithoutParentheses = fontUrl.replace(/\\(|\\)/g, '');\n\n    // Defaults for descriptors resolved in the super constructor\n    const determinedDescriptors = this.descriptors;\n\n    // Convert TrFontFaceDescriptors to CSS FontFaceDescriptors\n    let cssDescriptors: FontFaceDescriptors = {\n      style: determinedDescriptors.style,\n      weight:\n        typeof determinedDescriptors.weight === 'number'\n          ? `${determinedDescriptors.weight}`\n          : determinedDescriptors.weight,\n      stretch: determinedDescriptors.stretch,\n      unicodeRange: determinedDescriptors.unicodeRange,\n      featureSettings: determinedDescriptors.featureSettings,\n      display: determinedDescriptors.display,\n    };\n\n    for (const k in cssDescriptors) {\n      const key = k as keyof FontFaceDescriptors;\n      if (cssDescriptors[key] === undefined) {\n        delete cssDescriptors[key];\n      }\n    }\n\n    const fontFace = new FontFace(\n      fontFamily,\n      `url(${fontUrlWithoutParentheses})`,\n      cssDescriptors,\n    );\n\n    if (fontUrlWithoutParentheses.length > 0) {\n      fontFace\n        .load()\n        .then(() => {\n          (this.loaded as boolean) = true;\n          this.emit('loaded');\n        })\n        .catch(console.error);\n    } else {\n      // Default font\n      (this.loaded as boolean) = true;\n      this.emit('loaded');\n    }\n\n    this.fontFace = fontFace;\n    this.fontUrl = fontUrl;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport abstract class CoreRenderOp {\n  abstract draw(): void;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CoreRenderOp } from '../CoreRenderOp.js';\nimport { WebGlCoreShader } from './WebGlCoreShader.js';\nimport type { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nimport type { WebGlCoreRendererOptions } from './WebGlCoreRenderer.js';\nimport type { BufferCollection } from './internal/BufferCollection.js';\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport type { RectWithValid } from '../../lib/utils.js';\nimport type { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\n\n/**\n * Can render multiple quads with multiple textures (up to vertex shader texture limit)\n *\n */\nexport class WebGlCoreRenderOp extends CoreRenderOp {\n  length = 0;\n  numQuads = 0;\n  textures: WebGlCoreCtxTexture[] = [];\n  readonly maxTextures: number;\n\n  constructor(\n    readonly glw: WebGlContextWrapper,\n    readonly options: WebGlCoreRendererOptions,\n    readonly buffers: BufferCollection,\n    readonly shader: WebGlCoreShader,\n    readonly shaderProps: Record<string, unknown>,\n    readonly alpha: number,\n    readonly clippingRect: RectWithValid,\n    readonly dimensions: Dimensions,\n    readonly bufferIdx: number,\n    readonly zIndex: number,\n    readonly renderToTexture: boolean | undefined,\n    readonly parentHasRenderTexture: boolean | undefined,\n    readonly framebufferDimensions: Dimensions | undefined,\n  ) {\n    super();\n    this.maxTextures = shader.supportsIndexedTextures\n      ? (glw.getParameter(glw.MAX_VERTEX_TEXTURE_IMAGE_UNITS) as number)\n      : 1;\n  }\n\n  addTexture(texture: WebGlCoreCtxTexture): number {\n    const { textures, maxTextures } = this;\n    let existingIdx = -1;\n    const texturesLength = textures.length;\n    for (let i = 0; i < texturesLength; i++) {\n      const t = textures[i];\n      if (t === texture) {\n        existingIdx = i;\n        break;\n      }\n    }\n\n    if (existingIdx !== -1) {\n      return existingIdx;\n    }\n\n    if (texturesLength >= maxTextures) {\n      return 0xffffffff;\n    }\n    this.textures.push(texture);\n    return texturesLength;\n  }\n\n  draw() {\n    const { glw, shader, shaderProps, options } = this;\n    const { shManager } = options;\n\n    shManager.useShader(shader);\n    shader.bindRenderOp(this, shaderProps);\n\n    // TODO: Reduce calculations required\n    const quadIdx = (this.bufferIdx / 32) * 6 * 2;\n\n    // Clipping\n    if (this.clippingRect.valid) {\n      const { x, y, width, height } = this.clippingRect;\n      const pixelRatio = this.parentHasRenderTexture ? 1 : options.pixelRatio;\n      const canvasHeight = options.canvas.height;\n\n      const clipX = Math.round(x * pixelRatio);\n      const clipWidth = Math.round(width * pixelRatio);\n      const clipHeight = Math.round(height * pixelRatio);\n      let clipY = Math.round(canvasHeight - clipHeight - y * pixelRatio);\n\n      // if parent has render texture, we need to adjust the scissor rect\n      // to be relative to the parent's framebuffer\n      if (this.parentHasRenderTexture) {\n        clipY = this.framebufferDimensions\n          ? this.framebufferDimensions.height - this.dimensions.height\n          : 0;\n      }\n\n      glw.setScissorTest(true);\n      glw.scissor(clipX, clipY, clipWidth, clipHeight);\n    } else {\n      glw.setScissorTest(false);\n    }\n\n    glw.drawElements(\n      glw.TRIANGLES,\n      6 * this.numQuads,\n      glw.UNSIGNED_SHORT,\n      quadIdx,\n    );\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { WebGlContextWrapper } from '../../../lib/WebGlContextWrapper.js';\n\nexport interface CoreWebGlParameters {\n  MAX_RENDERBUFFER_SIZE: number;\n  MAX_TEXTURE_SIZE: number;\n  MAX_VIEWPORT_DIMS: Int32Array;\n  MAX_VERTEX_TEXTURE_IMAGE_UNITS: number;\n  MAX_TEXTURE_IMAGE_UNITS: number;\n  MAX_COMBINED_TEXTURE_IMAGE_UNITS: number;\n  MAX_VERTEX_ATTRIBS: number;\n  MAX_VARYING_VECTORS: number;\n  MAX_VERTEX_UNIFORM_VECTORS: number;\n  MAX_FRAGMENT_UNIFORM_VECTORS: number;\n}\n\n/**\n * Get device specific webgl parameters\n * @param glw\n */\nexport function getWebGlParameters(\n  glw: WebGlContextWrapper,\n): CoreWebGlParameters {\n  const params: CoreWebGlParameters = {\n    MAX_RENDERBUFFER_SIZE: 0,\n    MAX_TEXTURE_SIZE: 0,\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any\n    MAX_VIEWPORT_DIMS: 0 as any, // Code below will replace this with an Int32Array\n    MAX_VERTEX_TEXTURE_IMAGE_UNITS: 0,\n    MAX_TEXTURE_IMAGE_UNITS: 0,\n    MAX_COMBINED_TEXTURE_IMAGE_UNITS: 0,\n    MAX_VERTEX_ATTRIBS: 0,\n    MAX_VARYING_VECTORS: 0,\n    MAX_VERTEX_UNIFORM_VECTORS: 0,\n    MAX_FRAGMENT_UNIFORM_VECTORS: 0,\n  };\n\n  // Map over all parameters and get them\n  const keys = Object.keys(params) as Array<keyof CoreWebGlParameters>;\n  keys.forEach((key) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    params[key] = glw.getParameter(glw[key]);\n  });\n\n  return params;\n}\n\nexport interface CoreWebGlExtensions {\n  ANGLE_instanced_arrays: ANGLE_instanced_arrays | null;\n  WEBGL_compressed_texture_s3tc: WEBGL_compressed_texture_s3tc | null;\n  WEBGL_compressed_texture_astc: WEBGL_compressed_texture_astc | null;\n  WEBGL_compressed_texture_etc: WEBGL_compressed_texture_etc | null;\n  WEBGL_compressed_texture_etc1: WEBGL_compressed_texture_etc1 | null;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  WEBGL_compressed_texture_pvrtc: any | null;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  WEBKIT_WEBGL_compressed_texture_pvrtc: any | null;\n  WEBGL_compressed_texture_s3tc_srgb: WEBGL_compressed_texture_s3tc_srgb | null;\n  OES_vertex_array_object: OES_vertex_array_object | null;\n}\n\n/**\n * Get device webgl extensions\n * @param glw\n */\nexport function getWebGlExtensions(\n  glw: WebGlContextWrapper,\n): CoreWebGlExtensions {\n  const extensions: CoreWebGlExtensions = {\n    ANGLE_instanced_arrays: null,\n    WEBGL_compressed_texture_s3tc: null,\n    WEBGL_compressed_texture_astc: null,\n    WEBGL_compressed_texture_etc: null,\n    WEBGL_compressed_texture_etc1: null,\n    WEBGL_compressed_texture_pvrtc: null,\n    WEBKIT_WEBGL_compressed_texture_pvrtc: null,\n    WEBGL_compressed_texture_s3tc_srgb: null,\n    OES_vertex_array_object: null,\n  };\n\n  // Map over all extensions and get them\n  const keys = Object.keys(extensions) as Array<keyof CoreWebGlExtensions>;\n  keys.forEach((key) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    extensions[key] = glw.getExtension(key);\n  });\n\n  return extensions;\n}\n\n/**\n * Allocate big memory chunk that we\n * can re-use to draw quads\n *\n * @param glw\n * @param size\n */\nexport function createIndexBuffer(glw: WebGlContextWrapper, size: number) {\n  const maxQuads = ~~(size / 80);\n  const indices = new Uint16Array(maxQuads * 6);\n\n  for (let i = 0, j = 0; i < maxQuads; i += 6, j += 4) {\n    indices[i] = j;\n    indices[i + 1] = j + 1;\n    indices[i + 2] = j + 2;\n    indices[i + 3] = j + 2;\n    indices[i + 4] = j + 1;\n    indices[i + 5] = j + 3;\n  }\n\n  const buffer = glw.createBuffer();\n  glw.elementArrayBufferData(buffer, indices, glw.STATIC_DRAW);\n}\n\n/**\n * Checks if an object is of type HTMLImageElement.\n * This is used because we cant check for HTMLImageElement directly when the\n * renderer is running in a seperate web worker context.\n *\n * @param obj\n * @returns\n */\nexport function isHTMLImageElement(obj: unknown): obj is HTMLImageElement {\n  return (\n    obj !== null &&\n    ((typeof obj === 'object' &&\n      obj.constructor &&\n      obj.constructor.name === 'HTMLImageElement') ||\n      (typeof HTMLImageElement !== 'undefined' &&\n        obj instanceof HTMLImageElement))\n  );\n}\n\nexport interface WebGlColor {\n  raw: number;\n  normalized: [number, number, number, number];\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { assertTruthy } from '../../../utils.js';\nimport type { TextureMemoryManager } from '../../TextureMemoryManager.js';\nimport type { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport { uploadCompressedTexture } from '../../lib/textureCompression.js';\nimport type { Texture } from '../../textures/Texture.js';\nimport { CoreContextTexture } from '../CoreContextTexture.js';\nimport { isHTMLImageElement } from './internal/RendererUtils.js';\n\nconst TRANSPARENT_TEXTURE_DATA = new Uint8Array([0, 0, 0, 0]);\n\n/**\n * A wrapper around a WebGLTexture that handles loading the texture data\n * from a Texture source and uploading it to the GPU as well as freeing\n * the uploaded texture.\n *\n * @remarks\n * When accessing the ctxTexture property, the texture will be loaded if\n * it hasn't been already. ctxTexture will always return a valid WebGLTexture\n * and trigger the loading/uploading of the texture's data if it hasn't been\n * loaded yet.\n */\nexport class WebGlCoreCtxTexture extends CoreContextTexture {\n  protected _nativeCtxTexture: WebGLTexture | null = null;\n  private _w = 0;\n  private _h = 0;\n\n  txCoordX1 = 0;\n  txCoordY1 = 0;\n  txCoordX2 = 1;\n  txCoordY2 = 1;\n\n  constructor(\n    protected glw: WebGlContextWrapper,\n    memManager: TextureMemoryManager,\n    textureSource: Texture,\n  ) {\n    super(memManager, textureSource);\n  }\n\n  /**\n   * GL error check with direct state marking\n   * Uses cached error result to minimize function calls\n   */\n  private checkGLError(): boolean {\n    // Skip if already failed to prevent double-processing\n    if (this.state === 'failed') {\n      return true;\n    }\n\n    const error = this.glw.getError();\n    if (error !== 0) {\n      this.state = 'failed';\n      this.textureSource.setState('failed', new Error(`WebGL Error: ${error}`));\n      return true;\n    }\n    return false;\n  }\n\n  get ctxTexture(): WebGLTexture | null {\n    if (this.state === 'freed') {\n      this.load();\n      return null;\n    }\n    assertTruthy(this._nativeCtxTexture);\n    return this._nativeCtxTexture;\n  }\n\n  get w() {\n    return this._w;\n  }\n\n  get h() {\n    return this._h;\n  }\n\n  /**\n   * Load the texture data from the Texture source and upload it to the GPU\n   *\n   * @remarks\n   * This method is called automatically when accessing the ctxTexture property\n   * if the texture hasn't been loaded yet. But it can also be called manually\n   * to force the texture to be pre-loaded prior to accessing the ctxTexture\n   * property.\n   */\n  async load(): Promise<void> {\n    // If the texture is already loading or loaded, return resolved promise\n    if (this.state === 'loading' || this.state === 'loaded') {\n      return Promise.resolve();\n    }\n\n    this.state = 'loading';\n    this.textureSource.setState('loading');\n\n    // Await the native texture creation to ensure GPU buffer is fully allocated\n    this._nativeCtxTexture = this.createNativeCtxTexture();\n\n    if (this._nativeCtxTexture === null) {\n      this.state = 'failed';\n      this.textureSource.setState(\n        'failed',\n        new Error('WebGL Texture creation failed'),\n      );\n      return;\n    }\n\n    try {\n      const { width, height } = await this.onLoadRequest();\n\n      // If the texture has been freed while loading, return early.\n      // Type assertion needed because state could change during async operations\n      if ((this.state as string) === 'freed') {\n        return;\n      }\n\n      this.state = 'loaded';\n      this._w = width;\n      this._h = height;\n      // Update the texture source's width and height so that it can be used\n      // for rendering.\n      this.textureSource.setState('loaded', { width, height });\n      this.textureSource.freeTextureData();\n    } catch (err: unknown) {\n      // If the texture has been freed while loading, return early.\n      // Type assertion needed because state could change during async operations\n      if ((this.state as string) === 'freed') {\n        return;\n      }\n\n      // Ensure texture is marked as failed\n      this.state = 'failed';\n      this.textureSource.setState('failed');\n    }\n  }\n\n  /**\n   * Called when the texture data needs to be loaded and uploaded to a texture\n   */\n  async onLoadRequest(): Promise<Dimensions> {\n    const { glw } = this;\n    const textureData = this.textureSource.textureData;\n\n    // Early return if texture is already failed\n    if (this.state === 'failed') {\n      return { width: 0, height: 0 };\n    }\n\n    if (textureData === null || this._nativeCtxTexture === null) {\n      this.state = 'failed';\n      this.textureSource.setState(\n        'failed',\n        new Error('No texture data available'),\n      );\n      return { width: 0, height: 0 };\n    }\n\n    // Set to a 1x1 transparent texture\n    glw.texImage2D(0, glw.RGBA, 1, 1, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);\n    this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);\n\n    let width = 0;\n    let height = 0;\n\n    glw.activeTexture(0);\n\n    // High-performance error check - single call, direct state marking\n    if (this.checkGLError() === true) {\n      return { width: 0, height: 0 };\n    }\n\n    const tdata = textureData.data;\n    const format = glw.RGBA;\n    const formatBytes = 4;\n    const memoryPadding = 1.1; // Add padding to account for GPU Padding\n\n    // If textureData is null, the texture is empty (0, 0) and we don't need to\n    // upload any data to the GPU.\n    if (\n      (typeof ImageBitmap !== 'undefined' && tdata instanceof ImageBitmap) ||\n      tdata instanceof ImageData ||\n      // not using typeof HTMLImageElement due to web worker\n      isHTMLImageElement(tdata)\n    ) {\n      width = tdata.width;\n      height = tdata.height;\n      glw.bindTexture(this._nativeCtxTexture);\n      glw.pixelStorei(\n        glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL,\n        !!textureData.premultiplyAlpha,\n      );\n\n      glw.texImage2D(0, format, format, glw.UNSIGNED_BYTE, tdata);\n\n      // Check for errors after image upload operations\n      if (this.checkGLError() === true) {\n        return { width: 0, height: 0 };\n      }\n\n      this.setTextureMemUse(height * width * formatBytes * memoryPadding);\n    } else if (tdata && 'mipmaps' in tdata && tdata.mipmaps) {\n      const { mipmaps, type, blockInfo } = tdata;\n      uploadCompressedTexture[type]!(glw, this._nativeCtxTexture, tdata);\n\n      // Check for errors after compressed texture operations\n      if (this.checkGLError() === true) {\n        return { width: 0, height: 0 };\n      }\n\n      width = tdata.width;\n      height = tdata.height;\n      this.txCoordX2 =\n        width / (Math.ceil(width / blockInfo.width) * blockInfo.width);\n      this.txCoordY2 =\n        height / (Math.ceil(height / blockInfo.height) * blockInfo.height);\n\n      this.setTextureMemUse(mipmaps[0]?.byteLength ?? 0);\n    } else if (tdata && tdata instanceof Uint8Array) {\n      // Color Texture\n      width = 1;\n      height = 1;\n\n      glw.bindTexture(this._nativeCtxTexture);\n      glw.pixelStorei(\n        glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL,\n        !!textureData.premultiplyAlpha,\n      );\n\n      glw.texImage2D(\n        0,\n        format,\n        width,\n        height,\n        0,\n        format,\n        glw.UNSIGNED_BYTE,\n        tdata,\n      );\n\n      // Check for errors after color texture operations\n      if (this.checkGLError() === true) {\n        return { width: 0, height: 0 };\n      }\n\n      this.setTextureMemUse(width * height * formatBytes);\n    } else {\n      console.error(\n        `WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned`,\n        textureData,\n      );\n\n      this.state = 'failed';\n      this.textureSource.setState(\n        'failed',\n        new Error('Unexpected texture data'),\n      );\n      return { width: 0, height: 0 };\n    }\n\n    return {\n      width,\n      height,\n    };\n  }\n\n  /**\n   * Free the WebGLTexture from the GPU\n   *\n   * @returns\n   */\n  free() {\n    if (this.state === 'freed') {\n      return;\n    }\n\n    this.state = 'freed';\n    this.textureSource.setState('freed');\n    this.release();\n  }\n\n  /**\n   * Release the WebGLTexture from the GPU without changing state\n   */\n  release(): void {\n    this._w = 0;\n    this._h = 0;\n\n    if (this._nativeCtxTexture !== null) {\n      this.glw.deleteTexture(this._nativeCtxTexture);\n      this.setTextureMemUse(0);\n      this._nativeCtxTexture = null;\n    }\n\n    // if the texture still has source data, free it\n    this.textureSource.freeTextureData();\n  }\n\n  /**\n   * Create native context texture asynchronously\n   *\n   * @remarks\n   * When this method resolves, the returned texture will be bound to the GL context state\n   * and fully ready for use. This ensures proper GPU resource allocation timing.\n   *\n   * @returns Promise that resolves to the native WebGL texture or null on failure\n   */\n  protected createNativeCtxTexture(): WebGLTexture | null {\n    const { glw } = this;\n\n    const nativeTexture = glw.createTexture();\n    if (!nativeTexture) {\n      return null;\n    }\n\n    // On initial load request, create a 1x1 transparent texture to use until\n    // the texture data is finally loaded.\n    glw.activeTexture(0);\n    glw.bindTexture(nativeTexture);\n\n    // linear texture filtering\n    glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);\n    glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);\n\n    // texture wrapping method\n    glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);\n    glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);\n\n    const error = glw.getError();\n    if (error !== 0) {\n      return null;\n    }\n\n    return nativeTexture;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { assertTruthy } from '../../../utils.js';\nimport type { TextureMemoryManager } from '../../TextureMemoryManager.js';\nimport type { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport type { SubTexture } from '../../textures/SubTexture.js';\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\n\nexport class WebGlCoreCtxSubTexture extends WebGlCoreCtxTexture {\n  constructor(\n    glw: WebGlContextWrapper,\n    memManager: TextureMemoryManager,\n    textureSource: SubTexture,\n  ) {\n    super(glw, memManager, textureSource);\n  }\n\n  override async onLoadRequest(): Promise<Dimensions> {\n    const props = (this.textureSource as SubTexture).textureData;\n    assertTruthy(props, 'SubTexture must have texture data');\n\n    if (props.data instanceof Uint8Array) {\n      // its a 1x1 Color Texture\n      return { width: 1, height: 1 };\n    }\n\n    return {\n      width: props.data?.width || 0,\n      height: props.data?.height || 0,\n    };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { AttributeInfo } from './ShaderUtils.js';\n\nexport interface BufferItem {\n  buffer: WebGLBuffer;\n  attributes: Record<string, AttributeInfo>;\n}\n\n/**\n * Represents a collection of WebGL Buffers along with their associated\n * vertex attribute formats.\n */\nexport class BufferCollection {\n  constructor(readonly config: BufferItem[]) {}\n\n  /**\n   * Get the WebGLBuffer associated with the given attribute name if it exists.\n   *\n   * @param attributeName\n   * @returns\n   */\n  getBuffer(attributeName: string): WebGLBuffer | undefined {\n    return this.config.find((item) => item.attributes[attributeName])?.buffer;\n  }\n\n  /**\n   * Get the AttributeInfo associated with the given attribute name if it exists.\n   *\n   * @param attributeName\n   * @returns\n   */\n  getAttributeInfo(attributeName: string): AttributeInfo | undefined {\n    return this.config.find((item) => item.attributes[attributeName])\n      ?.attributes[attributeName];\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Generic WebGL Utility Functions\n *\n * @remarks\n * Nothing here should be coupled to Renderer logic / types.\n *\n * @param gl\n * @returns\n */\nexport function isWebGl2(\n  gl: WebGLRenderingContext,\n): gl is WebGL2RenderingContext {\n  return (\n    self.WebGL2RenderingContext && gl instanceof self.WebGL2RenderingContext\n  );\n}\n", "/* eslint-disable @typescript-eslint/no-unsafe-return */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unsafe-argument */\n\nimport { assertTruthy } from '../../utils.js';\nimport { isWebGl2 } from '../renderers/webgl/internal/WebGlUtils.js';\n\n/**\n * Optimized WebGL Context Wrapper\n *\n * @remarks\n * This class contains the subset of the WebGLRenderingContext & WebGL2RenderingContext\n * API that is used by the renderer. Select high volume WebGL methods include\n * caching optimizations to avoid making WebGL calls if the state is already set\n * to the desired value.\n *\n * While most methods contained are direct passthroughs to the WebGL context,\n * some methods combine multiple WebGL calls into one for convenience, modify\n * arguments to be more convenient, or are replaced by more specific methods.\n *\n * Not all methods are optimized. Only methods that are called frequently\n * and/or have a high cost are optimized.\n *\n * A subset of GLenum constants are also exposed as properties on this class\n * for convenience.\n */\nexport class WebGlContextWrapper {\n  //#region Cached WebGL State\n  private activeTextureUnit = 0;\n  private texture2dUnits: Array<WebGLTexture | null>;\n  private texture2dParams: WeakMap<\n    WebGLTexture,\n    Record<number, number | undefined>\n  > = new WeakMap();\n  private scissorEnabled;\n  private scissorX: number;\n  private scissorY: number;\n  private scissorWidth: number;\n  private scissorHeight: number;\n  private blendEnabled;\n  private blendSrcRgb: number;\n  private blendDstRgb: number;\n  private blendSrcAlpha: number;\n  private blendDstAlpha: number;\n  private boundArrayBuffer: WebGLBuffer | null;\n  private boundElementArrayBuffer: WebGLBuffer | null;\n  private curProgram: WebGLProgram | null;\n  //#endregion Cached WebGL State\n\n  //#region Canvas\n  public readonly canvas;\n  //#endregion Canvas\n\n  //#region WebGL Enums\n  public readonly MAX_RENDERBUFFER_SIZE;\n  public readonly MAX_TEXTURE_SIZE;\n  public readonly MAX_VIEWPORT_DIMS;\n  public readonly MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n  public readonly MAX_TEXTURE_IMAGE_UNITS;\n  public readonly MAX_COMBINED_TEXTURE_IMAGE_UNITS;\n  public readonly MAX_VERTEX_ATTRIBS;\n  public readonly MAX_VARYING_VECTORS;\n  public readonly MAX_VERTEX_UNIFORM_VECTORS;\n  public readonly MAX_FRAGMENT_UNIFORM_VECTORS;\n  public readonly TEXTURE_MAG_FILTER;\n  public readonly TEXTURE_MIN_FILTER;\n  public readonly TEXTURE_WRAP_S;\n  public readonly TEXTURE_WRAP_T;\n  public readonly LINEAR;\n  public readonly LINEAR_MIPMAP_LINEAR;\n  public readonly CLAMP_TO_EDGE;\n  public readonly RGB;\n  public readonly RGBA;\n  public readonly UNSIGNED_BYTE;\n  public readonly UNPACK_PREMULTIPLY_ALPHA_WEBGL;\n  public readonly UNPACK_FLIP_Y_WEBGL;\n  public readonly FLOAT;\n  public readonly TRIANGLES;\n  public readonly UNSIGNED_SHORT;\n  public readonly ONE;\n  public readonly ONE_MINUS_SRC_ALPHA;\n  public readonly VERTEX_SHADER;\n  public readonly FRAGMENT_SHADER;\n  public readonly STATIC_DRAW;\n  public readonly COMPILE_STATUS;\n  public readonly LINK_STATUS;\n  public readonly DYNAMIC_DRAW;\n  public readonly COLOR_ATTACHMENT0;\n  public readonly INVALID_ENUM: number;\n  public readonly INVALID_OPERATION: number;\n  //#endregion WebGL Enums\n\n  constructor(private gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    // The following code extracts the current state of the WebGL context\n    // to our local JavaScript cached version of it. This is so we can\n    // avoid making WebGL calls if we don't need to.\n    // We could assume that the WebGL context is in a default state, but\n    // in the future we may want to support restoring a broken WebGL context\n    // and this will help with that.\n    this.activeTextureUnit =\n      (gl.getParameter(gl.ACTIVE_TEXTURE) as number) - gl.TEXTURE0;\n    const maxTextureUnits = gl.getParameter(\n      gl.MAX_TEXTURE_IMAGE_UNITS,\n    ) as number;\n    // save current texture units\n    this.texture2dUnits = new Array<undefined>(maxTextureUnits)\n      .fill(undefined)\n      .map((_, i) => {\n        this.activeTexture(i);\n        return gl.getParameter(gl.TEXTURE_BINDING_2D) as WebGLTexture;\n      });\n    // restore active texture unit\n    this.activeTexture(this.activeTextureUnit);\n    this.scissorEnabled = gl.isEnabled(gl.SCISSOR_TEST);\n\n    const scissorBox = gl.getParameter(gl.SCISSOR_BOX) as [\n      number,\n      number,\n      number,\n      number,\n    ];\n    this.scissorX = scissorBox[0];\n    this.scissorY = scissorBox[1];\n    this.scissorWidth = scissorBox[2];\n    this.scissorHeight = scissorBox[3];\n\n    this.blendEnabled = gl.isEnabled(gl.BLEND);\n    this.blendSrcRgb = gl.getParameter(gl.BLEND_SRC_RGB) as number;\n    this.blendDstRgb = gl.getParameter(gl.BLEND_DST_RGB) as number;\n    this.blendSrcAlpha = gl.getParameter(gl.BLEND_SRC_ALPHA) as number;\n    this.blendDstAlpha = gl.getParameter(gl.BLEND_DST_ALPHA) as number;\n\n    this.boundArrayBuffer = gl.getParameter(\n      gl.ARRAY_BUFFER_BINDING,\n    ) as WebGLBuffer;\n    this.boundElementArrayBuffer = gl.getParameter(\n      gl.ELEMENT_ARRAY_BUFFER_BINDING,\n    ) as WebGLBuffer;\n\n    this.curProgram = gl.getParameter(\n      gl.CURRENT_PROGRAM,\n    ) as WebGLProgram | null;\n\n    this.canvas = gl.canvas;\n\n    // Extract GLenums\n    this.MAX_RENDERBUFFER_SIZE = gl.MAX_RENDERBUFFER_SIZE;\n    this.MAX_TEXTURE_SIZE = gl.MAX_TEXTURE_SIZE;\n    this.MAX_VIEWPORT_DIMS = gl.MAX_VIEWPORT_DIMS;\n    this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n    this.MAX_TEXTURE_IMAGE_UNITS = gl.MAX_TEXTURE_IMAGE_UNITS;\n    this.MAX_COMBINED_TEXTURE_IMAGE_UNITS = gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS;\n    this.MAX_VERTEX_ATTRIBS = gl.MAX_VERTEX_ATTRIBS;\n    this.MAX_VARYING_VECTORS = gl.MAX_VARYING_VECTORS;\n    this.MAX_VERTEX_UNIFORM_VECTORS = gl.MAX_VERTEX_UNIFORM_VECTORS;\n    this.MAX_FRAGMENT_UNIFORM_VECTORS = gl.MAX_FRAGMENT_UNIFORM_VECTORS;\n    this.TEXTURE_MAG_FILTER = gl.TEXTURE_MAG_FILTER;\n    this.TEXTURE_MIN_FILTER = gl.TEXTURE_MIN_FILTER;\n    this.TEXTURE_WRAP_S = gl.TEXTURE_WRAP_S;\n    this.TEXTURE_WRAP_T = gl.TEXTURE_WRAP_T;\n    this.LINEAR = gl.LINEAR;\n    this.LINEAR_MIPMAP_LINEAR = gl.LINEAR_MIPMAP_LINEAR;\n    this.CLAMP_TO_EDGE = gl.CLAMP_TO_EDGE;\n    this.RGB = gl.RGB;\n    this.RGBA = gl.RGBA;\n    this.UNSIGNED_BYTE = gl.UNSIGNED_BYTE;\n    this.UNPACK_PREMULTIPLY_ALPHA_WEBGL = gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL;\n    this.UNPACK_FLIP_Y_WEBGL = gl.UNPACK_FLIP_Y_WEBGL;\n    this.FLOAT = gl.FLOAT;\n    this.TRIANGLES = gl.TRIANGLES;\n    this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;\n    this.ONE = gl.ONE;\n    this.ONE_MINUS_SRC_ALPHA = gl.ONE_MINUS_SRC_ALPHA;\n    this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;\n    this.TRIANGLES = gl.TRIANGLES;\n    this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;\n    this.VERTEX_SHADER = gl.VERTEX_SHADER;\n    this.FRAGMENT_SHADER = gl.FRAGMENT_SHADER;\n    this.STATIC_DRAW = gl.STATIC_DRAW;\n    this.COMPILE_STATUS = gl.COMPILE_STATUS;\n    this.LINK_STATUS = gl.LINK_STATUS;\n    this.DYNAMIC_DRAW = gl.DYNAMIC_DRAW;\n    this.COLOR_ATTACHMENT0 = gl.COLOR_ATTACHMENT0;\n    this.INVALID_ENUM = gl.INVALID_ENUM;\n    this.INVALID_OPERATION = gl.INVALID_OPERATION;\n  }\n  /**\n   * Returns true if the WebGL context is WebGL2\n   *\n   * @returns\n   */\n  isWebGl2() {\n    return isWebGl2(this.gl);\n  }\n\n  /**\n   * ```\n   * gl.activeTexture(textureUnit + gl.TEXTURE0);\n   * ```\n   *\n   * @remarks\n   * **WebGL Difference**: `textureUnit` is based from 0, not `gl.TEXTURE0`.\n   *\n   * @param textureUnit\n   */\n  activeTexture(textureUnit: number) {\n    const { gl } = this;\n    if (this.activeTextureUnit !== textureUnit) {\n      gl.activeTexture(textureUnit + gl.TEXTURE0);\n      this.activeTextureUnit = textureUnit;\n    }\n  }\n\n  /**\n   * ```\n   * gl.bindTexture(gl.TEXTURE_2D, texture);\n   * ```\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n   *\n   * @param texture\n   */\n  bindTexture(texture: WebGLTexture | null) {\n    const { gl, activeTextureUnit, texture2dUnits } = this;\n\n    if (texture2dUnits[activeTextureUnit] === texture) {\n      return;\n    }\n    texture2dUnits[activeTextureUnit] = texture;\n\n    gl.bindTexture(this.gl.TEXTURE_2D, texture);\n  }\n\n  private _getActiveTexture(): WebGLTexture | null {\n    const { activeTextureUnit, texture2dUnits } = this;\n    return texture2dUnits[activeTextureUnit]!;\n  }\n\n  /**\n   * ```\n   * gl.texParameteri(gl.TEXTURE_2D, pname, param);\n   * ```\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n   *\n   * @param pname\n   * @param param\n   * @returns\n   */\n  texParameteri(pname: number, param: number) {\n    const { gl, texture2dParams } = this;\n\n    const activeTexture = this._getActiveTexture();\n    if (!activeTexture) {\n      throw new Error('No active texture');\n    }\n    let textureParams = texture2dParams.get(activeTexture);\n    if (!textureParams) {\n      textureParams = {};\n      texture2dParams.set(activeTexture, textureParams);\n    }\n    if (textureParams[pname] === param) {\n      return;\n    }\n    textureParams[pname] = param;\n    gl.texParameteri(gl.TEXTURE_2D, pname, param);\n  }\n\n  /**\n   * ```\n   * gl.texImage2D(\n   *   gl.TEXTURE_2D,\n   *   level,\n   *   internalFormat,\n   *   width,\n   *   height,\n   *   border,\n   *   format,\n   *   type,\n   *   pixels,\n   * );\n   * ```\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n   *\n   * @param level\n   * @param internalFormat\n   * @param width\n   * @param height\n   * @param border\n   * @param format\n   * @param type\n   * @param pixels\n   */\n  texImage2D(\n    level: GLint,\n    internalformat: GLint,\n    width: GLsizei,\n    height: GLsizei,\n    border: GLint,\n    format: GLenum,\n    type: GLenum,\n    pixels: ArrayBufferView | null,\n  ): void;\n  texImage2D(\n    level: GLint,\n    internalformat: GLint,\n    format: GLenum,\n    type: GLenum,\n    source: TexImageSource | Uint8Array,\n  ): void;\n  texImage2D(\n    level: any,\n    internalFormat: any,\n    widthOrFormat: any,\n    heightOrType: any,\n    borderOrSource: any,\n    format?: any,\n    type?: any,\n    pixels?: any,\n  ) {\n    const { gl } = this;\n    if (format) {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        widthOrFormat,\n        heightOrType,\n        borderOrSource,\n        format,\n        type,\n        pixels,\n      );\n    } else {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        level,\n        internalFormat,\n        widthOrFormat,\n        heightOrType,\n        borderOrSource,\n      );\n    }\n  }\n  /**\n   * ```\n   * gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, data);\n   * ```\n   *\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n   */\n\n  compressedTexImage2D(\n    level: GLint,\n    internalformat: GLenum,\n    width: GLsizei,\n    height: GLsizei,\n    border: GLint,\n    data?: ArrayBufferView,\n  ): void {\n    const { gl } = this;\n    gl.compressedTexImage2D(\n      gl.TEXTURE_2D,\n      level,\n      internalformat,\n      width,\n      height,\n      border,\n      data as ArrayBufferView,\n    );\n  }\n  /**\n   * ```\n   * gl.pixelStorei(pname, param);\n   * ```\n   *\n   * @param pname\n   * @param param\n   */\n  pixelStorei(pname: GLenum, param: GLint | GLboolean) {\n    const { gl } = this;\n    gl.pixelStorei(pname, param);\n  }\n\n  /**\n   * ```\n   * gl.generateMipmap(gl.TEXTURE_2D);\n   * ```\n   *\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`\n   */\n  generateMipmap() {\n    const { gl } = this;\n    gl.generateMipmap(gl.TEXTURE_2D);\n  }\n\n  /**\n   * ```\n   * gl.createTexture();\n   * ```\n   *\n   * @returns\n   */\n  createTexture() {\n    const { gl } = this;\n    return gl.createTexture();\n  }\n\n  /**\n   * ```\n   * gl.deleteTexture(texture);\n   * ```\n   *\n   * @param texture\n   */\n  deleteTexture(texture: WebGLTexture | null) {\n    const { gl } = this;\n    if (texture) {\n      this.texture2dParams.delete(texture);\n    }\n    gl.deleteTexture(texture);\n  }\n\n  /**\n   * ```\n   * gl.deleteFramebuffer(framebuffer);\n   *\n   * @param framebuffer\n   */\n  deleteFramebuffer(framebuffer: WebGLFramebuffer | null) {\n    this.gl.deleteFramebuffer(framebuffer);\n  }\n\n  /**\n   * ```\n   * gl.viewport(x, y, width, height);\n   * ```\n   */\n  viewport(x: GLint, y: GLint, width: GLsizei, height: GLsizei) {\n    const { gl } = this;\n    gl.viewport(x, y, width, height);\n  }\n\n  /**\n   * ```\n   * gl.clearColor(red, green, blue, alpha);\n   * ```\n   *\n   * @param red\n   * @param green\n   * @param blue\n   * @param alpha\n   */\n  clearColor(red: GLclampf, green: GLclampf, blue: GLclampf, alpha: GLclampf) {\n    const { gl } = this;\n    gl.clearColor(red, green, blue, alpha);\n  }\n\n  /**\n   * ```\n   * gl[\"enable\"|\"disable\"](gl.SCISSOR_TEST);\n   * ```\n   * @param enable\n   */\n  setScissorTest(enable: boolean) {\n    const { gl, scissorEnabled } = this;\n    if (enable === scissorEnabled) {\n      return;\n    }\n    if (enable) {\n      gl.enable(gl.SCISSOR_TEST);\n    } else {\n      gl.disable(gl.SCISSOR_TEST);\n    }\n    this.scissorEnabled = enable;\n  }\n\n  /**\n   * ```\n   * gl.scissor(x, y, width, height);\n   * ```\n   *\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  scissor(x: GLint, y: GLint, width: GLsizei, height: GLsizei) {\n    const { gl, scissorX, scissorY, scissorWidth, scissorHeight } = this;\n    if (\n      x !== scissorX ||\n      y !== scissorY ||\n      width !== scissorWidth ||\n      height !== scissorHeight\n    ) {\n      gl.scissor(x, y, width, height);\n      this.scissorX = x;\n      this.scissorY = y;\n      this.scissorWidth = width;\n      this.scissorHeight = height;\n    }\n  }\n\n  /**\n   * ```\n   * gl[\"enable\"|\"disable\"](gl.BLEND);\n   * ```\n   *\n   * @param blend\n   * @returns\n   */\n  setBlend(blend: boolean) {\n    const { gl, blendEnabled } = this;\n    if (blend === blendEnabled) {\n      return;\n    }\n    if (blend) {\n      gl.enable(gl.BLEND);\n    } else {\n      gl.disable(gl.BLEND);\n    }\n    this.blendEnabled = blend;\n  }\n\n  /**\n   * ```\n   * gl.blendFunc(src, dst);\n   * ```\n   *\n   * @param src\n   * @param dst\n   */\n  blendFunc(src: GLenum, dst: GLenum) {\n    const { gl, blendSrcRgb, blendDstRgb, blendSrcAlpha, blendDstAlpha } = this;\n    if (\n      src !== blendSrcRgb ||\n      dst !== blendDstRgb ||\n      src !== blendSrcAlpha ||\n      dst !== blendDstAlpha\n    ) {\n      gl.blendFunc(src, dst);\n      this.blendSrcRgb = src;\n      this.blendDstRgb = dst;\n      this.blendSrcAlpha = src;\n      this.blendDstAlpha = dst;\n    }\n  }\n\n  /**\n   * ```\n   * gl.createBuffer();\n   * ```\n   *\n   * @returns\n   */\n  createBuffer() {\n    const { gl } = this;\n    return gl.createBuffer();\n  }\n\n  /**\n   * ```\n   * gl.createFramebuffer();\n   * ```\n   * @returns\n   */\n  createFramebuffer() {\n    const { gl } = this;\n    return gl.createFramebuffer();\n  }\n\n  /**\n   * ```\n   * gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n   * ```\n   *\n   * @param framebuffer\n   */\n  bindFramebuffer(framebuffer: WebGLFramebuffer | null) {\n    const { gl } = this;\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  }\n\n  /**\n   * ```\n   * gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n   * ```\n   * @remarks\n   * **WebGL Difference**: Bind target is always `gl.FRAMEBUFFER` and textarget is always `gl.TEXTURE_2D`\n   */\n\n  framebufferTexture2D(\n    attachment: GLenum,\n    texture: WebGLTexture | null,\n    level: GLint,\n  ) {\n    const { gl } = this;\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      attachment,\n      gl.TEXTURE_2D,\n      texture,\n      level,\n    );\n  }\n\n  /**\n   * ```\n   * gl.clear(gl.COLOR_BUFFER_BIT);\n   * ```\n   *\n   * @remarks\n   * **WebGL Difference**: Clear mask is always `gl.COLOR_BUFFER_BIT`\n   */\n  clear() {\n    const { gl } = this;\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  }\n\n  /**\n   * ```\n   * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n   * gl.bufferData(gl.ARRAY_BUFFER, data, usage);\n   * ```\n   *\n   * @remarks\n   * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.\n   *\n   * @param buffer\n   * @param data\n   * @param usage\n   */\n  arrayBufferData(\n    buffer: WebGLBuffer | null,\n    data: ArrayBufferView,\n    usage: GLenum,\n  ) {\n    const { gl, boundArrayBuffer } = this;\n    if (boundArrayBuffer !== buffer) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      this.boundArrayBuffer = buffer;\n    }\n    gl.bufferData(gl.ARRAY_BUFFER, data, usage);\n  }\n\n  /**\n   * ```\n   * gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n   * gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);\n   * ```\n   * @remarks\n   * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.\n   *\n   * @param buffer\n   * @param data\n   * @param usage\n   */\n  elementArrayBufferData(\n    buffer: WebGLBuffer | null,\n    data: ArrayBufferView,\n    usage: GLenum,\n  ) {\n    const { gl, boundElementArrayBuffer } = this;\n    if (boundElementArrayBuffer !== buffer) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n      this.boundElementArrayBuffer = buffer;\n    }\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);\n  }\n\n  /**\n   * ```\n   * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n   * gl.vertexAttribPointer(index, size, type, normalized, stride, offset);\n   * ```\n   *\n   * @remarks\n   * **WebGL Combo**: `gl.bindBuffer` and `gl.vertexAttribPointer` are combined into one function.\n   *\n   * @param buffer\n   * @param index\n   * @param size\n   * @param type\n   * @param normalized\n   * @param stride\n   * @param offset\n   */\n  vertexAttribPointer(\n    buffer: WebGLBuffer,\n    index: GLuint,\n    size: GLint,\n    type: GLenum,\n    normalized: GLboolean,\n    stride: GLsizei,\n    offset: GLintptr,\n  ) {\n    const { gl, boundArrayBuffer } = this;\n    if (boundArrayBuffer !== buffer) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      this.boundArrayBuffer = buffer;\n    }\n    gl.vertexAttribPointer(index, size, type, normalized, stride, offset);\n  }\n\n  /**\n   * Returns object with Attribute names as key and numbers as location values\n   *\n   * @param program\n   * @returns object with numbers\n   */\n  getUniformLocations(\n    program: WebGLProgram,\n  ): Record<string, WebGLUniformLocation> {\n    const gl = this.gl;\n    const length = gl.getProgramParameter(\n      program,\n      gl.ACTIVE_UNIFORMS,\n    ) as number;\n    const result = {} as Record<string, WebGLUniformLocation>;\n    for (let i = 0; i < length; i++) {\n      const info = gl.getActiveUniform(program, i) as WebGLActiveInfo;\n      //remove bracket + value from uniform name;\n      let name = info.name.replace(/\\[.*?\\]/g, '');\n      result[name] = gl.getUniformLocation(\n        program,\n        name,\n      ) as WebGLUniformLocation;\n    }\n    return result;\n  }\n\n  /**\n   * Returns object with Attribute names as key and numbers as location values\n   * @param program\n   * @returns object with numbers\n   */\n  getAttributeLocations(program: WebGLProgram): string[] {\n    const gl = this.gl;\n    const length = gl.getProgramParameter(\n      program,\n      gl.ACTIVE_ATTRIBUTES,\n    ) as number;\n\n    const result: string[] = [];\n    for (let i = 0; i < length; i++) {\n      const { name } = gl.getActiveAttrib(program, i) as WebGLActiveInfo;\n      result[gl.getAttribLocation(program, name)] = name;\n    }\n    return result;\n  }\n\n  /**\n   * ```\n   * gl.useProgram(program);\n   * ```\n   *\n   * @param program\n   * @returns\n   */\n  useProgram(program: WebGLProgram | null) {\n    const { gl, curProgram } = this;\n    if (curProgram === program) {\n      return;\n    }\n    gl.useProgram(program);\n    this.curProgram = program;\n  }\n\n  /**\n   * Sets the value of a single float uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The value to set.\n   */\n  uniform1f(location: WebGLUniformLocation | null, v0: number) {\n    const { gl } = this;\n    gl.uniform1f(location, v0);\n  }\n\n  /**\n   * Sets the value of a float array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of values to set.\n   */\n  uniform1fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform1fv(location, value);\n  }\n\n  /**\n   * Sets the value of a single integer uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The value to set.\n   */\n  uniform1i(location: WebGLUniformLocation | null, v0: number) {\n    const { gl } = this;\n    gl.uniform1i(location, v0);\n  }\n\n  /**\n   * Sets the value of an integer array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of values to set.\n   */\n  uniform1iv(\n    location: WebGLUniformLocation | null,\n    value: Int32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform1iv(location, value);\n  }\n\n  /**\n   * Sets the value of a vec2 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   */\n  uniform2f(location: WebGLUniformLocation | null, v0: number, v1: number) {\n    const { gl } = this;\n    gl.uniform2f(location, v0, v1);\n  }\n\n  /**\n   * Sets the value of a vec2 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of vec2 values to set.\n   */\n  uniform2fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform2fv(location, value);\n  }\n\n  /**\n   * Sets the value of a ivec2 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   */\n  uniform2i(location: WebGLUniformLocation | null, v0: number, v1: number) {\n    const { gl } = this;\n    gl.uniform2i(location, v0, v1);\n  }\n\n  /**\n   * Sets the value of an ivec2 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of ivec2 values to set.\n   */\n  uniform2iv(\n    location: WebGLUniformLocation | null,\n    value: Int32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform2iv(location, value);\n  }\n\n  /**\n   * Sets the value of a vec3 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   * @param v2 - The third component of the vector.\n   */\n  uniform3f(\n    location: WebGLUniformLocation | null,\n    v0: number,\n    v1: number,\n    v2: number,\n  ) {\n    const { gl } = this;\n    gl.uniform3f(location, v0, v1, v2);\n  }\n\n  /**\n   * Sets the value of a vec3 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of vec3 values to set.\n   */\n  uniform3fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform3fv(location, value);\n  }\n\n  /**\n   * Sets the value of a ivec3 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   * @param v2 - The third component of the vector.\n   */\n  uniform3i(\n    location: WebGLUniformLocation | null,\n    v0: number,\n    v1: number,\n    v2: number,\n  ) {\n    const { gl } = this;\n    gl.uniform3i(location, v0, v1, v2);\n  }\n\n  /**\n   * Sets the value of an ivec3 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of ivec3 values to set.\n   */\n  uniform3iv(\n    location: WebGLUniformLocation | null,\n    value: Int32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform3iv(location, value);\n  }\n\n  /**\n   * Sets the value of a vec4 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   * @param v2 - The third component of the vector.\n   * @param v3 - The fourth component of the vector.\n   */\n  uniform4f(\n    location: WebGLUniformLocation | null,\n    v0: number,\n    v1: number,\n    v2: number,\n    v3: number,\n  ) {\n    const { gl } = this;\n    gl.uniform4f(location, v0, v1, v2, v3);\n  }\n\n  /**\n   * Sets the value of a vec4 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of vec4 values to set.\n   */\n  uniform4fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform4fv(location, value);\n  }\n\n  /**\n   * Sets the value of a ivec4 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param v0 - The first component of the vector.\n   * @param v1 - The second component of the vector.\n   * @param v2 - The third component of the vector.\n   * @param v3 - The fourth component of the vector.\n   */\n  uniform4i(\n    location: WebGLUniformLocation | null,\n    v0: number,\n    v1: number,\n    v2: number,\n    v3: number,\n  ) {\n    const { gl } = this;\n    gl.uniform4i(location, v0, v1, v2, v3);\n  }\n\n  /**\n   * Sets the value of an ivec4 array uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param value - The array of ivec4 values to set.\n   */\n  uniform4iv(\n    location: WebGLUniformLocation | null,\n    value: Int32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniform4iv(location, value);\n  }\n\n  /**\n   * Sets the value of a mat2 uniform variable.\n   *\n   * @param location - The location of the uniform variable.\n   * @param transpose - Whether to transpose the matrix.\n   * @param value - The array of mat2 values to set.\n   */\n  uniformMatrix2fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniformMatrix2fv(location, false, value);\n  }\n\n  /**\n   * Sets the value of a mat2 uniform variable.\n   * @param location - The location of the uniform variable.\n   * @param value - The array of mat2 values to set.\n   */\n  uniformMatrix3fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniformMatrix3fv(location, false, value);\n  }\n\n  /**\n   * Sets the value of a mat4 uniform variable.\n   * @param location - The location of the uniform variable.\n   * @param value - The array of mat4 values to set.\n   */\n  uniformMatrix4fv(\n    location: WebGLUniformLocation | null,\n    value: Float32Array | number[],\n  ) {\n    const { gl } = this;\n    gl.uniformMatrix4fv(location, false, value);\n  }\n\n  /**\n   * ```\n   * gl.getParameter(pname);\n   * ```\n   *\n   * @param pname\n   * @returns\n   */\n  getParameter(pname: GLenum): any {\n    const { gl } = this;\n    return gl.getParameter(pname);\n  }\n\n  /**\n   * ```\n   * gl.drawElements(mode, count, type, offset);\n   * ```\n   *\n   * @param mode\n   * @param count\n   * @param type\n   * @param offset\n   */\n  drawElements(mode: GLenum, count: GLsizei, type: GLenum, offset: GLintptr) {\n    const { gl } = this;\n    gl.drawElements(mode, count, type, offset);\n  }\n\n  /**\n   * ```\n   * gl.drawArrays(mode, first, count);\n   * ```\n   *\n   * @param name\n   * @returns\n   */\n  getExtension(name: string) {\n    const { gl } = this;\n    return gl.getExtension(name);\n  }\n\n  /**\n   * ```\n   * gl.getError(type);\n   * ```\n   *\n   * @returns\n   */\n  getError() {\n    const { gl } = this;\n    return gl.getError();\n  }\n\n  /**\n   * ```\n   * gl.createVertexArray();\n   * ```\n   *\n   * @returns\n   */\n  createVertexArray() {\n    const { gl } = this;\n    assertTruthy(gl instanceof WebGL2RenderingContext);\n    return gl.createVertexArray();\n  }\n\n  /**\n   * ```\n   * gl.bindVertexArray(vertexArray);\n   * ```\n   *\n   * @param vertexArray\n   */\n  bindVertexArray(vertexArray: WebGLVertexArrayObject | null) {\n    const { gl } = this;\n    assertTruthy(gl instanceof WebGL2RenderingContext);\n    gl.bindVertexArray(vertexArray);\n  }\n\n  /**\n   * ```\n   * gl.getAttribLocation(program, name);\n   * ```\n   *\n   * @param program\n   * @param name\n   * @returns\n   */\n  getAttribLocation(program: WebGLProgram, name: string) {\n    const { gl } = this;\n    return gl.getAttribLocation(program, name);\n  }\n\n  /**\n   * ```\n   * gl.getUniformLocation(program, name);\n   * ```\n   *\n   * @param program\n   * @param name\n   * @returns\n   */\n  getUniformLocation(program: WebGLProgram, name: string) {\n    const { gl } = this;\n    return gl.getUniformLocation(program, name);\n  }\n\n  /**\n   * ```\n   * gl.enableVertexAttribArray(index);\n   * ```\n   *\n   * @param index\n   */\n  enableVertexAttribArray(index: number) {\n    const { gl } = this;\n    gl.enableVertexAttribArray(index);\n  }\n\n  /**\n   * ```\n   * gl.disableVertexAttribArray(index);\n   * ```\n   *\n   * @param index\n   */\n  disableVertexAttribArray(index: number) {\n    const { gl } = this;\n    gl.disableVertexAttribArray(index);\n  }\n\n  /**\n   * ```\n   * gl.createShader(type);\n   * ```\n   *\n   * @param type\n   * @returns\n   */\n  createShader(type: number) {\n    const { gl } = this;\n    return gl.createShader(type);\n  }\n\n  /**\n   * ```\n   * gl.compileShader(shader);\n   * ```\n   *\n   * @param shader\n   * @returns\n   */\n  compileShader(shader: WebGLShader) {\n    const { gl } = this;\n    gl.compileShader(shader);\n  }\n\n  /**\n   * ```\n   * gl.attachShader(program, shader);\n   * ```\n   *\n   * @param program\n   * @param shader\n   */\n  attachShader(program: WebGLProgram, shader: WebGLShader) {\n    const { gl } = this;\n    gl.attachShader(program, shader);\n  }\n\n  /**\n   * ```\n   * gl.linkProgram(program);\n   * ```\n   *\n   * @param program\n   */\n  linkProgram(program: WebGLProgram) {\n    const { gl } = this;\n    gl.linkProgram(program);\n  }\n\n  /**\n   * ```\n   * gl.deleteProgram(shader);\n   * ```\n   *\n   * @param shader\n   */\n  deleteProgram(shader: WebGLProgram) {\n    const { gl } = this;\n    gl.deleteProgram(shader);\n  }\n\n  /**\n   * ```\n   * gl.getShaderParameter(shader, pname);\n   * ```\n   *\n   * @param shader\n   * @param pname\n   */\n  getShaderParameter(shader: WebGLShader, pname: GLenum) {\n    const { gl } = this;\n    return gl.getShaderParameter(shader, pname);\n  }\n\n  /**\n   * ```\n   * gl.getShaderInfoLog(shader);\n   * ```\n   *\n   * @param shader\n   */\n  getShaderInfoLog(shader: WebGLShader) {\n    const { gl } = this;\n    return gl.getShaderInfoLog(shader);\n  }\n\n  /**\n   * ```\n   * gl.createProgram();\n   * ```\n   *\n   * @returns\n   */\n  createProgram() {\n    const { gl } = this;\n    return gl.createProgram();\n  }\n\n  /**\n   * ```\n   * gl.getProgramParameter(program, pname);\n   * ```\n   *\n   * @param program\n   * @param pname\n   * @returns\n   */\n  getProgramParameter(program: WebGLProgram, pname: GLenum) {\n    const { gl } = this;\n    return gl.getProgramParameter(program, pname);\n  }\n\n  /**\n   * ```\n   * gl.getProgramInfoLog(program);\n   * ```\n   *\n   * @param program\n   * @returns\n   */\n  getProgramInfoLog(program: WebGLProgram) {\n    const { gl } = this;\n    return gl.getProgramInfoLog(program);\n  }\n\n  /**\n   * ```\n   * gl.shaderSource(shader, source);\n   * ```\n   *\n   * @param shader\n   * @param source\n   */\n  shaderSource(shader: WebGLShader, source: string) {\n    const { gl } = this;\n    gl.shaderSource(shader, source);\n  }\n\n  /**\n   * ```\n   * gl.deleteShader(shader);\n   * ```\n   *\n   * @param shader\n   */\n  deleteShader(shader: WebGLShader) {\n    const { gl } = this;\n    gl.deleteShader(shader);\n  }\n\n  /**\n   * Check for WebGL errors and return error information\n   * @param operation Description of the operation for error reporting\n   * @returns Object with error information or null if no error\n   */\n  checkError(\n    operation: string,\n  ): { error: number; errorName: string; message: string } | null {\n    const error = this.getError();\n    if (error !== 0) {\n      // 0 is GL_NO_ERROR\n      let errorName = 'UNKNOWN_ERROR';\n      switch (error) {\n        case this.INVALID_ENUM:\n          errorName = 'INVALID_ENUM';\n          break;\n        case 0x0501: // GL_INVALID_VALUE\n          errorName = 'INVALID_VALUE';\n          break;\n        case this.INVALID_OPERATION:\n          errorName = 'INVALID_OPERATION';\n          break;\n        case 0x0505: // GL_OUT_OF_MEMORY\n          errorName = 'OUT_OF_MEMORY';\n          break;\n        case 0x9242: // GL_CONTEXT_LOST_WEBGL\n          errorName = 'CONTEXT_LOST_WEBGL';\n          break;\n      }\n\n      const message = `WebGL ${errorName} (0x${error.toString(\n        16,\n      )}) during ${operation}`;\n      return { error, errorName, message };\n    }\n    return null;\n  }\n}\n\n// prettier-ignore\ntype IsUniformMethod<MethodName, MethodType> = MethodName extends `uniform${string}`\n  ?\n  MethodType extends (location: WebGLUniformLocation | null, ...args: any[]) => void\n  ? true\n  : false\n  : false;\n\n// prettier-ignore\nexport type UniformMethodMap = {\n  [Key in keyof WebGLRenderingContext as IsUniformMethod<Key, WebGLRenderingContext[Key]> extends true ? Key : never]: WebGLRenderingContext[Key] extends (\n    location: WebGLUniformLocation | null,\n    ...args: infer T\n  ) => void\n  ? T\n  : never;\n};\n\n/**\n * Compare two arrays for equality.\n *\n * @remarks\n * This function will not try to compare nested arrays or Float32Arrays and\n * instead will always return false when they are encountered.\n *\n * @param a\n * @param b\n * @returns\n */\nexport function compareArrays<T>(a: T[], b: T[]): boolean {\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  let result = false;\n  for (let i = 0; i < a.length; i++) {\n    if (Array.isArray(a[i]) || a[i] instanceof Float32Array) {\n      result = false;\n      break;\n    }\n\n    if (a[i] !== b[i]) {\n      result = false;\n      break;\n    }\n\n    result = true;\n  }\n\n  return result;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { assertTruthy } from '../../../utils.js';\nimport type { TextureMemoryManager } from '../../TextureMemoryManager.js';\nimport type { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport type { RenderTexture } from '../../textures/RenderTexture.js';\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\n\nexport class WebGlCoreCtxRenderTexture extends WebGlCoreCtxTexture {\n  declare textureSource: RenderTexture;\n\n  public framebuffer: WebGLFramebuffer | null = null;\n\n  constructor(\n    glw: WebGlContextWrapper,\n    memManager: TextureMemoryManager,\n    textureSource: RenderTexture,\n  ) {\n    super(glw, memManager, textureSource);\n  }\n\n  override async onLoadRequest(): Promise<Dimensions> {\n    const { glw } = this;\n    const nativeTexture = (this._nativeCtxTexture =\n      this.createNativeCtxTexture());\n\n    if (!nativeTexture) {\n      throw new Error('Failed to create native texture for RenderTexture');\n    }\n\n    const { width, height } = this.textureSource;\n\n    // Create Framebuffer object\n    this.framebuffer = glw.createFramebuffer();\n\n    // Set the dimensions of the render texture\n    glw.texImage2D(\n      0,\n      glw.RGBA,\n      width,\n      height,\n      0,\n      glw.RGBA,\n      glw.UNSIGNED_BYTE,\n      null,\n    );\n\n    // Update the texture memory manager\n    this.setTextureMemUse(width * height * 4);\n\n    // Bind the framebuffer\n    glw.bindFramebuffer(this.framebuffer);\n\n    // Attach the texture to the framebuffer\n    glw.framebufferTexture2D(glw.COLOR_ATTACHMENT0, nativeTexture, 0);\n\n    // Unbind the framebuffer\n    glw.bindFramebuffer(null);\n\n    return {\n      width,\n      height,\n    };\n  }\n\n  override free(): void {\n    super.free();\n\n    // Delete the framebuffer\n    this.glw.deleteFramebuffer(this.framebuffer);\n    this.framebuffer = null;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assertTruthy, createWebGLContext, hasOwn } from '../../../utils.js';\nimport {\n  CoreRenderer,\n  type BufferInfo,\n  type CoreRendererOptions,\n  type QuadOptions,\n} from '../CoreRenderer.js';\nimport { WebGlCoreRenderOp } from './WebGlCoreRenderOp.js';\nimport type { CoreContextTexture } from '../CoreContextTexture.js';\nimport {\n  createIndexBuffer,\n  type CoreWebGlParameters,\n  type CoreWebGlExtensions,\n  getWebGlParameters,\n  getWebGlExtensions,\n  type WebGlColor,\n} from './internal/RendererUtils.js';\nimport { WebGlCoreCtxTexture } from './WebGlCoreCtxTexture.js';\nimport { Texture, TextureType } from '../../textures/Texture.js';\nimport { SubTexture } from '../../textures/SubTexture.js';\nimport { WebGlCoreCtxSubTexture } from './WebGlCoreCtxSubTexture.js';\nimport { CoreShaderManager } from '../../CoreShaderManager.js';\nimport { BufferCollection } from './internal/BufferCollection.js';\nimport {\n  compareRect,\n  getNormalizedRgbaComponents,\n  type RectWithValid,\n} from '../../lib/utils.js';\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { WebGlCoreShader } from './WebGlCoreShader.js';\nimport { WebGlContextWrapper } from '../../lib/WebGlContextWrapper.js';\nimport { RenderTexture } from '../../textures/RenderTexture.js';\nimport { CoreNodeRenderState, type CoreNode } from '../../CoreNode.js';\nimport { WebGlCoreCtxRenderTexture } from './WebGlCoreCtxRenderTexture.js';\nimport type { BaseShaderController } from '../../../main-api/ShaderController.js';\n\nconst WORDS_PER_QUAD = 24;\n// const BYTES_PER_QUAD = WORDS_PER_QUAD * 4;\n\nexport type WebGlCoreRendererOptions = CoreRendererOptions;\n\ninterface CoreWebGlSystem {\n  parameters: CoreWebGlParameters;\n  extensions: CoreWebGlExtensions;\n}\n\nexport class WebGlCoreRenderer extends CoreRenderer {\n  //// WebGL Native Context and Data\n  glw: WebGlContextWrapper;\n  system: CoreWebGlSystem;\n\n  //// Persistent data\n  quadBuffer: ArrayBuffer;\n  fQuadBuffer: Float32Array;\n  uiQuadBuffer: Uint32Array;\n  renderOps: WebGlCoreRenderOp[] = [];\n\n  //// Render Op / Buffer Filling State\n  curBufferIdx = 0;\n  curRenderOp: WebGlCoreRenderOp | null = null;\n  override rttNodes: CoreNode[] = [];\n  activeRttNode: CoreNode | null = null;\n\n  //// Default Shader\n  defShaderCtrl: BaseShaderController;\n  defaultShader: WebGlCoreShader;\n  quadBufferCollection: BufferCollection;\n\n  clearColor: WebGlColor = {\n    raw: 0x00000000,\n    normalized: [0, 0, 0, 0],\n  };\n\n  /**\n   * White pixel texture used by default when no texture is specified.\n   */\n\n  quadBufferUsage = 0;\n  numQuadsRendered = 0;\n  /**\n   * Whether the renderer is currently rendering to a texture.\n   */\n  public renderToTextureActive = false;\n\n  constructor(options: WebGlCoreRendererOptions) {\n    super(options);\n\n    this.quadBuffer = new ArrayBuffer(this.stage.options.quadBufferSize);\n    this.fQuadBuffer = new Float32Array(this.quadBuffer);\n    this.uiQuadBuffer = new Uint32Array(this.quadBuffer);\n\n    this.mode = 'webgl';\n\n    const { canvas, clearColor, bufferMemory } = options;\n\n    const gl = createWebGLContext(\n      canvas,\n      options.forceWebGL2,\n      options.contextSpy,\n    );\n    const glw = (this.glw = new WebGlContextWrapper(gl));\n    glw.viewport(0, 0, canvas.width, canvas.height);\n\n    this.updateClearColor(clearColor);\n\n    glw.setBlend(true);\n    glw.blendFunc(glw.ONE, glw.ONE_MINUS_SRC_ALPHA);\n\n    createIndexBuffer(glw, bufferMemory);\n\n    this.system = {\n      parameters: getWebGlParameters(this.glw),\n      extensions: getWebGlExtensions(this.glw),\n    };\n    this.shManager.renderer = this;\n    this.defShaderCtrl = this.shManager.loadShader('DefaultShader');\n    this.defaultShader = this.defShaderCtrl.shader as WebGlCoreShader;\n    const quadBuffer = glw.createBuffer();\n    assertTruthy(quadBuffer);\n    const stride = 8 * Float32Array.BYTES_PER_ELEMENT;\n    this.quadBufferCollection = new BufferCollection([\n      {\n        buffer: quadBuffer,\n        attributes: {\n          a_position: {\n            name: 'a_position',\n            size: 2, // 2 components per iteration\n            type: glw.FLOAT, // the data is 32bit floats\n            normalized: false, // don't normalize the data\n            stride, // 0 = move forward size * sizeof(type) each iteration to get the next position\n            offset: 0, // start at the beginning of the buffer\n          },\n          a_textureCoordinate: {\n            name: 'a_textureCoordinate',\n            size: 2,\n            type: glw.FLOAT,\n            normalized: false,\n            stride,\n            offset: 2 * Float32Array.BYTES_PER_ELEMENT,\n          },\n          a_color: {\n            name: 'a_color',\n            size: 4,\n            type: glw.UNSIGNED_BYTE,\n            normalized: true,\n            stride,\n            offset: 4 * Float32Array.BYTES_PER_ELEMENT,\n          },\n          a_textureIndex: {\n            name: 'a_textureIndex',\n            size: 1,\n            type: glw.FLOAT,\n            normalized: false,\n            stride,\n            offset: 5 * Float32Array.BYTES_PER_ELEMENT,\n          },\n          a_nodeCoordinate: {\n            name: 'a_nodeCoordinate',\n            size: 2,\n            type: glw.FLOAT,\n            normalized: false,\n            stride,\n            offset: 6 * Float32Array.BYTES_PER_ELEMENT,\n          },\n        },\n      },\n    ]);\n  }\n\n  reset() {\n    const { glw } = this;\n    this.curBufferIdx = 0;\n    this.curRenderOp = null;\n    this.renderOps.length = 0;\n    glw.setScissorTest(false);\n    glw.clear();\n  }\n\n  override getShaderManager(): CoreShaderManager {\n    return this.shManager;\n  }\n\n  override createCtxTexture(textureSource: Texture): CoreContextTexture {\n    if (textureSource instanceof SubTexture) {\n      return new WebGlCoreCtxSubTexture(\n        this.glw,\n        this.txMemManager,\n        textureSource,\n      );\n    } else if (textureSource instanceof RenderTexture) {\n      return new WebGlCoreCtxRenderTexture(\n        this.glw,\n        this.txMemManager,\n        textureSource,\n      );\n    }\n    return new WebGlCoreCtxTexture(this.glw, this.txMemManager, textureSource);\n  }\n\n  /**\n   * This function adds a quad (a rectangle composed of two triangles) to the WebGL rendering pipeline.\n   *\n   * It takes a set of options that define the quad's properties, such as its dimensions, colors, texture, shader, and transformation matrix.\n   * The function first updates the shader properties with the current dimensions if necessary, then sets the default texture if none is provided.\n   * It then checks if a new render operation is needed, based on the current shader and clipping rectangle.\n   * If a new render operation is needed, it creates one and updates the current render operation.\n   * The function then adjusts the texture coordinates based on the texture options and adds the texture to the texture manager.\n   *\n   * Finally, it calculates the vertices for the quad, taking into account any transformations, and adds them to the quad buffer.\n   * The function updates the length and number of quads in the current render operation, and updates the current buffer index.\n   */\n  addQuad(params: QuadOptions) {\n    const { fQuadBuffer, uiQuadBuffer } = this;\n    let texture = params.texture;\n\n    assertTruthy(texture !== null, 'Texture is required');\n\n    /**\n     * If the shader props contain any automatic properties, update it with the\n     * current dimensions and or alpha that will be used to render the quad.\n     */\n    if (params.shader !== this.defaultShader) {\n      if (hasOwn(params.shaderProps, '$dimensions') == true) {\n        const dimensions = params.shaderProps.$dimensions as Dimensions;\n        dimensions.width = params.width;\n        dimensions.height = params.height;\n      }\n\n      if (hasOwn(params.shaderProps, '$alpha') === true) {\n        params.shaderProps.$alpha = params.alpha;\n      }\n    }\n\n    let { curBufferIdx: bufferIdx, curRenderOp } = this;\n    const targetDims = { width: params.width, height: params.height };\n\n    if (this.reuseRenderOp(params) === false) {\n      this.newRenderOp(\n        params.shader as WebGlCoreShader,\n        params.shaderProps as Record<string, unknown>,\n        params.alpha,\n        targetDims,\n        params.clippingRect,\n        bufferIdx,\n        params.rtt,\n        params.parentHasRenderTexture,\n        params.framebufferDimensions,\n      );\n      curRenderOp = this.curRenderOp;\n      assertTruthy(curRenderOp);\n    }\n\n    let ctxTexture = undefined;\n\n    let texCoordX1 = 0;\n    let texCoordY1 = 0;\n    let texCoordX2 = 1;\n    let texCoordY2 = 1;\n\n    if (texture.type === TextureType.subTexture) {\n      const {\n        x: tx,\n        y: ty,\n        width: tw,\n        height: th,\n      } = (texture as SubTexture).props;\n      const { width: parentW = 0, height: parentH = 0 } = (\n        texture as SubTexture\n      ).parentTexture.dimensions || { width: 0, height: 0 };\n      texCoordX1 = tx / parentW;\n      texCoordX2 = texCoordX1 + tw / parentW;\n      texCoordY1 = ty / parentH;\n      texCoordY2 = texCoordY1 + th / parentH;\n      texture = (texture as SubTexture).parentTexture;\n      ctxTexture = texture.ctxTexture as WebGlCoreCtxTexture;\n    } else {\n      ctxTexture = texture.ctxTexture as WebGlCoreCtxTexture;\n      if (ctxTexture === undefined) {\n        ctxTexture = this.stage.defaultTexture?.ctxTexture as WebGlCoreCtxTexture;\n        console.warn(\n          'WebGL Renderer: Texture does not have a ctxTexture, using default texture instead',\n        );\n      }\n      texCoordX1 = ctxTexture.txCoordX1;\n      texCoordY1 = ctxTexture.txCoordY1;\n      texCoordX2 = ctxTexture.txCoordX2;\n      texCoordY2 = ctxTexture.txCoordY2;\n    }\n\n    if (\n      texture.type === TextureType.image &&\n      params.textureOptions !== null &&\n      params.textureOptions.resizeMode !== undefined &&\n      texture.dimensions !== null\n    ) {\n      const resizeMode = params.textureOptions.resizeMode;\n      const { width: tw, height: th } = texture.dimensions;\n      if (resizeMode.type === 'cover') {\n        const scaleX = params.width / tw;\n        const scaleY = params.height / th;\n        const scale = Math.max(scaleX, scaleY);\n        const precision = 1 / scale;\n        // Determine based on width\n        if (scale && scaleX && scaleX < scale) {\n          const desiredSize = precision * params.width;\n          texCoordX1 = (1 - desiredSize / tw) * (resizeMode.clipX ?? 0.5);\n          texCoordX2 = texCoordX1 + desiredSize / tw;\n        }\n        // Determine based on height\n        if (scale && scaleY && scaleY < scale) {\n          const desiredSize = precision * params.height;\n          texCoordY1 = (1 - desiredSize / th) * (resizeMode.clipY ?? 0.5);\n          texCoordY2 = texCoordY1 + desiredSize / th;\n        }\n      }\n    }\n\n    // Flip texture coordinates if dictated by texture options\n    let flipY = 0;\n    if (params.textureOptions !== null) {\n      if (params.textureOptions.flipX === true) {\n        [texCoordX1, texCoordX2] = [texCoordX2, texCoordX1];\n      }\n\n      // convert to integer for bitwise operation below\n      flipY = +(params.textureOptions.flipY || false);\n    }\n\n    // Eitherone should be true\n    if (flipY ^ +(texture.type === TextureType.renderToTexture)) {\n      [texCoordY1, texCoordY2] = [texCoordY2, texCoordY1];\n    }\n\n    const textureIdx = this.addTexture(ctxTexture, bufferIdx);\n\n    assertTruthy(this.curRenderOp !== null);\n    if (params.renderCoords) {\n      // Upper-Left\n      fQuadBuffer[bufferIdx++] = params.renderCoords.x1; // vertexX\n      fQuadBuffer[bufferIdx++] = params.renderCoords.y1; // vertexY\n      fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n      fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n      uiQuadBuffer[bufferIdx++] = params.colorTl; // color\n      fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Upper-Right\n      fQuadBuffer[bufferIdx++] = params.renderCoords.x2;\n      fQuadBuffer[bufferIdx++] = params.renderCoords.y2;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY1;\n      uiQuadBuffer[bufferIdx++] = params.colorTr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Lower-Left\n      fQuadBuffer[bufferIdx++] = params.renderCoords.x4;\n      fQuadBuffer[bufferIdx++] = params.renderCoords.y4;\n      fQuadBuffer[bufferIdx++] = texCoordX1;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBl;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 1;\n\n      // Lower-Right\n      fQuadBuffer[bufferIdx++] = params.renderCoords.x3;\n      fQuadBuffer[bufferIdx++] = params.renderCoords.y3;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 1;\n    } else if (params.tb !== 0 || params.tc !== 0) {\n      // Upper-Left\n      fQuadBuffer[bufferIdx++] = params.tx; // vertexX\n      fQuadBuffer[bufferIdx++] = params.ty; // vertexY\n      fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n      fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n      uiQuadBuffer[bufferIdx++] = params.colorTl; // color\n      fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Upper-Right\n      fQuadBuffer[bufferIdx++] = params.tx + params.width * params.ta;\n      fQuadBuffer[bufferIdx++] = params.ty + params.width * params.tc;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY1;\n      uiQuadBuffer[bufferIdx++] = params.colorTr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Lower-Left\n      fQuadBuffer[bufferIdx++] = params.tx + params.height * params.tb;\n      fQuadBuffer[bufferIdx++] = params.ty + params.height * params.td;\n      fQuadBuffer[bufferIdx++] = texCoordX1;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBl;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 1;\n\n      // Lower-Right\n      fQuadBuffer[bufferIdx++] =\n        params.tx + params.width * params.ta + params.height * params.tb;\n      fQuadBuffer[bufferIdx++] =\n        params.ty + params.width * params.tc + params.height * params.td;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 1;\n    } else {\n      // Calculate the right corner of the quad\n      // multiplied by the scale\n      const rightCornerX = params.tx + params.width * params.ta;\n      const rightCornerY = params.ty + params.height * params.td;\n\n      // Upper-Left\n      fQuadBuffer[bufferIdx++] = params.tx; // vertexX\n      fQuadBuffer[bufferIdx++] = params.ty; // vertexY\n      fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX\n      fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY\n      uiQuadBuffer[bufferIdx++] = params.colorTl; // color\n      fQuadBuffer[bufferIdx++] = textureIdx; // texIndex\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Upper-Right\n      fQuadBuffer[bufferIdx++] = rightCornerX;\n      fQuadBuffer[bufferIdx++] = params.ty;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY1;\n      uiQuadBuffer[bufferIdx++] = params.colorTr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 0;\n\n      // Lower-Left\n      fQuadBuffer[bufferIdx++] = params.tx;\n      fQuadBuffer[bufferIdx++] = rightCornerY;\n      fQuadBuffer[bufferIdx++] = texCoordX1;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBl;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 0;\n      fQuadBuffer[bufferIdx++] = 1;\n\n      // Lower-Right\n      fQuadBuffer[bufferIdx++] = rightCornerX;\n      fQuadBuffer[bufferIdx++] = rightCornerY;\n      fQuadBuffer[bufferIdx++] = texCoordX2;\n      fQuadBuffer[bufferIdx++] = texCoordY2;\n      uiQuadBuffer[bufferIdx++] = params.colorBr;\n      fQuadBuffer[bufferIdx++] = textureIdx;\n      fQuadBuffer[bufferIdx++] = 1;\n      fQuadBuffer[bufferIdx++] = 1;\n    }\n    // Update the length of the current render op\n    this.curRenderOp.numQuads++;\n    this.curBufferIdx = bufferIdx;\n  }\n\n  /**\n   * Replace the existing RenderOp with a new one that uses the specified Shader\n   * and starts at the specified buffer index.\n   *\n   * @param shader\n   * @param bufferIdx\n   */\n  private newRenderOp(\n    shader: WebGlCoreShader,\n    shaderProps: Record<string, unknown>,\n    alpha: number,\n    dimensions: Dimensions,\n    clippingRect: RectWithValid,\n    bufferIdx: number,\n    renderToTexture?: boolean,\n    parentHasRenderTexture?: boolean,\n    framebufferDimensions?: Dimensions,\n  ) {\n    const curRenderOp = new WebGlCoreRenderOp(\n      this.glw,\n      this.options,\n      this.quadBufferCollection,\n      shader,\n      shaderProps,\n      alpha,\n      clippingRect,\n      dimensions,\n      bufferIdx,\n      0, // Z-Index is only used for explictly added Render Ops\n      renderToTexture,\n      parentHasRenderTexture,\n      framebufferDimensions,\n    );\n    this.curRenderOp = curRenderOp;\n    this.renderOps.push(curRenderOp);\n  }\n\n  /**\n   * Add a texture to the current RenderOp. If the texture cannot be added to the\n   * current RenderOp, a new RenderOp will be created and the texture will be added\n   * to that one.\n   *\n   * If the texture cannot be added to the new RenderOp, an error will be thrown.\n   *\n   * @param texture\n   * @param bufferIdx\n   * @param recursive\n   * @returns Assigned Texture Index of the texture in the render op\n   */\n  private addTexture(\n    texture: WebGlCoreCtxTexture,\n    bufferIdx: number,\n    recursive?: boolean,\n  ): number {\n    const { curRenderOp } = this;\n    assertTruthy(curRenderOp);\n    const textureIdx = curRenderOp.addTexture(texture);\n    // TODO: Refactor to be more DRY\n    if (textureIdx === 0xffffffff) {\n      if (recursive) {\n        throw new Error('Unable to add texture to render op');\n      }\n\n      this.newRenderOp(\n        curRenderOp.shader,\n        curRenderOp.shaderProps,\n        curRenderOp.alpha,\n        curRenderOp.dimensions,\n        curRenderOp.clippingRect,\n        bufferIdx,\n      );\n      return this.addTexture(texture, bufferIdx, true);\n    }\n    return textureIdx;\n  }\n\n  /**\n   * Test if the current Render operation can be reused for the specified parameters.\n   * @param params\n   * @returns\n   */\n  reuseRenderOp(params: QuadOptions): boolean {\n    const { shader, shaderProps, parentHasRenderTexture, rtt, clippingRect } =\n      params;\n\n    // Switching shader program will require a new render operation\n    if (this.curRenderOp?.shader !== shader) {\n      return false;\n    }\n\n    // Switching clipping rect will require a new render operation\n    if (compareRect(this.curRenderOp.clippingRect, clippingRect) === false) {\n      return false;\n    }\n\n    // Force new render operation if rendering to texture\n    // @todo: This needs to be improved, render operations could also be reused\n    // for rendering to texture\n    if (parentHasRenderTexture === true || rtt === true) {\n      return false;\n    }\n\n    // Check if the shader can batch the shader properties\n    if (\n      this.curRenderOp.shader !== this.defaultShader &&\n      this.curRenderOp.shader.canBatchShaderProps(\n        this.curRenderOp.shaderProps,\n        shaderProps,\n      ) === false\n    ) {\n      return false;\n    }\n\n    // Render operation can be reused\n    return true;\n  }\n\n  /**\n   * add RenderOp to the render pipeline\n   */\n  addRenderOp(renderable: WebGlCoreRenderOp) {\n    this.renderOps.push(renderable);\n    this.curRenderOp = null;\n  }\n\n  /**\n   * Render the current set of RenderOps to render to the specified surface.\n   *\n   * TODO: 'screen' is the only supported surface at the moment.\n   *\n   * @param surface\n   */\n  render(surface: 'screen' | CoreContextTexture = 'screen'): void {\n    const { glw, quadBuffer } = this;\n\n    const arr = new Float32Array(quadBuffer, 0, this.curBufferIdx);\n\n    const buffer = this.quadBufferCollection.getBuffer('a_position') || null;\n    glw.arrayBufferData(buffer, arr, glw.STATIC_DRAW);\n\n    for (let i = 0, length = this.renderOps.length; i < length; i++) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      this.renderOps[i]!.draw();\n    }\n    this.quadBufferUsage = this.curBufferIdx * arr.BYTES_PER_ELEMENT;\n\n    // Calculate the size of each quad in bytes (4 vertices per quad) times the size of each vertex in bytes\n    const QUAD_SIZE_IN_BYTES = 4 * (8 * arr.BYTES_PER_ELEMENT); // 8 attributes per vertex\n    this.numQuadsRendered = this.quadBufferUsage / QUAD_SIZE_IN_BYTES;\n  }\n\n  getQuadCount(): number {\n    return this.numQuadsRendered;\n  }\n\n  renderToTexture(node: CoreNode) {\n    for (let i = 0; i < this.rttNodes.length; i++) {\n      if (this.rttNodes[i] === node) {\n        return;\n      }\n    }\n\n    this.insertRTTNodeInOrder(node);\n  }\n\n  /**\n   * Inserts an RTT node into `this.rttNodes` while maintaining the correct rendering order based on hierarchy.\n   *\n   * Rendering order for RTT nodes is critical when nested RTT nodes exist in a parent-child relationship.\n   * Specifically:\n   *  - Child RTT nodes must be rendered before their RTT-enabled parents to ensure proper texture composition.\n   *  - If an RTT node is added and it has existing RTT children, it should be rendered after those children.\n   *\n   * This function addresses both cases by:\n   * 1. **Checking Upwards**: It traverses the node's hierarchy upwards to identify any RTT parent\n   *    already in `rttNodes`. If an RTT parent is found, the new node is placed before this parent.\n   * 2. **Checking Downwards**: It traverses the node’s children recursively to find any RTT-enabled\n   *    children that are already in `rttNodes`. If such children are found, the new node is inserted\n   *    after the last (highest index) RTT child node.\n   *\n   * The final calculated insertion index ensures the new node is positioned in `rttNodes` to respect\n   * both parent-before-child and child-before-parent rendering rules, preserving the correct order\n   * for the WebGL renderer.\n   *\n   * @param node - The RTT-enabled CoreNode to be added to `rttNodes` in the appropriate hierarchical position.\n   */\n  private insertRTTNodeInOrder(node: CoreNode) {\n    let insertIndex = this.rttNodes.length; // Default to the end of the array\n\n    // 1. Traverse upwards to ensure the node is placed before its RTT parent (if any).\n    let currentNode: CoreNode = node;\n    while (currentNode) {\n      if (!currentNode.parent) {\n        break;\n      }\n\n      const parentIndex = this.rttNodes.indexOf(currentNode.parent);\n      if (parentIndex !== -1) {\n        // Found an RTT parent in the list; set insertIndex to place node before the parent\n        insertIndex = parentIndex;\n        break;\n      }\n\n      currentNode = currentNode.parent;\n    }\n\n    // 2. Traverse downwards to ensure the node is placed after any RTT children.\n    // Look through each child recursively to see if any are already in rttNodes.\n    const maxChildIndex = this.findMaxChildRTTIndex(node);\n    if (maxChildIndex !== -1) {\n      // Adjust insertIndex to be after the last child RTT node\n      insertIndex = Math.max(insertIndex, maxChildIndex + 1);\n    }\n\n    // 3. Insert the node at the calculated position\n    this.rttNodes.splice(insertIndex, 0, node);\n  }\n\n  // Helper function to find the highest index of any RTT children of a node within rttNodes\n  private findMaxChildRTTIndex(node: CoreNode): number {\n    let maxIndex = -1;\n\n    const traverseChildren = (currentNode: CoreNode) => {\n      const currentIndex = this.rttNodes.indexOf(currentNode);\n      if (currentIndex !== -1) {\n        maxIndex = Math.max(maxIndex, currentIndex);\n      }\n\n      // Recursively check all children of the current node\n      for (const child of currentNode.children) {\n        traverseChildren(child);\n      }\n    };\n\n    // Start traversal directly with the provided node\n    traverseChildren(node);\n\n    return maxIndex;\n  }\n\n  renderRTTNodes() {\n    const { glw } = this;\n    const { txManager } = this.stage;\n\n    // Render all associated RTT nodes to their textures\n    for (let i = 0; i < this.rttNodes.length; i++) {\n      const node = this.rttNodes[i];\n\n      // Skip nodes that don't have RTT updates\n      if (node === undefined || node.hasRTTupdates === false) {\n        continue;\n      }\n\n      // Skip nodes that are not visible\n      if (\n        node.worldAlpha === 0 ||\n        (node.strictBounds === true &&\n          node.renderState === CoreNodeRenderState.OutOfBounds)\n      ) {\n        continue;\n      }\n\n      // Skip nodes that do not have a loaded texture\n      if (node.texture === null || node.texture.state !== 'loaded') {\n        continue;\n      }\n\n      // Set the active RTT node to the current node\n      // So we can prevent rendering children of nested RTT nodes\n      this.activeRttNode = node;\n\n      assertTruthy(node.texture, 'RTT node missing texture');\n      const ctxTexture = node.texture.ctxTexture;\n      assertTruthy(ctxTexture instanceof WebGlCoreCtxRenderTexture);\n      this.renderToTextureActive = true;\n\n      // Bind the the texture's framebuffer\n      glw.bindFramebuffer(ctxTexture.framebuffer);\n\n      glw.viewport(0, 0, ctxTexture.w, ctxTexture.h);\n      // Set the clear color to transparent\n      glw.clearColor(0, 0, 0, 0);\n      glw.clear();\n\n      // Render all associated quads to the texture\n      for (let i = 0; i < node.children.length; i++) {\n        const child = node.children[i];\n\n        if (child === undefined) {\n          continue;\n        }\n\n        this.stage.addQuads(child);\n        child.hasRTTupdates = false;\n      }\n\n      // Render all associated quads to the texture\n      this.render();\n\n      // Reset render operations\n      this.renderOps.length = 0;\n      node.hasRTTupdates = false;\n    }\n\n    const clearColor = this.clearColor.normalized;\n    // Restore the default clear color\n    glw.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);\n\n    // Bind the default framebuffer\n    glw.bindFramebuffer(null);\n\n    glw.viewport(0, 0, this.glw.canvas.width, this.glw.canvas.height);\n    this.renderToTextureActive = false;\n  }\n\n  removeRTTNode(node: CoreNode) {\n    const index = this.rttNodes.indexOf(node);\n    if (index === -1) {\n      return;\n    }\n    this.rttNodes.splice(index, 1);\n  }\n\n  getBufferInfo(): BufferInfo | null {\n    const bufferInfo: BufferInfo = {\n      totalAvailable: this.stage.options.quadBufferSize,\n      totalUsed: this.quadBufferUsage,\n    };\n    return bufferInfo;\n  }\n\n  override getDefShaderCtr(): BaseShaderController {\n    return this.defShaderCtrl;\n  }\n\n  /**\n   * Updates the WebGL context's clear color and clears the color buffer.\n   *\n   * @param color - The color to set as the clear color, represented as a 32-bit integer.\n   */\n  updateClearColor(color: number) {\n    if (this.clearColor.raw === color) {\n      return;\n    }\n    const glw = this.glw;\n    const normalizedColor = getNormalizedRgbaComponents(color);\n    glw.clearColor(\n      normalizedColor[0],\n      normalizedColor[1],\n      normalizedColor[2],\n      normalizedColor[3],\n    );\n    this.clearColor = {\n      raw: color,\n      normalized: normalizedColor,\n    };\n    glw.clear();\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const SpecialCodepoints = {\n  LINE_FEED: 0x0a,\n  CARRIAGE_RETURN: 0x0d,\n  SPACE: 0x20,\n  TAB: 0x09,\n  ZERO_WIDTH_SPACE: 0x200b,\n  ZERO_WIDTH_NON_JOINER: 0x200c,\n  ZERO_WIDTH_JOINER: 0x200d,\n  LEFT_TO_RIGHT_MARK: 0x200e,\n  RIGHT_TO_LEFT_MARK: 0x200f,\n  LEFT_TO_RIGHT_EMBEDDING: 0x202a,\n  RIGHT_TO_LEFT_EMBEDDING: 0x202b,\n  POP_DIRECTIONAL_FORMATTING: 0x202c,\n  LEFT_TO_RIGHT_OVERRIDE: 0x202d,\n  RIGHT_TO_LEFT_OVERRIDE: 0x202e,\n  LINE_SEPARATOR: 0x2028,\n  PARAGRAPH_SEPARATOR: 0x2029,\n  OBJECT_REPLACEMENT_CHARACTER: 0xfffc,\n  REPLACEMENT_CHARACTER: 0xfffd,\n  ZERO_WIDTH_NO_BREAK_SPACE: 0xfeff,\n  LEFT_TO_RIGHT_ISOLATE: 0x2066,\n  RIGHT_TO_LEFT_ISOLATE: 0x2067,\n  FIRST_STRONG_ISOLATE: 0x2068,\n  POP_DIRECTIONAL_ISOLATE: 0x2069,\n  INHIBIT_SYMMETRIC_SWAPPING: 0x206a,\n  ACTIVATE_SYMMETRIC_SWAPPING: 0x206b,\n  INHIBIT_ARABIC_FORM_SHAPING: 0x206c,\n  ACTIVATE_ARABIC_FORM_SHAPING: 0x206d,\n  NATIONAL_DIGIT_SHAPES: 0x206e,\n  NOMINAL_DIGIT_SHAPES: 0x206f,\n  LEFT_TO_RIGHT_BOUNDARY: 0x200e,\n  RIGHT_TO_LEFT_BOUNDARY: 0x200f,\n};\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { PeekableIterator } from '../../../renderers/SdfTextRenderer/internal/PeekableGenerator.js';\n\n/**\n * HarfBuzz compatible glyph position info\n */\nexport interface GlyphPosition {\n  /**\n   * how much the line advances after drawing this glyph when setting text in horizontal direction.\n   */\n  xAdvance: number;\n  /**\n   * how much the line advances after drawing this glyph when setting text in vertical direction.\n   */\n  yAdvance: number;\n  /**\n   * how much the glyph moves on the X-axis before drawing it, this should not affect how much the line advances.\n   */\n  xOffset: number;\n  /**\n   * how much the glyph moves on the Y-axis before drawing it, this should not affect how much the line advances.\n   */\n  yOffset: number;\n}\n\n/**\n * HarfBuzz compatible glyph info\n */\nexport interface GlyphInfo {\n  /**\n   * Glyph ID\n   */\n  glyphId: number;\n\n  /**\n   * First codepoint in the cluster this glyph was mapped from.\n   */\n  codepoint: number;\n\n  /**\n   * the index of the character in the original text that corresponds to this hb_glyph_info_t\n   * This is useful for mapping back from glyphs to characters.\n   */\n  cluster: number;\n}\n\n/**\n * HarfBuzz compatible glyph extents\n */\nexport interface GlyphExtents {\n  /**\n   * The X offset from the origin to the leftmost part of the glyph.\n   * This is negative for right-to-left scripts.\n   */\n  xBearing: number;\n\n  /**\n   * The Y offset from the origin to the topmost part of the glyph.\n   * This is negative for bottom-to-top scripts.\n   */\n  yBearing: number;\n\n  /**\n   * Distance from the top extremum of the glyph to the bottom extremum.\n   * This is always positive.\n   */\n  width: number;\n\n  /**\n   * Distance from the left extremum of the glyph to the right extremum.\n   * This is always positive.\n   */\n  height: number;\n}\n\nexport interface UnmappedCharacterInfo {\n  mapped: false;\n\n  /**\n   * The Unicode code point of the character.\n   */\n  codepoint: number;\n\n  /**\n   * The index of the character in the original text that corresponds to this hb_glyph_info_t\n   * This is useful for mapping back from glyphs to characters.\n   */\n  cluster: number;\n}\n\nexport type MappedGlyphInfo = { mapped: true } & GlyphInfo &\n  GlyphPosition &\n  GlyphExtents;\n\n/**\n * For performance reasons, all properties are required to reduce need for checking for undefined values.\n */\nexport interface FontShaperProps {\n  /**\n   * Letter spacing\n   *\n   * @default 0\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/letter-spacing\n   **/\n  letterSpacing: number;\n}\n\nexport abstract class FontShaper {\n  /**\n   * Returns the glyph IDs of the next\n   *\n   * @remarks\n   * If this returns undefined, a glyph for the next codepoint(s) could not be found.\n   *\n   * @param codepoints\n   */\n  abstract shapeText(\n    props: FontShaperProps,\n    codepoints: PeekableIterator<number>,\n  ): Generator<MappedGlyphInfo | UnmappedCharacterInfo, void>;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { PeekableIterator } from '../../../renderers/SdfTextRenderer/internal/PeekableGenerator.js';\nimport { SpecialCodepoints } from '../../../renderers/SdfTextRenderer/internal/SpecialCodepoints.js';\nimport type { FontMetrics } from '../../TrFontFace.js';\nimport {\n  FontShaper,\n  type FontShaperProps,\n  type MappedGlyphInfo,\n  type UnmappedCharacterInfo,\n} from './FontShaper.js';\n\n/**\n * Fast look up table for kernings\n */\ntype KerningTable = Record<\n  number,\n  Record<number, number | undefined> | undefined\n>;\n\nexport class SdfFontShaper extends FontShaper {\n  private readonly data: SdfFontData;\n  private readonly glyphMap: Map<number, SdfFontData['chars'][0]>;\n  private readonly kernings: KerningTable;\n\n  constructor(\n    data: SdfFontData,\n    glyphMap: Map<number, SdfFontData['chars'][0]>,\n  ) {\n    super();\n    this.data = data;\n    this.glyphMap = glyphMap;\n\n    const kernings: KerningTable = (this.kernings = {});\n    data.kernings.forEach((kerning) => {\n      const second = kerning.second;\n      const firsts = (kernings[second] = kernings[second] || {});\n      firsts[kerning.first] = kerning.amount;\n    });\n    this.kernings = kernings;\n  }\n\n  *shapeText(\n    props: FontShaperProps,\n    codepoints: PeekableIterator<number>,\n  ): Generator<MappedGlyphInfo | UnmappedCharacterInfo, void> {\n    let codepointResult: IteratorResult<number>;\n    let lastGlyphId: number | undefined = undefined;\n    while ((codepointResult = codepoints.peek()) && !codepointResult.done) {\n      const codepoint = codepointResult.value;\n      const glyph = this.glyphMap.get(codepoint);\n      codepoints.next();\n      if (glyph !== undefined) {\n        // We found a glyph for this codepoint\n        // Yield the mapped glyph info\n\n        /**\n         * Kerning includes any possible additional letter spacing\n         */\n        const kerning =\n          lastGlyphId !== undefined\n            ? (this.kernings[glyph.id]?.[lastGlyphId] || 0) +\n              props.letterSpacing\n            : 0;\n\n        lastGlyphId = glyph.id;\n        yield {\n          mapped: true,\n          glyphId: glyph.id,\n          codepoint,\n          cluster: codepoints.lastIndex,\n          xAdvance: glyph.xadvance + kerning,\n          yAdvance: 0,\n          xOffset: glyph.xoffset + kerning,\n          yOffset: glyph.yoffset,\n          xBearing: 0,\n          yBearing: 0,\n          width: glyph.width,\n          height: glyph.height,\n        };\n      } else {\n        // We didn't find a glyph for this codepoint\n        // Yield the unmapped codepoint info\n\n        // If this codepoint is a linebreak, we should reset the last glyph id\n        // so that the next glyph will not be kerned with the last glyph of the\n        // previous line.\n        if (codepoint === SpecialCodepoints.LINE_FEED) {\n          lastGlyphId = undefined;\n        }\n        yield {\n          mapped: false,\n          codepoint,\n          cluster: codepoints.lastIndex,\n        };\n      }\n    }\n  }\n}\n\nexport interface SdfFontData {\n  pages: string[];\n  chars: Array<{\n    id: number;\n    char: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    xoffset: number;\n    yoffset: number;\n    xadvance: number;\n    page: number;\n    chnl: number;\n  }>;\n\n  kernings: Array<{\n    first: number;\n    second: number;\n    amount: number;\n  }>;\n  info: {\n    face: string;\n    size: number;\n    bold: number;\n    italic: number;\n    charset: string[];\n    unicode: number;\n    stretchH: number;\n    smooth: number;\n    aa: number;\n    padding: [number, number, number, number]; // [up, right, down, left]\n    spacing: [number, number]; // [horizontal, vertical]\n    outline: number;\n  };\n  common: {\n    lineHeight: number;\n    base: number;\n    scaleW: number;\n    scaleH: number;\n    pages: number;\n    packed: number;\n    alphaChnl: number;\n    redChnl: number;\n    greenChnl: number;\n    blueChnl: number;\n  };\n  distanceField: {\n    // msdf-bmfont-xml uses the string 'sdf' for single-channel SDF.\n    fieldType: 'sdf' | 'msdf';\n    distanceRange: number;\n  };\n  lightningMetrics?: FontMetrics;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// import type { Renderer } from '../../../Renderer';\nimport { assertTruthy } from '../../../../utils.js';\nimport type { Stage } from '../../../Stage.js';\nimport { WebGlCoreRenderer } from '../../../renderers/webgl/WebGlCoreRenderer.js';\nimport { ImageTexture } from '../../../textures/ImageTexture.js';\nimport {\n  TrFontFace,\n  type NormalizedFontMetrics,\n  type TrFontFaceOptions,\n} from '../TrFontFace.js';\nimport { fetchJson } from '../utils.js';\nimport type { FontShaper } from './internal/FontShaper.js';\nimport { SdfFontShaper, type SdfFontData } from './internal/SdfFontShaper.js';\n\ntype SdfFontType = 'ssdf' | 'msdf';\n\ndeclare module '../TrFontFace.js' {\n  interface TrFontFaceMap {\n    ssdf: SdfTrFontFace<'ssdf'>;\n    msdf: SdfTrFontFace<'msdf'>;\n  }\n}\n\ninterface GlyphAtlasEntry {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface SdfTrFontFaceOptions extends TrFontFaceOptions {\n  atlasUrl: string;\n  atlasDataUrl: string;\n  stage: Stage;\n}\n\nexport class SdfTrFontFace<\n  FontTypeT extends SdfFontType = SdfFontType,\n> extends TrFontFace {\n  public readonly type: FontTypeT;\n  public readonly texture: ImageTexture;\n  /**\n   * Height of the tallest character in the font including the whitespace above it\n   * in SDF/vertex units.\n   */\n  public readonly maxCharHeight: number = 0;\n  public readonly shaper: FontShaper | undefined;\n  public readonly glyphMap: Map<number, SdfFontData['chars'][0]> = new Map();\n  public data: SdfFontData | undefined;\n\n  constructor(type: FontTypeT, options: SdfTrFontFaceOptions) {\n    super(options);\n    const { atlasUrl, atlasDataUrl, stage } = options;\n    this.type = type;\n    const renderer = stage.renderer;\n    assertTruthy(\n      renderer instanceof WebGlCoreRenderer,\n      'SDF Font Faces can only be used with the WebGL Renderer',\n    );\n\n    // Load image\n    this.texture = stage.txManager.createTexture('ImageTexture', {\n      src: atlasUrl,\n      // IMPORTANT: The SDF shader requires the alpha channel to NOT be\n      // premultiplied on the atlas texture. If it is premultiplied, the\n      // rendering of SDF glyphs (especially single-channel SDF fonts) will\n      // be very jagged.\n      premultiplyAlpha: false,\n    });\n\n    // Load the texture\n    stage.txManager.loadTexture(this.texture, true);\n\n    // FIXME This is a stop-gap solution to avoid Font Face textures to be cleaned up\n    // Ideally we do want to clean up the textures if they're not being used to save as much memory as possible\n    // However, we need to make sure that the font face is reloaded if the texture is cleaned up and needed again\n    // and make sure the SdfFontRenderer is properly guarded against textures being reloaded\n    // for now this will do the trick and the increase on memory is not that big\n    this.texture.preventCleanup = true;\n\n    this.texture.on('loaded', () => {\n      this.checkLoaded();\n      // Make sure we mark the stage for a re-render (in case the font's texture was freed and reloaded)\n      stage.requestRender();\n    });\n\n    // Set this.data to the fetched data from dataUrl\n    fetchJson(atlasDataUrl)\n      .then((response) => {\n        this.data = JSON.parse(response as unknown as string) as SdfFontData;\n        assertTruthy(this.data);\n        // Add all the glyphs to the glyph map\n\n        let maxCharHeight = 0;\n        this.data.chars.forEach((glyph) => {\n          this.glyphMap.set(glyph.id, glyph);\n          const charHeight = glyph.yoffset + glyph.height;\n          if (charHeight > maxCharHeight) {\n            maxCharHeight = charHeight;\n          }\n        });\n\n        (this.maxCharHeight as number) = maxCharHeight;\n        // We know `data` is defined here, because we just set it\n\n        (this.shaper as FontShaper) = new SdfFontShaper(\n          this.data,\n          this.glyphMap,\n        );\n\n        // If the metrics aren't provided explicitly in the font face options,\n        // Gather them from the metrics added by the msdf-generator tool ()\n        // If they are missing then we throw an error.\n        if (!this.metrics) {\n          if (this.data?.lightningMetrics) {\n            const { ascender, descender, lineGap, unitsPerEm } =\n              this.data.lightningMetrics;\n            (this.metrics as NormalizedFontMetrics | null) = {\n              ascender: ascender / unitsPerEm,\n              descender: descender / unitsPerEm,\n              lineGap: lineGap / unitsPerEm,\n            };\n          } else {\n            throw new Error(\n              `Font metrics not found in ${this.type} font ${this.fontFamily}. ` +\n                'Make sure you are using the latest version of the Lightning ' +\n                '3 `msdf-generator` tool to generate your SDF fonts.',\n            );\n          }\n        }\n\n        this.checkLoaded();\n      })\n      .catch(console.error);\n  }\n\n  getAtlasEntry(glyphId: number): GlyphAtlasEntry {\n    const glyph = this.glyphMap.get(glyphId);\n    if (glyph === undefined) {\n      throw new Error(`Glyph ${glyphId} not found in font ${this.fontFamily}`);\n    }\n    return {\n      x: glyph.x,\n      y: glyph.y,\n      width: glyph.width,\n      height: glyph.height,\n    };\n  }\n\n  private checkLoaded(): void {\n    if (this.loaded) return;\n    if (this.texture.state === 'loaded' && this.data) {\n      (this.loaded as boolean) = true;\n      this.emit('loaded');\n    }\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Number of floating point numbers that represent a single glyph in the SDF vertex buffer.\n *\n * @remarks\n * The vertex buffer contains:\n *  - 6 vertex positions\n *  - 6 texture coordinates\n *  - = 12 positions/coordinates per glyph\n *\n * Each vertex position and texture coordinate consist of 2 floating point numbers (x/y).\n * So there are 12 * 2 = 24 floating point numbers that make up a single glyph.\n */\nexport const FLOATS_PER_GLYPH = 24;\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assertTruthy } from '../../../../../utils.js';\nimport type { Bound } from '../../../../lib/utils.js';\nimport type { SdfTrFontFace } from '../../../font-face-types/SdfTrFontFace/SdfTrFontFace.js';\nimport type { TrProps, TextRendererState } from '../../TextRenderer.js';\nimport type { SdfTextRendererState } from '../SdfTextRenderer.js';\nimport type { SdfRenderWindow } from './setRenderWindow.js';\n\n/**\n * Gets the start conditions for the layout loop.\n *\n * @remarks\n * Returns `undefined` if the layout loop should not be run.\n *\n * @param fontSize\n * @param fontSizeRatio\n * @param sdfLineHeight\n * @param renderWindow\n * @param lineCache\n * @param textH\n * @returns\n */\nexport function getStartConditions(\n  sdfFontSize: number,\n  sdfLineHeight: number,\n  fontFace: SdfTrFontFace,\n  verticalAlign: TrProps['verticalAlign'],\n  offsetY: TrProps['offsetY'],\n  fontSizeRatio: number,\n  renderWindow: SdfRenderWindow,\n  lineCache: SdfTextRendererState['lineCache'],\n  textH: TextRendererState['textH'],\n):\n  | {\n      sdfX: number;\n      sdfY: number;\n      lineIndex: number;\n    }\n  | undefined {\n  // State variables\n  const startLineIndex = Math.min(\n    Math.max(renderWindow.firstLineIdx, 0),\n    lineCache.length,\n  );\n\n  const sdfStartX = 0;\n  const { metrics } = fontFace;\n  assertTruthy(metrics, 'Font metrics not loaded');\n  assertTruthy(fontFace.data, 'Font data not loaded');\n\n  /**\n   * Bare line height is the distance between the ascender and descender of the font.\n   * without the line gap metric.\n   */\n  const sdfBareLineHeight =\n    (metrics.ascender - metrics.descender) * sdfFontSize;\n  let sdfVerticalAlignYOffset = 0;\n  if (verticalAlign === 'middle') {\n    sdfVerticalAlignYOffset = (sdfLineHeight - sdfBareLineHeight) / 2;\n  } else if (verticalAlign === 'bottom') {\n    sdfVerticalAlignYOffset = sdfLineHeight - sdfBareLineHeight;\n  }\n\n  const sdfOffsetY = offsetY / fontSizeRatio;\n\n  /**\n   * This is the position from the top of the text drawing line to where the\n   * baseline of the text will be according to the encoded positioning data for\n   * each glyph in the SDF data. This also happens to be the ascender value\n   * that is encoded into the font data.\n   */\n  const sdfEncodedAscender = fontFace.data.common.base;\n  /**\n   * This is the ascender that is configured and overridable in the font face.\n   */\n  const sdfConfiguredAscender = metrics.ascender * sdfFontSize;\n  /**\n   * If the configured ascender is different from the SDF data's encoded\n   * ascender, the offset of the text will be adjusted by the difference.\n   */\n  const sdfAscenderAdjOffset = sdfConfiguredAscender - sdfEncodedAscender;\n\n  const sdfStartY =\n    sdfOffsetY +\n    sdfAscenderAdjOffset +\n    startLineIndex * sdfLineHeight +\n    sdfVerticalAlignYOffset; // TODO: Figure out what determines the initial y offset of text.\n\n  // Don't attempt to render anything if we know we're starting past the established end of the text\n  if (textH && sdfStartY >= textH / fontSizeRatio) {\n    return;\n  }\n\n  return {\n    sdfX: sdfStartX,\n    sdfY: sdfStartY,\n    lineIndex: startLineIndex,\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A wrapper Generator class that makes a generator peekable.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport class PeekableIterator<T = unknown, TReturn = any, TNext = unknown>\n  implements Iterator<T, TReturn, TNext>\n{\n  private peekBuffer: IteratorResult<T, TReturn>[] = [];\n  private _lastIndex;\n\n  constructor(private iterator: Iterator<T, TReturn, TNext>, indexBase = 0) {\n    this.iterator = iterator;\n    this._lastIndex = indexBase - 1;\n    this.peekBuffer = [];\n  }\n\n  next(): IteratorResult<T, TReturn> {\n    const nextResult =\n      this.peekBuffer.length > 0\n        ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          this.peekBuffer.pop()!\n        : this.iterator.next();\n\n    if (nextResult.done) {\n      this._lastIndex = -1;\n    } else {\n      this._lastIndex++;\n    }\n    return nextResult;\n  }\n\n  peek(): IteratorResult<T, TReturn> {\n    if (this.peekBuffer.length > 0) {\n      // We know that the buffer is not empty, so we can safely use the\n      // non-null assertion operator\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      return this.peekBuffer[0]!;\n    }\n    const result = this.iterator.next();\n    this.peekBuffer.push(result);\n    return result;\n  }\n\n  get lastIndex(): number {\n    return this._lastIndex;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Reversible Generator Wrapper Class\n\n/**\n * Generator function that yields each Unicode code point in the given string.\n */\nexport function* getUnicodeCodepoints(\n  text: string,\n  start = 0,\n): Generator<number> {\n  let i = start;\n  while (i < text.length) {\n    const codePoint = text.codePointAt(i);\n    if (codePoint === undefined) {\n      throw new Error('Invalid Unicode code point');\n    }\n    yield codePoint;\n    i += codePoint <= 0xffff ? 1 : 2;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  FontShaper,\n  FontShaperProps,\n} from '../../../font-face-types/SdfTrFontFace/internal/FontShaper.js';\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\n\n/**\n * Measures a single-line of text width ignoring any unmapped glyphs including line breaks\n *\n * @param text\n * @param shaperProps\n * @param shaper\n * @returns\n */\nexport function measureText(\n  text: string,\n  shaperProps: FontShaperProps,\n  shaper: FontShaper,\n): number {\n  const glyphs = shaper.shapeText(\n    shaperProps,\n    new PeekableIterator(getUnicodeCodepoints(text, 0), 0),\n  );\n  let width = 0;\n  for (const glyph of glyphs) {\n    if (glyph.mapped && glyph.codepoint !== 8203) {\n      // Skip ZWSP (\\u200B)\n      width += glyph.xAdvance;\n    }\n  }\n  return width;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assertTruthy } from '../../../../../utils.js';\nimport type { Bound } from '../../../../lib/utils.js';\nimport type {\n  FontShaperProps,\n  MappedGlyphInfo,\n  UnmappedCharacterInfo,\n} from '../../../font-face-types/SdfTrFontFace/internal/FontShaper.js';\nimport type { TrProps, TextRendererState } from '../../TextRenderer.js';\nimport type { SdfTextRendererState } from '../SdfTextRenderer.js';\nimport { PeekableIterator } from './PeekableGenerator.js';\nimport { getUnicodeCodepoints } from './getUnicodeCodepoints.js';\nimport { measureText } from './measureText.js';\n\nexport function layoutText(\n  curLineIndex: number,\n  startX: number,\n  startY: number,\n  text: TrProps['text'],\n  textAlign: TrProps['textAlign'],\n  width: TrProps['width'],\n  height: TrProps['height'],\n  fontSize: TrProps['fontSize'],\n  lineHeight: number,\n  letterSpacing: TrProps['letterSpacing'],\n  /**\n   * Mutated\n   */\n  vertexBuffer: NonNullable<SdfTextRendererState['vertexBuffer']>,\n  contain: TrProps['contain'],\n  /**\n   * Mutated\n   */\n  lineCache: SdfTextRendererState['lineCache'],\n  rwSdf: Bound,\n  trFontFace: SdfTextRendererState['trFontFace'],\n  forceFullLayoutCalc: TextRendererState['forceFullLayoutCalc'],\n  scrollable: TrProps['scrollable'],\n  overflowSuffix: TrProps['overflowSuffix'],\n  maxLines: TrProps['maxLines'],\n): {\n  bufferNumFloats: number;\n  bufferNumQuads: number;\n  layoutNumCharacters: number;\n  fullyProcessed: boolean;\n  maxX: number;\n  maxY: number;\n  numLines: number;\n} {\n  assertTruthy(trFontFace, 'Font face must be loaded');\n  assertTruthy(trFontFace.loaded, 'Font face must be loaded');\n  assertTruthy(trFontFace.data, 'Font face must be loaded');\n  assertTruthy(trFontFace.shaper, 'Font face must be loaded');\n\n  // Regardless of fontSize (or other scaling properties), we layout the vertices of each glyph\n  // using the fixed coordinate space determined by font size used to produce the atlas.\n  // Scaling for display is handled by shader uniforms inexpensively.\n  // So we have:\n  //  - vertex space: the space in which the vertices of each glyph are laid out\n  //  - screen space: the screen pixel space\n  // Input properties such as x, y, w, fontSize, letterSpacing, etc. are all expressed in screen space.\n  // We convert these to the vertex space by dividing them the `fontSizeRatio` factor.\n\n  /**\n   * See above\n   */\n  const fontSizeRatio = fontSize / trFontFace.data.info.size;\n\n  /**\n   * `lineHeight` in vertex coordinates\n   */\n  const vertexLineHeight = lineHeight / fontSizeRatio;\n  /**\n   * `w` in vertex coordinates\n   */\n  const vertexW = width / fontSizeRatio;\n  /**\n   * `letterSpacing` in vertex coordinates\n   */\n  const vertexLSpacing = letterSpacing / fontSizeRatio;\n\n  const startingLineCacheEntry = lineCache[curLineIndex];\n  const startingCodepointIndex = startingLineCacheEntry?.codepointIndex || 0;\n  const startingMaxX = startingLineCacheEntry?.maxX || 0;\n  const startingMaxY = startingLineCacheEntry?.maxY || 0;\n\n  let maxX = startingMaxX;\n  let maxY = startingMaxY;\n  let curX = startX;\n  let curY = startY;\n\n  let bufferOffset = 0;\n  /**\n   * Buffer offset to last word boundry. This is -1 when we aren't in a word boundry.\n   */\n  const lastWord: {\n    codepointIndex: number;\n    bufferOffset: number;\n    xStart: number;\n  } = {\n    codepointIndex: -1,\n    bufferOffset: -1,\n    xStart: -1,\n  };\n\n  const shaper = trFontFace.shaper;\n\n  const shaperProps: FontShaperProps = {\n    letterSpacing: vertexLSpacing,\n  };\n\n  // HACK: The space is used as a word boundary. When a text ends with a space, we need to\n  // add an extra space to ensure the space is included in the line width calculation.\n  if (text.endsWith(' ')) {\n    text += ' ';\n  }\n\n  // Get glyphs\n  let glyphs = shaper.shapeText(\n    shaperProps,\n    new PeekableIterator(\n      getUnicodeCodepoints(text, startingCodepointIndex),\n      startingCodepointIndex,\n    ),\n  );\n\n  let glyphResult:\n    | IteratorResult<MappedGlyphInfo | UnmappedCharacterInfo, void>\n    | undefined;\n\n  let curLineBufferStart = -1;\n\n  const bufferLineInfos: {\n    bufferStart: number;\n    bufferEnd: number;\n  }[] = [];\n\n  const vertexTruncateHeight = height / fontSizeRatio;\n  const overflowSuffVertexWidth = measureText(\n    overflowSuffix,\n    shaperProps,\n    shaper,\n  );\n\n  // Line-by-line layout\n  let moreLines = true;\n  while (moreLines) {\n    const nextLineWillFit =\n      (maxLines === 0 || curLineIndex + 1 < maxLines) &&\n      (contain !== 'both' ||\n        scrollable ||\n        curY + vertexLineHeight + trFontFace.maxCharHeight <=\n          vertexTruncateHeight);\n    const lineVertexW = nextLineWillFit\n      ? vertexW\n      : vertexW - overflowSuffVertexWidth;\n    /**\n     * Vertex X position to the beginning of the last word boundary. This becomes -1 when we start traversing a word.\n     */\n    let xStartLastWordBoundary = 0;\n\n    const lineIsBelowWindowTop = curY + trFontFace.maxCharHeight >= rwSdf.y1;\n    const lineIsAboveWindowBottom = curY <= rwSdf.y2;\n    const lineIsWithinWindow = lineIsBelowWindowTop && lineIsAboveWindowBottom;\n    // Layout glyphs in this line\n    // Any break statements in this while loop will trigger a line break\n    while ((glyphResult = glyphs.next()) && !glyphResult.done) {\n      const glyph = glyphResult.value;\n\n      if (curLineIndex === lineCache.length) {\n        lineCache.push({\n          codepointIndex: glyph.cluster,\n          maxY,\n          maxX,\n        });\n      } else if (curLineIndex > lineCache.length) {\n        throw new Error('Unexpected lineCache length');\n      }\n\n      // If we encounter a word boundary (white space or newline) we invalidate\n      // the lastWord and set the xStartLastWordBoundary if we haven't already.\n      if (\n        glyph.codepoint === 32 ||\n        glyph.codepoint === 10 ||\n        glyph.codepoint === 8203\n      ) {\n        if (lastWord.codepointIndex !== -1) {\n          lastWord.codepointIndex = -1;\n          xStartLastWordBoundary = curX;\n        }\n      } else if (lastWord.codepointIndex === -1) {\n        lastWord.codepointIndex = glyph.cluster;\n        lastWord.bufferOffset = bufferOffset;\n        lastWord.xStart = xStartLastWordBoundary;\n      }\n\n      if (glyph.mapped) {\n        // Mapped glyph\n        const charEndX = curX + glyph.xOffset + glyph.width;\n        // Word wrap check\n        if (\n          // We are containing the text\n          contain !== 'none' &&\n          // The current glyph reaches outside the contained width\n          charEndX >= lineVertexW &&\n          // There is a last word that we can break to the next line\n          lastWord.codepointIndex !== -1 &&\n          // Prevents infinite loop when a single word is longer than the width\n          lastWord.xStart > 0\n        ) {\n          // The current word is about to go off the edge of the container width\n          // Reinitialize the iterator starting at the last word\n          // and proceeding to the next line\n          if (nextLineWillFit) {\n            glyphs = shaper.shapeText(\n              shaperProps,\n              new PeekableIterator(\n                getUnicodeCodepoints(text, lastWord.codepointIndex),\n                lastWord.codepointIndex,\n              ),\n            );\n            bufferOffset = lastWord.bufferOffset;\n            break;\n          } else {\n            glyphs = shaper.shapeText(\n              shaperProps,\n              new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0),\n            );\n            curX = lastWord.xStart;\n            bufferOffset = lastWord.bufferOffset;\n            // HACK: For the rest of the line when inserting the overflow suffix,\n            // set contain = 'none' to prevent an infinite loop.\n            contain = 'none';\n          }\n        } else {\n          // This glyph fits, so we can add it to the buffer\n          const quadX = curX + glyph.xOffset;\n          const quadY = curY + glyph.yOffset;\n\n          // Only add to buffer for rendering if the line is within the render window\n          if (lineIsWithinWindow) {\n            if (curLineBufferStart === -1) {\n              curLineBufferStart = bufferOffset;\n            }\n\n            const atlasEntry = trFontFace.getAtlasEntry(glyph.glyphId);\n\n            // Add texture coordinates\n            const u = atlasEntry.x / trFontFace.data.common.scaleW;\n            const v = atlasEntry.y / trFontFace.data.common.scaleH;\n            const uvWidth = atlasEntry.width / trFontFace.data.common.scaleW;\n            const uvHeight = atlasEntry.height / trFontFace.data.common.scaleH;\n\n            // TODO: (Performance) We can optimize this by using ELEMENT_ARRAY_BUFFER\n            // eliminating the need to duplicate vertices\n\n            // Top-left\n            vertexBuffer[bufferOffset++] = quadX;\n            vertexBuffer[bufferOffset++] = quadY;\n            vertexBuffer[bufferOffset++] = u;\n            vertexBuffer[bufferOffset++] = v;\n\n            // Top-right\n            vertexBuffer[bufferOffset++] = quadX + glyph.width;\n            vertexBuffer[bufferOffset++] = quadY;\n            vertexBuffer[bufferOffset++] = u + uvWidth;\n            vertexBuffer[bufferOffset++] = v;\n\n            // Bottom-left\n            vertexBuffer[bufferOffset++] = quadX;\n            vertexBuffer[bufferOffset++] = quadY + glyph.height;\n            vertexBuffer[bufferOffset++] = u;\n            vertexBuffer[bufferOffset++] = v + uvHeight;\n\n            // Bottom-right\n            vertexBuffer[bufferOffset++] = quadX + glyph.width;\n            vertexBuffer[bufferOffset++] = quadY + glyph.height;\n            vertexBuffer[bufferOffset++] = u + uvWidth;\n            vertexBuffer[bufferOffset++] = v + uvHeight;\n          }\n\n          maxY = Math.max(maxY, quadY + glyph.height);\n          maxX = Math.max(maxX, quadX + glyph.width);\n          curX += glyph.xAdvance;\n        }\n      } else {\n        // Unmapped character\n\n        // Handle newlines\n        if (glyph.codepoint === 10) {\n          if (nextLineWillFit) {\n            // The whole line fit, so we can break to the next line\n            break;\n          } else {\n            // The whole line won't fit, so we need to add the overflow suffix\n            glyphs = shaper.shapeText(\n              shaperProps,\n              new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0),\n            );\n            // HACK: For the rest of the line when inserting the overflow suffix,\n            // set contain = 'none' to prevent an infinite loop.\n            contain = 'none';\n          }\n        }\n      }\n    }\n\n    // Prepare for the next line...\n    if (curLineBufferStart !== -1) {\n      bufferLineInfos.push({\n        bufferStart: curLineBufferStart,\n        bufferEnd: bufferOffset,\n      });\n      curLineBufferStart = -1;\n    }\n    curX = 0;\n    curY += vertexLineHeight;\n    curLineIndex++;\n    lastWord.codepointIndex = -1;\n    xStartLastWordBoundary = 0;\n\n    // Figure out if there are any more lines to render...\n    if (!forceFullLayoutCalc && contain === 'both' && curY > rwSdf.y2) {\n      // Stop layout calculation early (for performance purposes) if:\n      // - We're not forcing a full layout calculation (for width/height calculation)\n      // - ...and we're containing the text vertically+horizontally (contain === 'both')\n      // - ...and we have a render window\n      // - ...and the next line is below the bottom of the render window\n      moreLines = false;\n    } else if (glyphResult && glyphResult.done) {\n      // If we've reached the end of the text, we know we're done\n      moreLines = false;\n    } else if (!nextLineWillFit) {\n      // If we're contained vertically+horizontally (contain === 'both')\n      // but not scrollable and the next line won't fit, we're done.\n      moreLines = false;\n    }\n  }\n\n  // Use textAlign to determine if we need to adjust the x position of the text\n  // in the buffer line by line\n  if (textAlign === 'center') {\n    const vertexTextW = contain === 'none' ? maxX : vertexW;\n\n    for (let i = 0; i < bufferLineInfos.length; i++) {\n      const line = bufferLineInfos[i]!;\n      // - 4 = the x position of a rightmost vertex\n      const lineWidth =\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        vertexBuffer[line.bufferEnd - 4]! - vertexBuffer[line.bufferStart]!;\n\n      const xOffset = (vertexTextW - lineWidth) / 2;\n      for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        vertexBuffer[j]! += xOffset;\n      }\n    }\n  } else if (textAlign === 'right') {\n    const vertexTextW = contain === 'none' ? maxX : vertexW;\n\n    for (let i = 0; i < bufferLineInfos.length; i++) {\n      const line = bufferLineInfos[i]!;\n      const lineWidth =\n        line.bufferEnd === line.bufferStart\n          ? 0\n          : // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            vertexBuffer[line.bufferEnd - 4]! - vertexBuffer[line.bufferStart]!;\n\n      const xOffset = vertexTextW - lineWidth;\n      for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        vertexBuffer[j]! += xOffset;\n      }\n    }\n  }\n\n  assertTruthy(glyphResult);\n\n  return {\n    bufferNumFloats: bufferOffset,\n    bufferNumQuads: bufferOffset / 16,\n    layoutNumCharacters: glyphResult.done\n      ? text.length - startingCodepointIndex\n      : glyphResult.value.cluster - startingCodepointIndex + 1,\n    fullyProcessed: !!glyphResult.done,\n    maxX,\n    maxY,\n    numLines: lineCache.length,\n  };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Round up to the nearest multiple of the given number.\n *\n * @param value\n * @param multiple\n * @returns\n */\nexport function roundUpToMultiple(value: number, multiple: number) {\n  return Math.ceil(value / multiple) * multiple;\n}\n\n/**\n * Round down to the nearest multiple of the given number.\n *\n * @param value\n * @param multiple\n * @returns\n */\nexport function roundDownToMultiple(value: number, multiple: number) {\n  return Math.floor(value / multiple) * multiple;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isBoundPositive, type Bound } from '../../../../lib/utils.js';\nimport type { TrProps } from '../../TextRenderer.js';\nimport { roundDownToMultiple, roundUpToMultiple } from './util.js';\n\nexport interface SdfRenderWindow {\n  screen: Bound;\n  sdf: Bound;\n  firstLineIdx: number;\n  numLines: number;\n  valid: boolean;\n}\n\n/**\n * Create a render window from the given parameters.\n *\n * @remarks\n * The render window is a rectangle that defines the area of the text that\n * should be rendered. It is used to skip rendering parts of the text that\n * are outside of the render window. The render window is relative to the\n * text's top left corner of the overrall text.\n *\n * @param x The x coordinate of the text element's top left corner relative to the screen.\n * @param y The y coordinate of the text element's top left corner relative to the screen.\n * @param scrollY The amount of pixels to scroll the text vertically.\n * @param lineHeight The number of extra lines to render above and below the visible window.\n * @param visibleWindow The visible window of the text element relative to the screen\n * @returns\n */\nexport function setRenderWindow(\n  outRenderWindow: SdfRenderWindow,\n  x: TrProps['x'],\n  y: TrProps['y'],\n  scrollY: TrProps['scrollY'],\n  lineHeight: number,\n  bufferMargin: number,\n  visibleWindow: Bound,\n  fontSizeRatio: number,\n): void {\n  const { screen, sdf } = outRenderWindow;\n  if (!isBoundPositive(visibleWindow)) {\n    screen.x1 = 0;\n    screen.y1 = 0;\n    screen.x2 = 0;\n    screen.y2 = 0;\n    sdf.x1 = 0;\n    sdf.y1 = 0;\n    sdf.x2 = 0;\n    sdf.y2 = 0;\n    outRenderWindow.numLines = 0;\n    outRenderWindow.firstLineIdx = 0;\n  } else {\n    const x1 = visibleWindow.x1 - x;\n    const x2 = x1 + (visibleWindow.x2 - visibleWindow.x1);\n    const y1Base = visibleWindow.y1 - y + scrollY;\n    const y1 = roundDownToMultiple(y1Base - bufferMargin, lineHeight || 1);\n    const y2 = roundUpToMultiple(\n      y1Base + (visibleWindow.y2 - visibleWindow.y1) + bufferMargin,\n      lineHeight || 1,\n    );\n\n    screen.x1 = x1;\n    screen.y1 = y1;\n    screen.x2 = x2;\n    screen.y2 = y2;\n    sdf.x1 = x1 / fontSizeRatio;\n    sdf.y1 = y1 / fontSizeRatio;\n    sdf.x2 = x2 / fontSizeRatio;\n    sdf.y2 = y2 / fontSizeRatio;\n\n    outRenderWindow.numLines = Math.ceil((y2 - y1) / lineHeight);\n    outRenderWindow.firstLineIdx = lineHeight ? Math.floor(y1 / lineHeight) : 0;\n  }\n  outRenderWindow.valid = true;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2024 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { NormalizedFontMetrics } from './font-face-types/TrFontFace.js';\n\n/**\n * Calculate the default line height given normalized font metrics\n *\n * @remarks\n * This method may be used for both the WebTrFontFace and SdfTrFontFace font types.\n *\n * @param metrics\n * @param fontSize\n * @returns\n */\nexport function calcDefaultLineHeight(\n  metrics: NormalizedFontMetrics,\n  fontSize: number,\n): number {\n  return fontSize * (metrics.ascender - metrics.descender + metrics.lineGap);\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  type Bound,\n  type Rect,\n  createBound,\n  type BoundWithValid,\n  intersectRect,\n  type RectWithValid,\n  copyRect,\n  boundsOverlap,\n  convertBoundToRect,\n} from '../../../lib/utils.js';\nimport {\n  TextRenderer,\n  type TrProps,\n  type TextRendererState,\n  type TrFontProps,\n  type TrPropSetters,\n} from '../TextRenderer.js';\nimport { SdfTrFontFace } from '../../font-face-types/SdfTrFontFace/SdfTrFontFace.js';\nimport { FLOATS_PER_GLYPH } from './internal/constants.js';\nimport { getStartConditions } from './internal/getStartConditions.js';\nimport { layoutText } from './internal/layoutText.js';\nimport {\n  setRenderWindow,\n  type SdfRenderWindow,\n} from './internal/setRenderWindow.js';\nimport type { TrFontFace } from '../../font-face-types/TrFontFace.js';\nimport { TrFontManager, type FontFamilyMap } from '../../TrFontManager.js';\nimport { assertTruthy, mergeColorAlpha } from '../../../../utils.js';\nimport type { Stage } from '../../../Stage.js';\nimport { WebGlCoreRenderOp } from '../../../renderers/webgl/WebGlCoreRenderOp.js';\nimport { BufferCollection } from '../../../renderers/webgl/internal/BufferCollection.js';\nimport type {\n  SdfShader,\n  SdfShaderProps,\n} from '../../../renderers/webgl/shaders/SdfShader.js';\nimport type { WebGlCoreCtxTexture } from '../../../renderers/webgl/WebGlCoreCtxTexture.js';\nimport { EventEmitter } from '../../../../common/EventEmitter.js';\nimport type { Matrix3d } from '../../../lib/Matrix3d.js';\nimport type { Dimensions } from '../../../../common/CommonTypes.js';\nimport { WebGlCoreRenderer } from '../../../renderers/webgl/WebGlCoreRenderer.js';\nimport { calcDefaultLineHeight } from '../../TextRenderingUtils.js';\n\ndeclare module '../TextRenderer.js' {\n  interface TextRendererMap {\n    sdf: SdfTextRenderer;\n  }\n\n  // Add prefixed SDF-specific props to TextRendererDebugProps\n  interface TextRendererDebugProps {\n    sdfShaderDebug: boolean;\n  }\n}\n\nexport interface LineCacheItem {\n  codepointIndex: number;\n  maxY: number;\n  maxX: number;\n}\n\nexport interface SdfTextRendererState extends TextRendererState {\n  /**\n   * Cache for layout resume points indexed by the `curY` for each line\n   * in the render sequence.\n   *\n   * Allows faster rendering by skipping parts of the layout loop that are\n   * outside of the renderWindow.\n   */\n  lineCache: LineCacheItem[];\n\n  renderWindow: SdfRenderWindow;\n\n  elementBounds: BoundWithValid;\n\n  clippingRect: RectWithValid;\n\n  bufferNumFloats: number;\n\n  bufferNumQuads: number;\n\n  vertexBuffer: Float32Array | undefined;\n\n  webGlBuffers: BufferCollection | null;\n\n  bufferUploaded: boolean;\n\n  distanceRange: number;\n\n  trFontFace: SdfTrFontFace | undefined;\n\n  /**\n   * Resolved line height in logical screen pixel units\n   */\n  resLineHeight: number | undefined;\n}\n\n/**\n * Ephemeral rect object used for calculations\n */\nconst tmpRect: Rect = {\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n};\n\n/**\n * Singleton class for rendering text using signed distance fields.\n *\n * @remarks\n * SdfTextRenderer supports both single-channel and multi-channel signed distance fields.\n */\nexport class SdfTextRenderer extends TextRenderer<SdfTextRendererState> {\n  /**\n   * Map of font family names to a set of font faces.\n   */\n  private ssdfFontFamilies: FontFamilyMap = {};\n  private msdfFontFamilies: FontFamilyMap = {};\n  private fontFamilyArray: FontFamilyMap[] = [\n    this.ssdfFontFamilies,\n    this.msdfFontFamilies,\n  ];\n  private sdfShader: SdfShader;\n  private rendererBounds: Bound;\n\n  public type: 'canvas' | 'sdf' = 'sdf';\n\n  constructor(stage: Stage) {\n    super(stage);\n    this.sdfShader = this.stage.shManager.loadShader('SdfShader', {\n      transform: new Float32Array(),\n      color: 0,\n      size: 0,\n      scrollY: 0,\n      distanceRange: 0,\n      debug: false,\n    }).shader;\n    this.rendererBounds = {\n      x1: 0,\n      y1: 0,\n      x2: this.stage.options.appWidth,\n      y2: this.stage.options.appHeight,\n    };\n  }\n\n  //#region Overrides\n  getPropertySetters(): Partial<TrPropSetters<SdfTextRendererState>> {\n    return {\n      fontFamily: (state, value) => {\n        state.props.fontFamily = value;\n        this.releaseFontFace(state);\n        this.invalidateLayoutCache(state);\n      },\n      fontWeight: (state, value) => {\n        state.props.fontWeight = value;\n        this.releaseFontFace(state);\n        this.invalidateLayoutCache(state);\n      },\n      fontStyle: (state, value) => {\n        state.props.fontStyle = value;\n        this.releaseFontFace(state);\n        this.invalidateLayoutCache(state);\n      },\n      fontStretch: (state, value) => {\n        state.props.fontStretch = value;\n        this.releaseFontFace(state);\n        this.invalidateLayoutCache(state);\n      },\n      fontSize: (state, value) => {\n        state.props.fontSize = value;\n        this.invalidateLayoutCache(state);\n      },\n      text: (state, value) => {\n        state.props.text = value;\n        this.invalidateLayoutCache(state);\n      },\n      textAlign: (state, value) => {\n        state.props.textAlign = value;\n        this.invalidateLayoutCache(state);\n      },\n      color: (state, value) => {\n        state.props.color = value;\n      },\n      x: (state, value) => {\n        state.props.x = value;\n        if (state.elementBounds.valid) {\n          this.setElementBoundsX(state);\n          // Only schedule an update if the text is not already rendered\n          // (renderWindow is invalid) and the element possibly overlaps the screen\n          // This is to avoid unnecessary updates when we know text is off-screen\n          if (\n            !state.renderWindow.valid &&\n            boundsOverlap(state.elementBounds, this.rendererBounds)\n          ) {\n            this.scheduleUpdateState(state);\n          }\n        }\n      },\n      y: (state, value) => {\n        state.props.y = value;\n        if (state.elementBounds.valid) {\n          this.setElementBoundsY(state);\n          // See x() for explanation\n          if (\n            !state.renderWindow.valid &&\n            boundsOverlap(state.elementBounds, this.rendererBounds)\n          ) {\n            this.scheduleUpdateState(state);\n          }\n        }\n      },\n      contain: (state, value) => {\n        state.props.contain = value;\n        this.invalidateLayoutCache(state);\n      },\n      width: (state, value) => {\n        state.props.width = value;\n        // Only invalidate layout cache if we're containing in the horizontal direction\n        if (state.props.contain !== 'none') {\n          this.invalidateLayoutCache(state);\n        }\n      },\n      height: (state, value) => {\n        state.props.height = value;\n        // Only invalidate layout cache if we're containing in the vertical direction\n        if (state.props.contain === 'both') {\n          this.invalidateLayoutCache(state);\n        }\n      },\n      offsetY: (state, value) => {\n        state.props.offsetY = value;\n        this.invalidateLayoutCache(state);\n      },\n      scrollable: (state, value) => {\n        state.props.scrollable = value;\n        this.invalidateLayoutCache(state);\n      },\n      scrollY: (state, value) => {\n        state.props.scrollY = value;\n        // Scrolling doesn't need to invalidate any caches, but it does need to\n        // schedule an update\n        this.scheduleUpdateState(state);\n      },\n      letterSpacing: (state, value) => {\n        state.props.letterSpacing = value;\n        this.invalidateLayoutCache(state);\n      },\n      lineHeight: (state, value) => {\n        state.props.lineHeight = value;\n        state.resLineHeight = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      maxLines: (state, value) => {\n        state.props.maxLines = value;\n        this.invalidateLayoutCache(state);\n      },\n      textBaseline: (state, value) => {\n        state.props.textBaseline = value;\n        this.invalidateLayoutCache(state);\n      },\n      verticalAlign: (state, value) => {\n        state.props.verticalAlign = value;\n        this.invalidateLayoutCache(state);\n      },\n      overflowSuffix: (state, value) => {\n        state.props.overflowSuffix = value;\n        this.invalidateLayoutCache(state);\n      },\n      debug: (state, value) => {\n        state.props.debug = value;\n      },\n    };\n  }\n\n  override canRenderFont(props: TrFontProps): boolean {\n    // TODO: Support matching on font stretch, weight and style (if/when needed)\n    // For now we just match on the font family name\n    // '$$SDF_FAILURE_TEST$$' is used to test the 'failure' event coming from text\n    const { fontFamily } = props;\n    return (\n      fontFamily in this.ssdfFontFamilies ||\n      fontFamily in this.msdfFontFamilies ||\n      fontFamily === '$$SDF_FAILURE_TEST$$'\n    );\n  }\n\n  override isFontFaceSupported(fontFace: TrFontFace): boolean {\n    return fontFace instanceof SdfTrFontFace;\n  }\n\n  override addFontFace(fontFace: TrFontFace): void {\n    // Make sure the font face is an SDF font face (it should have already passed\n    // the `isFontFaceSupported` check)\n    assertTruthy(fontFace instanceof SdfTrFontFace);\n    const familyName = fontFace.fontFamily;\n    const fontFamiles =\n      fontFace.type === 'ssdf'\n        ? this.ssdfFontFamilies\n        : fontFace.type === 'msdf'\n        ? this.msdfFontFamilies\n        : undefined;\n    if (!fontFamiles) {\n      console.warn(`Invalid font face type: ${fontFace.type as string}`);\n      return;\n    }\n    let faceSet = fontFamiles[familyName];\n    if (!faceSet) {\n      faceSet = new Set();\n      fontFamiles[familyName] = faceSet;\n    }\n    faceSet.add(fontFace);\n  }\n\n  override createState(props: TrProps): SdfTextRendererState {\n    return {\n      props,\n      status: 'initialState',\n      updateScheduled: false,\n      emitter: new EventEmitter(),\n      lineCache: [],\n      forceFullLayoutCalc: false,\n      renderWindow: {\n        screen: {\n          x1: 0,\n          y1: 0,\n          x2: 0,\n          y2: 0,\n        },\n        sdf: {\n          x1: 0,\n          y1: 0,\n          x2: 0,\n          y2: 0,\n        },\n        firstLineIdx: 0,\n        numLines: 0,\n        valid: false,\n      },\n      elementBounds: {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n        valid: false,\n      },\n      clippingRect: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        valid: false,\n      },\n      bufferNumFloats: 0,\n      bufferNumQuads: 0,\n      vertexBuffer: undefined,\n      webGlBuffers: null,\n      bufferUploaded: false,\n      textH: undefined,\n      textW: undefined,\n      distanceRange: 0,\n      trFontFace: undefined,\n      isRenderable: false,\n      resLineHeight: undefined,\n      debugData: {\n        updateCount: 0,\n        layoutCount: 0,\n        lastLayoutNumCharacters: 0,\n        layoutSum: 0,\n        drawSum: 0,\n        drawCount: 0,\n        bufferSize: 0,\n      },\n    };\n  }\n\n  override updateState(state: SdfTextRendererState): void {\n    let { trFontFace } = state;\n    const { textH, lineCache, debugData, forceFullLayoutCalc } = state;\n    debugData.updateCount++;\n\n    // On the first update call we need to set the status to loading\n    if (state.status === 'initialState') {\n      this.setStatus(state, 'loading');\n    }\n\n    // Resolve font face if we haven't yet\n    if (trFontFace === undefined) {\n      trFontFace = this.resolveFontFace(state.props);\n      state.trFontFace = trFontFace;\n      if (trFontFace === undefined) {\n        const msg = `SdfTextRenderer: Could not resolve font face for family: '${state.props.fontFamily}'`;\n        console.error(msg);\n        this.setStatus(state, 'failed', new Error(msg));\n        return;\n      }\n      trFontFace.texture.setRenderableOwner(state.props.fontFamily, true);\n    }\n\n    // If the font hasn't been loaded yet, stop here.\n    // Listen for the 'loaded' event and forward fontLoaded event\n    if (trFontFace.loaded === false) {\n      trFontFace.once('loaded', () => {\n        this.scheduleUpdateState(state);\n      });\n      return;\n    }\n\n    // If the font is loaded then so should the data\n    assertTruthy(trFontFace.data, 'Font face data should be loaded');\n    assertTruthy(trFontFace.metrics, 'Font face metrics should be loaded');\n\n    const {\n      text,\n      fontSize,\n      x,\n      y,\n      contain,\n      width,\n      height,\n      verticalAlign,\n      scrollable,\n      overflowSuffix,\n      maxLines,\n    } = state.props;\n\n    // scrollY only has an effect when contain === 'both' and scrollable === true\n    const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n\n    const { renderWindow } = state;\n\n    /**\n     * The font size of the SDF font face (the basis for SDF space units)\n     */\n    const sdfFontSize = trFontFace.data.info.size;\n\n    /**\n     * Divide screen space units by this to get the SDF space units\n     * Mulitple SDF space units by this to get screen space units\n     */\n    const fontSizeRatio = fontSize / sdfFontSize;\n\n    // If not already resolved, resolve the line height and store it in the state\n    let resLineHeight = state.resLineHeight;\n    if (resLineHeight === undefined) {\n      const lineHeight = state.props.lineHeight;\n      // If lineHeight is undefined, use the maxCharHeight from the font face\n      if (lineHeight === undefined) {\n        resLineHeight = calcDefaultLineHeight(trFontFace.metrics, fontSize);\n      } else {\n        resLineHeight = lineHeight;\n      }\n      state.resLineHeight = resLineHeight;\n    }\n\n    // Needed in renderWindow calculation\n    const sdfLineHeight = resLineHeight / fontSizeRatio;\n\n    state.distanceRange =\n      fontSizeRatio * trFontFace.data.distanceField.distanceRange;\n\n    // Allocate buffers if needed\n    const neededLength = text.length * FLOATS_PER_GLYPH;\n    let vertexBuffer = state.vertexBuffer;\n    if (!vertexBuffer || vertexBuffer.length < neededLength) {\n      vertexBuffer = new Float32Array(neededLength * 2);\n    }\n\n    const elementBounds = state.elementBounds;\n    if (!elementBounds.valid) {\n      this.setElementBoundsX(state);\n      this.setElementBoundsY(state);\n      elementBounds.valid = true;\n    }\n\n    // Return early if we're still viewing inside the established render window\n    // No need to re-render what we've already rendered\n    // (Only if there's an established renderWindow and we're not suppressing early exit)\n    if (!forceFullLayoutCalc && renderWindow.valid) {\n      const rwScreen = renderWindow.screen;\n      if (\n        x + rwScreen.x1 <= elementBounds.x1 &&\n        x + rwScreen.x2 >= elementBounds.x2 &&\n        y - scrollY + rwScreen.y1 <= elementBounds.y1 &&\n        y - scrollY + rwScreen.y2 >= elementBounds.y2\n      ) {\n        this.setStatus(state, 'loaded');\n        return;\n      }\n      // Otherwise invalidate the renderWindow so it can be redone\n      renderWindow.valid = false;\n      this.setStatus(state, 'loading');\n    }\n\n    const { offsetY, textAlign } = state.props;\n\n    // Create a new renderWindow if needed\n    if (!renderWindow.valid) {\n      const isPossiblyOnScreen = boundsOverlap(\n        elementBounds,\n        this.rendererBounds,\n      );\n\n      if (!isPossiblyOnScreen) {\n        // If the element is not possibly on screen, we can skip the layout and rendering completely\n        return;\n      }\n\n      setRenderWindow(\n        renderWindow,\n        x,\n        y,\n        scrollY,\n        resLineHeight,\n        contain === 'both' ? elementBounds.y2 - elementBounds.y1 : 0,\n        elementBounds,\n        fontSizeRatio,\n      );\n      // console.log('newRenderWindow', renderWindow);\n    }\n\n    const start = getStartConditions(\n      sdfFontSize,\n      sdfLineHeight,\n      trFontFace,\n      verticalAlign,\n      offsetY,\n      fontSizeRatio,\n      renderWindow,\n      lineCache,\n      textH,\n    );\n\n    if (!start) {\n      // Nothing to render, return early, but still mark as loaded (since the text is just scrolled\n      // out of view)\n      this.setStatus(state, 'loaded');\n      return;\n    }\n\n    const { letterSpacing } = state.props;\n\n    const out2 = layoutText(\n      start.lineIndex,\n      start.sdfX,\n      start.sdfY,\n      text,\n      textAlign,\n      width,\n      height,\n      fontSize,\n      resLineHeight,\n      letterSpacing,\n      vertexBuffer,\n      contain,\n      lineCache,\n      renderWindow.sdf,\n      trFontFace,\n      forceFullLayoutCalc,\n      scrollable,\n      overflowSuffix,\n      maxLines,\n    );\n\n    state.bufferUploaded = false;\n    state.bufferNumFloats = out2.bufferNumFloats;\n    state.bufferNumQuads = out2.bufferNumQuads;\n    state.vertexBuffer = vertexBuffer;\n    state.renderWindow = renderWindow;\n    debugData.lastLayoutNumCharacters = out2.layoutNumCharacters;\n    debugData.bufferSize = vertexBuffer.byteLength;\n\n    // If we didn't exit early, we know we have completely computed w/h\n    if (out2.fullyProcessed) {\n      state.textW = out2.maxX * fontSizeRatio;\n      state.textH = out2.numLines * sdfLineHeight * fontSizeRatio;\n    }\n\n    // if (state.props.debug.printLayoutTime) {\n    //   debugData.layoutSum += performance.now() - updateStartTime;\n    //   debugData.layoutCount++;\n    // }\n    this.setStatus(state, 'loaded');\n  }\n\n  override renderQuads(\n    state: SdfTextRendererState,\n    transform: Matrix3d,\n    clippingRect: Readonly<RectWithValid>,\n    alpha: number,\n    parentHasRenderTexture: boolean,\n    framebufferDimensions: Dimensions,\n  ): void {\n    if (!state.vertexBuffer) {\n      // Nothing to draw\n      return;\n    }\n\n    const renderer = this.stage.renderer;\n    assertTruthy(renderer instanceof WebGlCoreRenderer);\n\n    const { fontSize, color, contain, scrollable, zIndex, debug } = state.props;\n\n    // scrollY only has an effect when contain === 'both' and scrollable === true\n    const scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;\n\n    const {\n      textW = 0,\n      textH = 0,\n      distanceRange,\n      vertexBuffer,\n      bufferUploaded,\n      trFontFace,\n      elementBounds,\n    } = state;\n\n    let { webGlBuffers } = state;\n\n    if (!webGlBuffers) {\n      const glw = renderer.glw;\n      const stride = 4 * Float32Array.BYTES_PER_ELEMENT;\n      const webGlBuffer = glw.createBuffer();\n      assertTruthy(webGlBuffer);\n      state.webGlBuffers = new BufferCollection([\n        {\n          buffer: webGlBuffer,\n          attributes: {\n            a_position: {\n              name: 'a_position',\n              size: 2, // 2 components per iteration\n              type: glw.FLOAT, // the data is 32bit floats\n              normalized: false, // don't normalize the data\n              stride, // 0 = move forward size * sizeof(type) each iteration to get the next position\n              offset: 0, // start at the beginning of the buffer\n            },\n            a_textureCoordinate: {\n              name: 'a_textureCoordinate',\n              size: 2,\n              type: glw.FLOAT,\n              normalized: false,\n              stride,\n              offset: 2 * Float32Array.BYTES_PER_ELEMENT,\n            },\n          },\n        },\n      ]);\n      state.bufferUploaded = false;\n      assertTruthy(state.webGlBuffers);\n      webGlBuffers = state.webGlBuffers;\n    }\n\n    if (!bufferUploaded) {\n      const glw = renderer.glw;\n\n      const buffer = webGlBuffers?.getBuffer('a_textureCoordinate') ?? null;\n      glw.arrayBufferData(buffer, vertexBuffer, glw.STATIC_DRAW);\n      state.bufferUploaded = true;\n    }\n\n    assertTruthy(trFontFace);\n    if (scrollable && contain === 'both') {\n      assertTruthy(elementBounds.valid);\n      const elementRect = convertBoundToRect(elementBounds, tmpRect);\n\n      if (clippingRect.valid) {\n        state.clippingRect.valid = true;\n        clippingRect = intersectRect(\n          clippingRect,\n          elementRect,\n          state.clippingRect,\n        );\n      } else {\n        state.clippingRect.valid = true;\n        clippingRect = copyRect(elementRect, state.clippingRect);\n      }\n    }\n\n    const renderOp = new WebGlCoreRenderOp(\n      renderer.glw,\n      renderer.options,\n      webGlBuffers,\n      this.sdfShader,\n      {\n        transform: transform.getFloatArr(),\n        // IMPORTANT: The SDF Shader expects the color NOT to be premultiplied\n        // for the best blending results. Which is why we use `mergeColorAlpha`\n        // instead of `mergeColorAlphaPremultiplied` here.\n        color: mergeColorAlpha(color, alpha),\n        size: fontSize / (trFontFace.data?.info.size || 0),\n        scrollY,\n        distanceRange,\n        debug: debug.sdfShaderDebug,\n      } satisfies SdfShaderProps,\n      alpha,\n      clippingRect,\n      { height: textH, width: textW },\n      0,\n      zIndex,\n      false,\n      parentHasRenderTexture,\n      framebufferDimensions,\n    );\n\n    const texture = state.trFontFace?.texture;\n    assertTruthy(texture);\n    const ctxTexture = texture.ctxTexture;\n\n    renderOp.addTexture(ctxTexture as WebGlCoreCtxTexture);\n    renderOp.length = state.bufferNumFloats;\n    renderOp.numQuads = state.bufferNumQuads;\n\n    renderer.addRenderOp(renderOp);\n\n    // if (!debug.disableScissor) {\n    //   renderer.enableScissor(\n    //     visibleRect.x,\n    //     visibleRect.y,\n    //     visibleRect.w,\n    //     visibleRect.h,\n    //   );\n    // }\n\n    // Draw the arrays\n    // gl.drawArrays(\n    //   gl.TRIANGLES, // Primitive type\n    //   0,\n    //   bufferNumVertices, // Number of verticies\n    // );\n\n    // renderer.disableScissor();\n\n    // if (debug.showElementRect) {\n    //   this.renderer.drawBorder(\n    //     Colors.Blue,\n    //     elementRect.x,\n    //     elementRect.y,\n    //     elementRect.w,\n    //     elementRect.h,\n    //   );\n    // }\n\n    // if (debug.showVisibleRect) {\n    //   this.renderer.drawBorder(\n    //     Colors.Green,\n    //     visibleRect.x,\n    //     visibleRect.y,\n    //     visibleRect.w,\n    //     visibleRect.h,\n    //   );\n    // }\n\n    // if (debug.showRenderWindow && renderWindow) {\n    //   this.renderer.drawBorder(\n    //     Colors.Red,\n    //     x + renderWindow.x1,\n    //     y + renderWindow.y1 - scrollY,\n    //     x + renderWindow.x2 - (x + renderWindow.x1),\n    //     y + renderWindow.y2 - scrollY - (y + renderWindow.y1 - scrollY),\n    //   );\n    // }\n    // if (debug.printLayoutTime) {\n    //   debugData.drawSum += performance.now() - drawStartTime;\n    //   debugData.drawCount++;\n    // }\n  }\n\n  override setIsRenderable(\n    state: SdfTextRendererState,\n    renderable: boolean,\n  ): void {\n    super.setIsRenderable(state, renderable);\n    state.trFontFace?.texture.setRenderableOwner(\n      state.props.fontFamily,\n      renderable,\n    );\n  }\n\n  override destroyState(state: SdfTextRendererState): void {\n    super.destroyState(state);\n    // If there's a Font Face assigned we must free the owner relation to its texture\n    state.trFontFace?.texture.setRenderableOwner(state.props.fontFamily, false);\n  }\n  //#endregion Overrides\n\n  public resolveFontFace(props: TrFontProps): SdfTrFontFace | undefined {\n    return this.stage.fontManager.resolveFontFace(\n      this.fontFamilyArray,\n      props,\n      'sdf',\n    ) as SdfTrFontFace | undefined;\n  }\n\n  /**\n   * Release the loaded SDF font face\n   *\n   * @param state\n   */\n  protected releaseFontFace(state: SdfTextRendererState) {\n    state.resLineHeight = undefined;\n    if (state.trFontFace) {\n      state.trFontFace.texture.setRenderableOwner(\n        state.props.fontFamily,\n        false,\n      );\n      state.trFontFace = undefined;\n    }\n  }\n\n  /**\n   * Invalidate the layout cache stored in the state. This will cause the text\n   * to be re-layed out on the next update.\n   *\n   * @remarks\n   * This also invalidates the visible window cache.\n   *\n   * @param state\n   */\n  protected invalidateLayoutCache(state: SdfTextRendererState): void {\n    state.renderWindow.valid = false;\n    state.elementBounds.valid = false;\n    state.textH = undefined;\n    state.textW = undefined;\n    state.lineCache = [];\n    this.setStatus(state, 'loading');\n    this.scheduleUpdateState(state);\n  }\n\n  protected setElementBoundsX(state: SdfTextRendererState): void {\n    const { x, contain, width } = state.props;\n    const { elementBounds } = state;\n    elementBounds.x1 = x;\n    elementBounds.x2 = contain !== 'none' ? x + width : Infinity;\n  }\n\n  protected setElementBoundsY(state: SdfTextRendererState): void {\n    const { y, contain, height } = state.props;\n    const { elementBounds } = state;\n    elementBounds.y1 = y;\n    elementBounds.y2 = contain === 'both' ? y + height : Infinity;\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { NormalizedFontMetrics } from './font-face-types/TrFontFace.js';\nimport type { WebTrFontFace } from './font-face-types/WebTrFontFace.js';\n\n/**\n * Returns CSS font setting string for use in canvas context.\n *\n * @param fontFace\n * @param fontStyle\n * @param fontSize\n * @param precision\n * @param defaultFontFace\n * @returns\n */\nexport function getFontSetting(\n  fontFace: string | string[],\n  fontStyle: string,\n  fontSize: number,\n  precision: number,\n  defaultFontFace: string,\n): string {\n  let ff = fontFace;\n\n  if (!Array.isArray(ff)) {\n    ff = [ff];\n  }\n\n  const ffs = [];\n  for (let i = 0, n = ff.length; i < n; i++) {\n    let curFf = ff[i];\n    // Replace the default font face `null` with the actual default font face set\n    // on the stage.\n    if (curFf === null || curFf === undefined) {\n      curFf = defaultFontFace;\n    }\n    if (curFf === 'serif' || curFf === 'sans-serif') {\n      ffs.push(curFf);\n    } else {\n      ffs.push(`\"${curFf}\"`);\n    }\n  }\n\n  return `${fontStyle} ${fontSize * precision}px ${ffs.join(',')}`;\n}\n\n/**\n * Returns true if the given character is a zero-width space.\n *\n * @param space\n */\nexport function isZeroWidthSpace(space: string): boolean {\n  return space === '' || space === '\\u200B';\n}\n\n/**\n * Returns true if the given character is a zero-width space or a regular space.\n *\n * @param space\n */\nexport function isSpace(space: string): boolean {\n  return isZeroWidthSpace(space) || space === ' ';\n}\n\n/**\n * Converts a string into an array of tokens and the words between them.\n *\n * @param tokenRegex\n * @param text\n */\nexport function tokenizeString(tokenRegex: RegExp, text: string): string[] {\n  const delimeters = text.match(tokenRegex) || [];\n  const words = text.split(tokenRegex) || [];\n\n  const final: string[] = [];\n  for (let i = 0; i < words.length; i++) {\n    final.push(words[i]!, delimeters[i]!);\n  }\n  final.pop();\n  return final.filter((word) => word != '');\n}\n\n/**\n * Measure the width of a string accounting for letter spacing.\n *\n * @param context\n * @param word\n * @param space\n */\nexport function measureText(\n  context: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\n  word: string,\n  space = 0,\n): number {\n  if (!space) {\n    return context.measureText(word).width;\n  }\n  return word.split('').reduce((acc, char) => {\n    // Zero-width spaces should not include letter spacing.\n    // And since we know the width of a zero-width space is 0, we can skip\n    // measuring it.\n    if (isZeroWidthSpace(char)) {\n      return acc;\n    }\n    return acc + context.measureText(char).width + space;\n  }, 0);\n}\n\n/**\n * Get the font metrics for a font face.\n *\n * @remarks\n * This function will attempt to grab the explicitly defined metrics from the\n * font face first. If the font face does not have metrics defined, it will\n * attempt to calculate the metrics using the browser's measureText method.\n *\n * If the browser does not support the font metrics API, it will use some\n * default values.\n *\n * @param context\n * @param fontFace\n * @param fontSize\n * @returns\n */\nexport function getWebFontMetrics(\n  context: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\n  fontFace: WebTrFontFace,\n  fontSize: number,\n): NormalizedFontMetrics {\n  if (fontFace.metrics) {\n    return fontFace.metrics;\n  }\n  // If the font face doesn't have metrics defined, we fallback to using the\n  // browser's measureText method to calculate take a best guess at the font\n  // actual font's metrics.\n  // - fontBoundingBox[Ascent|Descent] is the best estimate but only supported\n  //   in Chrome 87+ (2020), Firefox 116+ (2023), and Safari 11.1+ (2018).\n  //   - It is an estimate as it can vary between browsers.\n  // - actualBoundingBox[Ascent|Descent] is less accurate and supported in\n  //   Chrome 77+ (2019), Firefox 74+ (2020), and Safari 11.1+ (2018).\n  // - If neither are supported, we'll use some default values which will\n  //   get text on the screen but likely not be great.\n  // NOTE: It's been decided not to rely on fontBoundingBox[Ascent|Descent]\n  // as it's browser support is limited and it also tends to produce higher than\n  // expected values. It is instead HIGHLY RECOMMENDED that developers provide\n  // explicit metrics in the font face definition.\n  const browserMetrics = context.measureText(\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',\n  );\n  console.warn(\n    `Font metrics not provided for Canvas Web font ${fontFace.fontFamily}. ` +\n      'Using fallback values. It is HIGHLY recommended you use the latest ' +\n      'version of the Lightning 3 `msdf-generator` tool to extract the default ' +\n      'metrics for the font and provide them in the Canvas Web font definition.',\n  );\n  let metrics: NormalizedFontMetrics;\n  if (\n    browserMetrics.actualBoundingBoxDescent &&\n    browserMetrics.actualBoundingBoxAscent\n  ) {\n    metrics = {\n      ascender: browserMetrics.actualBoundingBoxAscent / fontSize,\n      descender: -browserMetrics.actualBoundingBoxDescent / fontSize,\n      lineGap: 0.2,\n    };\n  } else {\n    // If the browser doesn't support the font metrics API, we'll use some\n    // default values.\n    metrics = {\n      ascender: 0.8,\n      descender: -0.2,\n      lineGap: 0.2,\n    };\n  }\n  // Save the calculated metrics to the font face for future use.\n  (fontFace.metrics as NormalizedFontMetrics | null) = metrics;\n  return metrics;\n}\n\nexport interface WrapTextResult {\n  l: string[];\n  n: number[];\n}\n\n/**\n * Applies newlines to a string to have it optimally fit into the horizontal\n * bounds set by the Text object's wordWrapWidth property.\n *\n * @param context\n * @param text\n * @param wordWrapWidth\n * @param letterSpacing\n * @param indent\n */\nexport function wrapText(\n  context: CanvasRenderingContext2D,\n  text: string,\n  wordWrapWidth: number,\n  letterSpacing: number,\n  indent: number,\n): WrapTextResult {\n  // Greedy wrapping algorithm that will wrap words as the line grows longer.\n  // than its horizontal bounds.\n  const spaceRegex = / |\\u200B/g;\n  const lines = text.split(/\\r?\\n/g);\n  let allLines: string[] = [];\n  const realNewlines: number[] = [];\n  for (let i = 0; i < lines.length; i++) {\n    const resultLines: string[] = [];\n    let result = '';\n    let spaceLeft = wordWrapWidth - indent;\n    const words = lines[i]!.split(spaceRegex);\n    const spaces = lines[i]!.match(spaceRegex) || [];\n    for (let j = 0; j < words.length; j++) {\n      const space = spaces[j - 1] || '';\n      const word = words[j]!;\n      const wordWidth = measureText(context, word, letterSpacing);\n      const wordWidthWithSpace =\n        wordWidth + measureText(context, space, letterSpacing);\n      if (j === 0 || wordWidthWithSpace > spaceLeft) {\n        // Skip printing the newline if it's the first word of the line that is.\n        // greater than the word wrap width.\n        if (j > 0) {\n          resultLines.push(result);\n          result = '';\n        }\n        result += word;\n        spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n      } else {\n        spaceLeft -= wordWidthWithSpace;\n        result += space + word;\n      }\n    }\n\n    resultLines.push(result);\n    result = '';\n\n    allLines = allLines.concat(resultLines);\n\n    if (i < lines.length - 1) {\n      realNewlines.push(allLines.length);\n    }\n  }\n\n  return { l: allLines, n: realNewlines };\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-non-null-assertion */\n\nimport { assertTruthy } from '../../../utils.js';\nimport { getRgbaString, type RGBA } from '../../lib/utils.js';\nimport { calcDefaultLineHeight } from '../TextRenderingUtils.js';\nimport {\n  getWebFontMetrics,\n  isZeroWidthSpace,\n} from '../TextTextureRendererUtils.js';\nimport type { NormalizedFontMetrics } from '../font-face-types/TrFontFace.js';\nimport type { WebTrFontFace } from '../font-face-types/WebTrFontFace.js';\n\nconst MAX_TEXTURE_DIMENSION = 2048;\n\n/**\n * Text Overflow Values\n */\nexport type TextOverflow =\n  | 'ellipsis'\n  | 'clip'\n  | (string & Record<never, never>);\n\n/***\n * Text Horizontal Align Values\n */\nexport type TextAlign = 'left' | 'center' | 'right';\n\n/***\n * Text Baseline Values\n */\nexport type TextBaseline =\n  | 'alphabetic'\n  | 'top'\n  | 'hanging'\n  | 'middle'\n  | 'ideographic'\n  | 'bottom';\n\n/***\n * Text Vertical Align Values\n */\nexport type TextVerticalAlign = 'top' | 'middle' | 'bottom';\n\n/**\n * Text Texture Settings\n */\nexport interface Settings {\n  w: number;\n  h: number;\n  text: string;\n  fontStyle: string;\n  fontSize: number;\n  fontBaselineRatio: number;\n  fontFamily: string | null;\n  trFontFace: WebTrFontFace | null;\n  wordWrap: boolean;\n  wordWrapWidth: number;\n  wordBreak: boolean;\n  textOverflow: TextOverflow | null;\n  lineHeight: number | null;\n  textBaseline: TextBaseline;\n  textAlign: TextAlign;\n  verticalAlign: TextVerticalAlign;\n  offsetY: number | null;\n  maxLines: number;\n  maxHeight: number | null;\n  overflowSuffix: string;\n  precision: number;\n  textColor: RGBA;\n  paddingLeft: number;\n  paddingRight: number;\n  shadow: boolean;\n  shadowColor: RGBA;\n  shadowOffsetX: number;\n  shadowOffsetY: number;\n  shadowBlur: number;\n  highlight: boolean;\n  highlightHeight: number;\n  highlightColor: RGBA;\n  highlightOffset: number;\n  highlightPaddingLeft: number;\n  highlightPaddingRight: number;\n  letterSpacing: number;\n  textIndent: number;\n  cutSx: number;\n  cutSy: number;\n  cutEx: number;\n  cutEy: number;\n  advancedRenderer: boolean;\n\n  // Normally stage options\n  textRenderIssueMargin: number;\n}\n\nexport interface RenderInfo {\n  w: number;\n  h: number;\n  lines: string[];\n  precision: number;\n  remainingText: string;\n  moreTextLines: boolean;\n  width: number;\n  innerWidth: number;\n  height: number;\n  fontSize: number;\n  cutSx: number;\n  cutSy: number;\n  cutEx: number;\n  cutEy: number;\n  lineHeight: number;\n  defLineHeight: number;\n  lineWidths: number[];\n  offsetY: number;\n  paddingLeft: number;\n  paddingRight: number;\n  letterSpacing: number;\n  textIndent: number;\n  metrics: NormalizedFontMetrics;\n}\n\n/**\n * Calculate height for the canvas\n *\n * @param textBaseline\n * @param fontSize\n * @param lineHeight\n * @param numLines\n * @param offsetY\n * @returns\n */\nfunction calcHeight(\n  textBaseline: TextBaseline,\n  fontSize: number,\n  lineHeight: number,\n  numLines: number,\n  offsetY: number | null,\n) {\n  const baselineOffset = textBaseline !== 'bottom' ? 0.5 * fontSize : 0;\n  return (\n    lineHeight * (numLines - 1) +\n    baselineOffset +\n    Math.max(lineHeight, fontSize) +\n    (offsetY || 0)\n  );\n}\n\nexport class LightningTextTextureRenderer {\n  private _canvas: OffscreenCanvas | HTMLCanvasElement;\n  private _context:\n    | OffscreenCanvasRenderingContext2D\n    | CanvasRenderingContext2D;\n  private _settings: Settings;\n\n  constructor(\n    canvas: OffscreenCanvas | HTMLCanvasElement,\n    context: OffscreenCanvasRenderingContext2D | CanvasRenderingContext2D,\n  ) {\n    this._canvas = canvas;\n    this._context = context;\n    this._settings = this.mergeDefaults({});\n  }\n\n  set settings(v: Partial<Settings>) {\n    this._settings = this.mergeDefaults(v);\n  }\n\n  get settings(): Settings {\n    return this._settings;\n  }\n\n  getPrecision() {\n    return this._settings.precision;\n  }\n\n  setFontProperties() {\n    this._context.font = this._getFontSetting();\n    this._context.textBaseline = this._settings.textBaseline;\n  }\n\n  _getFontSetting() {\n    const ff = [this._settings.fontFamily];\n\n    const ffs = [];\n    for (let i = 0, n = ff.length; i < n; i++) {\n      if (ff[i] === 'serif' || ff[i] === 'sans-serif') {\n        ffs.push(ff[i]);\n      } else {\n        ffs.push(`\"${ff[i]!}\"`);\n      }\n    }\n\n    return `${this._settings.fontStyle} ${\n      this._settings.fontSize * this.getPrecision()\n    }px ${ffs.join(',')}`;\n  }\n\n  _load() {\n    if (true && document.fonts) {\n      const fontSetting = this._getFontSetting();\n      try {\n        if (!document.fonts.check(fontSetting, this._settings.text)) {\n          // Use a promise that waits for loading.\n          return document.fonts\n            .load(fontSetting, this._settings.text)\n            .catch((err) => {\n              // Just load the fallback font.\n              console.warn('[Lightning] Font load error', err, fontSetting);\n            })\n            .then(() => {\n              if (!document.fonts.check(fontSetting, this._settings.text)) {\n                console.warn('[Lightning] Font not found', fontSetting);\n              }\n            });\n        }\n      } catch (e) {\n        console.warn(\"[Lightning] Can't check font loading for \" + fontSetting);\n      }\n    }\n  }\n\n  calculateRenderInfo(): RenderInfo {\n    const renderInfo: Partial<RenderInfo> = {};\n\n    const precision = this.getPrecision();\n\n    const paddingLeft = this._settings.paddingLeft * precision;\n    const paddingRight = this._settings.paddingRight * precision;\n    const fontSize = this._settings.fontSize * precision;\n    let offsetY =\n      this._settings.offsetY === null\n        ? null\n        : this._settings.offsetY * precision;\n    const w = this._settings.w * precision;\n    const h = this._settings.h * precision;\n    let wordWrapWidth = this._settings.wordWrapWidth * precision;\n    const cutSx = this._settings.cutSx * precision;\n    const cutEx = this._settings.cutEx * precision;\n    const cutSy = this._settings.cutSy * precision;\n    const cutEy = this._settings.cutEy * precision;\n    const letterSpacing = (this._settings.letterSpacing || 0) * precision;\n    const textIndent = this._settings.textIndent * precision;\n    const trFontFace = this._settings.trFontFace;\n\n    // Set font properties.\n    this.setFontProperties();\n\n    assertTruthy(trFontFace);\n    const metrics = getWebFontMetrics(this._context, trFontFace, fontSize);\n    const defLineHeight = calcDefaultLineHeight(metrics, fontSize) * precision;\n    const lineHeight =\n      this._settings.lineHeight !== null\n        ? this._settings.lineHeight * precision\n        : defLineHeight;\n\n    const maxHeight = this._settings.maxHeight;\n    const containedMaxLines =\n      maxHeight !== null && lineHeight > 0\n        ? Math.floor(maxHeight / lineHeight)\n        : 0;\n\n    const setMaxLines = this._settings.maxLines;\n    const calcMaxLines =\n      containedMaxLines > 0 && setMaxLines > 0\n        ? Math.min(containedMaxLines, setMaxLines)\n        : Math.max(containedMaxLines, setMaxLines);\n\n    // Total width.\n    let width = w || 2048 / this.getPrecision();\n\n    // Inner width.\n    let innerWidth = width - paddingLeft;\n    if (innerWidth < 10) {\n      width += 10 - innerWidth;\n      innerWidth = 10;\n    }\n\n    if (!wordWrapWidth) {\n      wordWrapWidth = innerWidth;\n    }\n\n    // Text overflow\n    if (this._settings.textOverflow && !this._settings.wordWrap) {\n      let suffix;\n      switch (this._settings.textOverflow) {\n        case 'clip':\n          suffix = '';\n          break;\n        case 'ellipsis':\n          suffix = this._settings.overflowSuffix;\n          break;\n        default:\n          suffix = this._settings.textOverflow;\n      }\n      this._settings.text = this.wrapWord(\n        this._settings.text,\n        wordWrapWidth - textIndent,\n        suffix,\n      );\n    }\n\n    // word wrap\n    // preserve original text\n    let linesInfo: { n: number[]; l: string[] };\n    if (this._settings.wordWrap) {\n      linesInfo = this.wrapText(\n        this._settings.text,\n        wordWrapWidth,\n        letterSpacing,\n        textIndent,\n      );\n    } else {\n      linesInfo = { l: this._settings.text.split(/(?:\\r\\n|\\r|\\n)/), n: [] };\n      const n = linesInfo.l.length;\n      for (let i = 0; i < n - 1; i++) {\n        linesInfo.n.push(i);\n      }\n    }\n    let lines = linesInfo.l;\n\n    if (calcMaxLines && lines.length > calcMaxLines) {\n      const usedLines = lines.slice(0, calcMaxLines);\n\n      let otherLines = null;\n      if (this._settings.overflowSuffix) {\n        // Wrap again with max lines suffix enabled.\n        const w = this._settings.overflowSuffix\n          ? this.measureText(this._settings.overflowSuffix)\n          : 0;\n        const al = this.wrapText(\n          usedLines[usedLines.length - 1]!,\n          wordWrapWidth - w,\n          letterSpacing,\n          textIndent,\n        );\n        usedLines[usedLines.length - 1] = `${al.l[0]!}${\n          this._settings.overflowSuffix\n        }`;\n        otherLines = [al.l.length > 1 ? al.l[1] : ''];\n      } else {\n        otherLines = [''];\n      }\n\n      // Re-assemble the remaining text.\n      let i;\n      const n = lines.length;\n      let j = 0;\n      const m = linesInfo.n.length;\n      for (i = calcMaxLines; i < n; i++) {\n        otherLines[j] += `${otherLines[j] ? ' ' : ''}${lines[i]!}`;\n        if (i + 1 < m && linesInfo.n[i + 1]) {\n          j++;\n        }\n      }\n\n      renderInfo.remainingText = otherLines.join('\\n');\n\n      renderInfo.moreTextLines = true;\n\n      lines = usedLines;\n    } else {\n      renderInfo.moreTextLines = false;\n      renderInfo.remainingText = '';\n    }\n\n    // calculate text width\n    let maxLineWidth = 0;\n    const lineWidths: number[] = [];\n    for (let i = 0; i < lines.length; i++) {\n      const lineWidth =\n        this.measureText(lines[i]!, letterSpacing) + (i === 0 ? textIndent : 0);\n      lineWidths.push(lineWidth);\n      maxLineWidth = Math.max(maxLineWidth, lineWidth);\n    }\n\n    renderInfo.lineWidths = lineWidths;\n\n    if (!w) {\n      // Auto-set width to max text length.\n      width = maxLineWidth + paddingLeft + paddingRight;\n      innerWidth = maxLineWidth;\n    }\n\n    // If word wrap is enabled the width needs to be the width of the text.\n    if (\n      this._settings.wordWrap &&\n      w > maxLineWidth &&\n      this._settings.textAlign === 'left' &&\n      lines.length === 1\n    ) {\n      width = maxLineWidth + paddingLeft + paddingRight;\n    }\n\n    let height;\n    if (h) {\n      height = h;\n    } else {\n      height = calcHeight(\n        this._settings.textBaseline,\n        fontSize,\n        lineHeight,\n        lines.length,\n        offsetY,\n      );\n    }\n\n    if (offsetY === null) {\n      offsetY = fontSize;\n    }\n\n    renderInfo.w = width;\n    renderInfo.h = height;\n    renderInfo.lines = lines;\n    renderInfo.precision = precision;\n\n    if (!width) {\n      // To prevent canvas errors.\n      width = 1;\n    }\n\n    if (!height) {\n      // To prevent canvas errors.\n      height = 1;\n    }\n\n    if (cutSx || cutEx) {\n      width = Math.min(width, cutEx - cutSx);\n    }\n\n    if (cutSy || cutEy) {\n      height = Math.min(height, cutEy - cutSy);\n    }\n\n    renderInfo.width = width;\n    renderInfo.innerWidth = innerWidth;\n    renderInfo.height = height;\n    renderInfo.fontSize = fontSize;\n    renderInfo.cutSx = cutSx;\n    renderInfo.cutSy = cutSy;\n    renderInfo.cutEx = cutEx;\n    renderInfo.cutEy = cutEy;\n    renderInfo.lineHeight = lineHeight;\n    renderInfo.defLineHeight = defLineHeight;\n    renderInfo.lineWidths = lineWidths;\n    renderInfo.offsetY = offsetY;\n    renderInfo.paddingLeft = paddingLeft;\n    renderInfo.paddingRight = paddingRight;\n    renderInfo.letterSpacing = letterSpacing;\n    renderInfo.textIndent = textIndent;\n    renderInfo.metrics = metrics;\n\n    return renderInfo as RenderInfo;\n  }\n\n  draw(\n    renderInfo: RenderInfo,\n    linesOverride?: { lines: string[]; lineWidths: number[] },\n  ) {\n    const precision = this.getPrecision();\n\n    // Allow lines to be overriden for partial rendering.\n    const lines = linesOverride?.lines || renderInfo.lines;\n    const lineWidths = linesOverride?.lineWidths || renderInfo.lineWidths;\n    const height = linesOverride\n      ? calcHeight(\n          this._settings.textBaseline,\n          renderInfo.fontSize,\n          renderInfo.lineHeight,\n          linesOverride.lines.length,\n          this._settings.offsetY === null\n            ? null\n            : this._settings.offsetY * precision,\n        )\n      : renderInfo.height;\n\n    // Add extra margin to prevent issue with clipped text when scaling.\n    this._canvas.width = Math.min(\n      Math.ceil(renderInfo.width + this._settings.textRenderIssueMargin),\n      MAX_TEXTURE_DIMENSION,\n    );\n    this._canvas.height = Math.min(Math.ceil(height), MAX_TEXTURE_DIMENSION);\n\n    // Canvas context has been reset.\n    this.setFontProperties();\n\n    if (renderInfo.fontSize >= 128) {\n      // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.\n      this._context.globalAlpha = 0.01;\n      this._context.fillRect(0, 0, 0.01, 0.01);\n      this._context.globalAlpha = 1.0;\n    }\n\n    if (renderInfo.cutSx || renderInfo.cutSy) {\n      this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);\n    }\n\n    let linePositionX;\n    let linePositionY;\n\n    const drawLines = [];\n\n    const { metrics } = renderInfo;\n\n    /**\n     * Ascender (in pixels)\n     */\n    const ascenderPx = metrics\n      ? metrics.ascender * renderInfo.fontSize\n      : renderInfo.fontSize;\n\n    /**\n     * Bare line height is the distance between the ascender and descender of the font.\n     * without the line gap metric.\n     */\n    const bareLineHeightPx =\n      (metrics.ascender - metrics.descender) * renderInfo.fontSize;\n\n    // Draw lines line by line.\n    for (let i = 0, n = lines.length; i < n; i++) {\n      linePositionX = i === 0 ? renderInfo.textIndent : 0;\n\n      // By default, text is aligned to top\n      linePositionY = i * renderInfo.lineHeight + ascenderPx;\n\n      if (this._settings.verticalAlign == 'middle') {\n        linePositionY += (renderInfo.lineHeight - bareLineHeightPx) / 2;\n      } else if (this._settings.verticalAlign == 'bottom') {\n        linePositionY += renderInfo.lineHeight - bareLineHeightPx;\n      }\n\n      if (this._settings.textAlign === 'right') {\n        linePositionX += renderInfo.innerWidth - lineWidths[i]!;\n      } else if (this._settings.textAlign === 'center') {\n        linePositionX += (renderInfo.innerWidth - lineWidths[i]!) / 2;\n      }\n      linePositionX += renderInfo.paddingLeft;\n\n      drawLines.push({\n        text: lines[i]!,\n        x: linePositionX,\n        y: linePositionY,\n        w: lineWidths[i]!,\n      });\n    }\n\n    // Highlight.\n    if (this._settings.highlight) {\n      const color = this._settings.highlightColor;\n\n      const hlHeight =\n        this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5;\n      const offset = this._settings.highlightOffset * precision;\n      const hlPaddingLeft =\n        this._settings.highlightPaddingLeft !== null\n          ? this._settings.highlightPaddingLeft * precision\n          : renderInfo.paddingLeft;\n      const hlPaddingRight =\n        this._settings.highlightPaddingRight !== null\n          ? this._settings.highlightPaddingRight * precision\n          : renderInfo.paddingRight;\n\n      this._context.fillStyle = getRgbaString(color);\n      for (let i = 0; i < drawLines.length; i++) {\n        const drawLine = drawLines[i]!;\n        this._context.fillRect(\n          drawLine.x - hlPaddingLeft,\n          drawLine.y - renderInfo.offsetY + offset,\n          drawLine.w + hlPaddingRight + hlPaddingLeft,\n          hlHeight,\n        );\n      }\n    }\n\n    // Text shadow.\n    let prevShadowSettings: null | [string, number, number, number] = null;\n    if (this._settings.shadow) {\n      prevShadowSettings = [\n        this._context.shadowColor,\n        this._context.shadowOffsetX,\n        this._context.shadowOffsetY,\n        this._context.shadowBlur,\n      ];\n\n      this._context.shadowColor = getRgbaString(this._settings.shadowColor);\n      this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;\n      this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;\n      this._context.shadowBlur = this._settings.shadowBlur * precision;\n    }\n\n    this._context.fillStyle = getRgbaString(this._settings.textColor);\n    for (let i = 0, n = drawLines.length; i < n; i++) {\n      const drawLine = drawLines[i]!;\n\n      if (renderInfo.letterSpacing === 0) {\n        this._context.fillText(drawLine.text, drawLine.x, drawLine.y);\n      } else {\n        const textSplit = drawLine.text.split('');\n        let x = drawLine.x;\n        for (let i = 0, j = textSplit.length; i < j; i++) {\n          this._context.fillText(textSplit[i]!, x, drawLine.y);\n          x += this.measureText(textSplit[i]!, renderInfo.letterSpacing);\n        }\n      }\n    }\n\n    if (prevShadowSettings) {\n      this._context.shadowColor = prevShadowSettings[0];\n      this._context.shadowOffsetX = prevShadowSettings[1];\n      this._context.shadowOffsetY = prevShadowSettings[2];\n      this._context.shadowBlur = prevShadowSettings[3];\n    }\n\n    if (renderInfo.cutSx || renderInfo.cutSy) {\n      this._context.translate(renderInfo.cutSx, renderInfo.cutSy);\n    }\n  }\n\n  wrapWord(word: string, wordWrapWidth: number, suffix: string) {\n    const suffixWidth = this._context.measureText(suffix).width;\n    const wordLen = word.length;\n    const wordWidth = this._context.measureText(word).width;\n\n    /* If word fits wrapWidth, do nothing */\n    if (wordWidth <= wordWrapWidth) {\n      return word;\n    }\n\n    /* Make initial guess for text cuttoff */\n    let cutoffIndex = Math.floor((wordWrapWidth * wordLen) / wordWidth);\n    let truncWordWidth =\n      this._context.measureText(word.substring(0, cutoffIndex)).width +\n      suffixWidth;\n\n    /* In case guess was overestimated, shrink it letter by letter. */\n    if (truncWordWidth > wordWrapWidth) {\n      while (cutoffIndex > 0) {\n        truncWordWidth =\n          this._context.measureText(word.substring(0, cutoffIndex)).width +\n          suffixWidth;\n        if (truncWordWidth > wordWrapWidth) {\n          cutoffIndex -= 1;\n        } else {\n          break;\n        }\n      }\n\n      /* In case guess was underestimated, extend it letter by letter. */\n    } else {\n      while (cutoffIndex < wordLen) {\n        truncWordWidth =\n          this._context.measureText(word.substring(0, cutoffIndex)).width +\n          suffixWidth;\n        if (truncWordWidth < wordWrapWidth) {\n          cutoffIndex += 1;\n        } else {\n          // Finally, when bound is crossed, retract last letter.\n          cutoffIndex -= 1;\n          break;\n        }\n      }\n    }\n\n    /* If wrapWidth is too short to even contain suffix alone, return empty string */\n    return (\n      word.substring(0, cutoffIndex) +\n      (wordWrapWidth >= suffixWidth ? suffix : '')\n    );\n  }\n\n  /**\n   * Applies newlines to a string to have it optimally fit into the horizontal\n   * bounds set by the Text object's wordWrapWidth property.\n   */\n  wrapText(\n    text: string,\n    wordWrapWidth: number,\n    letterSpacing: number,\n    indent = 0,\n  ) {\n    const spaceRegex = / |\\u200B/g; // ZWSP and spaces\n    const lines = text.split(/\\r?\\n/g);\n    let allLines: string[] = [];\n    const realNewlines: number[] = [];\n\n    for (let i = 0; i < lines.length; i++) {\n      const resultLines: string[] = [];\n      let result = '';\n      let spaceLeft = wordWrapWidth - indent;\n\n      // Split the line into words, considering ZWSP\n      const words = lines[i]!.split(spaceRegex);\n      const spaces = lines[i]!.match(spaceRegex) || [];\n\n      for (let j = 0; j < words.length; j++) {\n        const space = spaces[j - 1] || '';\n        const word = words[j]!;\n        const wordWidth = this.measureText(word, letterSpacing);\n        const wordWidthWithSpace = isZeroWidthSpace(space)\n          ? wordWidth\n          : wordWidth + this.measureText(space, letterSpacing);\n\n        if (j === 0 || wordWidthWithSpace > spaceLeft) {\n          if (j > 0) {\n            resultLines.push(result);\n            result = '';\n          }\n          result += word;\n          spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);\n        } else {\n          spaceLeft -= wordWidthWithSpace;\n          result += space + word;\n        }\n      }\n\n      resultLines.push(result);\n      result = '';\n      allLines = allLines.concat(resultLines);\n\n      if (i < lines.length - 1) {\n        realNewlines.push(allLines.length);\n      }\n    }\n\n    return { l: allLines, n: realNewlines };\n  }\n\n  measureText(word: string, space = 0) {\n    if (!space) {\n      return this._context.measureText(word).width;\n    }\n\n    // Split word into characters, but skip ZWSP in the width calculation\n    return word.split('').reduce((acc, char) => {\n      // Check if the character is a zero-width space and skip it\n      if (isZeroWidthSpace(char)) {\n        return acc;\n      }\n      return acc + this._context.measureText(char).width + space;\n    }, 0);\n  }\n\n  mergeDefaults(settings: Partial<Settings>): Settings {\n    return {\n      text: '',\n      w: 0,\n      h: 0,\n      fontStyle: 'normal',\n      fontSize: 40,\n      fontFamily: null,\n      trFontFace: null,\n      wordWrap: true,\n      wordWrapWidth: 0,\n      wordBreak: false,\n      textOverflow: '',\n      lineHeight: null,\n      textBaseline: 'alphabetic',\n      textAlign: 'left',\n      verticalAlign: 'top',\n      offsetY: null,\n      maxLines: 0,\n      maxHeight: null,\n      overflowSuffix: '...',\n      textColor: [1.0, 1.0, 1.0, 1.0],\n      paddingLeft: 0,\n      paddingRight: 0,\n      shadow: false,\n      shadowColor: [0.0, 0.0, 0.0, 1.0],\n      shadowOffsetX: 0,\n      shadowOffsetY: 0,\n      shadowBlur: 5,\n      highlight: false,\n      highlightHeight: 0,\n      highlightColor: [0.0, 0.0, 0.0, 1.0],\n      highlightOffset: 0,\n      highlightPaddingLeft: 0,\n      highlightPaddingRight: 0,\n      letterSpacing: 0,\n      textIndent: 0,\n      cutSx: 0,\n      cutEx: 0,\n      cutSy: 0,\n      cutEy: 0,\n      advancedRenderer: false,\n      fontBaselineRatio: 0,\n      precision: 1,\n      textRenderIssueMargin: 0,\n      ...settings,\n    };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from '../../../common/EventEmitter.js';\nimport { assertTruthy } from '../../../utils.js';\nimport type { CoreNode } from '../../CoreNode.js';\nimport type { CoreTextNode } from '../../CoreTextNode.js';\nimport type { Stage } from '../../Stage.js';\nimport {\n  getNormalizedRgbaComponents,\n  getNormalizedAlphaComponent,\n} from '../../lib/utils.js';\nimport { type FontFamilyMap } from '../TrFontManager.js';\nimport type { TrFontFace } from '../font-face-types/TrFontFace.js';\nimport { WebTrFontFace } from '../font-face-types/WebTrFontFace.js';\nimport {\n  LightningTextTextureRenderer,\n  type RenderInfo,\n} from './LightningTextTextureRenderer.js';\nimport {\n  TextRenderer,\n  type TextRendererState,\n  type TrFontProps,\n  type TrPropSetters,\n  type TrProps,\n} from './TextRenderer.js';\n\nconst resolvedGlobal = typeof self === 'undefined' ? globalThis : self;\n\n/**\n * Global font set regardless of if run in the main thread or a web worker\n */\nconst globalFontSet: FontFaceSet = (resolvedGlobal.document?.fonts ||\n  (resolvedGlobal as any).fonts) as FontFaceSet;\n\ndeclare module './TextRenderer.js' {\n  interface TextRendererMap {\n    canvas: CanvasTextRenderer;\n  }\n}\n\nfunction getFontCssString(props: TrProps): string {\n  const { fontFamily, fontStyle, fontWeight, fontStretch, fontSize } = props;\n  return [fontStyle, fontWeight, fontStretch, `${fontSize}px`, fontFamily].join(\n    ' ',\n  );\n}\n\nexport interface CanvasTextRendererState extends TextRendererState {\n  node: CoreTextNode;\n  props: TrProps;\n  fontInfo:\n    | {\n        fontFace: WebTrFontFace;\n        cssString: string;\n        loaded: boolean;\n      }\n    | undefined;\n  textureNode: CoreNode | undefined;\n  lightning2TextRenderer: LightningTextTextureRenderer;\n  renderInfo: RenderInfo | undefined;\n}\n\nexport class CanvasTextRenderer extends TextRenderer<CanvasTextRendererState> {\n  protected canvas: OffscreenCanvas | HTMLCanvasElement;\n  protected context:\n    | OffscreenCanvasRenderingContext2D\n    | CanvasRenderingContext2D;\n  /**\n   * Font family map used to store web font faces that were added to the\n   * canvas text renderer.\n   */\n  private fontFamilies: FontFamilyMap = {};\n  private fontFamilyArray: FontFamilyMap[] = [this.fontFamilies];\n\n  public type: 'canvas' | 'sdf' = 'canvas';\n\n  constructor(stage: Stage) {\n    super(stage);\n    if (typeof OffscreenCanvas !== 'undefined') {\n      this.canvas = new OffscreenCanvas(0, 0);\n    } else {\n      this.canvas = document.createElement('canvas');\n    }\n\n    let context = this.canvas.getContext('2d', {\n      willReadFrequently: true,\n    }) as OffscreenCanvasRenderingContext2D | CanvasRenderingContext2D | null;\n    if (!context) {\n      // A browser may appear to support OffscreenCanvas but not actually support the Canvas '2d' context\n      // Here we try getting the context again after falling back to an HTMLCanvasElement.\n      // See: https://github.com/lightning-js/renderer/issues/26#issuecomment-1750438486\n      this.canvas = document.createElement('canvas');\n      context = this.canvas.getContext('2d', {\n        willReadFrequently: true,\n      });\n    }\n    assertTruthy(context);\n    this.context = context;\n\n    // Install the default 'san-serif' font face\n    this.addFontFace(\n      new WebTrFontFace({\n        fontFamily: 'sans-serif',\n        descriptors: {},\n        fontUrl: '',\n      }),\n    );\n  }\n\n  //#region Overrides\n  override getPropertySetters(): Partial<\n    TrPropSetters<CanvasTextRendererState>\n  > {\n    return {\n      fontFamily: (state, value) => {\n        state.props.fontFamily = value;\n        state.fontInfo = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      fontWeight: (state, value) => {\n        state.props.fontWeight = value;\n        state.fontInfo = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      fontStyle: (state, value) => {\n        state.props.fontStyle = value;\n        state.fontInfo = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      fontStretch: (state, value) => {\n        state.props.fontStretch = value;\n        state.fontInfo = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      fontSize: (state, value) => {\n        state.props.fontSize = value;\n        state.fontInfo = undefined;\n        this.invalidateLayoutCache(state);\n      },\n      text: (state, value) => {\n        state.props.text = value;\n        this.invalidateLayoutCache(state);\n      },\n      textAlign: (state, value) => {\n        state.props.textAlign = value;\n        this.invalidateLayoutCache(state);\n      },\n      color: (state, value) => {\n        state.props.color = value;\n        this.invalidateLayoutCache(state);\n      },\n      x: (state, value) => {\n        state.props.x = value;\n      },\n      y: (state, value) => {\n        state.props.y = value;\n      },\n      contain: (state, value) => {\n        state.props.contain = value;\n        this.invalidateLayoutCache(state);\n      },\n      width: (state, value) => {\n        state.props.width = value;\n        // Only invalidate layout cache if we're containing in the horizontal direction\n        if (state.props.contain !== 'none') {\n          this.invalidateLayoutCache(state);\n        }\n      },\n      height: (state, value) => {\n        state.props.height = value;\n        // Only invalidate layout cache if we're containing in the vertical direction\n        if (state.props.contain === 'both') {\n          this.invalidateLayoutCache(state);\n        }\n      },\n      offsetY: (state, value) => {\n        state.props.offsetY = value;\n        this.invalidateLayoutCache(state);\n      },\n      scrollY: (state, value) => {\n        state.props.scrollY = value;\n      },\n      letterSpacing: (state, value) => {\n        state.props.letterSpacing = value;\n        this.invalidateLayoutCache(state);\n      },\n      lineHeight: (state, value) => {\n        state.props.lineHeight = value;\n        this.invalidateLayoutCache(state);\n      },\n      maxLines: (state, value) => {\n        state.props.maxLines = value;\n        this.invalidateLayoutCache(state);\n      },\n      textBaseline: (state, value) => {\n        state.props.textBaseline = value;\n        this.invalidateLayoutCache(state);\n      },\n      verticalAlign: (state, value) => {\n        state.props.verticalAlign = value;\n        this.invalidateLayoutCache(state);\n      },\n      overflowSuffix: (state, value) => {\n        state.props.overflowSuffix = value;\n        this.invalidateLayoutCache(state);\n      },\n    };\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  override canRenderFont(props: TrFontProps): boolean {\n    // The canvas renderer can render any font because it automatically\n    // falls back to system fonts. The CanvasTextRenderer should be\n    // checked last if other renderers are preferred.\n    return true;\n  }\n\n  override isFontFaceSupported(fontFace: TrFontFace): boolean {\n    return fontFace instanceof WebTrFontFace;\n  }\n\n  override addFontFace(fontFace: TrFontFace): void {\n    // Make sure the font face is an Canvas font face (it should have already passed\n    // the `isFontFaceSupported` check)\n    assertTruthy(fontFace instanceof WebTrFontFace);\n\n    const fontFamily = fontFace.fontFamily;\n\n    // Add the font face to the document\n    // Except for the 'sans-serif' font family, which the Renderer provides\n    // as a special default fallback.\n    if (fontFamily !== 'sans-serif') {\n      // @ts-expect-error `add()` method should be available from a FontFaceSet\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      globalFontSet.add(fontFace.fontFace);\n    }\n\n    let faceSet = this.fontFamilies[fontFamily];\n    if (!faceSet) {\n      faceSet = new Set();\n      this.fontFamilies[fontFamily] = faceSet;\n    }\n    faceSet.add(fontFace);\n  }\n\n  override createState(\n    props: TrProps,\n    node: CoreTextNode,\n  ): CanvasTextRendererState {\n    return {\n      node,\n      props,\n      status: 'initialState',\n      updateScheduled: false,\n      emitter: new EventEmitter(),\n      textureNode: undefined,\n      lightning2TextRenderer: new LightningTextTextureRenderer(\n        this.canvas,\n        this.context,\n      ),\n      renderInfo: undefined,\n      forceFullLayoutCalc: false,\n      textW: 0,\n      textH: 0,\n      fontInfo: undefined,\n      isRenderable: false,\n      debugData: {\n        updateCount: 0,\n        layoutCount: 0,\n        drawCount: 0,\n        lastLayoutNumCharacters: 0,\n        layoutSum: 0,\n        drawSum: 0,\n        bufferSize: 0,\n      },\n    };\n  }\n\n  override updateState(state: CanvasTextRendererState): void {\n    // On the first update call we need to set the status to loading\n    if (state.status === 'initialState') {\n      this.setStatus(state, 'loading');\n      // check if we're on screen\n      // if (this.isValidOnScreen(state) === true) {\n      //   this.setStatus(state, 'loading');\n      // }\n    }\n\n    if (state.status === 'loaded') {\n      // If we're loaded, we don't need to do anything\n      return;\n    }\n\n    // If fontInfo is invalid, we need to establish it\n    if (!state.fontInfo) {\n      return this.loadFont(state);\n    }\n\n    // If we're waiting for a font face to load, don't render anything\n    if (!state.fontInfo.loaded) {\n      return;\n    }\n\n    if (!state.renderInfo) {\n      state.renderInfo = this.calculateRenderInfo(state);\n      state.textH = state.renderInfo.lineHeight * state.renderInfo.lines.length;\n      state.textW = state.renderInfo.width;\n      this.renderSingleCanvasPage(state);\n    }\n\n    // handle scrollable text !!!\n    // if (state.isScrollable === true) {\n    //   return this.renderScrollableCanvasPages(state);\n    // }\n\n    // handle single page text\n  }\n\n  renderSingleCanvasPage(state: CanvasTextRendererState): void {\n    assertTruthy(state.renderInfo);\n    const node = state.node;\n\n    const texture = this.stage.txManager.createTexture('ImageTexture', {\n      premultiplyAlpha: true,\n      src: function (\n        this: CanvasTextRenderer,\n        lightning2TextRenderer: LightningTextTextureRenderer,\n        renderInfo: RenderInfo,\n      ) {\n        // load the canvas texture\n        assertTruthy(renderInfo);\n        lightning2TextRenderer.draw(renderInfo, {\n          lines: renderInfo.lines,\n          lineWidths: renderInfo.lineWidths,\n        });\n        if (this.canvas.width === 0 || this.canvas.height === 0) {\n          return null;\n        }\n        return this.context.getImageData(\n          0,\n          0,\n          this.canvas.width,\n          this.canvas.height,\n        );\n      }.bind(this, state.lightning2TextRenderer, state.renderInfo),\n    });\n\n    if (state.textureNode) {\n      // Use the existing texture node\n      state.textureNode.texture = texture;\n      // Update the alpha\n      state.textureNode.alpha = getNormalizedAlphaComponent(state.props.color);\n    } else {\n      // Create a new texture node\n      const textureNode = this.stage.createNode({\n        parent: node,\n        texture,\n        autosize: true,\n        // The alpha channel of the color is ignored when rasterizing the text\n        // texture so we need to pass it directly to the texture node.\n        alpha: getNormalizedAlphaComponent(state.props.color),\n      });\n      state.textureNode = textureNode;\n    }\n\n    this.setStatus(state, 'loaded');\n  }\n\n  loadFont = (state: CanvasTextRendererState): void => {\n    const cssString = getFontCssString(state.props);\n\n    const trFontFace = this.stage.fontManager.resolveFontFace(\n      this.fontFamilyArray,\n      state.props,\n      'canvas',\n    ) as WebTrFontFace | undefined;\n    assertTruthy(trFontFace, `Could not resolve font face for ${cssString}`);\n    state.fontInfo = {\n      fontFace: trFontFace,\n      cssString: cssString,\n      // TODO: For efficiency we would use this here but it's not reliable on WPE -> document.fonts.check(cssString),\n      loaded: false,\n    };\n    // If font is not loaded, set up a handler to update the font info when the font loads\n    if (!state.fontInfo.loaded) {\n      globalFontSet\n        .load(cssString)\n        .then(this.onFontLoaded.bind(this, state, cssString))\n        .catch(this.onFontLoadError.bind(this, state, cssString));\n      return;\n    }\n  };\n\n  calculateRenderInfo(state: CanvasTextRendererState): RenderInfo {\n    state.lightning2TextRenderer.settings = {\n      text: state.props.text,\n      textAlign: state.props.textAlign,\n      fontFamily: state.props.fontFamily,\n      trFontFace: state.fontInfo?.fontFace,\n      fontSize: state.props.fontSize,\n      fontStyle: [\n        state.props.fontStretch,\n        state.props.fontStyle,\n        state.props.fontWeight,\n      ].join(' '),\n      textColor: getNormalizedRgbaComponents(state.props.color),\n      offsetY: state.props.offsetY,\n      wordWrap: state.props.contain !== 'none',\n      wordWrapWidth:\n        state.props.contain === 'none' ? undefined : state.props.width,\n      letterSpacing: state.props.letterSpacing,\n      lineHeight: state.props.lineHeight ?? null,\n      maxLines: state.props.maxLines,\n      maxHeight:\n        state.props.contain === 'both'\n          ? state.props.height - state.props.offsetY\n          : null,\n      textBaseline: state.props.textBaseline,\n      verticalAlign: state.props.verticalAlign,\n      overflowSuffix: state.props.overflowSuffix,\n      w: state.props.contain !== 'none' ? state.props.width : undefined,\n    };\n    state.renderInfo = state.lightning2TextRenderer.calculateRenderInfo();\n    return state.renderInfo;\n  }\n\n  override renderQuads(): void {\n    // Do nothing. The renderer will render the child node(s) that were created\n    // in the state update.\n    return;\n  }\n\n  override destroyState(state: CanvasTextRendererState): void {\n    if (state.status === 'destroyed') {\n      return;\n    }\n    super.destroyState(state);\n\n    if (state.textureNode) {\n      state.textureNode.destroy();\n      delete state.textureNode;\n    }\n    delete state.renderInfo;\n  }\n  //#endregion Overrides\n\n  /**\n   * Invalidate the layout cache stored in the state. This will cause the text\n   * to be re-rendered on the next update.\n   *\n   * @remarks\n   * This also invalidates the visible window cache.\n   *\n   * @param state\n   */\n  private invalidateLayoutCache(state: CanvasTextRendererState): void {\n    state.renderInfo = undefined;\n    this.setStatus(state, 'loading');\n    this.scheduleUpdateState(state);\n  }\n\n  private onFontLoaded(\n    state: CanvasTextRendererState,\n    cssString: string,\n  ): void {\n    if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n      return;\n    }\n    state.fontInfo.loaded = true;\n    this.scheduleUpdateState(state);\n  }\n\n  private onFontLoadError(\n    state: CanvasTextRendererState,\n    cssString: string,\n    error: Error,\n  ): void {\n    if (cssString !== state.fontInfo?.cssString || !state.fontInfo) {\n      return;\n    }\n\n    // Font didn't actually load, but we'll log the error and mark it as loaded\n    // because the browser can still render with a fallback font.\n    state.fontInfo.loaded = true;\n\n    console.error(\n      `CanvasTextRenderer: Error loading font '${state.fontInfo.cssString}'`,\n      error,\n    );\n    this.scheduleUpdateState(state);\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface IParsedColor {\n  isWhite: boolean;\n  a: number;\n  r: number;\n  g: number;\n  b: number;\n}\n\nconst WHITE: IParsedColor = {\n  isWhite: true,\n  a: 1,\n  r: 0xff,\n  g: 0xff,\n  b: 0xff,\n};\n\n/**\n * Extract color components\n */\nexport function parseColor(abgr: number): IParsedColor {\n  if (abgr === 0xffffffff) {\n    return WHITE;\n  }\n  const a = ((abgr >>> 24) & 0xff) / 255;\n  const b = (abgr >>> 16) & 0xff & 0xff;\n  const g = (abgr >>> 8) & 0xff & 0xff;\n  const r = abgr & 0xff & 0xff;\n  return { isWhite: false, a, r, g, b };\n}\n\n/**\n * Extract color components\n */\nexport function parseColorRgba(rgba: number): IParsedColor {\n  if (rgba === 0xffffffff) {\n    return WHITE;\n  }\n  const r = (rgba >>> 24) & 0xff;\n  const g = (rgba >>> 16) & 0xff & 0xff;\n  const b = (rgba >>> 8) & 0xff & 0xff;\n  const a = (rgba & 0xff & 0xff) / 255;\n  return { isWhite: false, r, g, b, a };\n}\n\n/**\n * Format a parsed color into a rgba CSS color\n */\nexport function formatRgba({ a, r, g, b }: IParsedColor): string {\n  return `rgba(${r},${g},${b},${a})`;\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dimensions } from '../../../common/CommonTypes.js';\nimport { assertTruthy } from '../../../utils.js';\nimport { CoreContextTexture } from '../CoreContextTexture.js';\nimport { formatRgba, type IParsedColor } from './internal/ColorUtils.js';\n\nexport class CanvasCoreTexture extends CoreContextTexture {\n  protected image:\n    | ImageBitmap\n    | HTMLCanvasElement\n    | HTMLImageElement\n    | undefined;\n  protected tintCache:\n    | {\n        key: string;\n        image: HTMLCanvasElement;\n      }\n    | undefined;\n\n  async load(): Promise<void> {\n    this.textureSource.setState('loading');\n\n    try {\n      const size = await this.onLoadRequest();\n      this.textureSource.setState('loaded', size);\n      this.updateMemSize();\n    } catch (err) {\n      this.textureSource.setState('failed', err as Error);\n      throw err;\n    }\n  }\n\n  release(): void {\n    this.image = undefined;\n    this.tintCache = undefined;\n  }\n\n  free(): void {\n    this.release();\n    this.textureSource.setState('freed');\n    this.setTextureMemUse(0);\n    this.textureSource.freeTextureData();\n  }\n\n  updateMemSize(): void {\n    // Counting memory usage for:\n    // - main image\n    // - tinted image\n    const mult = this.tintCache ? 8 : 4;\n    if (this.textureSource.dimensions) {\n      const { width, height } = this.textureSource.dimensions;\n      this.setTextureMemUse(width * height * mult);\n    }\n  }\n\n  hasImage(): boolean {\n    return this.image !== undefined;\n  }\n\n  getImage(\n    color: IParsedColor,\n  ): ImageBitmap | HTMLCanvasElement | HTMLImageElement {\n    const image = this.image;\n    assertTruthy(image, 'Attempt to get unloaded image texture');\n\n    if (color.isWhite) {\n      if (this.tintCache) {\n        this.tintCache = undefined;\n        this.updateMemSize();\n      }\n      return image;\n    }\n    const key = formatRgba(color);\n    if (this.tintCache?.key === key) {\n      return this.tintCache.image;\n    }\n\n    const tintedImage = this.tintTexture(image, key);\n    this.tintCache = {\n      key,\n      image: tintedImage,\n    };\n    this.updateMemSize();\n    return tintedImage;\n  }\n\n  protected tintTexture(\n    source: ImageBitmap | HTMLCanvasElement | HTMLImageElement,\n    color: string,\n  ) {\n    const { width, height } = source;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      // fill with target color\n      ctx.fillStyle = color;\n      ctx.globalCompositeOperation = 'copy';\n      ctx.fillRect(0, 0, width, height);\n\n      // multiply with image, resulting in non-transparent tinted image\n      ctx.globalCompositeOperation = 'multiply';\n      ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);\n\n      // apply original image alpha\n      ctx.globalCompositeOperation = 'destination-in';\n      ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);\n    }\n    return canvas;\n  }\n\n  private async onLoadRequest(): Promise<Dimensions> {\n    assertTruthy(this.textureSource?.textureData?.data, 'Texture data is null');\n    const { data } = this.textureSource.textureData;\n\n    // TODO: canvas from text renderer should be able to provide the canvas directly\n    // instead of having to re-draw it into a new canvas...\n    if (data instanceof ImageData) {\n      const canvas = document.createElement('canvas');\n      canvas.width = data.width;\n      canvas.height = data.height;\n      const ctx = canvas.getContext('2d');\n      if (ctx) ctx.putImageData(data, 0, 0);\n      this.image = canvas;\n      return { width: data.width, height: data.height };\n    } else if (\n      (typeof ImageBitmap !== 'undefined' && data instanceof ImageBitmap) ||\n      data instanceof HTMLImageElement\n    ) {\n      this.image = data;\n      return { width: data.width, height: data.height };\n    }\n\n    return { width: 0, height: 0 };\n  }\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { QuadOptions } from '../../CoreRenderer.js';\nimport type { BorderEffectProps } from '../../webgl/shaders/effects/BorderEffect.js';\nimport type { RadiusEffectProps } from '../../webgl/shaders/effects/RadiusEffect.js';\nimport type { EffectDescUnion } from '../../webgl/shaders/effects/ShaderEffect.js';\nimport {\n  ROUNDED_RECTANGLE_SHADER_TYPE,\n  UnsupportedShader,\n} from '../shaders/UnsupportedShader.js';\nimport { formatRgba, parseColorRgba } from './ColorUtils.js';\n\ntype Direction = 'Top' | 'Right' | 'Bottom' | 'Left';\n\n/**\n * Extract `RoundedRectangle` shader radius to apply as a clipping\n */\nexport function getRadius(quad: QuadOptions): RadiusEffectProps['radius'] {\n  if (quad.shader instanceof UnsupportedShader) {\n    const shType = quad.shader.shType;\n    if (shType === ROUNDED_RECTANGLE_SHADER_TYPE) {\n      return (quad.shaderProps?.radius as number) ?? 0;\n    } else if (shType === 'DynamicShader') {\n      const effects = quad.shaderProps?.effects as\n        | EffectDescUnion[]\n        | undefined;\n\n      if (effects) {\n        const effect = effects.find((effect: EffectDescUnion) => {\n          return effect.type === 'radius' && effect?.props?.radius;\n        });\n\n        return (effect && effect.type === 'radius' && effect.props.radius) || 0;\n      }\n    }\n  }\n  return 0;\n}\n\n/**\n * Extract `RoundedRectangle` shader radius to apply as a clipping */\nexport function getBorder(\n  quad: QuadOptions,\n  direction: '' | Direction = '',\n): BorderEffectProps | undefined {\n  if (quad.shader instanceof UnsupportedShader) {\n    const shType = quad.shader.shType;\n    if (shType === 'DynamicShader') {\n      const effects = quad.shaderProps?.effects as\n        | EffectDescUnion[]\n        | undefined;\n\n      if (effects && effects.length) {\n        const effect = effects.find((effect: EffectDescUnion) => {\n          return (\n            effect.type === `border${direction}` &&\n            effect.props &&\n            effect.props.width\n          );\n        });\n\n        return effect && effect.props;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nexport function roundRect(\n  this: CanvasRenderingContext2D | Path2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | DOMPointInit | (number | DOMPointInit)[],\n) {\n  const context = Object.getPrototypeOf(this) as Path2D;\n  if (!context.roundRect) {\n    const fixOverlappingCorners = (radii: {\n      topLeft: number;\n      topRight: number;\n      bottomRight: number;\n      bottomLeft: number;\n    }) => {\n      const maxRadius = Math.min(width / 2, height / 2);\n      const totalHorizontal =\n        radii.topLeft + radii.topRight + radii.bottomRight + radii.bottomLeft;\n\n      if (totalHorizontal > width || totalHorizontal > height) {\n        const scale =\n          maxRadius /\n          Math.max(\n            radii.topLeft,\n            radii.topRight,\n            radii.bottomRight,\n            radii.bottomLeft,\n          );\n        radii.topLeft *= scale;\n        radii.topRight *= scale;\n        radii.bottomRight *= scale;\n        radii.bottomLeft *= scale;\n      }\n    };\n    const radii =\n      typeof radius === 'number'\n        ? {\n            topLeft: radius,\n            topRight: radius,\n            bottomRight: radius,\n            bottomLeft: radius,\n          }\n        : { topLeft: 0, topRight: 0, bottomRight: 0, bottomLeft: 0, ...radius };\n\n    fixOverlappingCorners(radii);\n\n    this.moveTo(x + radii.topLeft, y);\n    this.lineTo(x + width - radii.topRight, y);\n    this.ellipse(\n      x + width - radii.topRight,\n      y + radii.topRight,\n      radii.topRight,\n      radii.topRight,\n      0,\n      1.5 * Math.PI,\n      2 * Math.PI,\n    );\n    this.lineTo(x + width, y + height - radii.bottomRight);\n    this.ellipse(\n      x + width - radii.bottomRight,\n      y + height - radii.bottomRight,\n      radii.bottomRight,\n      radii.bottomRight,\n      0,\n      0,\n      0.5 * Math.PI,\n    );\n    this.lineTo(x + radii.bottomLeft, y + height);\n    this.ellipse(\n      x + radii.bottomLeft,\n      y + height - radii.bottomLeft,\n      radii.bottomLeft,\n      radii.bottomLeft,\n      0,\n      0.5 * Math.PI,\n      Math.PI,\n    );\n    this.lineTo(x, y + radii.topLeft);\n    this.ellipse(\n      x + radii.topLeft,\n      y + radii.topLeft,\n      radii.topLeft,\n      radii.topLeft,\n      0,\n      Math.PI,\n      1.5 * Math.PI,\n    );\n  } else {\n    this.roundRect(x, y, width, height, radius);\n  }\n}\n\nexport function strokeLine(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  lineWidth = 0,\n  color: number | undefined,\n  direction: Direction,\n) {\n  if (!lineWidth) {\n    return;\n  }\n\n  let sx,\n    sy = 0;\n  let ex,\n    ey = 0;\n\n  switch (direction) {\n    case 'Top':\n      sx = x;\n      sy = y;\n      ex = width + x;\n      ey = y;\n      break;\n    case 'Right':\n      sx = x + width;\n      sy = y;\n      ex = x + width;\n      ey = y + height;\n      break;\n    case 'Bottom':\n      sx = x;\n      sy = y + height;\n      ex = x + width;\n      ey = y + height;\n      break;\n    case 'Left':\n      sx = x;\n      sy = y;\n      ex = x;\n      ey = y + height;\n      break;\n  }\n  ctx.beginPath();\n  ctx.lineWidth = lineWidth;\n  ctx.strokeStyle = formatRgba(parseColorRgba(color ?? 0));\n  ctx.moveTo(sx, sy);\n  ctx.lineTo(ex, ey);\n  ctx.stroke();\n}\n", "/*\n * If not stated otherwise in this file or this component's LICENSE file the\n * following copyright and licenses apply:\n *\n * Copyright 2023 Comcast Cable Communications Management, LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the License);\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BaseShaderController } from '../../../main-api/ShaderController.js';\nimport type { CoreNode } from '../../CoreNode.js';\nimport type { CoreShaderManager } from '../../CoreShaderManager.js';\nimport { getRgbaComponents, type RGBA } from '../../lib/utils.js';\nimport { SubTexture } from '../../textures/SubTexture.js';\nimport { TextureType, type Texture } from '../../textures/Texture.js';\nimport type { CoreContextTexture } from '../CoreContextTexture.js';\nimport {\n  CoreRenderer,\n  type CoreRendererOptions,\n  type QuadOptions,\n} from '../CoreRenderer.js';\nimport { CanvasCoreTexture } from './CanvasCoreTexture.js';\nimport {\n  getBorder,\n  getRadius,\n  roundRect,\n  strokeLine,\n} from './internal/C2DShaderUtils.js';\nimport {\n  formatRgba,\n  parseColorRgba,\n  parseColor,\n  type IParsedColor,\n} from './internal/ColorUtils.js';\nimport { UnsupportedShader } from './shaders/UnsupportedShader.js';\nimport { assertTruthy } from '../../../utils.js';\n\nexport class CanvasCoreRenderer extends CoreRenderer {\n  private context: CanvasRenderingContext2D;\n  private canvas: HTMLCanvasElement;\n  private pixelRatio: number;\n  private clearColor: RGBA | undefined;\n  public renderToTextureActive = false;\n  activeRttNode: CoreNode | null = null;\n  private defShaderCtr: BaseShaderController;\n\n  constructor(options: CoreRendererOptions) {\n    super(options);\n\n    this.mode = 'canvas';\n    this.shManager.renderer = this;\n\n    const { canvas, pixelRatio, clearColor } = options;\n    this.canvas = canvas as HTMLCanvasElement;\n    this.context = canvas.getContext('2d') as CanvasRenderingContext2D;\n    this.pixelRatio = pixelRatio;\n    this.clearColor = clearColor ? getRgbaComponents(clearColor) : undefined;\n\n    // Stub for default shader controller since the canvas renderer does not\n    // (really) support the concept of a shader (yet)\n    this.defShaderCtr = {\n      type: 'DefaultShader',\n      props: {},\n      shader: new UnsupportedShader('DefaultShader'),\n      getResolvedProps: () => () => {\n        return {};\n      },\n    };\n  }\n\n  reset(): void {\n    this.canvas.width = this.canvas.width; // quick reset canvas\n\n    const ctx = this.context;\n\n    if (this.clearColor) {\n      const [r, g, b, a] = this.clearColor;\n      ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a / 255})`;\n      ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    ctx.scale(this.pixelRatio, this.pixelRatio);\n  }\n\n  render(): void {\n    // noop\n  }\n\n  addQuad(quad: QuadOptions): void {\n    const ctx = this.context;\n    const {\n      tx,\n      ty,\n      width,\n      height,\n      alpha,\n      colorTl,\n      colorTr,\n      colorBr,\n      ta,\n      tb,\n      tc,\n      td,\n      clippingRect,\n    } = quad;\n    let texture = quad.texture;\n    let ctxTexture: CanvasCoreTexture | undefined = undefined;\n    let frame:\n      | { x: number; y: number; width: number; height: number }\n      | undefined;\n\n    const textureType = texture?.type;\n    assertTruthy(textureType, 'Texture type is not defined');\n\n    // The Canvas2D renderer only supports image and color textures and subTexture images\n    if (\n      textureType !== TextureType.image &&\n      textureType !== TextureType.color &&\n      textureType !== TextureType.subTexture &&\n      textureType !== TextureType.noise\n    ) {\n      return;\n    }\n\n    if (texture) {\n      if (texture instanceof SubTexture) {\n        frame = texture.props;\n        texture = texture.parentTexture;\n      }\n\n      ctxTexture = texture.ctxTexture as CanvasCoreTexture;\n      if (texture.state === 'freed') {\n        return;\n      }\n      if (texture.state !== 'loaded') {\n        return;\n      }\n    }\n\n    const color = parseColor(colorTl);\n    const hasTransform = ta !== 1;\n    const hasClipping = clippingRect.width !== 0 && clippingRect.height !== 0;\n    const hasGradient = colorTl !== colorTr || colorTl !== colorBr;\n    const hasQuadShader = Boolean(quad.shader);\n    const radius = hasQuadShader ? getRadius(quad) : 0;\n    const border = hasQuadShader ? getBorder(quad) : undefined;\n\n    if (hasTransform || hasClipping || radius) {\n      ctx.save();\n    }\n\n    if (hasClipping) {\n      const path = new Path2D();\n      const { x, y, width, height } = clippingRect;\n      path.rect(x, y, width, height);\n      ctx.clip(path);\n    }\n\n    if (hasTransform) {\n      // Quad transform:\n      // | ta tb tx |\n      // | tc td ty |\n      // | 0  0  1  |\n      // C2D transform:\n      // | a  c  e  |\n      // | b  d  f  |\n      // | 0  0  1  |\n      const scale = this.pixelRatio;\n      ctx.setTransform(ta, tc, tb, td, tx * scale, ty * scale);\n      ctx.scale(scale, scale);\n      ctx.translate(-tx, -ty);\n    }\n\n    if (radius) {\n      const path = new Path2D();\n      roundRect.call(path, tx, ty, width, height, radius);\n      ctx.clip(path);\n    }\n\n    if (\n      (textureType === TextureType.image ||\n        textureType === TextureType.subTexture ||\n        textureType === TextureType.noise) &&\n      ctxTexture\n    ) {\n      const image = ctxTexture.getImage(color);\n      ctx.globalAlpha = color.a ?? alpha;\n      if (frame) {\n        ctx.drawImage(\n          image,\n          frame.x,\n          frame.y,\n          frame.width,\n          frame.height,\n          tx,\n          ty,\n          width,\n          height,\n        );\n      } else {\n        try {\n          ctx.drawImage(image, tx, ty, width, height);\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        } catch (error) {\n          // noop\n        }\n      }\n      ctx.globalAlpha = 1;\n    } else if (textureType === TextureType.color && hasGradient) {\n      let endX: number = tx;\n      let endY: number = ty;\n      let endColor: IParsedColor;\n      if (colorTl === colorTr) {\n        // vertical\n        endX = tx;\n        endY = ty + height;\n        endColor = parseColor(colorBr);\n      } else {\n        // horizontal\n        endX = tx + width;\n        endY = ty;\n        endColor = parseColor(colorTr);\n      }\n      const gradient = ctx.createLinearGradient(tx, ty, endX, endY);\n      gradient.addColorStop(0, formatRgba(color));\n      gradient.addColorStop(1, formatRgba(endColor));\n      ctx.fillStyle = gradient;\n      ctx.fillRect(tx, ty, width, height);\n    } else if (textureType === TextureType.color) {\n      ctx.fillStyle = formatRgba(color);\n      ctx.fillRect(tx, ty, width, height);\n    }\n\n    if (border && border.width) {\n      const borderWidth = border.width;\n      const borderInnerWidth = border.width / 2;\n      const borderColor = formatRgba(parseColorRgba(border.color ?? 0));\n\n      ctx.beginPath();\n      ctx.lineWidth = borderWidth;\n      ctx.strokeStyle = borderColor;\n      ctx.globalAlpha = alpha;\n      if (radius) {\n        roundRect.call(\n          ctx,\n          tx + borderInnerWidth,\n          ty + borderInnerWidth,\n          width - borderWidth,\n          height - borderWidth,\n          radius,\n        );\n        ctx.stroke();\n      } else {\n        ctx.strokeRect(\n          tx + borderInnerWidth,\n          ty + borderInnerWidth,\n          width - borderWidth,\n          height - borderWidth,\n        );\n      }\n      ctx.globalAlpha = 1;\n    } else if (hasQuadShader) {\n      const borderTop = getBorder(quad, 'Top');\n      const borderRight = getBorder(quad, 'Right');\n      const borderBottom = getBorder(quad, 'Bottom');\n      const borderLeft = getBorder(quad, 'Left');\n\n      if (borderTop) {\n        strokeLine(\n          ctx,\n          tx,\n          ty,\n          width,\n          height,\n          borderTop.width,\n          borderTop.color,\n          'Top',\n        );\n      }\n\n      if (borderRight) {\n        strokeLine(\n          ctx,\n          tx,\n          ty,\n          width,\n          height,\n          borderRight.width,\n          borderRight.color,\n          'Right',\n        );\n      }\n\n      if (borderBottom) {\n        strokeLine(\n          ctx,\n          tx,\n          ty,\n          width,\n          height,\n          borderBottom.width,\n          borderBottom.color,\n          'Bottom',\n        );\n      }\n\n      if (borderLeft) {\n        strokeLine(\n          ctx,\n          tx,\n          ty,\n          width,\n          height,\n          borderLeft.width,\n          borderLeft.color,\n          'Left',\n        );\n      }\n    }\n\n    if (hasTransform || hasClipping || radius) {\n      ctx.restore();\n    }\n  }\n\n  createCtxTexture(textureSource: Texture): CoreContextTexture {\n    return new CanvasCoreTexture(this.txMemManager, textureSource);\n  }\n\n  getShaderManager(): CoreShaderManager {\n    return this.shManager;\n  }\n\n  override getDefShaderCtr(): BaseShaderController {\n    return this.defShaderCtr;\n  }\n\n  renderRTTNodes(): void {\n    // noop\n  }\n\n  removeRTTNode(node: CoreNode): void {\n    // noop\n  }\n\n  renderToTexture(node: CoreNode): void {\n    // noop\n  }\n  getBufferInfo(): null {\n    return null;\n  }\n\n  getQuadCount(): null {\n    return null;\n  }\n\n  /**\n   * Updates the clear color of the canvas renderer.\n   *\n   * @param color - The color to set as the clear color.\n   */\n  updateClearColor(color: number) {\n    this.clearColor = color ? getRgbaComponents(color) : undefined;\n  }\n}\n", "import {\n  CoreNode,\n  type CoreNodeAnimateProps,\n  type CoreNodeProps,\n} from '../core/CoreNode.js';\nimport { type RendererMainSettings } from './Renderer.js';\nimport type { AnimationSettings } from '../core/animations/CoreAnimation.js';\nimport type { IAnimationController } from '../common/IAnimationController.js';\nimport { isProductionEnvironment } from '../utils.js';\nimport type { CoreTextNode, CoreTextNodeProps } from '../core/CoreTextNode.js';\nimport type { Texture } from '../core/textures/Texture.js';\nimport { TextureType } from '../core/textures/Texture.js';\n\n/**\n * Inspector\n *\n * The inspector is a tool that allows you to inspect the state of the renderer\n * and the nodes that are being rendered. It is a tool that is used for debugging\n * and development purposes.\n *\n * The inspector will generate a DOM tree that mirrors the state of the renderer\n */\n\n/**\n * stylePropertyMap is a map of renderer properties that are mapped to CSS properties\n *\n * It can either return a string or an object with a prop and value property. Once a\n * property is found in the map, the value is set on the style of the div element.\n * Erik H made me do it.\n */\ninterface StyleResponse {\n  prop: string;\n  value: string;\n}\nconst stylePropertyMap: {\n  [key: string]: (\n    value: string | number | boolean,\n  ) => string | StyleResponse | null;\n} = {\n  alpha: (v) => {\n    if (v === 1) {\n      return null;\n    }\n\n    return { prop: 'opacity', value: `${v}` };\n  },\n  x: (x) => {\n    return { prop: 'left', value: `${x}px` };\n  },\n  y: (y) => {\n    return { prop: 'top', value: `${y}px` };\n  },\n  width: (w) => {\n    if (w === 0) {\n      return { prop: 'width', value: 'auto' };\n    }\n\n    return { prop: 'width', value: `${w}px` };\n  },\n  height: (h) => {\n    if (h === 0) {\n      return { prop: 'height', value: 'auto' };\n    }\n\n    return { prop: 'height', value: `${h}px` };\n  },\n  fontSize: (fs) => {\n    if (fs === 0) {\n      return null;\n    }\n\n    return { prop: 'font-size', value: `${fs}px` };\n  },\n  lineHeight: (lh) => {\n    if (lh === 0) {\n      return null;\n    }\n\n    return { prop: 'line-height', value: `${lh}px` };\n  },\n  zIndex: () => 'z-index',\n  fontFamily: () => 'font-family',\n  fontStyle: () => 'font-style',\n  fontWeight: () => 'font-weight',\n  fontStretch: () => 'font-stretch',\n  letterSpacing: () => 'letter-spacing',\n  textAlign: () => 'text-align',\n  overflowSuffix: () => 'overflow-suffix',\n  maxLines: () => 'max-lines',\n  contain: () => 'contain',\n  verticalAlign: () => 'vertical-align',\n  clipping: (v) => {\n    if (v === false) {\n      return null;\n    }\n\n    return { prop: 'overflow', value: v ? 'hidden' : 'visible' };\n  },\n  rotation: (v) => {\n    if (v === 0) {\n      return null;\n    }\n\n    return { prop: 'transform', value: `rotate(${v}rad)` };\n  },\n  scale: (v) => {\n    if (v === 1) {\n      return null;\n    }\n\n    return { prop: 'transform', value: `scale(${v})` };\n  },\n  scaleX: (v) => {\n    if (v === 1) {\n      return null;\n    }\n\n    return { prop: 'transform', value: `scaleX(${v})` };\n  },\n  scaleY: (v) => {\n    if (v === 1) {\n      return null;\n    }\n\n    return { prop: 'transform', value: `scaleY(${v})` };\n  },\n  color: (v) => {\n    if (v === 0) {\n      return null;\n    }\n\n    return { prop: 'color', value: convertColorToRgba(v as number) };\n  },\n};\n\nconst convertColorToRgba = (color: number) => {\n  const a = (color & 0xff) / 255;\n  const b = (color >> 8) & 0xff;\n  const g = (color >> 16) & 0xff;\n  const r = (color >> 24) & 0xff;\n  return `rgba(${r},${g},${b},${a})`;\n};\n\nconst domPropertyMap: { [key: string]: string } = {\n  id: 'test-id',\n};\n\nconst gradientColorPropertyMap = [\n  'colorTop',\n  'colorBottom',\n  'colorLeft',\n  'colorRight',\n  'colorTl',\n  'colorTr',\n  'colorBl',\n  'colorBr',\n];\n\nconst textureTypeNames: Record<number, string> = {\n  [TextureType.generic]: 'generic',\n  [TextureType.color]: 'color',\n  [TextureType.image]: 'image',\n  [TextureType.noise]: 'noise',\n  [TextureType.renderToTexture]: 'renderToTexture',\n  [TextureType.subTexture]: 'subTexture',\n};\n\ninterface TextureMetrics {\n  previousState: string;\n  loadedCount: number;\n  failedCount: number;\n  freedCount: number;\n}\n\nconst knownProperties = new Set<string>([\n  ...Object.keys(stylePropertyMap),\n  ...Object.keys(domPropertyMap),\n  // ...gradientColorPropertyMap,\n  'src',\n  'parent',\n  'data',\n  'text',\n  'texture',\n]);\n\nexport class Inspector {\n  private root: HTMLElement | null = null;\n  private canvas: HTMLCanvasElement | null = null;\n  private height = 1080;\n  private width = 1920;\n  private scaleX = 1;\n  private scaleY = 1;\n  private textureMetrics = new Map<Texture, TextureMetrics>();\n\n  constructor(canvas: HTMLCanvasElement, settings: RendererMainSettings) {\n    if (isProductionEnvironment) return;\n\n    if (!settings) {\n      throw new Error('settings is required');\n    }\n\n    // calc dimensions based on the devicePixelRatio\n    this.height = Math.ceil(\n      settings.appHeight ?? 1080 / (settings.deviceLogicalPixelRatio ?? 1),\n    );\n\n    this.width = Math.ceil(\n      settings.appWidth ?? 1920 / (settings.deviceLogicalPixelRatio ?? 1),\n    );\n\n    this.scaleX = settings.deviceLogicalPixelRatio ?? 1;\n    this.scaleY = settings.deviceLogicalPixelRatio ?? 1;\n\n    this.canvas = canvas;\n    this.root = document.createElement('div');\n    this.setRootPosition();\n    document.body.appendChild(this.root);\n\n    //listen for changes on canvas\n    const mutationObserver = new MutationObserver(\n      this.setRootPosition.bind(this),\n    );\n    mutationObserver.observe(canvas, {\n      attributes: true,\n      childList: false,\n      subtree: false,\n    });\n\n    // Create a ResizeObserver to watch for changes in the element's size\n    const resizeObserver = new ResizeObserver(this.setRootPosition.bind(this));\n    resizeObserver.observe(canvas);\n\n    //listen for changes on window\n    window.addEventListener('resize', this.setRootPosition.bind(this));\n\n    console.warn('Inspector is enabled, this will impact performance');\n  }\n\n  setRootPosition() {\n    if (this.root === null || this.canvas === null) {\n      return;\n    }\n\n    // get the world position of the canvas object, so we can match the inspector to it\n    const rect = this.canvas.getBoundingClientRect();\n    const top = document.documentElement.scrollTop + rect.top;\n    const left = document.documentElement.scrollLeft + rect.left;\n\n    this.root.id = 'root';\n    this.root.style.left = `${left}px`;\n    this.root.style.top = `${top}px`;\n    this.root.style.width = `${this.width}px`;\n    this.root.style.height = `${this.height}px`;\n    this.root.style.position = 'absolute';\n    this.root.style.transformOrigin = '0 0 0';\n    this.root.style.transform = `scale(${this.scaleX}, ${this.scaleY})`;\n    this.root.style.overflow = 'hidden';\n    this.root.style.zIndex = '65534';\n  }\n\n  createDiv(\n    id: number,\n    properties: CoreNodeProps | CoreTextNodeProps,\n  ): HTMLElement {\n    const div = document.createElement('div');\n    div.style.position = 'absolute';\n    div.id = id.toString();\n\n    // set initial properties\n    for (const key in properties) {\n      this.updateNodeProperty(\n        div,\n        // really typescript? really?\n        key as keyof CoreNodeProps,\n        properties[key as keyof CoreNodeProps],\n        properties,\n      );\n    }\n\n    return div;\n  }\n\n  createNode(node: CoreNode): CoreNode {\n    const div = this.createDiv(node.id, node.props);\n    (div as HTMLElement & { node: CoreNode }).node = node;\n    (node as CoreNode & { div: HTMLElement }).div = div;\n\n    node.on('inViewport', () => div.setAttribute('state', 'inViewport'));\n    node.on('inBounds', () => div.setAttribute('state', 'inBounds'));\n    node.on('outOfBounds', () => div.setAttribute('state', 'outOfBounds'));\n\n    // Monitor only relevant properties by trapping with selective assignment\n    return this.createProxy(node, div);\n  }\n\n  createTextNode(node: CoreNode): CoreTextNode {\n    const div = this.createDiv(node.id, node.props);\n    (div as HTMLElement & { node: CoreNode }).node = node;\n    (node as CoreNode & { div: HTMLElement }).div = div;\n\n    return this.createProxy(node, div) as CoreTextNode;\n  }\n\n  createProxy(\n    node: CoreNode | CoreTextNode,\n    div: HTMLElement,\n  ): CoreNode | CoreTextNode {\n    // Store texture event listeners for cleanup\n    const textureListeners = new Map<\n      Texture,\n      {\n        onLoaded: () => void;\n        onFailed: () => void;\n        onFreed: () => void;\n      }\n    >();\n\n    // Helper function to setup texture event listeners\n    const setupTextureListeners = (texture: Texture | null) => {\n      // Clean up existing listeners first\n      textureListeners.forEach((listeners, oldTexture) => {\n        oldTexture.off('loaded', listeners.onLoaded);\n        oldTexture.off('failed', listeners.onFailed);\n        oldTexture.off('freed', listeners.onFreed);\n      });\n      textureListeners.clear();\n\n      // Setup new listeners if texture exists\n      if (texture) {\n        // Initialize metrics if not exists\n        if (!this.textureMetrics.has(texture)) {\n          this.textureMetrics.set(texture, {\n            previousState: texture.state,\n            loadedCount: 0,\n            failedCount: 0,\n            freedCount: 0,\n          });\n        }\n\n        const onLoaded = () => {\n          const metrics = this.textureMetrics.get(texture);\n          if (metrics) {\n            metrics.previousState =\n              metrics.previousState !== texture.state\n                ? metrics.previousState\n                : 'loading';\n            metrics.loadedCount++;\n          }\n          this.updateTextureAttributes(div, texture);\n        };\n        const onFailed = () => {\n          const metrics = this.textureMetrics.get(texture);\n          if (metrics) {\n            metrics.previousState =\n              metrics.previousState !== texture.state\n                ? metrics.previousState\n                : 'loading';\n            metrics.failedCount++;\n          }\n          this.updateTextureAttributes(div, texture);\n        };\n        const onFreed = () => {\n          const metrics = this.textureMetrics.get(texture);\n          if (metrics) {\n            metrics.previousState =\n              metrics.previousState !== texture.state\n                ? metrics.previousState\n                : texture.state;\n            metrics.freedCount++;\n          }\n          this.updateTextureAttributes(div, texture);\n        };\n\n        texture.on('loaded', onLoaded);\n        texture.on('failed', onFailed);\n        texture.on('freed', onFreed);\n\n        textureListeners.set(texture, { onLoaded, onFailed, onFreed });\n      }\n    };\n    // Define traps for each property in knownProperties\n    knownProperties.forEach((property) => {\n      let originalProp = Object.getOwnPropertyDescriptor(node, property);\n\n      if (originalProp === undefined) {\n        // Search the prototype chain for the property descriptor\n        const proto = Object.getPrototypeOf(node) as CoreNode | CoreTextNode;\n        originalProp = Object.getOwnPropertyDescriptor(proto, property);\n      }\n\n      if (originalProp === undefined) {\n        return;\n      }\n\n      Object.defineProperty(node, property, {\n        get() {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n          return originalProp?.get?.call(node);\n        },\n        set: (value) => {\n          originalProp?.set?.call(node, value);\n          this.updateNodeProperty(\n            div,\n            property as keyof CoreNodeProps | keyof CoreTextNodeProps,\n            value,\n            node.props,\n          );\n\n          // Setup texture event listeners if this is a texture property\n          if (property === 'texture') {\n            const textureValue =\n              value && typeof value === 'object' && 'state' in value\n                ? (value as Texture)\n                : null;\n            setupTextureListeners(textureValue);\n          }\n        },\n        configurable: true,\n        enumerable: true,\n      });\n    });\n\n    const originalDestroy = node.destroy;\n    Object.defineProperty(node, 'destroy', {\n      value: () => {\n        // Clean up texture event listeners and metrics\n        textureListeners.forEach((listeners, texture) => {\n          texture.off('loaded', listeners.onLoaded);\n          texture.off('failed', listeners.onFailed);\n          texture.off('freed', listeners.onFreed);\n          // Clean up metrics for this texture\n          this.textureMetrics.delete(texture);\n        });\n        textureListeners.clear();\n\n        this.destroyNode(node.id);\n        originalDestroy.call(node);\n      },\n    });\n\n    // Setup initial texture listeners if node already has a texture\n    if (node.texture) {\n      setupTextureListeners(node.texture);\n    }\n\n    const originalAnimate = node.animate;\n    Object.defineProperty(node, 'animate', {\n      value: (\n        props: CoreNodeAnimateProps,\n        settings: AnimationSettings,\n      ): IAnimationController => {\n        const animationController = originalAnimate.call(node, props, settings);\n\n        const originalStart =\n          animationController.start.bind(animationController);\n        animationController.start = () => {\n          this.animateNode(div, props, settings);\n\n          return originalStart();\n        };\n\n        return animationController;\n      },\n    });\n\n    return node;\n  }\n\n  destroyNode(id: number) {\n    const div = document.getElementById(id.toString());\n    div?.remove();\n  }\n\n  updateTextureAttributes(div: HTMLElement, texture: Texture) {\n    // Update texture state\n    div.setAttribute('data-texture-state', texture.state);\n\n    // Update texture type\n    div.setAttribute(\n      'data-texture-type',\n      textureTypeNames[texture.type] || 'unknown',\n    );\n\n    // Update texture dimensions if available\n    if (texture.dimensions) {\n      div.setAttribute('data-texture-width', String(texture.dimensions.width));\n      div.setAttribute(\n        'data-texture-height',\n        String(texture.dimensions.height),\n      );\n    } else {\n      div.removeAttribute('data-texture-width');\n      div.removeAttribute('data-texture-height');\n    }\n\n    // Update renderable owners count\n    div.setAttribute(\n      'data-texture-owners',\n      String(texture.renderableOwners.length),\n    );\n\n    // Update retry count\n    div.setAttribute('data-texture-retry-count', String(texture.retryCount));\n\n    // Update max retry count if available\n    if (texture.maxRetryCount !== null) {\n      div.setAttribute(\n        'data-texture-max-retry-count',\n        String(texture.maxRetryCount),\n      );\n    } else {\n      div.removeAttribute('data-texture-max-retry-count');\n    }\n\n    // Update metrics if available\n    const metrics = this.textureMetrics.get(texture);\n    if (metrics) {\n      div.setAttribute('data-texture-previous-state', metrics.previousState);\n      div.setAttribute(\n        'data-texture-loaded-count',\n        String(metrics.loadedCount),\n      );\n      div.setAttribute(\n        'data-texture-failed-count',\n        String(metrics.failedCount),\n      );\n      div.setAttribute('data-texture-freed-count', String(metrics.freedCount));\n    } else {\n      div.removeAttribute('data-texture-previous-state');\n      div.removeAttribute('data-texture-loaded-count');\n      div.removeAttribute('data-texture-failed-count');\n      div.removeAttribute('data-texture-freed-count');\n    }\n\n    // Update error information if present\n    if (texture.error) {\n      div.setAttribute(\n        'data-texture-error',\n        texture.error.code || texture.error.message,\n      );\n    } else {\n      div.removeAttribute('data-texture-error');\n    }\n  }\n\n  updateNodeProperty(\n    div: HTMLElement,\n    property: keyof CoreNodeProps | keyof CoreTextNodeProps,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    value: any,\n    props: CoreNodeProps | CoreTextNodeProps,\n  ) {\n    if (this.root === null || value === undefined || value === null) {\n      return;\n    }\n\n    /**\n     * Special case for parent property\n     */\n    if (property === 'parent') {\n      const parentId: number = value.id;\n\n      // only way to detect if the parent is the root node\n      // if you are reading this and have a better way, please let me know\n      if (parentId === 1) {\n        this.root.appendChild(div);\n        return;\n      }\n\n      const parent = document.getElementById(parentId.toString());\n      parent?.appendChild(div);\n      return;\n    }\n\n    // special case for text\n    if (property === 'text') {\n      div.innerHTML = String(value);\n\n      // Keep DOM text invisible without breaking visibility checks\n      // Use very low opacity (0.001) instead of 0 so Playwright still detects it\n      div.style.opacity = '0.001';\n      div.style.pointerEvents = 'none';\n      div.style.userSelect = 'none';\n      return;\n    }\n\n    // special case for images\n    // we're not setting any CSS properties to avoid images getting loaded twice\n    // as the renderer will handle the loading of the image. Setting it to `data-src`\n    if (property === 'src' && value) {\n      div.setAttribute(`data-src`, String(value));\n      return;\n    }\n\n    // special case for color gradients (normal colors are handled by the stylePropertyMap)\n    // FIXME the renderer seems to return the same number for all colors\n    // if (gradientColorPropertyMap.includes(property as string)) {\n    //   const color = convertColorToRgba(value as number);\n    //   div.setAttribute(`data-${property}`, color);\n    //   return;\n    // }\n\n    if (property === 'rtt' && value) {\n      div.setAttribute('data-rtt', String(value));\n      return;\n    }\n\n    // special case for texture information\n    if (property === 'texture') {\n      if (value && typeof value === 'object' && 'state' in value) {\n        const texture = value as Texture;\n        this.updateTextureAttributes(div, texture);\n      } else {\n        // Remove all texture attributes when texture is null\n        div.removeAttribute('data-texture-state');\n        div.removeAttribute('data-texture-type');\n        div.removeAttribute('data-texture-width');\n        div.removeAttribute('data-texture-height');\n        div.removeAttribute('data-texture-owners');\n        div.removeAttribute('data-texture-error');\n      }\n      return;\n    }\n\n    // CSS mappable attribute\n    if (stylePropertyMap[property]) {\n      const mappedStyleResponse = stylePropertyMap[property]?.(value);\n\n      if (mappedStyleResponse === null) {\n        return;\n      }\n\n      if (typeof mappedStyleResponse === 'string') {\n        div.style.setProperty(mappedStyleResponse, String(value));\n        return;\n      }\n\n      if (typeof mappedStyleResponse === 'object') {\n        let value = mappedStyleResponse.value;\n        if (property === 'x') {\n          const mount = props.mountX;\n          const width = props.width;\n\n          if (mount) {\n            value = `${parseInt(value) - width * mount}px`;\n          }\n        } else if (property === 'y') {\n          const mount = props.mountY;\n          const height = props.height;\n\n          if (mount) {\n            value = `${parseInt(value) - height * mount}px`;\n          }\n        }\n        div.style.setProperty(mappedStyleResponse.prop, value);\n      }\n\n      return;\n    }\n\n    // DOM properties\n    if (domPropertyMap[property]) {\n      const domProperty = domPropertyMap[property];\n      if (!domProperty) {\n        return;\n      }\n\n      div.setAttribute(String(domProperty), String(value));\n      return;\n    }\n\n    // custom data properties\n    if (property === 'data') {\n      for (const key in value) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const keyValue: unknown = value[key];\n        if (keyValue === undefined) {\n          div.removeAttribute(`data-${key}`);\n        } else {\n          div.setAttribute(`data-${key}`, String(keyValue));\n        }\n      }\n      return;\n    }\n  }\n\n  // simple animation handler\n  animateNode(\n    div: HTMLElement,\n    props: CoreNodeAnimateProps,\n    settings: AnimationSettings,\n  ) {\n    const {\n      duration = 1000,\n      delay = 0,\n      // easing = 'linear',\n      // repeat = 0,\n      // loop = false,\n      // stopMethod = false,\n    } = settings;\n\n    const {\n      x,\n      y,\n      width,\n      height,\n      alpha = 1,\n      rotation = 0,\n      scale = 1,\n      color,\n      mountX,\n      mountY,\n    } = props;\n\n    // ignoring loops and repeats for now, as that might be a bit too much for the inspector\n    function animate() {\n      setTimeout(() => {\n        div.style.top = `${y - height * mountY}px`;\n        div.style.left = `${x - width * mountX}px`;\n        div.style.width = `${width}px`;\n        div.style.height = `${height}px`;\n        div.style.opacity = `${alpha}`;\n        div.style.rotate = `${rotation}rad`;\n        div.style.scale = `${scale}`;\n        div.style.color = convertColorToRgba(color);\n      }, duration);\n    }\n\n    setTimeout(animate, delay);\n  }\n}\n", "export const DEFAULT_HOLD_TIMEOUT_MS = 50\n\nexport const DEFAULT_KEYMAP = {\n  ArrowLeft: 'left',\n  ArrowRight: 'right',\n  ArrowUp: 'up',\n  ArrowDown: 'down',\n  Enter: 'enter',\n  ' ': 'space',\n  Backspace: 'back',\n  Escape: 'escape',\n  37: 'left',\n  39: 'right',\n  38: 'up',\n  40: 'down',\n  13: 'enter',\n  32: 'space',\n  8: 'back',\n  27: 'escape',\n}\n\nexport const SCREEN_RESOLUTIONS = {\n  hd: 0.66666667,\n  '720p': 0.66666667,\n  720: 0.66666667,\n  fhd: 1,\n  fullhd: 1,\n  '1080p': 1,\n  1080: 1,\n  '4k': 2,\n  '2160p': 2,\n  2160: 2,\n}\n\nexport const RENDER_QUALITIES = {\n  low: 0.66666667,\n  medium: 0.85,\n  high: 1,\n  retina: 2,\n}\n", "import { SdfTrFontFace, WebTrFontFace } from '@lightningjs/renderer'\nimport Settings from '../../settings.js'\nimport { renderer } from './launch.js'\n\nexport default () => {\n  const stage = renderer.stage\n  Settings.get('fonts', []).forEach((font) => {\n    if (font.type === 'sdf' || font.type === 'msdf') {\n      // automatically map png key to file name\n      if (!font.png && font.file) {\n        font.png = font.file.replace(/\\.[^.]+$/, `.${font.type}.png`)\n      }\n      // automatically map json to file name\n      if (!font.json && font.file) {\n        font.json = font.file.replace(/\\.[^.]+$/, `.${font.type}.json`)\n      }\n      stage.fontManager.addFontFace(\n        new SdfTrFontFace(font.type, {\n          fontFamily: font.family,\n          descriptors: {},\n          atlasUrl: font.png,\n          atlasDataUrl: font.json,\n          stage,\n          metrics: font.metrics,\n        })\n      )\n    } else if (font.type === 'web') {\n      stage.fontManager.addFontFace(\n        new WebTrFontFace({\n          fontFamily: font.family,\n          fontUrl: font.file,\n          descriptors: {},\n          metrics: font.metrics,\n        })\n      )\n    }\n  })\n}\n", "import Settings from '../../settings.js'\nimport { renderer } from './launch.js'\n\nexport default () => {\n  const stage = renderer.stage\n  Settings.get('shaders', []).forEach((shader) => {\n    stage.shManager.registerShaderType(shader.name, shader.type)\n  })\n  Settings.get('effects', []).forEach((effect) => {\n    stage.shManager.registerShaderType(effect.name, effect.type)\n  })\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { RendererMain } from '@lightningjs/renderer'\nimport { WebGlCoreRenderer, SdfTextRenderer } from '@lightningjs/renderer/webgl'\nimport { CanvasCoreRenderer, CanvasTextRenderer } from '@lightningjs/renderer/canvas'\nimport { Inspector } from '@lightningjs/renderer/inspector'\n\nimport { Log } from '../../lib/log.js'\nimport { SCREEN_RESOLUTIONS, RENDER_QUALITIES } from '../../constants.js'\nimport colors from '../../lib/colors/colors.js'\nimport fontLoader from './fontLoader.js'\nimport shaderLoader from './shaderLoader.js'\n\n/** @type {RendererMain|{}} */\nexport let renderer = {}\n\nconst renderEngine = (settings) => {\n  const renderMode = 'renderMode' in settings ? settings.renderMode : 'webgl'\n\n  if (renderMode === 'webgl') return WebGlCoreRenderer\n  if (renderMode === 'canvas') return CanvasCoreRenderer\n}\n\nconst textRenderEngines = (settings) => {\n  const renderMode = 'renderMode' in settings ? settings.renderMode : 'webgl'\n\n  if (renderMode === 'webgl') return [SdfTextRenderer, CanvasTextRenderer]\n  if (renderMode === 'canvas') return [CanvasTextRenderer]\n}\n\nconst textureMemorySettings = (settings) => {\n  const gpuMemory = {\n    ...{\n      max: 200,\n      target: 0.8,\n      cleanupInterval: 5000,\n      baseline: 25,\n      strict: false,\n    },\n    ...('gpuMemory' in settings === true ? settings.gpuMemory : {}),\n  }\n\n  return {\n    criticalThreshold: gpuMemory.max * 1024 * 1024, // convert from mb to bytes\n    targetThresholdLevel: gpuMemory.target,\n    cleanupInterval: gpuMemory.cleanupInterval,\n    baselineMemoryAllocation: gpuMemory.baseline * 1024 * 1024, // convert from mb to bytes\n    doNotExceedCriticalThreshold: gpuMemory.strict,\n  }\n}\n\n/**\n * Launch the render engine and application\n *\n * @param {import('../../launch.js').BlitsAppFactory} App - Factory function that returns the application instance (extends BlitsComponent with .quit())\n * @param {HTMLElement} target - The target element to render the application into\n * @param {Partial<import('../../launch.js').BlitsSettings>} [settings] - The settings for the renderer\n *\n */\nexport default (App, target, settings = {}) => {\n  renderer = new RendererMain(\n    {\n      ...{\n        appWidth: settings.w || 1920,\n        appHeight: settings.h || 1080,\n        fpsUpdateInterval: settings.fpsInterval || 1000,\n        devicePhysicalPixelRatio:\n          RENDER_QUALITIES[settings.renderQuality] || settings.renderQuality || 1,\n        deviceLogicalPixelRatio:\n          settings.pixelRatio ||\n          SCREEN_RESOLUTIONS[settings.screenResolution] ||\n          SCREEN_RESOLUTIONS[window.innerHeight] ||\n          1,\n        numImageWorkers:\n          'webWorkersLimit' in settings\n            ? settings.webWorkersLimit\n            : window.navigator.hardwareConcurrency || 2,\n        clearColor: (settings.canvasColor && colors.normalize(settings.canvasColor)) || 0x00000000,\n        inspector: settings.inspector === true ? Inspector : undefined,\n        boundsMargin: settings.viewportMargin || 0,\n        renderEngine: renderEngine(settings),\n        fontEngines: textRenderEngines(settings),\n        canvas: settings.canvas,\n        textureProcessingTimeLimit: settings.textureProcessingTimeLimit,\n        textureMemory: textureMemorySettings(settings),\n        createImageBitmapSupport: 'auto',\n        targetFPS: 'maxFPS' in settings ? settings.maxFPS : 0,\n      },\n      ...(settings.advanced || {}),\n    },\n    target\n  )\n\n  const initApp = () => {\n    let app = App()\n    app.quit = () => {\n      Log.info('Closing App')\n      app.destroy()\n      app = null\n      renderer = null\n    }\n  }\n\n  shaderLoader()\n  fontLoader()\n  initApp()\n\n  return renderer\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { renderer } from './launch.js'\nimport colors from '../../lib/colors/colors.js'\n\nimport { Log } from '../../lib/log.js'\nimport symbols from '../../lib/symbols.js'\nimport Settings from '../../settings.js'\n\n/**\n * Creates a padding object from a value and direction.\n * @param {number|object|string|undefined} padding - The padding value.\n * @param {string} direction - The layout direction ('vertical' or 'horizontal').\n * @returns {{start: number, end: number, oppositeStart: number, oppositeEnd: number}} The padding object.\n */\nconst createPaddingObject = (padding, direction) => {\n  if (padding === undefined) {\n    return { start: 0, end: 0, oppositeStart: 0, oppositeEnd: 0 }\n  }\n\n  if (typeof padding === 'number') {\n    return { start: padding, end: padding, oppositeStart: padding, oppositeEnd: padding }\n  }\n\n  // todo: do we need to do this runtime every time? or can we optimize this?\n  if (isObjectString(padding) === true) {\n    padding = parseToObject(padding)\n  }\n\n  if (typeof padding === 'object') {\n    const {\n      top = undefined,\n      right = undefined,\n      bottom = undefined,\n      left = undefined,\n      x = 0,\n      y = 0,\n    } = padding\n\n    // use specific values if provided, otherwise fall back to x or y\n    return direction === 'vertical'\n      ? {\n          start: top !== undefined ? top : y,\n          end: bottom !== undefined ? bottom : y,\n          oppositeStart: left !== undefined ? left : x,\n          oppositeEnd: right !== undefined ? right : x,\n        }\n      : {\n          start: left !== undefined ? left : x,\n          end: right !== undefined ? right : x,\n          oppositeStart: top !== undefined ? top : y,\n          oppositeEnd: bottom !== undefined ? bottom : y,\n        }\n  }\n  return { start: 0, end: 0, oppositeStart: 0, oppositeEnd: 0 }\n}\n\n/**\n * Layout function for arranging children in a layout container.\n * @param {object} config - The layout configuration object.\n * @this {import('../../component.js').BlitsElement}\n */\nconst layoutFn = function (config) {\n  const position = config.direction === 'vertical' ? 'y' : 'x'\n  const oppositePosition = config.direction === 'vertical' ? 'x' : 'y'\n  const oppositeMount = config.direction === 'vertical' ? 'mountX' : 'mountY'\n  const dimension = config.direction === 'vertical' ? 'height' : 'width'\n  const oppositeDimension = config.direction === 'vertical' ? 'width' : 'height'\n  const padding = createPaddingObject(config.padding, config.direction)\n\n  let offset = padding.start\n\n  const children = this.node.children\n  const childrenLength = children.length\n  const elementChildren = this.children\n  let otherDimension = 0\n  const gap = config.gap || 0\n  for (let i = 0; i < childrenLength; i++) {\n    if (elementChildren[i] !== undefined && elementChildren[i].props.raw.show === false) {\n      continue\n    }\n    const node = children[i]\n    node[position] = offset\n    node[oppositePosition] = padding.oppositeStart\n    // todo: temporary text check, due to 1px width of empty text node\n    if (dimension === 'width') {\n      offset += node.width + (node.width !== ('text' in node ? 1 : 0) ? gap : 0)\n    } else {\n      offset +=\n        'text' in node\n          ? node.width > 1\n            ? node.height + gap\n            : 0\n          : node.height !== 0\n            ? node.height + gap\n            : 0\n    }\n    otherDimension = Math.max(\n      otherDimension,\n      node[oppositeDimension] + padding.oppositeStart + padding.oppositeEnd\n    )\n  }\n  // adjust the size of the layout container\n  this.node[dimension] = offset - gap + padding.end\n  this.node[oppositeDimension] = otherDimension\n\n  const align = {\n    start: 0,\n    end: 1,\n    center: 0.5,\n  }[config['align-items'] || 'start']\n\n  if (align !== 0) {\n    for (let i = 0; i < childrenLength; i++) {\n      const node = children[i]\n      node[oppositePosition] = otherDimension * align\n      node[oppositeMount] = align\n    }\n  }\n\n  // emit an updated event\n  if (config['@updated'] !== undefined) {\n    config['@updated']({ w: this.node.width, h: this.node.height }, this)\n  }\n\n  // trigger layout on parent if parent is a layout\n  if (this.config.parent && this.config.parent.props.__layout === true) {\n    this.config.parent.triggerLayout(this.config.parent.props)\n  }\n}\n\n/**\n * Checks if a value is a transition object.\n * @param {any} value - The value to check.\n * @returns {boolean} True if the value is a transition object, false otherwise.\n */\nconst isTransition = (value) => {\n  return value !== null && typeof value === 'object' && 'transition' in value === true\n}\n\n/**\n * Checks if a string is an object string (starts and ends with curly braces).\n * @param {string} str - The string to check.\n * @returns {boolean} True if the string is an object string, false otherwise.\n */\nconst isObjectString = (str) => {\n  return typeof str === 'string' && str.startsWith('{') && str.endsWith('}')\n}\n\n/**\n * Parses a string into an object, converting single quotes to double and adding quotes to keys.\n * @param {string} str - The string to parse.\n * @returns {object} The parsed object.\n */\nconst parseToObject = (str) => {\n  return JSON.parse(str.replace(/'/g, '\"').replace(/([{,]\\s*)([\\w-_]+)(\\s*:)/g, '$1\"$2\"$3'))\n}\n\n/**\n * Parses a percentage string or returns the value as-is.\n * @param {string|number} v - The value to parse (may be a percentage string).\n * @param {string} base - The base property name ('width' or 'height').\n * @returns {number|string} The parsed value as a number or the original value.\n * @this {{ element: { config: { parent?: { node?: Record<string, number> } } } }}\n */\nconst parsePercentage = function (v, base) {\n  if (typeof v !== 'string') {\n    return v\n  } else if (v.indexOf('%') === v.length - 1) {\n    return (\n      (this.element.config.parent &&\n        (this.element.config.parent.node[base] || 0) * (parseFloat(v) / 100)) ||\n      0\n    )\n  }\n  return v\n}\n\n/**\n * Unpacks a transition value from an object or returns the value as-is.\n * @param {any} v - The value to unpack.\n * @returns {any} The unpacked value.\n */\nconst unpackTransition = (v) => {\n  if (typeof v !== 'object' || v === null) return v\n  if (v.constructor === Object) {\n    if ('value' in v === true) {\n      return v.value\n    }\n    if ('transition' in v === true) {\n      return unpackTransition(v.transition)\n    }\n  }\n  return v\n}\n\nconst colorMap = {\n  top: 'colorTop',\n  bottom: 'colorBottom',\n  left: 'colorLeft',\n  right: 'colorRight',\n}\n\n/**\n * Default text settings for text nodes (initialized on first use).\n * @type {object|null}\n */\nlet textDefaults = null\n\n/**\n * Inspector enabled flag (initialized on first use).\n * @type {boolean|null}\n */\nlet inspectorEnabled = null\n\n/**\n * @typedef {import('../../component.js').BlitsElement} BlitsElement\n *\n * This is always a BlitsElement\n * @this {BlitsElement} this\n */\nconst propsTransformer = {\n  set parent(v) {\n    this.props['parent'] = v === 'root' ? renderer.root : v.node\n  },\n  set rotation(v) {\n    this.props['rotation'] = v * (Math.PI / 180)\n  },\n  set w(v) {\n    this.props['width'] = parsePercentage.call(this, v, 'width')\n  },\n  set width(v) {\n    this.props['width'] = parsePercentage.call(this, v, 'width')\n  },\n  set h(v) {\n    this.props['height'] = parsePercentage.call(this, v, 'height')\n  },\n  set height(v) {\n    this.props['height'] = parsePercentage.call(this, v, 'height')\n  },\n  set x(v) {\n    this.props['x'] = parsePercentage.call(this, v, 'width')\n  },\n  set y(v) {\n    this.props['y'] = parsePercentage.call(this, v, 'height')\n  },\n  set z(v) {\n    this.props['zIndex'] = v\n  },\n  set zIndex(v) {\n    this.props['zIndex'] = v\n  },\n  set color(v) {\n    if (typeof v === 'string' && v.startsWith('{') === false) {\n      this.props['color'] = colors.normalize(v)\n    } else if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      this.props['color'] = 0\n      Object.entries(v).forEach((color) => {\n        this.props[colorMap[color[0]]] = colors.normalize(color[1])\n      })\n    }\n  },\n  set src(v) {\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      this.props['src'] = v.src\n      this.props['imageType'] = v.type\n    } else {\n      this.props['src'] = v\n    }\n\n    if (this.raw['color'] === undefined) {\n      this.props['color'] = this.props['src'] ? 0xffffffff : 0x00000000\n    }\n    // apply auto sizing when no width or height specified\n    if (!('w' in this.raw) && !('w' in this.raw) && !('h' in this.raw) && !('height' in this.raw)) {\n      this.props['autosize'] = true\n    }\n  },\n  set texture(v) {\n    this.props['texture'] = v\n\n    if (this.raw['color'] === undefined && (v === null || v === undefined)) {\n      this.props['color'] = 0x00000000\n    } else if (this.raw['color'] === undefined) {\n      this.props['color'] = 0xffffffff\n    }\n  },\n  set fit(v) {\n    const resizeMode = {}\n\n    if (v === 'cover' || v === 'contain') {\n      this.props['textureOptions'] = { resizeMode: { type: v } }\n      return\n    }\n\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      resizeMode['type'] = v.type || 'cover'\n\n      if (typeof v.position === 'number') {\n        resizeMode['clipY'] = resizeMode['clipX'] = v.position\n      }\n\n      if (typeof v.position === 'object') {\n        resizeMode['clipX'] = 'x' in v.position === true ? v.position.x : null\n        resizeMode['clipY'] = 'y' in v.position === true ? v.position.y : null\n      }\n      this.props['textureOptions'] = { resizeMode }\n    }\n  },\n  set rtt(v) {\n    this.props['rtt'] = v\n    if (this.raw['color'] === undefined) {\n      this.props['color'] = v === true ? 0xffffffff : 0x00000000\n    }\n  },\n  set mount(v) {\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      if ('x' in v === true) {\n        this.props['mountX'] = v.x\n      }\n      if ('y' in v === true) {\n        this.props['mountY'] = v.y\n      }\n    } else {\n      this.props['mountX'] = v\n      this.props['mountY'] = v\n    }\n  },\n  set pivot(v) {\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      if ('x' in v === true) {\n        this.props['pivotX'] = v.x\n      }\n      if ('y' in v === true) {\n        this.props['pivotY'] = v.y\n      }\n    } else {\n      this.props['pivotX'] = v\n      this.props['pivotY'] = v\n    }\n  },\n  set scale(v) {\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      if ('x' in v === true) {\n        this.props['scaleX'] = v.x\n      }\n      if ('y' in v === true) {\n        this.props['scaleY'] = v.y\n      }\n    } else {\n      this.props['scaleX'] = v\n      this.props['scaleY'] = v\n    }\n  },\n  set show(v) {\n    if (v) {\n      this.props['alpha'] = this.raw['alpha'] !== undefined ? this.raw['alpha'] : 1\n    } else {\n      this.props['alpha'] = 0\n    }\n  },\n  set alpha(v) {\n    if (this.raw['show'] === undefined || this.raw['show'] == true) {\n      this.props['alpha'] = v\n    }\n  },\n  set shader(v) {\n    const target = this.element.node !== undefined ? this.element.node : this.props\n\n    if (v === null) {\n      target['shader'] = null\n      return\n    }\n\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      if (target.shader !== undefined && target.shader.type === v.type) {\n        for (const prop in v.props) {\n          target.shader.props[prop] = v.props[prop]\n        }\n        return\n      }\n      target['shader'] = renderer.createShader(v.type, v.props)\n    }\n  },\n  set effects(v) {\n    for (let i = 0; i < v.length; i++) {\n      if (v[i].props && v[i].props.color) {\n        v[i].props.color = colors.normalize(v[i].props.color)\n      }\n    }\n    if (this.element.node === undefined) {\n      this.props['shader'] = renderer.createShader('DynamicShader', {\n        effects: v.map((effect) => {\n          return renderer.createEffect(effect.type, effect.props)\n        }),\n      })\n    }\n  },\n  set clipping(v) {\n    this.props['clipping'] = v\n  },\n  set overflow(v) {\n    this.props['clipping'] = !!!v\n  },\n  set font(v) {\n    this.props['fontFamily'] = v\n  },\n  set size(v) {\n    this.props['fontSize'] = v\n  },\n  set wordwrap(v) {\n    Log.warn('The wordwrap attribute is deprecated, use maxwidth instead')\n    this.props['width'] = v\n    this.props['contain'] = 'width'\n  },\n  set maxwidth(v) {\n    this.props['width'] = v\n    this.props['contain'] = 'width'\n  },\n  set maxheight(v) {\n    this.props['height'] = v\n    this.props['contain'] = 'both'\n  },\n  set contain(v) {\n    this.props['contain'] = v\n  },\n  set maxlines(v) {\n    this.props['maxLines'] = v\n  },\n  set textoverflow(v) {\n    this.props['overflowSuffix'] = v === false ? ' ' : v === true ? undefined : v\n  },\n  set letterspacing(v) {\n    this.props['letterSpacing'] = v || 1\n  },\n  set lineheight(v) {\n    this.props['lineHeight'] = v\n  },\n  set align(v) {\n    this.props['textAlign'] = v\n  },\n  set content(v) {\n    this.props['text'] = '' + v\n  },\n  set placement(v) {\n    let x, y\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      if ('x' in v === true) {\n        x = v.x\n      }\n      if ('y' in v === true) {\n        y = v.y\n      }\n    } else {\n      v === 'center' || v === 'right' ? (x = v) : (y = v)\n    }\n\n    // Set X position\n    if (x === 'center') {\n      this.x = '50%'\n      this.props['mountX'] = 0.5\n    } else if (x === 'right') {\n      this.x = '100%'\n      this.props['mountX'] = 1\n    }\n\n    // Set Y position\n    if (y === 'middle') {\n      this.y = '50%'\n      this.props['mountY'] = 0.5\n    } else if (y === 'bottom') {\n      this.y = '100%'\n      this.props['mountY'] = 1\n    }\n  },\n  set 'inspector-data'(v) {\n    // Skip processing if inspector is not enabled for performance optimization\n    if (inspectorEnabled === false) {\n      return\n    }\n\n    if (typeof v === 'object' || (isObjectString(v) === true && (v = parseToObject(v)))) {\n      this.props['data'] = v\n    }\n  },\n}\n\nconst Element = {\n  /**\n   * Populates the element with data\n   * @param {import('../../component.js').BlitsElementProps} data\n   */\n  populate(data) {\n    const props = data\n    props['node'] = this.config.node\n\n    if (props[symbols.isSlot] === true) {\n      this[symbols.isSlot] = true\n    }\n\n    this.props.element = this\n\n    this.props['parent'] = props['parent'] || this.config.parent\n    //@ts-ignore This might be a left over from the old code?\n    delete props.parent\n\n    this.props.raw = data\n\n    const propKeys = Object.keys(props)\n    const length = propKeys.length\n\n    for (let i = 0; i < length; i++) {\n      const key = propKeys[i]\n      const value = props[key]\n      if (value !== undefined) {\n        this.props[key] = unpackTransition(value)\n      }\n    }\n\n    // correct for default white nodes (but not for text nodes)\n    if (this.props.props['color'] === undefined && '__textnode' in props === false) {\n      this.props.props['color'] = 0\n    }\n\n    this.node = props.__textnode\n      ? renderer.createTextNode({ ...textDefaults, ...this.props.props })\n      : renderer.createNode(this.props.props)\n\n    if (props['@loaded'] !== undefined && typeof props['@loaded'] === 'function') {\n      this.node.on('loaded', (el, { type, dimensions }) => {\n        props['@loaded']({ w: dimensions.width, h: dimensions.height, type }, this)\n      })\n    }\n\n    if (props['@error'] !== undefined && typeof props['@error'] === 'function') {\n      this.node.on('failed', (el, error) => {\n        props['@error'](error, this)\n      })\n    }\n\n    if (props.__layout === true) {\n      this.triggerLayout = layoutFn.bind(this)\n    }\n\n    if (this.config.parent.props !== undefined && this.config.parent.props.__layout === true) {\n      this.config.parent.triggerLayout(this.config.parent.props)\n      this.node.on('loaded', () => {\n        this.config.parent.triggerLayout(this.config.parent.props)\n      })\n    }\n  },\n  /**\n   * Set an individual property on the node\n   *\n   * @this {import('../../component').BlitsElement} this\n   *\n   * @param {import('../..//component.js').BlitsElementProps} prop\n   * @param {any} value\n   * @returns {void}\n   */\n  set(prop, value) {\n    if (value === undefined) return\n    // @ts-ignore\n    if (this.props.raw[prop] === value) return\n    // @ts-ignore\n    this.props.raw[prop] = value\n\n    this.props.props = {}\n    // @ts-ignore\n    this.props[prop] = unpackTransition(value)\n\n    const propsKeys = Object.keys(this.props.props)\n\n    if (propsKeys.length === 1) {\n      if (isTransition(value) === true) {\n        return this.animate(propsKeys[0], this.props.props[propsKeys[0]], value.transition)\n      }\n      // set the prop to the value on the node\n      this.node[propsKeys[0]] = this.props.props[propsKeys[0]]\n    } else {\n      for (let i = 0; i < propsKeys.length; i++) {\n        // todo: fix code duplication\n        if (isTransition(value) === true) {\n          this.animate(propsKeys[i], this.props.props[propsKeys[i]], value.transition)\n        } else {\n          // set the prop to the value on the node\n          this.node[propsKeys[i]] = this.props.props[propsKeys[i]]\n        }\n      }\n    }\n\n    if (this.config.parent.props && this.config.parent.props.__layout === true) {\n      this.config.parent.triggerLayout(this.config.parent.props)\n    }\n  },\n  animate(prop, value, transition) {\n    // check if a transition is already scheduled to run on the same prop\n    // and cancels it if it does\n    if (\n      this.scheduledTransitions[prop] !== undefined &&\n      this.scheduledTransitions[prop].f.state === 'scheduled'\n    ) {\n      this.scheduledTransitions[prop].f.stop()\n    }\n\n    // if current value is the same as the value to animate to, instantly resolve\n    if (this.node[prop] === value) return\n\n    const props = {}\n    props[prop] = value\n\n    // construct animate function\n    const f = this.node.animate(props, {\n      duration:\n        typeof transition === 'object'\n          ? 'duration' in transition\n            ? transition.duration\n            : 300\n          : 300,\n      easing:\n        typeof transition === 'object'\n          ? 'easing' in transition\n            ? transition.easing\n            : 'ease'\n          : 'ease',\n      delay: typeof transition === 'object' ? ('delay' in transition ? transition.delay : 0) : 0,\n    })\n\n    // capture the current value to be used in the transition start\n    const startValue = this.node[prop]\n\n    // schedule the transition for this prop, so it can be canceled /\n    // removed if another transition for the same prop starts in the mean time\n    this.scheduledTransitions[prop] = {\n      v: props[prop],\n      f,\n    }\n\n    if (transition.start !== undefined && typeof transition.start === 'function') {\n      // fire transition start callback when animation really starts (depending on specified delay)\n      f.once('animating', () => {\n        transition.start.call(this.component, this, prop, startValue)\n      })\n    }\n\n    if (this.config.parent.props && this.config.parent.props.__layout === true) {\n      f.on('tick', () => {\n        this.config.parent.triggerLayout(this.config.parent.props)\n      })\n    }\n\n    if (transition.progress !== undefined && typeof transition.progress === 'function') {\n      let prevProgress = 0\n      f.on('tick', (_node, { progress }) => {\n        transition.progress.call(this.component, this, prop, progress, prevProgress)\n        prevProgress = progress\n      })\n    }\n\n    f.once('stopped', () => {\n      if (\n        this.scheduledTransitions[prop] !== undefined &&\n        this.scheduledTransitions[prop].canceled === true\n      ) {\n        return\n      }\n      // fire transition end callback when animation ends (if specified)\n      if (this.node !== undefined && transition.end && typeof transition.end === 'function') {\n        transition.end.call(this.component, this, prop, this.node[prop])\n      }\n      // remove the prop from scheduled transitions\n      delete this.scheduledTransitions[prop]\n    })\n\n    // start animation\n    f.start()\n  },\n  destroy() {\n    if (this.node === null) return\n\n    Log.debug('Deleting Node', this.nodeId)\n    // Clearing transition end callback functions\n    const transitionProps = Object.keys(this.scheduledTransitions)\n    for (let i = 0; i < transitionProps.length; i++) {\n      const transition = this.scheduledTransitions[transitionProps[i]]\n      if (transition !== undefined) {\n        transition.canceled = true\n        if (transition.f !== undefined) transition.f.stop()\n      }\n    }\n\n    // not setting to null and deleting,\n    // because transition stopped might still be fired (maybe a renderer fix resolves that)\n    this.scheduledTransitions = {}\n\n    this.component = null\n    delete this.component\n\n    this.config = null\n    delete this.config\n\n    this.props.raw = {}\n    this.props.element = null\n    this.props.props = null\n    this.props = {}\n    delete this.props\n\n    this.triggerLayout = null\n    delete this.triggerLayout\n\n    this.forComponent = null\n    delete this.forComponent\n\n    this.node.destroy()\n    this.node = null\n  },\n  get nodeId() {\n    return this.node && this.node.id\n  },\n  get ref() {\n    return this.props.ref || null\n  },\n  get parent() {\n    return this.node && this.node.parent\n  },\n  get children() {\n    const allChildren = this.component[symbols.getChildren]()\n    const directChildren = []\n    const l = allChildren.length\n    for (let i = 0; i < l; i++) {\n      const child = allChildren[i]\n      if (\n        child !== undefined &&\n        child.parent === (this[symbols.isSlot] ? this.node.children[0] : this.node)\n      ) {\n        directChildren.push(child)\n      }\n    }\n\n    return directChildren\n  },\n}\n\n/**\n * Returns a new Blits Element\n *\n * @param {Object} config - The configuration object for the element\n * @param {import('../../component.js').BlitsComponent} component - The component to which the element belongs\n * @returns {import('../../component.js').BlitsElement} - The new Blits Element\n */\nexport default (config, component) => {\n  if (textDefaults === null) {\n    textDefaults = {\n      fontSize: 32,\n      fontFamily: Settings.get('defaultFont', 'sans-serif'),\n    }\n  }\n  if (inspectorEnabled === null) {\n    inspectorEnabled = Settings.get('inspector', false)\n  }\n  return Object.assign(Object.create(Element), {\n    props: Object.assign(Object.create(propsTransformer), { props: {} }),\n    scheduledTransitions: {},\n    config,\n    component,\n  })\n}\n", "import Element from './element.js'\nimport Launch from './launch.js'\n\nexport default {\n  Element,\n  Launch,\n}\n", "{\n  \"name\": \"@lightningjs/blits\",\n  \"version\": \"1.45.2\",\n  \"description\": \"Blits: The Lightning 3 App Development Framework\",\n  \"bin\": \"bin/index.js\",\n  \"exports\": {\n    \".\": \"./index.js\",\n    \"./vite\": \"./vite/index.js\",\n    \"./transitions\": \"./src/router/transitions/index.js\",\n    \"./precompiler\": \"./src/lib/precompiler/precompiler.js\",\n    \"./plugins\": {\n      \"types\": \"./src/plugins/index.d.ts\",\n      \"default\": \"./src/plugins/index.js\"\n    },\n    \"./plugins/language\": {\n      \"types\": \"./src/plugins/language.d.ts\",\n      \"default\": \"./src/plugins/language.js\"\n    },\n    \"./plugins/theme\": {\n      \"types\": \"./src/plugins/theme.d.ts\",\n      \"default\": \"./src/plugins/theme.js\"\n    },\n    \"./plugins/appstate\": {\n      \"types\": \"./src/plugins/appstate.d.ts\",\n      \"default\": \"./src/plugins/appstate.js\"\n    },\n    \"./plugins/storage\": {\n      \"types\": \"./src/plugins/storage/storage.d.ts\",\n      \"default\": \"./src/plugins/storage/storage.js\"\n    },\n    \"./symbols\": \"./src/lib/symbols.js\",\n    \"./blitsFileConverter\": \"./src/lib/blitsfileconverter/blitsfileconverter.js\"\n  },\n  \"scripts\": {\n    \"test\": \"c8 node scripts/runTests.js\",\n    \"test:ci\": \"c8 npm run test:run\",\n    \"test:run\": \"node -r global-jsdom/register ./node_modules/.bin/tape '{,!(node_modules|packages)/**/}*.test.js' | tap-diff\",\n    \"lint\": \"node scripts/lint.js\",\n    \"lint:fix\": \"node scripts/lint.js fix\",\n    \"prepublishOnly\": \"node scripts/prepublishOnly.js\",\n    \"postpublish\": \"node scripts/postpublish.js\",\n    \"prepare\": \"husky\",\n    \"pack-preview\": \"npm pack --dry-run\",\n    \"release\": \"npm publish --access public\"\n  },\n  \"types\": \"./index.d.ts\",\n  \"lint-staged\": {\n    \"*.js\": [\n      \"eslint --fix\"\n    ]\n  },\n  \"type\": \"module\",\n  \"author\": \"Michiel van der Geest <hello@michielvandergeest.com>\",\n  \"license\": \"Apache-2.0\",\n  \"devDependencies\": {\n    \"@babel/eslint-parser\": \"^7.26.5\",\n    \"@babel/plugin-syntax-import-assertions\": \"^7.26.0\",\n    \"@eslint/eslintrc\": \"^3.3.1\",\n    \"@eslint/js\": \"^9.33.0\",\n    \"c8\": \"^9.1.0\",\n    \"eslint\": \"^9.33.0\",\n    \"eslint-config-prettier\": \"^10.1.8\",\n    \"eslint-plugin-prettier\": \"^5.5.4\",\n    \"fast-glob\": \"^3.3.3\",\n    \"global-jsdom\": \"24.0.0\",\n    \"globals\": \"^16.3.0\",\n    \"husky\": \"^9.1.7\",\n    \"jsdom\": \"24.0.0\",\n    \"lint-staged\": \"^15.5.0\",\n    \"prettier\": \"^3.6.2\",\n    \"sinon\": \"^21.0.0\",\n    \"tap-diff\": \"^0.1.1\",\n    \"tape\": \"^5.5.0\"\n  },\n  \"dependencies\": {\n    \"@lightningjs/msdf-generator\": \"^1.2.0\",\n    \"@lightningjs/renderer\": \"^2.20.2\",\n    \"magic-string\": \"^0.30.21\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/lightning-js/blits.git\"\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Settings from './settings.js'\nimport { initLog, Log } from './lib/log.js'\nimport engine from './engine.js'\nimport blitsPackageInfo from '../package.json' with { type: 'json' }\n\n/**\n * @typedef {Object} Font\n * @property {string} family - Name of the font family\n * @property {string} type - Type of font (web, msdf, sdf)\n * @property {string} [file] - Location to the font file\n * @property {string} [json] - Location of the font map (for msdf/sdf)\n * @property {string} [png] - Location of the font png (for msdf/sdf)\n */\n/**\n * @typedef {Object} ShaderEffect\n * @property {string} name\n * @property {any} type\n */\n/**\n * @typedef {Object} Shader\n * @property {string} name\n * @property {any} type\n */\n\n/**\n * @typedef {import('@lightningjs/renderer').RendererMain} RendererMain\n * @type {RendererMain}\n */\n// @ts-ignore - We ignore this because it will be replaced by the renderer once the app is launched\nexport let renderer = {}\nexport const stage = {}\n\nasync function rendererVersion() {\n  let rendererPackageInfo\n  try {\n    // Dynamically import the renderer package.json\n    rendererPackageInfo = await import('../../renderer/package.json')\n    if (rendererPackageInfo !== undefined) {\n      return rendererPackageInfo.version\n    }\n  } catch (e) {\n    // Fallback to renderer version in dependencies\n    return blitsPackageInfo.dependencies['@lightningjs/renderer']\n  }\n}\n\n/**\n * @typedef {Object} BlitsSettings\n * @property {number} [w] - Width of the Application\n * @property {number} [h] - Height of the Application\n * @property {boolean} [multithreaded] - Whether to enable multithreaded\n * @property {0|1|2|\"info\"|\"warn\"|\"error\"|\"debug\"[]} [debugLevel] - Debug level for console log messages\n * @property {Font[]} [fonts] - Fonts to be used in the Application\n * @property {ShaderEffect[]} [effects] - Effects to be used by DynamicShader\n * @property {Shader[]} [shaders] - Shaders to be used in the application\n * @property {string} [defaultFont] - Default font family to use in the Application\n * @property {object} [keymap] - Custom keymapping\n * @property {\"Proxy\"|\"defineProperty\"} [reactivityMode] - Mode of reactivity\n * @property {\"hd\"|\"720p\"|720|\"fhd\"|\"fullhd\"|\"1080p\"|1080|\"4k\"|\"2160p\"|2160} [screenResolution] - Screen resolution of the device\n * @property {\"low\"|\"medium\"|\"high\"|\"retina\"|number} [renderQuality] - Quality of the rendered App\n * @property {number} [pixelRatio] - Custom pixel ratio of the device\n * @property {number} [fpsInterval] - Interval in ms to receive FPS updates\n * @property {number} [webWorkersLimit] - Maximum number of web workers\n * @property {string} [canvasColor] - Background color of the canvas\n * @property {boolean} [inspector] - Enable inspector\n * @property {number|[number,number,number,number]} [viewportMargin] - Extra margin to the viewport\n * @property {number} [gpuMemoryLimit] - Threshold after which textures are freed (deprecated)\n * @property {object} [gpuMemory] - Configures the gpu memory settings\n * @property {\"webgl\"|\"canvas\"} [renderMode] - Defines which mode the renderer should operate in\n * @property {number} [holdTimeout] - Time after which a key press is considered a hold\n * @property {HTMLCanvasElement} [canvas] - Custom canvas object used to render the App\n * @property {number} [textureProcessingTimeLimit] - Max time renderer can process textures in a frame\n * @property {Partial<import('@lightningjs/renderer').RendererMainSettings>} [advanced] - Advanced renderer settings\n * @property {boolean} [announcer] - Whether or not the announcer should be activated on initialization\n * @property {number} [maxFPS] - Maximum FPS\n */\n\n/**\n * Blits App defines the structure of the Blits application.\n * @typedef {import('./component').BlitsComponent} BlitsComponent\n * @typedef {BlitsComponent & { quit: () => void }} BlitsAppComponent\n * @typedef {() => BlitsAppComponent} BlitsAppFactory\n */\n\n/**\n * Launches the Blits application with the given App, target, and settings.\n * Sets up logging, version info, and initializes the renderer and stage singletons.\n *\n * @param {BlitsAppFactory} App - The root BlitsComponent to launch.\n * @param {HTMLElement} target - The DOM element or rendering target.\n * @param {BlitsSettings} settings - Configuration settings for the application.\n * @returns {void}\n */\nexport default (App, target, settings) => {\n  Settings.set(settings)\n\n  initLog()\n\n  rendererVersion().then((v) => {\n    Log.info('Blits Version ', blitsPackageInfo.version)\n    Log.info('Renderer Version ', v)\n  })\n\n  stage.element = engine.Element\n\n  renderer = engine.Launch(App, target, settings)\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport default {\n  before: {\n    prop: 'alpha',\n    value: 0,\n  },\n  in: {\n    prop: 'alpha',\n    value: 1,\n    duration: 200,\n  },\n  out: {\n    prop: 'alpha',\n    value: 0,\n    duration: 100,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../lib/log.js'\n\nconst syn = window.speechSynthesis\n\nconst isAndroid = /android/i.test((window.navigator || {}).userAgent || '')\n\nconst utterances = new Map() // Strong references with unique keys\n\nlet initialized = false\nlet infinityTimer = null\n\nconst clear = () => {\n  if (infinityTimer) {\n    clearTimeout(infinityTimer)\n    infinityTimer = null\n  }\n}\n\nconst resumeInfinity = (target) => {\n  if (!target || infinityTimer) {\n    return clear()\n  }\n\n  syn.pause()\n  setTimeout(() => {\n    syn.resume()\n  }, 0)\n\n  infinityTimer = setTimeout(() => {\n    resumeInfinity(target)\n  }, 5000)\n}\n\nconst defaultUtteranceProps = {\n  lang: 'en-US',\n  pitch: 1,\n  rate: 1,\n  voice: null,\n  volume: 1,\n}\n\nconst initialize = () => {\n  const voices = syn.getVoices()\n  defaultUtteranceProps.voice = voices[0] || null\n  initialized = true\n}\n\nconst speak = (options) => {\n  const utterance = new SpeechSynthesisUtterance(options.message)\n  const id = options.id\n  utterance.lang = options.lang || defaultUtteranceProps.lang\n  utterance.pitch = options.pitch || defaultUtteranceProps.pitch\n  utterance.rate = options.rate || defaultUtteranceProps.rate\n  utterance.voice = options.voice || defaultUtteranceProps.voice\n  utterance.volume = options.volume || defaultUtteranceProps.volume\n  utterances.set(id, utterance) // Strong reference\n\n  if (isAndroid === false) {\n    utterance.onstart = () => {\n      resumeInfinity(utterance)\n    }\n\n    utterance.onresume = () => {\n      resumeInfinity(utterance)\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    utterance.onend = () => {\n      clear()\n      utterances.delete(id) // Cleanup\n      resolve()\n    }\n\n    utterance.onerror = (e) => {\n      clear()\n      utterances.delete(id) // Cleanup\n      reject(e)\n    }\n\n    syn.speak(utterance)\n  })\n}\n\nexport default {\n  speak(options) {\n    if (syn !== undefined) {\n      if (initialized === false) {\n        initialize()\n      }\n      return speak(options)\n    } else {\n      Log.error('speechSynthesis web API not available')\n      return Promise.reject({ error: 'unavailable' })\n    }\n  },\n  cancel() {\n    if (syn !== undefined) {\n      syn.cancel()\n      clear()\n    }\n  },\n  // @todo\n  // getVoices() {\n  //   return syn.getVoices()\n  // },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../lib/log.js'\nimport speechSynthesis from './speechSynthesis.js'\n\nlet active = false\nlet count = 0\nconst queue = []\nlet isProcessing = false\nlet currentId = null\nlet debounce = null\n\n// Global default utterance options\nlet globalDefaultOptions = {}\n\nconst noopAnnouncement = {\n  then() {},\n  done() {},\n  cancel() {},\n  remove() {},\n  stop() {},\n}\n\nconst enable = () => {\n  active = true\n}\n\nconst disable = () => {\n  active = false\n}\n\nconst toggle = (v) => {\n  active = v ? true : false\n}\n\nconst speak = (message, politeness = 'off', options = {}) => {\n  if (active === false) return noopAnnouncement\n\n  return addToQueue(message, politeness, false, options)\n}\n\nconst pause = (delay) => {\n  if (active === false) return noopAnnouncement\n\n  return addToQueue(undefined, undefined, delay)\n}\n\nconst addToQueue = (message, politeness, delay = false, options = {}) => {\n  // keep track of the id so message can be canceled\n  const id = count++\n\n  // setup a promise to allow developer to chain functionality\n  // when specific utterances are done\n  let resolveFn\n  const done = new Promise((resolve) => {\n    resolveFn = resolve\n  })\n\n  // augment the promise with a cancel / remove function\n  done.remove = done.cancel = () => {\n    const index = queue.findIndex((item) => item.id === id)\n    if (index !== -1) queue.splice(index, 1)\n    Log.debug(`Announcer - removed from queue: \"${message}\" (id: ${id})`)\n    resolveFn('canceled')\n  }\n\n  // augment the promise with a stop function\n  done.stop = () => {\n    if (id === currentId) {\n      speechSynthesis.cancel()\n      isProcessing = false\n      resolveFn('interupted')\n    }\n  }\n\n  // add message of pause\n  if (delay === false) {\n    politeness === 'assertive'\n      ? queue.unshift({ message, resolveFn, id, options })\n      : queue.push({ message, resolveFn, id, options })\n  } else {\n    queue.push({ delay, resolveFn, id })\n  }\n\n  Log.debug(`Announcer - added to queue: \"${message}\" (id: ${id})`)\n\n  setTimeout(() => {\n    processQueue()\n  }, 100)\n\n  return done\n}\n\nconst processQueue = async () => {\n  if (isProcessing === true || queue.length === 0) return\n  isProcessing = true\n\n  const { message, resolveFn, delay, id, options = {} } = queue.shift()\n\n  currentId = id\n\n  if (delay) {\n    setTimeout(() => {\n      isProcessing = false\n      currentId = null\n      resolveFn('finished')\n      processQueue()\n    }, delay)\n  } else {\n    if (debounce !== null) clearTimeout(debounce)\n    // add some easing when speaking the messages to reduce stuttering\n    debounce = setTimeout(() => {\n      Log.debug(`Announcer - speaking: \"${message}\" (id: ${id})`)\n\n      speechSynthesis\n        .speak({\n          message,\n          id,\n          ...globalDefaultOptions,\n          ...options,\n        })\n        .then(() => {\n          Log.debug(`Announcer - finished speaking: \"${message}\" (id: ${id})`)\n\n          currentId = null\n          isProcessing = false\n          resolveFn('finished')\n          processQueue()\n        })\n        .catch((e) => {\n          currentId = null\n          isProcessing = false\n          Log.debug(`Announcer - error (\"${e.error}\") while speaking: \"${message}\" (id: ${id})`)\n          resolveFn(e.error)\n          processQueue()\n        })\n      debounce = null\n    }, 200)\n  }\n}\n\nconst polite = (message, options = {}) => speak(message, 'polite', options)\n\nconst assertive = (message, options = {}) => speak(message, 'assertive', options)\n\nconst stop = () => {\n  speechSynthesis.cancel()\n}\n\nconst clear = () => {\n  isProcessing = false\n  queue.length = 0\n}\n\nconst configure = (options = {}) => {\n  globalDefaultOptions = { ...globalDefaultOptions, ...options }\n}\n\nexport default {\n  speak,\n  polite,\n  assertive,\n  stop,\n  enable,\n  disable,\n  toggle,\n  clear,\n  pause,\n  configure,\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { default as fadeInFadeOutTransition } from './transitions/fadeInOut.js'\nimport { reactive } from '../lib/reactivity/reactive.js'\n\nimport symbols from '../lib/symbols.js'\nimport { Log } from '../lib/log.js'\nimport { stage } from '../launch.js'\nimport Focus from '../focus.js'\nimport Announcer from '../announcer/announcer.js'\nimport Settings from '../settings.js'\n\n/**\n * @typedef {import('../component.js').BlitsComponentFactory} BlitsComponentFactory - The component of the route\n * @typedef {import('../component.js').BlitsComponent} BlitsComponent - The element of the route\n * @typedef {import('../engines/L3/element.js').BlitsElement} BlitsElement - The element of the route\n *\n * @typedef {Object} Route\n * @property {string} path - The path of the route\n * @property {string} hash - The hash of the route\n * @property {Object} params - The params of the route\n * @property {Object} data - The data of the route\n * @property {Object} options - The options of the route\n * @property {Object} hooks - The hooks of the route\n * @property {Object} transition - The transition of the route\n * @property {Object} announce - The announce of the route\n * @property {(options: Object, parentEl: BlitsElement, parentComponent: BlitsComponent, rootComponent?: BlitsComponent) => BlitsComponent} component - The component factory of the route\n *\n * @typedef {Object} Hash\n * @property {string} path - The path of the hash\n * @property {URLSearchParams} queryParams - The query params of the hash\n * @property {string} hash - The hash\n *\n */\n\n/** @type {Route} */\nexport let currentRoute\nexport const state = reactive(\n  {\n    path: '',\n    navigating: false,\n    data: null,\n    params: null,\n    hash: '',\n  },\n  Settings.get('reactivityMode'),\n  true\n)\n\n// Changed from WeakMap to Map to allow for caching of views by the url hash.\n// We are manually doing the cleanup of the cache when the route is not marked as keepAlive.\n\n/**\n * @typedef {Object} CacheMapEntry\n * @property {BlitsComponent|BlitsComponentFactory} view - The view of the route\n * @property {BlitsComponent} focus - The focus of the route\n */\n\nconst history = []\n\nlet overrideOptions = {}\nlet navigationData = {}\nlet navigatingBack = false\nlet navigatingBackTo = undefined\nlet previousFocus\n// Skips internal router navigation when set to true only for the next \"navigate\"\n// execution, needed for window.history management\nlet preventHashChangeNavigation = false\n/**\n * Get the current hash\n * @returns {Hash}\n */\nexport const getHash = (hash) => {\n  if (!hash) hash = '/'\n  const hashParts = hash.replace(/^#/, '').split('?')\n  return {\n    path: hashParts[0],\n    queryParams: new URLSearchParams(hashParts[1]),\n    hash: hash,\n  }\n}\n\nconst normalizePath = (path) => {\n  return (\n    path\n      // remove leading and trailing slashes\n      .replace(/^\\/+|\\/+$/g, '')\n      .toLowerCase()\n  )\n}\n\n/**\n * Check if a value is an object\n * @param {any} v\n * @returns {boolean} True if v is an object\n */\nconst isObject = (v) => typeof v === 'object' && v !== null\n\n/**\n * Check if a value is a function\n * @param {any} v\n * @returns {boolean} True if v is a string\n */\nconst isString = (v) => typeof v === 'string'\n\nconst queryParamsToObject = (queryParams) => {\n  if (!queryParams) return {}\n  const object = {}\n  const queryParamsEntries = [...queryParams.entries()]\n  for (let i = 0; i < queryParamsEntries.length; i++) {\n    object[queryParamsEntries[i][0]] = queryParamsEntries[i][1]\n  }\n\n  return object\n}\n\n/**\n * Match a path to a route\n *\n * @param {object} hashObject\n * @param {Route[]} routes\n * @returns {Route}\n */\nexport const matchHash = ({ hash, path, queryParams }, routes = []) => {\n  // remove trailing slashes\n  const originalPath = path.replace(/^\\/+|\\/+$/g, '')\n  const originalNormalizedPath = normalizePath(path)\n\n  const override = {\n    hash: hash,\n    queryParams: queryParamsToObject(queryParams),\n    path: path,\n  }\n\n  /** @type {boolean|Route} */\n  let matchingRoute = false\n  let i = 0\n  while (!matchingRoute && i < routes.length) {\n    const route = routes[i]\n\n    const normalizedPath = normalizePath(route.path)\n    if (normalizePath(normalizedPath) === originalNormalizedPath) {\n      matchingRoute = makeRouteObject(route, override)\n    } else if (normalizedPath.indexOf(':') > -1) {\n      // match dynamic route parts\n      const dynamicRouteParts = [...normalizedPath.matchAll(/:([^\\s/]+)/gi)]\n\n      // construct a regex for the route with dynamic parts\n      let dynamicRoutePartsRegex = normalizedPath\n      dynamicRouteParts.reverse().forEach((part) => {\n        dynamicRoutePartsRegex =\n          dynamicRoutePartsRegex.substring(0, part.index) +\n          '([^\\\\s/]+)' +\n          dynamicRoutePartsRegex.substring(part.index + part[0].length)\n      })\n\n      dynamicRoutePartsRegex = '^' + dynamicRoutePartsRegex\n\n      // test if the constructed regex matches the path\n      const match = originalPath.match(new RegExp(`${dynamicRoutePartsRegex}`, 'i'))\n\n      if (match) {\n        // map the route params to a params object\n        override.params = dynamicRouteParts.reverse().reduce((acc, part, index) => {\n          acc[part[1]] = match[index + 1]\n          return acc\n        }, {})\n\n        matchingRoute = makeRouteObject(route, override)\n      }\n    } else if (normalizedPath.endsWith('*')) {\n      const regex = new RegExp(normalizedPath.replace(/\\/?\\*/, '/?([^\\\\s]*)'), 'i')\n      const match = originalNormalizedPath.match(regex)\n\n      if (match) {\n        override.params = {}\n        if (match[1]) override.params.path = match[1]\n        matchingRoute = makeRouteObject(route, override)\n      }\n    }\n    i++\n  }\n\n  // @ts-ignore - Remove me when we have a better way to handle this\n  return matchingRoute\n}\n\n/**\n * Default Route options\n *\n */\nconst defaultOptions = {\n  inHistory: true,\n  keepAlive: false,\n  passFocus: true,\n  reuseComponent: false,\n}\n\nconst makeRouteObject = (route, overrides) => {\n  const cleanRoute = {\n    hash: overrides.hash,\n    path: route.path,\n    component: route.component,\n    transition: 'transition' in route ? route.transition : fadeInFadeOutTransition,\n    options: { ...defaultOptions, ...route.options, ...overrideOptions },\n    announce: route.announce || false,\n    hooks: route.hooks || {},\n    data: { ...route.data, ...navigationData, ...overrides.queryParams },\n    params: overrides.params || {},\n    meta: route.meta || {},\n  }\n\n  return cleanRoute\n}\n\n/**\n * Navigate to a route\n *\n * This isn't the prettiest way to do this, but it works. The reason is that extends\n * only works for Classes or Factory functions. As such we need to use this\n * @typedef {BlitsComponent & {\n *   activeView: BlitsComponent\n * }} RouterViewComponent\n *\n * @this {RouterViewComponent} this\n * @returns {Promise<void>}\n */\nexport const navigate = async function () {\n  Announcer.stop()\n  Announcer.clear()\n  state.navigating = true\n  let reuse = false\n  if (preventHashChangeNavigation === false && this.parent[symbols.routes]) {\n    let previousRoute = currentRoute //? Object.assign({}, currentRoute) : undefined\n    let route = matchHash(getHash(document.location.hash), this.parent[symbols.routes])\n\n    currentRoute = route\n\n    if (route) {\n      const currentPath = currentRoute.path\n      let beforeEachResult\n      if (this.parent[symbols.routerHooks]) {\n        const hooks = this.parent[symbols.routerHooks]\n        if (hooks.beforeEach) {\n          try {\n            beforeEachResult = await hooks.beforeEach.call(this.parent, route, previousRoute)\n            if (isString(beforeEachResult)) {\n              currentRoute = previousRoute\n              to(beforeEachResult)\n              return\n            }\n          } catch (error) {\n            Log.error('Error or Rejected Promise in \"BeforeEach\" Hook', error)\n\n            if (history.length > 0) {\n              preventHashChangeNavigation = true\n              currentRoute = previousRoute\n              window.history.back()\n\n              navigatingBack = false\n              state.navigating = false\n              return\n            }\n          }\n          // If the resolved result is an object, redirect if the path in the object was changed\n          if (isObject(beforeEachResult) === true && beforeEachResult.path !== currentPath) {\n            currentRoute = previousRoute\n            to(beforeEachResult.path, beforeEachResult.data, beforeEachResult.options)\n            return\n          }\n          // If the resolved result is false, cancel navigation\n          if (beforeEachResult === false && history.length > 0) {\n            preventHashChangeNavigation = true\n            currentRoute = previousRoute\n            window.history.back()\n\n            navigatingBack = false\n            state.navigating = false\n            return\n          }\n        }\n      }\n\n      let beforeHookOutput\n      if (route.hooks.before) {\n        try {\n          beforeHookOutput = await route.hooks.before.call(this.parent, route, previousRoute)\n          if (isString(beforeHookOutput)) {\n            currentRoute = previousRoute\n            to(beforeHookOutput)\n            return\n          }\n        } catch (error) {\n          Log.error('Error or Rejected Promise in \"Before\" Hook', error)\n\n          if (history.length > 0) {\n            preventHashChangeNavigation = true\n            currentRoute = previousRoute\n            window.history.back()\n\n            navigatingBack = false\n            state.navigating = false\n            return\n          }\n        }\n        // If the resolved result is an object, redirect if the path in the object was changed\n        if (isObject(beforeHookOutput) === true && beforeHookOutput.path !== currentPath) {\n          currentRoute = previousRoute\n          to(beforeHookOutput.path, beforeHookOutput.data, beforeHookOutput.options)\n          return\n        }\n        // If the resolved result is false, cancel navigation\n        if (beforeHookOutput === false && history.length > 0) {\n          preventHashChangeNavigation = true\n          currentRoute = previousRoute\n          window.history.back()\n\n          navigatingBack = false\n          state.navigating = false\n          return\n        }\n      }\n      // add the previous route (technically still the current route at this point)\n      // into the history stack when inHistory is true and we're not navigating back\n      if (\n        previousRoute !== undefined &&\n        previousRoute.options.inHistory === true &&\n        navigatingBack === false\n      ) {\n        history.push(previousRoute)\n      }\n\n      // a transition can be a function returning a dynamic transition object\n      // based on current and previous route\n      if (typeof route.transition === 'function') {\n        route.transition = route.transition(previousRoute, route)\n      }\n\n      /** @type {import('../engines/L3/element.js').BlitsElement} */\n      let holder\n\n      let view\n      let focus\n      // when navigating back let's see if we're navigating back to a route that was kept alive\n      if (navigatingBack === true && navigatingBackTo !== undefined) {\n        view = navigatingBackTo.view\n        focus = navigatingBackTo.focus\n        navigatingBackTo = null\n      }\n      // merge props with potential route params, navigation data and route data to be injected into the component instance\n      const props = {\n        ...this[symbols.props],\n        ...route.params,\n        ...route.data,\n      }\n\n      // see if the component of the previous route can be reused for the\n      // current route\n      if (\n        previousRoute &&\n        route.options.reuseComponent === true &&\n        route.options.keepAlive !== true &&\n        route.component === previousRoute.component\n      ) {\n        reuse = true\n        view = this[symbols.children][this[symbols.children].length - 1]\n        for (const prop in props) {\n          view[symbols.props][prop] = props[prop]\n        }\n      }\n\n      // Announce route change if a message has been specified for this route\n      if (route.announce) {\n        if (typeof route.announce === 'string') {\n          route.announce = {\n            message: route.announce,\n          }\n        }\n        Announcer.speak(route.announce.message, route.announce.politeness)\n      }\n\n      // Update router state after announcements and final route resolution,\n      // right before initializing or restoring the view\n      state.path = route.path\n      state.params = route.params || {}\n      state.hash = route.hash\n      state.data = null\n      state.data = route.data || {}\n\n      if (!view) {\n        // create a holder element for the new view\n        holder = stage.element({ parent: this[symbols.children][0] })\n        holder.populate({})\n        holder.set('w', '100%')\n        holder.set('h', '100%')\n\n        view = await route.component({ props }, holder, this)\n\n        // is the component a dynamic module?\n        if (view[Symbol.toStringTag] === 'Module') {\n          if (view.default && typeof view.default === 'function') {\n            view = view.default({ props }, holder, this)\n          } else {\n            Log.error(\"Dynamic import doesn't have a default export or default is not a function\")\n          }\n        }\n\n        if (typeof view === 'function') {\n          // had to inline this because the tscompiler does not like LHS reassignments\n          // that also change the type of the variable in a variable union\n          view = /** @type {BlitsComponentFactory} */ (view)({ props }, holder, this)\n        }\n      } else {\n        holder = view[symbols.holder]\n\n        // Check, whether cached view holder's alpha prop is exists in transition or not\n        let hasAlphaProp = false\n        if (route.transition.before) {\n          if (Array.isArray(route.transition.before)) {\n            for (let i = 0; i < route.transition.before.length; i++) {\n              if (route.transition.before[i].prop === 'alpha') {\n                hasAlphaProp = true\n                break\n              }\n            }\n          } else if (route.transition.before.prop === 'alpha') {\n            hasAlphaProp = true\n          }\n        }\n        // set holder alpha when alpha prop is not exists in route transition\n        if (hasAlphaProp === false) {\n          holder.set('alpha', 1)\n        }\n      }\n\n      // store the new view as new child, only if we're not reusing the previous page component\n      if (reuse === false) {\n        this[symbols.children].push(view)\n      }\n\n      // keep reference to the previous focus for storing in cache\n      previousFocus = Focus.get()\n\n      const children = this[symbols.children]\n      this.activeView = children[children.length - 1]\n\n      // set focus to the view that we're routing to (unless explicitly disabling passing focus)\n      if (route.options.passFocus !== false) {\n        focus ? focus.$focus() : /** @type {BlitsComponent} */ (view).$focus()\n      }\n\n      // apply before settings to holder element\n      if (route.transition.before) {\n        if (Array.isArray(route.transition.before)) {\n          for (let i = 0; i < route.transition.before.length; i++) {\n            holder.set(route.transition.before[i].prop, route.transition.before[i].value)\n          }\n        } else {\n          holder.set(route.transition.before.prop, route.transition.before.value)\n        }\n      }\n\n      let shouldAnimate = false\n\n      // apply out out transition on previous view if available, unless\n      // we're reusing the prvious page component\n      if (previousRoute !== undefined && reuse === false) {\n        // only animate when there is a previous route\n        shouldAnimate = true\n        const oldView = this[symbols.children].splice(1, 1).pop()\n        if (oldView) {\n          removeView(previousRoute, oldView, route.transition.out, navigatingBack)\n        }\n      }\n\n      // apply in transition\n      if (route.transition.in) {\n        if (Array.isArray(route.transition.in)) {\n          for (let i = 0; i < route.transition.in.length; i++) {\n            i === route.transition.length - 1\n              ? await setOrAnimate(holder, route.transition.in[i], shouldAnimate)\n              : setOrAnimate(holder, route.transition.in[i], shouldAnimate)\n          }\n        } else {\n          await setOrAnimate(holder, route.transition.in, shouldAnimate)\n        }\n      }\n    } else {\n      Log.error(`Route ${route.hash} not found`)\n      const routerHooks = this.parent[symbols.routerHooks]\n      if (routerHooks && typeof routerHooks.error === 'function') {\n        routerHooks.error.call(this.parent, `Route ${route.hash} not found`)\n      }\n    }\n  }\n\n  // reset navigating indicators\n  navigatingBack = false\n  state.navigating = false\n  preventHashChangeNavigation = false\n}\n\n/**\n * Remove the currently active view\n *\n * @param {Route} route\n * @param {BlitsComponent} view\n * @param {Object} transition\n */\nconst removeView = async (route, view, transition, navigatingBack) => {\n  // apply out transition\n  if (transition) {\n    if (Array.isArray(transition)) {\n      for (let i = 0; i < transition.length; i++) {\n        i === transition.length - 1\n          ? await setOrAnimate(view[symbols.holder], transition[i])\n          : setOrAnimate(view[symbols.holder], transition[i])\n      }\n    } else {\n      await setOrAnimate(view[symbols.holder], transition)\n    }\n  }\n\n  // cache the page when it's as 'keepAlive' instead of destroying\n  if (\n    navigatingBack === false &&\n    route.options &&\n    route.options.keepAlive === true &&\n    route.options.inHistory === true\n  ) {\n    const historyItem = history[history.length - 1]\n    if (historyItem !== undefined) {\n      historyItem.view = view\n      historyItem.focus = previousFocus\n    }\n  }\n\n  /* Destroy the view in the following cases:\n   * 1. Navigating forward, and the previous route is not configured with \"keep alive\" set to true.\n   * 2. Navigating back, and the previous route is configured with \"keep alive\" set to true.\n   * 3. Navigating back, and the previous route is not configured with \"keep alive\" set to true.\n   */\n  if (route.options && (route.options.keepAlive !== true || navigatingBack === true)) {\n    view.destroy()\n    view = null\n  }\n\n  previousFocus = null\n  route = null\n}\n\nconst setOrAnimate = (node, transition, shouldAnimate = true) => {\n  return new Promise((resolve) => {\n    if (shouldAnimate === true) {\n      // resolve the promise in the transition end-callback\n      // (\"extending\" end callback when one is already specified)\n      let existingEndCallback = transition.end\n      transition.end = (...args) => {\n        existingEndCallback && existingEndCallback(args)\n        // null the callback to enable memory cleanup\n        existingEndCallback = null\n        resolve()\n      }\n      if (node !== undefined) node.set(transition.prop, { transition })\n      else resolve()\n    } else {\n      node !== undefined && node.set(transition.prop, transition.value)\n      resolve()\n    }\n  })\n}\n\nexport const to = (location, data = {}, options = {}) => {\n  navigationData = data\n  overrideOptions = options\n\n  window.location.hash = location\n}\n\nexport const back = function () {\n  const route = history.pop()\n  if (route && currentRoute !== route) {\n    // set indicator that we are navigating back (to prevent adding page to history stack)\n    navigatingBack = true\n    navigatingBackTo = route\n    to(route.hash, route.data, route.options)\n    return true\n  }\n\n  const backtrack = (currentRoute && currentRoute.options.backtrack) || false\n\n  // If we deeplink to a page without backtrack\n  // we we let the RouterView handle back\n  if (backtrack === false) {\n    return false\n  }\n\n  const hashEnd = /(\\/:?[\\w%\\s-]+)$/\n  let path = currentRoute.path\n\n  let level = path.split('/').length\n\n  // On root return\n  if (level <= 1) {\n    return false\n  }\n\n  while (level--) {\n    if (!hashEnd.test(path)) {\n      return false\n    }\n    // Construct new path to backtrack to\n    path = path.replace(hashEnd, '')\n    const route = matchHash(getHash(path), this.parent[symbols.routes])\n\n    if (route && backtrack) {\n      to(route.path, route.data, route.options)\n      return true\n    }\n  }\n\n  return false\n}\n\nexport default {\n  navigate,\n  to,\n  back,\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './lib/symbols.js'\nimport { state } from './router/router.js'\nimport Settings from './settings.js'\nimport { DEFAULT_HOLD_TIMEOUT_MS } from './constants.js'\nimport { Log } from './lib/log.js'\n\nlet focusedComponent = null\nlet focusChain = []\nlet setFocusTimeout\n\nexport const keyUpCallbacks = new Map()\n\nexport default {\n  _hold: false,\n  set hold(v) {\n    this._hold = v\n  },\n  get hold() {\n    return this._hold\n  },\n  get() {\n    return focusedComponent\n  },\n  set(component, event) {\n    clearTimeout(setFocusTimeout)\n\n    // early return if already focused\n    if (component === focusedComponent) return\n\n    if (focusedComponent === null) {\n      focusChain = getAncestors([component])\n    }\n\n    // unfocus currently focused components\n    if (focusedComponent !== null) {\n      if (focusChain[focusChain.length - 1] === component.parent) {\n        focusChain.push(component)\n      } else {\n        const newFocusChain = getAncestors([component])\n        let i = focusChain.length\n        while (i--) {\n          // don't unfocus when part of the new focus chain\n          if (newFocusChain.indexOf(focusChain[i]) > -1) break\n          focusChain[i].lifecycle.state = 'unfocus'\n        }\n        focusChain = newFocusChain\n      }\n    }\n\n    // ensure that all components in the focus path have focus state\n    let i = 0\n    while (i < focusChain.length - 1) {\n      focusChain[i].lifecycle.state = 'focus'\n      i++\n    }\n\n    // and finally set focus to the leaf component\n    setFocusTimeout = setTimeout(\n      () => setFocus(component, event),\n      this.hold === true ? Settings.get('holdTimeout', DEFAULT_HOLD_TIMEOUT_MS) : 0\n    )\n  },\n  input(key, event) {\n    if (state.navigating === true) return\n\n    const componentWithInputEvent = getComponentWithInputEvent(focusedComponent, key)\n\n    if (componentWithInputEvent === null) return\n\n    const inputEvents = componentWithInputEvent[symbols.inputEvents]\n\n    let cb\n    if (inputEvents[key]) {\n      cb = inputEvents[key].call(componentWithInputEvent, event)\n    } else if (inputEvents.any) {\n      cb = inputEvents.any.call(componentWithInputEvent, event)\n    }\n\n    if (cb !== undefined) {\n      keyUpCallbacks.set(event.code, cb)\n    }\n  },\n}\n\n/**\n * Recursive function that retrieves the ancestors of a component\n * @param {Array} components\n * @returns array components\n */\nconst getAncestors = (components) => {\n  if (components[0].parent !== undefined) {\n    components.unshift(components[0].parent)\n    return getAncestors(components)\n  }\n  return components\n}\n\n/**\n * Get the component in the ancestors chain that has a handler for a certain key code\n * @param {Object} component\n * @param {String} key\n * @returns component\n */\nexport const getComponentWithInputEvent = (component, key) => {\n  if (\n    component[symbols.inputEvents] &&\n    (typeof component[symbols.inputEvents][key] === 'function' ||\n      typeof component[symbols.inputEvents].any === 'function')\n  ) {\n    return component\n  } else if (component.parent !== undefined) {\n    return getComponentWithInputEvent(component.parent, key)\n  } else return null\n}\n\n/**\n * Set the focus to the Component\n * @param {Object} component  - The component fo focus\n * @param {KeyboardEvent} event - Keyboard event\n */\nconst setFocus = (component, event) => {\n  Log.info(\n    '\\nFocus chain:\\n',\n    focusChain.map((c, index) => '\\t'.repeat(index) + '↳ ' + c.componentId).join('\\n')\n  )\n\n  focusedComponent = component\n  component.lifecycle.state = 'focus'\n\n  if (event instanceof KeyboardEvent) {\n    const internalEvent = new KeyboardEvent('keydown', event)\n    // @ts-ignore - this is an internal event\n    internalEvent[symbols.internalEvent] = true\n    document.dispatchEvent(internalEvent)\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from './symbols.js'\nimport { getRaw } from './reactivity/reactive.js'\n\nconst eventsMap = new Map()\nconst callbackCache = new Map()\n\nfunction isProxy(obj) {\n  return obj && typeof obj === 'object' && obj[symbols.isProxy] === true\n}\n\nfunction deepUnproxyClone(obj) {\n  if (obj === null || typeof obj !== 'object') return obj\n\n  const raw = isProxy(obj) ? getRaw(obj) : obj\n  const result = Array.isArray(raw) ? [] : {}\n\n  for (const key of Object.keys(raw)) {\n    const value = raw[key]\n    result[key] = value && typeof value === 'object' ? deepUnproxyClone(value) : value\n  }\n\n  return result\n}\n\nexport default {\n  /**\n   * Registers a listener callback for a specific event on a component.\n   *\n   * @param {object} component - The component instance to register the listener for.\n   * @param {string} event - The name of the event to listen for.\n   * @param {Function} cb - The callback function to execute when the event is emitted.\n   * @param {number} [priority=0] - The priority of the listener (higher runs first).\n   * @returns {void}\n   */\n  registerListener(component, event, cb, priority = 0) {\n    let componentsMap = eventsMap.get(event)\n    if (componentsMap === undefined) {\n      componentsMap = new Map()\n      eventsMap.set(event, componentsMap)\n    }\n\n    let components = componentsMap.get(component)\n    if (components === undefined) {\n      components = new Set()\n      componentsMap.set(component, components)\n    }\n\n    components.add({ cb, priority })\n    callbackCache.delete(event) // Invalidate the callbackCache when a new callback is added\n  },\n\n  /**\n   * Deregisters a listener for a specific event on a component.\n   *\n   * @param {object} component - The component instance to deregister the listener for.\n   * @param {string} event - The name of the event to stop listening for.\n   * @returns {void}\n   */\n  deregisterListener(component, event) {\n    let componentsMap = eventsMap.get(event)\n    if (componentsMap === undefined) {\n      return\n    }\n\n    if (componentsMap.has(component)) {\n      componentsMap.delete(component)\n      eventsMap.set(event, componentsMap)\n      callbackCache.delete(event)\n    }\n  },\n\n  /**\n   * Executes all registered listeners for a given event, in priority order.\n   *\n   * @param {string} event - The name of the event to emit.\n   * @param {any} params - The parameters to pass to the event listeners.\n   * @param byReference - whether or not to pass the data by reference.\n   * The default behaviour is passing the data object by reference (`true`).\n   * When explicitely passing `false` the object will be recursively cloned\n   * and cleaned from any potential reactivity before emitting\n   * @returns {boolean} True if all listeners executed without stopping propagation, false if any listener returned false.\n   */\n  executeListeners(event, params, byReference) {\n    if (byReference === false) {\n      params = deepUnproxyClone(params)\n    }\n    const componentsMap = eventsMap.get(event)\n    if (componentsMap === undefined || componentsMap.size === 0) {\n      return true // No listeners, so execution can be considered successful\n    }\n\n    if (callbackCache.has(event) === false) {\n      const allCallbacks = []\n      for (const [component, components] of componentsMap) {\n        for (const callbackObj of components) {\n          allCallbacks.push({ ...callbackObj, component })\n        }\n      }\n      allCallbacks.sort((a, b) => b.priority - a.priority)\n      callbackCache.set(event, allCallbacks) // callbackCache the sorted callbacks with component context\n    }\n\n    const callbacks = callbackCache.get(event)\n    for (let i = 0; i < callbacks.length; i++) {\n      const { cb, component } = callbacks[i]\n      const result = cb.call(component, params)\n      if (result === false) {\n        return false // Stop propagation if any listener returns false\n      }\n    }\n\n    return true // All listeners executed without stopping propagation\n  },\n\n  /**\n   * Removes all listeners for a given component from all events.\n   *\n   * @param {object} component - The component instance to remove listeners for.\n   * @returns {void}\n   */\n  removeListeners(component) {\n    for (const [event, componentsMap] of eventsMap) {\n      if (componentsMap.has(component)) {\n        componentsMap.delete(component)\n        callbackCache.delete(event) // Invalidate the callbackCache for this event\n\n        // If no more components for this event, remove the event entirely\n        if (componentsMap.size === 0) {\n          eventsMap.delete(event)\n        }\n      }\n    }\n  },\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from './component.js'\nimport { default as Focus, keyUpCallbacks } from './focus.js'\nimport Settings from './settings.js'\n\nimport symbols from './lib/symbols.js'\nimport { DEFAULT_HOLD_TIMEOUT_MS, DEFAULT_KEYMAP } from './constants.js'\n\n/**\n * Merged keyMap (default + custom settings).\n * Initialized once during application init.\n * @type {Object<string, string>}\n */\nexport let keyMap = {}\n\nconst Application = (config) => {\n  config.hooks = config.hooks || {}\n\n  let keyDownHandler\n  let keyUpHandler\n  let holdTimeout\n  let lastInputTime = 0\n  let lastInputKey = null\n\n  config.hooks[symbols.destroy] = function () {\n    document.removeEventListener('keydown', keyDownHandler)\n    document.removeEventListener('keyup', keyUpHandler)\n  }\n\n  config.hooks[symbols.init] = function () {\n    // set the initial activation state of the announcer based on launch setting\n    this.$announcer.toggle(Settings.get('announcer', false))\n    // configure global default utterance options if provided in settings\n    const announcerOptions = Settings.get('announcerOptions', null)\n    if (announcerOptions && typeof announcerOptions === 'object') {\n      this.$announcer.configure(announcerOptions)\n    }\n    // Initialize merged keyMap once during application init\n    keyMap = { ...DEFAULT_KEYMAP, ...Settings.get('keymap', {}) }\n\n    /** @type {number} Input throttle time in milliseconds (0 = disabled) */\n    const throttleMs = Settings.get('inputThrottle', 0)\n\n    keyDownHandler = async (e) => {\n      const currentTime = performance.now()\n\n      const key = keyMap[e.key] || keyMap[e.keyCode] || e.key || e.keyCode\n      const sameKey = lastInputKey === key\n      lastInputKey = key\n      // execute immediately when no throttle is specified or event is internal (bubbled up by focus manager)\n      // or key is different from the last used key\n      if (throttleMs === 0 || e[symbols.internalEvent] === true || sameKey === false) {\n        return await processInput.call(this, e, key)\n      }\n\n      if (currentTime - lastInputTime < throttleMs) {\n        return\n      }\n\n      lastInputTime = currentTime\n      await processInput.call(this, e, key)\n    }\n\n    const processInput = async function (e, key) {\n      // intercept key press if specified in main Application component\n      if (\n        this[symbols.inputEvents] !== undefined &&\n        this[symbols.inputEvents].intercept !== undefined\n      ) {\n        e = await this[symbols.inputEvents].intercept.call(this, e)\n        // only pass on the key press to focused component when keyboard event is returned\n        if (e instanceof KeyboardEvent === false) return\n      }\n\n      Focus.input(key, e)\n      clearTimeout(holdTimeout)\n      holdTimeout = setTimeout(\n        () => {\n          Focus.hold = true\n        },\n        Settings.get('holdTimeout', DEFAULT_HOLD_TIMEOUT_MS)\n      )\n    }\n\n    keyUpHandler = (e) => {\n      const cb = keyUpCallbacks.get(e.code)\n      if (cb !== undefined && typeof cb === 'function') {\n        keyUpCallbacks.delete(e.code)\n        cb()\n      }\n      clearTimeout(holdTimeout)\n      Focus.hold = false\n    }\n\n    document.addEventListener('keydown', keyDownHandler)\n    document.addEventListener('keyup', keyUpHandler)\n\n    // next tick\n    setTimeout(() => Focus.set(this))\n  }\n\n  return Component('App', config)\n}\n\nexport default Application\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\nimport Focus from '../../focus.js'\nimport { keyUpCallbacks, getComponentWithInputEvent } from '../../focus.js'\nimport eventListeners from '../../lib/eventListeners.js'\nimport { trigger } from '../../lib/reactivity/effect.js'\nimport { Log } from '../../lib/log.js'\nimport { removeGlobalEffects } from '../../lib/reactivity/effect.js'\nimport { renderer } from '../../launch.js'\nimport { keyMap } from '../../application.js'\n\nexport default {\n  focus: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (e) {\n      Log.warn('this.focus is deprecated, use this.$focus instead')\n      return this.$focus(e)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $focus: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (e) {\n      // force refocus when the component is already in focused state\n      if (this.lifecycle.state === 'focus') {\n        this.lifecycle.state = 'refocus'\n      }\n      Focus.set(this, e)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $input: {\n    /**\n     * Handle a keyboard event on this component without changing focus\n     * @this {import('../../component').BlitsComponent}\n     * @param {KeyboardEvent} event - The keyboard event to handle\n     * @returns {boolean} - Returns true if this component or a parent component handled the event, false otherwise\n     */\n    value: function (event) {\n      if (event === null || event === undefined || event instanceof KeyboardEvent === false)\n        return false\n\n      const key = keyMap[event.key] || keyMap[event.keyCode] || event.key || event.keyCode\n\n      const componentWithInputEvent = getComponentWithInputEvent(this, key)\n      if (componentWithInputEvent === null) return false\n\n      const inputEvents = componentWithInputEvent[symbols.inputEvents] || {}\n\n      let cb\n      if (inputEvents[key]) {\n        cb = inputEvents[key].call(componentWithInputEvent, event)\n      } else if (inputEvents.any) {\n        cb = inputEvents.any.call(componentWithInputEvent, event)\n      }\n\n      if (cb !== undefined && event.code) {\n        keyUpCallbacks.set(event.code, cb)\n      }\n\n      return true\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  unfocus: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function () {\n      this[symbols.state].hasFocus = false\n      this.lifecycle.state = 'unfocus'\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  destroy: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function () {\n      this.eol = true\n      this.lifecycle.state = 'destroy'\n\n      // when destroying a component that currently has focus\n      // pass focus to the parent so we don't get lost in focus limbo\n      if (this.hasFocus === true) this.parent.$focus()\n\n      for (let key in this[symbols.state]) {\n        if (Array.isArray(this[symbols.state][key])) {\n          this[symbols.state][key] = []\n        }\n      }\n\n      this.$clearTimeouts()\n      this.$clearIntervals()\n      eventListeners.removeListeners(this)\n\n      const rendererEventListenersLength = this[symbols.rendererEventListeners].length\n      if (rendererEventListenersLength > 0) {\n        for (let i = 0; i < rendererEventListenersLength; i++) {\n          const eventListener = this[symbols.rendererEventListeners][i]\n          renderer.off(eventListener.event, eventListener.cb)\n        }\n      }\n\n      this[symbols.rendererEventListeners] = null\n\n      deleteChildren(this[symbols.children])\n      this[symbols.children].length = 0\n      removeGlobalEffects(this[symbols.effects])\n\n      this[symbols.state] = {}\n\n      this[symbols.props] = {}\n      this[symbols.computed] = null\n      this.lifecycle = {}\n      this[symbols.effects].length = 0\n      this.parent = null\n      this.rootParent = null\n      this[symbols.wrapper] = null\n      this[symbols.originalState] = null\n      this[symbols.slots].length = 0\n\n      delete this[symbols.computed]\n      delete this.parent\n      delete this.rootParent\n      delete this[symbols.wrapper]\n      delete this[symbols.originalState]\n      delete this[symbols.children]\n      delete this[symbols.slots]\n      delete this.componentId\n      delete this[symbols.id]\n      delete this.ref\n      delete this[symbols.state].hasFocus\n\n      this[symbols.holder].destroy()\n      this[symbols.holder] = null\n      delete this[symbols.holder]\n\n      this[symbols.cleanup]()\n      delete this[symbols.cleanup]\n\n      delete this[symbols.effects]\n\n      Log.debug(`Destroyed component ${this.componentId}`)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  [symbols.removeGlobalEffects]: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (effects = []) {\n      removeGlobalEffects(effects)\n    },\n    writable: false,\n    enumerable: false,\n    configurable: false,\n  },\n  select: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (ref) {\n      Log.warn('this.select is deprecated, use this.$select instead')\n      return this.$select(ref)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $select: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (ref) {\n      // early exit when component is marked as end of life\n      if (this.eol === true) return\n\n      let selected = null\n      this[symbols.children].forEach((child) => {\n        if (Array.isArray(child)) {\n          child.forEach((c) => {\n            if (c['ref'] === ref) selected = c\n          })\n        } else if (Object.getPrototypeOf(child) === Object.prototype) {\n          Object.keys(child).forEach((k) => {\n            if (child[k]['ref'] === ref) selected = child[k]\n          })\n        } else {\n          if (child['ref'] === ref) selected = child\n        }\n      })\n      return selected\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  trigger: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (key) {\n      Log.warn('this.trigger is deprecated, use this.$trigger instead')\n      return this.$trigger(key)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $trigger: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (key) {\n      let target = this[symbols.originalState]\n      // when dot notation used, find the nested target\n      if (key.indexOf('.') > -1) {\n        const keys = key.split('.')\n        key = keys.pop(keys)\n        for (let i = 0; i < keys.length; i++) {\n          target = target[keys[i]]\n        }\n      }\n      // trigger with force set to true\n      trigger(target, key, true)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  shader: {\n    /**\n     * @this {import('../../component').BlitsComponent}\n     */\n    value: function (type, args) {\n      return {\n        type: type,\n        props: args,\n      }\n      // const shaders = renderer.driver.stage.shManager.getRegisteredEffects()\n\n      // if (target in shaders) {\n      //   return {\n      //     type: target,\n      //     props: args,\n      //   }\n      // } else {\n      //   Log.error(`Shader ${type} not found`)\n      // }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n\n/**\n * Recursively destroys all BlitsComponent children.\n * @param {import('../../component').BlitsComponent[]} children\n */\nconst deleteChildren = function (children) {\n  for (let i = 0; i < children.length; i++) {\n    if (!children[i]) return\n    // call destroy when method is available on child\n    if (children[i].destroy && typeof children[i].destroy === 'function') {\n      children[i].destroy()\n    }\n    // recursively call deleteChildren when it's an object of items (happens when using a forloop construct)\n    else if (Object.getPrototypeOf(children[i]) === Object.prototype) {\n      deleteChildren(Object.values(children[i]))\n    }\n\n    children[i] = null\n  }\n\n  children.length = 0\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default {\n  $setTimeout: {\n    value: function (fn, ms, ...params) {\n      // early exit when component is marked as end of life\n      if (this.eol === true) return\n\n      const timeoutId = setTimeout(\n        () => {\n          this.$clearTimeout(timeoutId)\n          fn.apply(null, params)\n        },\n        ms,\n        params\n      )\n      this[symbols.timeouts].push(timeoutId)\n      return timeoutId\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearTimeout: {\n    value: function (timeoutId) {\n      const index = this[symbols.timeouts].indexOf(timeoutId)\n      if (index > -1) {\n        this[symbols.timeouts].splice(index, 1)\n        clearTimeout(timeoutId)\n      }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearTimeouts: {\n    value: function () {\n      for (let i = 0; i < this[symbols.timeouts].length; i++) {\n        clearTimeout(this[symbols.timeouts][i])\n      }\n      this[symbols.timeouts] = []\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $setInterval: {\n    value: function (fn, ms, ...params) {\n      // early exit when component is marked as end of life\n      if (this.eol === true) return\n      const intervalId = setInterval(() => fn.apply(null, params), ms, params)\n      this[symbols.intervals].push(intervalId)\n      return intervalId\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearInterval: {\n    value: function (intervalId) {\n      const index = this[symbols.intervals].indexOf(intervalId)\n      if (index > -1) {\n        this[symbols.intervals].splice(index, 1)\n        clearInterval(intervalId)\n      }\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  $clearIntervals: {\n    value: function () {\n      for (let i = 0; i < this[symbols.intervals].length; i++) {\n        clearInterval(this[symbols.intervals][i])\n      }\n      this[symbols.intervals] = []\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport eventListeners from '../../lib/eventListeners.js'\n\nexport default {\n  /**\n   * Emits an event to all registered listeners for the given event name.\n   *\n   * @param {string} event - The name of the event to emit.\n   * @param {any} params - The parameters to pass to the event listeners.\n   * @param byReference - whether or not to pass the data by reference.\n   * The default behaviour is passing the data object by reference (`true`).\n   * When explicitely passing `false` the object will be recursively cloned\n   * and cleaned from any potential reactivity before emitting\n   * @returns {boolean} True if all listeners executed, false otherwise.\n   */\n  $emit: {\n    value: function (event, params, byReference = true) {\n      // early exit when component is marked as end of life\n      if (this.eol === true) return\n      // returning if all listeners executed\n      return eventListeners.executeListeners(event, params, byReference)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  /**\n   * Registers a listener callback for a specific event.\n   *\n   * @param {string} event - The name of the event to listen for.\n   * @param {Function} callback - The callback function to execute when the event is emitted.\n   * @param {number} [priority=0] - The priority of the listener (higher runs first).\n   * @returns {void}\n   */\n  $listen: {\n    value: function (event, callback, priority = 0) {\n      // early exit when component is marked as end of life\n      if (this.eol === true) return\n      eventListeners.registerListener(this, event, callback, priority)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  /**\n   * Deregisters a listener for a specific event.\n   *\n   * @param {string} event - The name of the event to stop listening for.\n   * @returns {void}\n   */\n  $unlisten: {\n    value: function (event) {\n      eventListeners.deregisterListener(this, event)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n\n  /**\n   * Removes all listeners for this component from all events.\n   *\n   * @returns {void}\n   */\n  $clearListeners: {\n    value: function () {\n      eventListeners.removeListeners(this)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\nimport { to, currentRoute, back, state } from '../../router/router.js'\n\nexport default {\n  $router: {\n    value: {\n      to,\n      back,\n      get currentRoute() {\n        return currentRoute\n      },\n      get routes() {\n        return this[symbols.routes]\n      },\n      get navigating() {\n        return state.navigating\n      },\n      state,\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Announcer from '../../announcer/announcer.js'\n\nexport default {\n  $announcer: {\n    value: Announcer,\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nimport { renderer } from '../../launch.js'\n\nexport default {\n  $size: {\n    value: function (dimensions = { w: 0, h: 0 }) {\n      this[symbols.holder].set('w', dimensions.w || 0)\n      this[symbols.holder].set('h', dimensions.h || 0)\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  [symbols.renderer]: {\n    value: () => renderer,\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n  [symbols.getChildren]: {\n    value() {\n      const parent = this.rootParent || this.parent\n      return (this[symbols.children] || []).concat(\n        (parent &&\n          parent[symbols.getChildren]()\n            .map((child) => {\n              if (Object.getPrototypeOf(child) === Object.prototype) {\n                return Object.values(child).map((c) => {\n                  // ugly hack .. but the point is to reference the right component\n                  c.forComponent =\n                    c[Symbol.for('config')] && c[Symbol.for('config')].parent.component\n                  return c\n                })\n              }\n              return child\n            })\n            .flat()\n            .filter((child) => {\n              // problem is that component of a forloop in a slot has component of root component\n              if (child && child.component) {\n                return (\n                  (child.component && child.component.componentId === this.componentId) ||\n                  (child.forComponent && child.forComponent.componentId === this.componentId)\n                )\n              }\n            })) ||\n          []\n      )\n    },\n    writable: false,\n    enumerable: true,\n    configurable: false,\n  },\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport methods from './methods.js'\nimport scheduling from './timeouts_intervals.js'\nimport events from './events.js'\nimport router from './router.js'\nimport announcer from './announcer.js'\nimport utils from './utils.js'\nimport symbols from '../../lib/symbols.js'\n\nexport const shared = { ...events, ...router, ...announcer }\n\nexport default Object.defineProperties(\n  {\n    [symbols['launched']]: false,\n  },\n  { ...methods, ...scheduling, ...shared, ...utils }\n)\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nconst baseProp = {\n  cast: (v) => v,\n  required: false,\n}\n\nexport default (component, props = []) => {\n  if (props.indexOf('ref') === -1) {\n    props.push('ref')\n  }\n  component[symbols.propKeys] = []\n\n  const propsLength = props.length\n\n  for (let i = 0; i < propsLength; i++) {\n    const prop = { ...baseProp, ...(typeof props[i] === 'object' ? props[i] : { key: props[i] }) }\n    component[symbols.propKeys].push(prop.key)\n    Object.defineProperty(component, prop.key, {\n      get() {\n        const value = prop.cast(\n          this[symbols.props] !== undefined && prop.key in this[symbols.props]\n            ? this[symbols.props][prop.key]\n            : 'default' in prop\n              ? prop.default\n              : undefined\n        )\n\n        if (prop.required === true && value === undefined) {\n          Log.warn(`${prop.key} is required`)\n        }\n\n        return value\n      },\n      set(v) {\n        Log.warn(\n          `Warning! Avoid mutating props directly (prop \"${prop.key}\" in component \"${this.componentId}\")`\n        )\n        this[symbols.props][prop.key] = v\n      },\n    })\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, methods) => {\n  component[symbols.methodKeys] = []\n\n  for (let method in methods) {\n    // test for reserved keys?\n    if (component[symbols.propKeys] && component[symbols.propKeys].indexOf(method) > -1) {\n      Log.error(`${method} already exists as a prop`)\n    } else {\n      if (typeof methods[method] !== 'function') {\n        Log.warn(`${method} is not a function`)\n      }\n      component[symbols.methodKeys].push(method)\n      component[method] = methods[method]\n    }\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, state = () => {}) => {\n  Object.defineProperty(component, symbols.stateKeys, {\n    value: [],\n    enumerable: false,\n    configurable: false,\n    writable: false,\n  })\n\n  const stateKeys = Object.keys(state.apply(component) || {})\n  if (stateKeys.indexOf('hasFocus') > -1) {\n    Log.warn(\n      'State `hasFocus` already exists as a built-in Component variable (to indicate whether the component currently has focus). Avoid using your own `hasFocus` key in the Component state'\n    )\n  } else {\n    // add built-in hasFocus key\n    stateKeys.push(['hasFocus'])\n  }\n  const stateKeysLength = stateKeys.length\n\n  for (let i = 0; i < stateKeysLength; i++) {\n    const key = stateKeys[i]\n    if (\n      component[symbols.propKeys] !== undefined &&\n      component[symbols.propKeys].indexOf(key) > -1\n    ) {\n      Log.error(`State ${key} already exists as a prop`)\n    }\n    if (\n      component[symbols.methodKeys] !== undefined &&\n      component[symbols.methodKeys].indexOf(key) > -1\n    ) {\n      Log.error(`State ${key} already exists as a method`)\n    }\n    component[symbols.stateKeys].push(key)\n    Object.defineProperty(component, key, {\n      get() {\n        return this[symbols.state][key]\n      },\n      set(v) {\n        this[symbols.state][key] = v\n      },\n    })\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, computeds) => {\n  component[symbols.computedKeys] = []\n\n  for (let computed in computeds) {\n    // test for reserved keys?\n    if (component[symbols.stateKeys] && component[symbols.stateKeys].indexOf(computed) > -1) {\n      Log.error(`${computed} already exists as a state variable`)\n    } else if (component[symbols.propKeys] && component[symbols.propKeys].indexOf(computed) > -1) {\n      Log.error(`${computed} already exists as a prop`)\n    } else if (\n      component[symbols.methodKeys] &&\n      component[symbols.methodKeys].indexOf(computed) > -1\n    ) {\n      Log.error(`${computed} already exists as a method`)\n    } else {\n      if (typeof computeds[computed] !== 'function') {\n        Log.warn(`${computed} is not a function`)\n      }\n      component[symbols.computedKeys].push(computed)\n      Object.defineProperty(component, computed, {\n        get() {\n          return computeds[computed].apply(this)\n        },\n      })\n    }\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from '../../lib/log.js'\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, input) => {\n  component[symbols.inputEvents] = []\n  Object.keys(input).forEach((key) => {\n    if (typeof input[key] !== 'function') {\n      Log.warn(`${input[key]} is not a function`)\n    }\n    component[symbols.inputEvents][key] = input[key]\n  })\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, data) => {\n  let routes = data\n  if (Array.isArray(data) === false) {\n    component[symbols.routerHooks] = data.hooks\n    routes = data.routes\n  }\n  component[symbols.routes] = []\n\n  const l = routes.length\n  for (let i = 0; i < l; i++) {\n    component[symbols.routes][i] = routes[i]\n    // merge default route options with route specific options\n    component[symbols.routes][i].options = {\n      ...{\n        inHistory: true,\n      },\n      ...routes[i].options,\n    }\n  }\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport symbols from '../../lib/symbols.js'\n\nexport default (component, watchers) => {\n  component[symbols.watchKeys] = []\n  component[symbols.watchers] = {}\n\n  for (let watch in watchers) {\n    if (typeof watchers[watch] !== 'function') {\n      console.warn(`${watch} is not a function`)\n    }\n\n    component[symbols.watchKeys].push(watch)\n\n    component[symbols.watchers][watch] = function (v, old) {\n      watchers[watch].call(this, v, old)\n    }\n  }\n}\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport setupProps from './props.js'\nimport setupMethods from './methods.js'\nimport setupState from './state.js'\nimport setupComputed from './computed.js'\nimport setupInput from './input.js'\nimport setupRouter from './routes.js'\nimport setupWatch from './watch.js'\n\nimport { registerHooks } from '../../lib/hooks.js'\n\nimport symbols from '../../lib/symbols.js'\n\nlet counter = 0\n\nexport default function (component, config) {\n  component[symbols.identifier] = ++counter\n\n  // setup hooks\n  registerHooks(config.hooks, component[symbols.identifier])\n\n  // setup props\n  // if (config.props) // because of the default props like id - might change this\n  setupProps(component, config.props)\n\n  // // setup methods\n  if (config.methods) setupMethods(component, config.methods)\n\n  // // setup state\n  setupState(component, config.state)\n\n  // // setup computed\n  if (config.computed) setupComputed(component, config.computed)\n\n  // // setup watchers\n  if (config.watch) setupWatch(component, config.watch)\n\n  // // setup router\n  const routerConfig = config.router !== undefined ? config.router : config.routes\n  if (routerConfig !== undefined) setupRouter(component, routerConfig)\n\n  // // setup input\n  if (config.input) setupInput(component, config.input)\n\n  return component\n}\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\n\nexport default () =>\n  Component('Circle', {\n    /* eslint-disable no-unused-vars */\n    code: {\n      render: function anonymous(parent, component, context, components, effect, getRaw, Log) {\n        const elms = []\n        const elementConfigs = []\n        const forloops = []\n        const props = []\n        const created = []\n        const effects = {}\n        const skips = []\n        let componentType\n        let rootComponent = component\n        let propData\n        let slotComponent\n        let inSlot = false\n        let slotChildCounter = 0\n        let cmps = []\n        elementConfigs[0] = {}\n\n        elms[0] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[0]['color'] = component.color\n        elementConfigs[0]['w'] = component.size\n        elementConfigs[0]['h'] = component.size\n        elementConfigs[0]['effects'] = [component.shader('radius', { radius: component.radius })]\n        elms[0].populate(elementConfigs[0])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        return {\n          elms,\n          cleanup: () => {\n            rootComponent = null\n            propData = null\n            slotComponent = null\n            parent = null\n            component = null\n            cmps.length = 0\n            elms.length = 0\n            components.length = 0\n            elementConfigs.length = 0\n            forloops.length = 0\n            props.length = 0\n            skips.length = 0\n          },\n        }\n      },\n      effects: [\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('color', component.color)\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('w', component.size)\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('h', component.size)\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('effects', [component.shader('radius', { radius: component.radius })])\n        },\n      ],\n      context: {},\n    },\n    props: [{ key: 'size', default: 40 }, 'color'],\n    computed: {\n      radius() {\n        return this.size / 2\n      },\n    },\n  })\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\nimport Router from '../router/router.js'\nimport symbols from '../lib/symbols.js'\nimport Focus from '../focus.js'\n\nlet hashchangeHandler = null\n\nexport default () =>\n  Component('RouterView', {\n    /* eslint-disable no-unused-vars */\n    code: {\n      render: function anonymous(parent, component, context, components, effect, getRaw, Log) {\n        const elms = []\n        const elementConfigs = []\n        const forloops = []\n        const props = []\n        const created = []\n        const effects = {}\n        const skips = []\n        let componentType\n        let rootComponent = component\n        let propData\n        let slotComponent\n        let inSlot = false\n        let slotChildCounter = 0\n        let cmps = []\n        elementConfigs[0] = {}\n\n        elms[0] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[0]['w'] = parent.node.width * (100 / 100)\n        elementConfigs[0]['height'] = parent.node.height * (100 / 100)\n        elms[0].populate(elementConfigs[0])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        return {\n          elms,\n          cleanup: () => {\n            rootComponent = null\n            propData = null\n            slotComponent = null\n            parent = null\n            component = null\n            cmps.length = 0\n            elms.length = 0\n            components.length = 0\n            elementConfigs.length = 0\n            forloops.length = 0\n            props.length = 0\n            skips.length = 0\n          },\n        }\n      },\n      effects: [],\n      context: {},\n    },\n    state() {\n      return {\n        activeView: null,\n      }\n    },\n    hooks: {\n      async ready() {\n        if (this.parent[symbols.routerHooks] && this.parent[symbols.routerHooks].init) {\n          await this.parent[symbols.routerHooks].init.apply(this.parent)\n        }\n        hashchangeHandler = () => Router.navigate.apply(this)\n        Router.navigate.apply(this)\n        window.addEventListener('hashchange', hashchangeHandler)\n      },\n      destroy() {\n        window.removeEventListener('hashchange', hashchangeHandler, false)\n      },\n      focus() {\n        if (this.activeView && Focus.get() === this) {\n          this.activeView.$focus()\n        }\n      },\n    },\n    input: {\n      back(e) {\n        const navigating = Router.back.call(this)\n        if (navigating === false) {\n          this.parent.$focus(e)\n        }\n      },\n    },\n  })\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\n\nimport symbols from '../lib/symbols.js'\n\nexport default () =>\n  Component('Sprite', {\n    /* eslint-disable no-unused-vars */\n    code: {\n      render: function anonymous(parent, component, context, components, effect, getRaw, Log) {\n        const elms = []\n        const elementConfigs = []\n        const forloops = []\n        const props = []\n        const created = []\n        const effects = {}\n        const skips = []\n        let componentType\n        let rootComponent = component\n        let propData\n        let slotComponent\n        let inSlot = false\n        let slotChildCounter = 0\n        let cmps = []\n        elementConfigs[0] = {}\n\n        elms[0] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[0]['w'] = parent.node.width * (100 / 100)\n        elementConfigs[0]['h'] = parent.node.height * (100 / 100)\n        elementConfigs[0]['texture'] = component.texture\n        elementConfigs[0]['color'] = component.color\n        elementConfigs[0]['effects'] = component.effects\n        elms[0].populate(elementConfigs[0])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        return {\n          elms,\n          cleanup: () => {\n            rootComponent = null\n            propData = null\n            slotComponent = null\n            parent = null\n            component = null\n            cmps.length = 0\n            elms.length = 0\n            components.length = 0\n            elementConfigs.length = 0\n            forloops.length = 0\n            props.length = 0\n            skips.length = 0\n          },\n        }\n      },\n      effects: [\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('texture', component.texture)\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[0].set('color', component.color)\n        },\n      ],\n      context: {},\n    },\n    props: ['image', 'map', 'frame', 'color', 'effects'],\n\n    state() {\n      return {\n        spriteTexture: null,\n        currentSrc: null,\n      }\n    },\n\n    computed: {\n      texture() {\n        // If no image - nothing to render\n        if (this.image === undefined || this.image === null) {\n          return null\n        }\n\n        // Get renderer\n        const renderer = this[symbols.renderer]()\n        if (renderer === null || renderer === undefined || renderer.createTexture === undefined) {\n          return null\n        }\n\n        // Recreate texture only when image src changes\n        if (\n          this.spriteTexture === undefined ||\n          this.spriteTexture === null ||\n          this.currentSrc !== this.image\n        ) {\n          this.spriteTexture = renderer.createTexture('ImageTexture', {\n            src: this.image,\n          })\n          this.currentSrc = this.image\n        }\n\n        // Resolve frame data from sprite map\n        let options = null\n        if (\n          this.map !== null &&\n          this.map !== undefined &&\n          this.frame !== null &&\n          this.frame !== undefined\n        ) {\n          if (\n            this.map.frames !== null &&\n            this.map.frames !== undefined &&\n            this.frame in this.map.frames\n          ) {\n            options = Object.assign({}, this.map.defaults || {}, this.map.frames[this.frame])\n          } else if (this.frame in this.map) {\n            options = this.map[this.frame]\n          }\n        }\n\n        // If no map but frame is object (manual subtexture)\n        if ((options === null || options === undefined) && typeof this.frame === 'object') {\n          options = this.frame\n        }\n\n        // Create SubTexture only if frame data exists\n        if (options !== null && options !== undefined) {\n          return renderer.createTexture('SubTexture', {\n            texture: this.spriteTexture,\n            x: options.x,\n            y: options.y,\n            width: options.w,\n            height: options.h,\n          })\n        }\n\n        // Default fallback (single image)\n        return this.spriteTexture\n      },\n    },\n  })\n", "export default 'data:image/png;base64,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'\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from '../component.js'\nimport { renderer } from '../launch.js'\nimport fps_sprite from '../../public/assets/fps_sprite.base64.js'\n\nexport default () =>\n  Component('FPScounter', {\n    /* eslint-disable no-unused-vars */\n    code: {\n      render: function anonymous(parent, component, context, components, effect, getRaw, Log) {\n        const elms = []\n        const elementConfigs = []\n        const forloops = []\n        const props = []\n        const created = []\n        const effects = {}\n        const skips = []\n        let componentType\n        let rootComponent = component\n        let propData\n        let slotComponent\n        let inSlot = false\n        let slotChildCounter = 0\n        let cmps = []\n        elementConfigs[0] = {}\n\n        elms[0] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elms[0].populate(elementConfigs[0])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[0]\n        elementConfigs[1] = {}\n\n        elms[1] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[1]['y'] = 15\n        elementConfigs[1]['x'] = 20\n        elms[1].populate(elementConfigs[1])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[1]\n        elementConfigs[2] = {}\n\n        elms[2] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elms[2].populate(elementConfigs[2])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[3] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[2]\n        elementConfigs[3] = {}\n\n        elms[3] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[3]['image'] = component.image\n        elementConfigs[3]['w'] = 43\n        elementConfigs[3]['h'] = 25\n        elementConfigs[3]['map'] = component.sprite\n        elementConfigs[3]['frame'] = 'fps'\n\n        skips[3] = []\n        if (typeof cmps[3] !== 'undefined') {\n          for (let key in cmps[3][Symbol.for('config')].props) {\n            delete elementConfigs[3][cmps[3][Symbol.for('config')].props[key]]\n            skips[3].push(cmps[3][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[3].populate(elementConfigs[3])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[3]\n        props[4] = {}\n        props[4]['image'] = component.image\n        props[4]['w'] = 43\n        props[4]['h'] = 25\n        props[4]['map'] = component.sprite\n        props[4]['frame'] = 'fps'\n\n        componentType = props[4]['is'] || 'Sprite'\n\n        components[4]\n        if (typeof componentType === 'string') {\n          components[4] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[4]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[4] = componentType\n        }\n\n        elms[4] = components[4].call(null, { props: props[4] }, elms[3], component)\n\n        if (elms[4][Symbol.for('slots')][0]) {\n          parent = elms[4][Symbol.for('slots')][0]\n          slotComponent = elms[4]\n          inSlot = true\n        } else {\n          parent = elms[4][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[2]\n        elementConfigs[5] = {}\n\n        elms[5] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[5]['x'] = 58\n        elementConfigs[5]['y'] = 2\n        elms[5].populate(elementConfigs[5])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[6] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[5]\n        elementConfigs[6] = {}\n\n        elms[6] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[6]['image'] = component.image\n        elementConfigs[6]['x'] = 0\n        elementConfigs[6]['h'] = 20\n        elementConfigs[6]['w'] = 20\n        elementConfigs[6]['map'] = component.sprite\n        elementConfigs[6]['frame'] = component.fps[0]\n\n        skips[6] = []\n        if (typeof cmps[6] !== 'undefined') {\n          for (let key in cmps[6][Symbol.for('config')].props) {\n            delete elementConfigs[6][cmps[6][Symbol.for('config')].props[key]]\n            skips[6].push(cmps[6][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[6].populate(elementConfigs[6])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[6]\n        props[7] = {}\n        props[7]['image'] = component.image\n        props[7]['x'] = 0\n        props[7]['h'] = 20\n        props[7]['w'] = 20\n        props[7]['map'] = component.sprite\n\n        propData = component.fps[0]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[7]['frame'] = propData\n\n        componentType = props[7]['is'] || 'Sprite'\n\n        components[7]\n        if (typeof componentType === 'string') {\n          components[7] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[7]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[7] = componentType\n        }\n\n        elms[7] = components[7].call(null, { props: props[7] }, elms[6], component)\n\n        if (elms[7][Symbol.for('slots')][0]) {\n          parent = elms[7][Symbol.for('slots')][0]\n          slotComponent = elms[7]\n          inSlot = true\n        } else {\n          parent = elms[7][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[8] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[5]\n        elementConfigs[8] = {}\n\n        elms[8] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[8]['image'] = component.image\n        elementConfigs[8]['x'] = 18\n        elementConfigs[8]['h'] = 20\n        elementConfigs[8]['w'] = 20\n        elementConfigs[8]['map'] = component.sprite\n        elementConfigs[8]['frame'] = component.fps[1]\n\n        skips[8] = []\n        if (typeof cmps[8] !== 'undefined') {\n          for (let key in cmps[8][Symbol.for('config')].props) {\n            delete elementConfigs[8][cmps[8][Symbol.for('config')].props[key]]\n            skips[8].push(cmps[8][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[8].populate(elementConfigs[8])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[8]\n        props[9] = {}\n        props[9]['image'] = component.image\n        props[9]['x'] = 18\n        props[9]['h'] = 20\n        props[9]['w'] = 20\n        props[9]['map'] = component.sprite\n\n        propData = component.fps[1]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[9]['frame'] = propData\n\n        componentType = props[9]['is'] || 'Sprite'\n\n        components[9]\n        if (typeof componentType === 'string') {\n          components[9] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[9]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[9] = componentType\n        }\n\n        elms[9] = components[9].call(null, { props: props[9] }, elms[8], component)\n\n        if (elms[9][Symbol.for('slots')][0]) {\n          parent = elms[9][Symbol.for('slots')][0]\n          slotComponent = elms[9]\n          inSlot = true\n        } else {\n          parent = elms[9][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[10] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[5]\n        elementConfigs[10] = {}\n\n        elms[10] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[10]['image'] = component.image\n        elementConfigs[10]['x'] = 36\n        elementConfigs[10]['h'] = 20\n        elementConfigs[10]['w'] = 20\n        elementConfigs[10]['map'] = component.sprite\n        elementConfigs[10]['frame'] = component.fps[2]\n\n        skips[10] = []\n        if (typeof cmps[10] !== 'undefined') {\n          for (let key in cmps[10][Symbol.for('config')].props) {\n            delete elementConfigs[10][cmps[10][Symbol.for('config')].props[key]]\n            skips[10].push(cmps[10][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[10].populate(elementConfigs[10])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[10]\n        props[11] = {}\n        props[11]['image'] = component.image\n        props[11]['x'] = 36\n        props[11]['h'] = 20\n        props[11]['w'] = 20\n        props[11]['map'] = component.sprite\n\n        propData = component.fps[2]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[11]['frame'] = propData\n\n        componentType = props[11]['is'] || 'Sprite'\n\n        components[11]\n        if (typeof componentType === 'string') {\n          components[11] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[11]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[11] = componentType\n        }\n\n        elms[11] = components[11].call(null, { props: props[11] }, elms[10], component)\n\n        if (elms[11][Symbol.for('slots')][0]) {\n          parent = elms[11][Symbol.for('slots')][0]\n          slotComponent = elms[11]\n          inSlot = true\n        } else {\n          parent = elms[11][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[1]\n        elementConfigs[12] = {}\n\n        elms[12] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[12]['x'] = 150\n        elms[12].populate(elementConfigs[12])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[13] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[12]\n        elementConfigs[13] = {}\n\n        elms[13] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[13]['image'] = component.image\n        elementConfigs[13]['y'] = 2\n        elementConfigs[13]['w'] = 48\n        elementConfigs[13]['h'] = 25\n        elementConfigs[13]['map'] = component.sprite\n        elementConfigs[13]['frame'] = 'avg'\n\n        skips[13] = []\n        if (typeof cmps[13] !== 'undefined') {\n          for (let key in cmps[13][Symbol.for('config')].props) {\n            delete elementConfigs[13][cmps[13][Symbol.for('config')].props[key]]\n            skips[13].push(cmps[13][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[13].populate(elementConfigs[13])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[13]\n        props[14] = {}\n        props[14]['image'] = component.image\n        props[14]['y'] = 2\n        props[14]['w'] = 48\n        props[14]['h'] = 25\n        props[14]['map'] = component.sprite\n        props[14]['frame'] = 'avg'\n\n        componentType = props[14]['is'] || 'Sprite'\n\n        components[14]\n        if (typeof componentType === 'string') {\n          components[14] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[14]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[14] = componentType\n        }\n\n        elms[14] = components[14].call(null, { props: props[14] }, elms[13], component)\n\n        if (elms[14][Symbol.for('slots')][0]) {\n          parent = elms[14][Symbol.for('slots')][0]\n          slotComponent = elms[14]\n          inSlot = true\n        } else {\n          parent = elms[14][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[12]\n        elementConfigs[15] = {}\n\n        elms[15] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[15]['x'] = 63\n        elementConfigs[15]['y'] = 2\n        elms[15].populate(elementConfigs[15])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[16] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[15]\n        elementConfigs[16] = {}\n\n        elms[16] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[16]['image'] = component.image\n        elementConfigs[16]['x'] = 0\n        elementConfigs[16]['h'] = 20\n        elementConfigs[16]['w'] = 20\n        elementConfigs[16]['map'] = component.sprite\n        elementConfigs[16]['frame'] = component.avgFps[0]\n\n        skips[16] = []\n        if (typeof cmps[16] !== 'undefined') {\n          for (let key in cmps[16][Symbol.for('config')].props) {\n            delete elementConfigs[16][cmps[16][Symbol.for('config')].props[key]]\n            skips[16].push(cmps[16][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[16].populate(elementConfigs[16])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[16]\n        props[17] = {}\n        props[17]['image'] = component.image\n        props[17]['x'] = 0\n        props[17]['h'] = 20\n        props[17]['w'] = 20\n        props[17]['map'] = component.sprite\n\n        propData = component.avgFps[0]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[17]['frame'] = propData\n\n        componentType = props[17]['is'] || 'Sprite'\n\n        components[17]\n        if (typeof componentType === 'string') {\n          components[17] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[17]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[17] = componentType\n        }\n\n        elms[17] = components[17].call(null, { props: props[17] }, elms[16], component)\n\n        if (elms[17][Symbol.for('slots')][0]) {\n          parent = elms[17][Symbol.for('slots')][0]\n          slotComponent = elms[17]\n          inSlot = true\n        } else {\n          parent = elms[17][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[18] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[15]\n        elementConfigs[18] = {}\n\n        elms[18] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[18]['image'] = component.image\n        elementConfigs[18]['x'] = 18\n        elementConfigs[18]['h'] = 20\n        elementConfigs[18]['w'] = 20\n        elementConfigs[18]['map'] = component.sprite\n        elementConfigs[18]['frame'] = component.avgFps[1]\n\n        skips[18] = []\n        if (typeof cmps[18] !== 'undefined') {\n          for (let key in cmps[18][Symbol.for('config')].props) {\n            delete elementConfigs[18][cmps[18][Symbol.for('config')].props[key]]\n            skips[18].push(cmps[18][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[18].populate(elementConfigs[18])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[18]\n        props[19] = {}\n        props[19]['image'] = component.image\n        props[19]['x'] = 18\n        props[19]['h'] = 20\n        props[19]['w'] = 20\n        props[19]['map'] = component.sprite\n\n        propData = component.avgFps[1]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[19]['frame'] = propData\n\n        componentType = props[19]['is'] || 'Sprite'\n\n        components[19]\n        if (typeof componentType === 'string') {\n          components[19] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[19]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[19] = componentType\n        }\n\n        elms[19] = components[19].call(null, { props: props[19] }, elms[18], component)\n\n        if (elms[19][Symbol.for('slots')][0]) {\n          parent = elms[19][Symbol.for('slots')][0]\n          slotComponent = elms[19]\n          inSlot = true\n        } else {\n          parent = elms[19][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[20] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[15]\n        elementConfigs[20] = {}\n\n        elms[20] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[20]['image'] = component.image\n        elementConfigs[20]['x'] = 36\n        elementConfigs[20]['h'] = 20\n        elementConfigs[20]['w'] = 20\n        elementConfigs[20]['map'] = component.sprite\n        elementConfigs[20]['frame'] = component.avgFps[2]\n\n        skips[20] = []\n        if (typeof cmps[20] !== 'undefined') {\n          for (let key in cmps[20][Symbol.for('config')].props) {\n            delete elementConfigs[20][cmps[20][Symbol.for('config')].props[key]]\n            skips[20].push(cmps[20][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[20].populate(elementConfigs[20])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[20]\n        props[21] = {}\n        props[21]['image'] = component.image\n        props[21]['x'] = 36\n        props[21]['h'] = 20\n        props[21]['w'] = 20\n        props[21]['map'] = component.sprite\n\n        propData = component.avgFps[2]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[21]['frame'] = propData\n\n        componentType = props[21]['is'] || 'Sprite'\n\n        components[21]\n        if (typeof componentType === 'string') {\n          components[21] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[21]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[21] = componentType\n        }\n\n        elms[21] = components[21].call(null, { props: props[21] }, elms[20], component)\n\n        if (elms[21][Symbol.for('slots')][0]) {\n          parent = elms[21][Symbol.for('slots')][0]\n          slotComponent = elms[21]\n          inSlot = true\n        } else {\n          parent = elms[21][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[1]\n        elementConfigs[22] = {}\n\n        elms[22] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[22]['x'] = 0\n        elementConfigs[22]['y'] = 40\n        elms[22].populate(elementConfigs[22])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[23] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[22]\n        elementConfigs[23] = {}\n\n        elms[23] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[23]['image'] = component.image\n        elementConfigs[23]['x'] = '-2'\n        elementConfigs[23]['w'] = 47\n        elementConfigs[23]['h'] = 25\n        elementConfigs[23]['map'] = component.sprite\n        elementConfigs[23]['frame'] = 'min'\n\n        skips[23] = []\n        if (typeof cmps[23] !== 'undefined') {\n          for (let key in cmps[23][Symbol.for('config')].props) {\n            delete elementConfigs[23][cmps[23][Symbol.for('config')].props[key]]\n            skips[23].push(cmps[23][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[23].populate(elementConfigs[23])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[23]\n        props[24] = {}\n        props[24]['image'] = component.image\n        props[24]['x'] = '-2'\n        props[24]['w'] = 47\n        props[24]['h'] = 25\n        props[24]['map'] = component.sprite\n        props[24]['frame'] = 'min'\n\n        componentType = props[24]['is'] || 'Sprite'\n\n        components[24]\n        if (typeof componentType === 'string') {\n          components[24] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[24]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[24] = componentType\n        }\n\n        elms[24] = components[24].call(null, { props: props[24] }, elms[23], component)\n\n        if (elms[24][Symbol.for('slots')][0]) {\n          parent = elms[24][Symbol.for('slots')][0]\n          slotComponent = elms[24]\n          inSlot = true\n        } else {\n          parent = elms[24][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[22]\n        elementConfigs[25] = {}\n\n        elms[25] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[25]['x'] = 58\n        elementConfigs[25]['y'] = 2\n        elms[25].populate(elementConfigs[25])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[26] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[25]\n        elementConfigs[26] = {}\n\n        elms[26] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[26]['image'] = component.image\n        elementConfigs[26]['x'] = 0\n        elementConfigs[26]['h'] = 20\n        elementConfigs[26]['w'] = 20\n        elementConfigs[26]['map'] = component.sprite\n        elementConfigs[26]['frame'] = component.minFps[0]\n\n        skips[26] = []\n        if (typeof cmps[26] !== 'undefined') {\n          for (let key in cmps[26][Symbol.for('config')].props) {\n            delete elementConfigs[26][cmps[26][Symbol.for('config')].props[key]]\n            skips[26].push(cmps[26][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[26].populate(elementConfigs[26])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[26]\n        props[27] = {}\n        props[27]['image'] = component.image\n        props[27]['x'] = 0\n        props[27]['h'] = 20\n        props[27]['w'] = 20\n        props[27]['map'] = component.sprite\n\n        propData = component.minFps[0]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[27]['frame'] = propData\n\n        componentType = props[27]['is'] || 'Sprite'\n\n        components[27]\n        if (typeof componentType === 'string') {\n          components[27] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[27]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[27] = componentType\n        }\n\n        elms[27] = components[27].call(null, { props: props[27] }, elms[26], component)\n\n        if (elms[27][Symbol.for('slots')][0]) {\n          parent = elms[27][Symbol.for('slots')][0]\n          slotComponent = elms[27]\n          inSlot = true\n        } else {\n          parent = elms[27][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[28] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[25]\n        elementConfigs[28] = {}\n\n        elms[28] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[28]['image'] = component.image\n        elementConfigs[28]['x'] = 18\n        elementConfigs[28]['h'] = 20\n        elementConfigs[28]['w'] = 20\n        elementConfigs[28]['map'] = component.sprite\n        elementConfigs[28]['frame'] = component.minFps[1]\n\n        skips[28] = []\n        if (typeof cmps[28] !== 'undefined') {\n          for (let key in cmps[28][Symbol.for('config')].props) {\n            delete elementConfigs[28][cmps[28][Symbol.for('config')].props[key]]\n            skips[28].push(cmps[28][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[28].populate(elementConfigs[28])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[28]\n        props[29] = {}\n        props[29]['image'] = component.image\n        props[29]['x'] = 18\n        props[29]['h'] = 20\n        props[29]['w'] = 20\n        props[29]['map'] = component.sprite\n\n        propData = component.minFps[1]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[29]['frame'] = propData\n\n        componentType = props[29]['is'] || 'Sprite'\n\n        components[29]\n        if (typeof componentType === 'string') {\n          components[29] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[29]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[29] = componentType\n        }\n\n        elms[29] = components[29].call(null, { props: props[29] }, elms[28], component)\n\n        if (elms[29][Symbol.for('slots')][0]) {\n          parent = elms[29][Symbol.for('slots')][0]\n          slotComponent = elms[29]\n          inSlot = true\n        } else {\n          parent = elms[29][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[30] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[25]\n        elementConfigs[30] = {}\n\n        elms[30] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[30]['image'] = component.image\n        elementConfigs[30]['x'] = 36\n        elementConfigs[30]['h'] = 20\n        elementConfigs[30]['w'] = 20\n        elementConfigs[30]['map'] = component.sprite\n        elementConfigs[30]['frame'] = component.minFps[2]\n\n        skips[30] = []\n        if (typeof cmps[30] !== 'undefined') {\n          for (let key in cmps[30][Symbol.for('config')].props) {\n            delete elementConfigs[30][cmps[30][Symbol.for('config')].props[key]]\n            skips[30].push(cmps[30][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[30].populate(elementConfigs[30])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[30]\n        props[31] = {}\n        props[31]['image'] = component.image\n        props[31]['x'] = 36\n        props[31]['h'] = 20\n        props[31]['w'] = 20\n        props[31]['map'] = component.sprite\n\n        propData = component.minFps[2]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[31]['frame'] = propData\n\n        componentType = props[31]['is'] || 'Sprite'\n\n        components[31]\n        if (typeof componentType === 'string') {\n          components[31] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[31]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[31] = componentType\n        }\n\n        elms[31] = components[31].call(null, { props: props[31] }, elms[30], component)\n\n        if (elms[31][Symbol.for('slots')][0]) {\n          parent = elms[31][Symbol.for('slots')][0]\n          slotComponent = elms[31]\n          inSlot = true\n        } else {\n          parent = elms[31][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[1]\n        elementConfigs[32] = {}\n\n        elms[32] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[32]['x'] = 150\n        elementConfigs[32]['y'] = 40\n        elms[32].populate(elementConfigs[32])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[33] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[32]\n        elementConfigs[33] = {}\n\n        elms[33] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[33]['image'] = component.image\n        elementConfigs[33]['w'] = 53\n        elementConfigs[33]['h'] = 25\n        elementConfigs[33]['map'] = component.sprite\n        elementConfigs[33]['frame'] = 'max'\n\n        skips[33] = []\n        if (typeof cmps[33] !== 'undefined') {\n          for (let key in cmps[33][Symbol.for('config')].props) {\n            delete elementConfigs[33][cmps[33][Symbol.for('config')].props[key]]\n            skips[33].push(cmps[33][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[33].populate(elementConfigs[33])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[33]\n        props[34] = {}\n        props[34]['image'] = component.image\n        props[34]['w'] = 53\n        props[34]['h'] = 25\n        props[34]['map'] = component.sprite\n        props[34]['frame'] = 'max'\n\n        componentType = props[34]['is'] || 'Sprite'\n\n        components[34]\n        if (typeof componentType === 'string') {\n          components[34] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[34]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[34] = componentType\n        }\n\n        elms[34] = components[34].call(null, { props: props[34] }, elms[33], component)\n\n        if (elms[34][Symbol.for('slots')][0]) {\n          parent = elms[34][Symbol.for('slots')][0]\n          slotComponent = elms[34]\n          inSlot = true\n        } else {\n          parent = elms[34][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        parent = elms[32]\n        elementConfigs[35] = {}\n\n        elms[35] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[35]['x'] = 63\n        elementConfigs[35]['y'] = 2\n        elms[35].populate(elementConfigs[35])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        cmps[36] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[35]\n        elementConfigs[36] = {}\n\n        elms[36] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[36]['image'] = component.image\n        elementConfigs[36]['x'] = 0\n        elementConfigs[36]['h'] = 20\n        elementConfigs[36]['w'] = 20\n        elementConfigs[36]['map'] = component.sprite\n        elementConfigs[36]['frame'] = component.maxFps[0]\n\n        skips[36] = []\n        if (typeof cmps[36] !== 'undefined') {\n          for (let key in cmps[36][Symbol.for('config')].props) {\n            delete elementConfigs[36][cmps[36][Symbol.for('config')].props[key]]\n            skips[36].push(cmps[36][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[36].populate(elementConfigs[36])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[36]\n        props[37] = {}\n        props[37]['image'] = component.image\n        props[37]['x'] = 0\n        props[37]['h'] = 20\n        props[37]['w'] = 20\n        props[37]['map'] = component.sprite\n\n        propData = component.maxFps[0]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[37]['frame'] = propData\n\n        componentType = props[37]['is'] || 'Sprite'\n\n        components[37]\n        if (typeof componentType === 'string') {\n          components[37] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[37]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[37] = componentType\n        }\n\n        elms[37] = components[37].call(null, { props: props[37] }, elms[36], component)\n\n        if (elms[37][Symbol.for('slots')][0]) {\n          parent = elms[37][Symbol.for('slots')][0]\n          slotComponent = elms[37]\n          inSlot = true\n        } else {\n          parent = elms[37][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[38] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[35]\n        elementConfigs[38] = {}\n\n        elms[38] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[38]['image'] = component.image\n        elementConfigs[38]['x'] = 18\n        elementConfigs[38]['h'] = 20\n        elementConfigs[38]['w'] = 20\n        elementConfigs[38]['map'] = component.sprite\n        elementConfigs[38]['frame'] = component.maxFps[1]\n\n        skips[38] = []\n        if (typeof cmps[38] !== 'undefined') {\n          for (let key in cmps[38][Symbol.for('config')].props) {\n            delete elementConfigs[38][cmps[38][Symbol.for('config')].props[key]]\n            skips[38].push(cmps[38][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[38].populate(elementConfigs[38])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[38]\n        props[39] = {}\n        props[39]['image'] = component.image\n        props[39]['x'] = 18\n        props[39]['h'] = 20\n        props[39]['w'] = 20\n        props[39]['map'] = component.sprite\n\n        propData = component.maxFps[1]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[39]['frame'] = propData\n\n        componentType = props[39]['is'] || 'Sprite'\n\n        components[39]\n        if (typeof componentType === 'string') {\n          components[39] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[39]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[39] = componentType\n        }\n\n        elms[39] = components[39].call(null, { props: props[39] }, elms[38], component)\n\n        if (elms[39][Symbol.for('slots')][0]) {\n          parent = elms[39][Symbol.for('slots')][0]\n          slotComponent = elms[39]\n          inSlot = true\n        } else {\n          parent = elms[39][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        cmps[40] = (context.components && context.components['Sprite']) || components['Sprite']\n\n        parent = elms[35]\n        elementConfigs[40] = {}\n\n        elms[40] = this.element(\n          { parent: parent || 'root' },\n          inSlot === true ? slotComponent : component\n        )\n\n        elementConfigs[40]['image'] = component.image\n        elementConfigs[40]['x'] = 36\n        elementConfigs[40]['h'] = 20\n        elementConfigs[40]['w'] = 20\n        elementConfigs[40]['map'] = component.sprite\n        elementConfigs[40]['frame'] = component.maxFps[2]\n\n        skips[40] = []\n        if (typeof cmps[40] !== 'undefined') {\n          for (let key in cmps[40][Symbol.for('config')].props) {\n            delete elementConfigs[40][cmps[40][Symbol.for('config')].props[key]]\n            skips[40].push(cmps[40][Symbol.for('config')].props[key])\n          }\n        }\n\n        elms[40].populate(elementConfigs[40])\n\n        if (inSlot === true) {\n          slotChildCounter -= 1\n        }\n\n        parent = elms[40]\n        props[41] = {}\n        props[41]['image'] = component.image\n        props[41]['x'] = 36\n        props[41]['h'] = 20\n        props[41]['w'] = 20\n        props[41]['map'] = component.sprite\n\n        propData = component.maxFps[2]\n        if (Array.isArray(propData) === true) {\n          propData = getRaw(propData).slice(0)\n        }\n        props[41]['frame'] = propData\n\n        componentType = props[41]['is'] || 'Sprite'\n\n        components[41]\n        if (typeof componentType === 'string') {\n          components[41] =\n            (context.components && context.components[componentType]) || components[componentType]\n          if (!components[41]) {\n            throw new Error('Component \"Sprite\" not found')\n          }\n        } else if (\n          typeof componentType === 'function' &&\n          componentType[Symbol.for('isComponent')] === true\n        ) {\n          components[41] = componentType\n        }\n\n        elms[41] = components[41].call(null, { props: props[41] }, elms[40], component)\n\n        if (elms[41][Symbol.for('slots')][0]) {\n          parent = elms[41][Symbol.for('slots')][0]\n          slotComponent = elms[41]\n          inSlot = true\n        } else {\n          parent = elms[41][Symbol.for('children')][0]\n        }\n\n        if (inSlot === true && slotChildCounter === 0) {\n          inSlot = false\n        }\n\n        return {\n          elms,\n          cleanup: () => {\n            rootComponent = null\n            propData = null\n            slotComponent = null\n            parent = null\n\n            cmps[3] = null\n\n            props[4] = null\n            components[4] = null\n\n            cmps[6] = null\n\n            props[7] = null\n            components[7] = null\n\n            cmps[8] = null\n\n            props[9] = null\n            components[9] = null\n\n            cmps[10] = null\n\n            props[11] = null\n            components[11] = null\n\n            cmps[13] = null\n\n            props[14] = null\n            components[14] = null\n\n            cmps[16] = null\n\n            props[17] = null\n            components[17] = null\n\n            cmps[18] = null\n\n            props[19] = null\n            components[19] = null\n\n            cmps[20] = null\n\n            props[21] = null\n            components[21] = null\n\n            cmps[23] = null\n\n            props[24] = null\n            components[24] = null\n\n            cmps[26] = null\n\n            props[27] = null\n            components[27] = null\n\n            cmps[28] = null\n\n            props[29] = null\n            components[29] = null\n\n            cmps[30] = null\n\n            props[31] = null\n            components[31] = null\n\n            cmps[33] = null\n\n            props[34] = null\n            components[34] = null\n\n            cmps[36] = null\n\n            props[37] = null\n            components[37] = null\n\n            cmps[38] = null\n\n            props[39] = null\n            components[39] = null\n\n            cmps[40] = null\n\n            props[41] = null\n            components[41] = null\n            component = null\n            cmps.length = 0\n            elms.length = 0\n            components.length = 0\n            elementConfigs.length = 0\n            forloops.length = 0\n            props.length = 0\n            skips.length = 0\n          },\n        }\n      },\n      effects: [\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[6] === 'undefined' ||\n            skips[6].indexOf('frame') === -1\n          )\n            elms[6].set('frame', component.fps[0])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[7][Symbol.for('props')]['frame'] = component.fps[0]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[8] === 'undefined' ||\n            skips[8].indexOf('frame') === -1\n          )\n            elms[8].set('frame', component.fps[1])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[9][Symbol.for('props')]['frame'] = component.fps[1]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[10] === 'undefined' ||\n            skips[10].indexOf('frame') === -1\n          )\n            elms[10].set('frame', component.fps[2])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[11][Symbol.for('props')]['frame'] = component.fps[2]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[16] === 'undefined' ||\n            skips[16].indexOf('frame') === -1\n          )\n            elms[16].set('frame', component.avgFps[0])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[17][Symbol.for('props')]['frame'] = component.avgFps[0]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[18] === 'undefined' ||\n            skips[18].indexOf('frame') === -1\n          )\n            elms[18].set('frame', component.avgFps[1])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[19][Symbol.for('props')]['frame'] = component.avgFps[1]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[20] === 'undefined' ||\n            skips[20].indexOf('frame') === -1\n          )\n            elms[20].set('frame', component.avgFps[2])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[21][Symbol.for('props')]['frame'] = component.avgFps[2]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[26] === 'undefined' ||\n            skips[26].indexOf('frame') === -1\n          )\n            elms[26].set('frame', component.minFps[0])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[27][Symbol.for('props')]['frame'] = component.minFps[0]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[28] === 'undefined' ||\n            skips[28].indexOf('frame') === -1\n          )\n            elms[28].set('frame', component.minFps[1])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[29][Symbol.for('props')]['frame'] = component.minFps[1]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[30] === 'undefined' ||\n            skips[30].indexOf('frame') === -1\n          )\n            elms[30].set('frame', component.minFps[2])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[31][Symbol.for('props')]['frame'] = component.minFps[2]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[36] === 'undefined' ||\n            skips[36].indexOf('frame') === -1\n          )\n            elms[36].set('frame', component.maxFps[0])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[37][Symbol.for('props')]['frame'] = component.maxFps[0]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[38] === 'undefined' ||\n            skips[38].indexOf('frame') === -1\n          )\n            elms[38].set('frame', component.maxFps[1])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[39][Symbol.for('props')]['frame'] = component.maxFps[1]\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          if (\n            typeof skips === 'undefined' ||\n            typeof skips[40] === 'undefined' ||\n            skips[40].indexOf('frame') === -1\n          )\n            elms[40].set('frame', component.maxFps[2])\n        },\n        function anonymous(component, elms, context, components, rootComponent, effect) {\n          elms[41][Symbol.for('props')]['frame'] = component.maxFps[2]\n        },\n      ],\n      context: {},\n    },\n    state() {\n      return {\n        image: fps_sprite,\n        sprite: {\n          defaults: {\n            y: 1,\n            w: 20,\n            h: 20,\n          },\n          frames: {\n            '-': { x: -1000 },\n            0: { x: 1 },\n            1: { x: 23 },\n            2: { x: 45 },\n            3: { x: 67 },\n            4: { x: 89 },\n            5: { x: 111 },\n            6: { x: 133 },\n            7: { x: 155 },\n            8: { x: 177 },\n            9: { x: 199 },\n            avg: { x: 221, w: 48, h: 25 },\n            fps: { x: 271, w: 43, h: 25 },\n            max: { x: 316, w: 53, h: 25 },\n            min: { x: 371, w: 47, h: 25 },\n          },\n        },\n        fps: '---',\n        avgFps: '---',\n        minFps: '---',\n        maxFps: '---',\n      }\n    },\n    hooks: {\n      ready() {\n        let minFps = 10000\n        let maxFps = 0\n        let avgFps = 0\n        let totalFps = 0\n        let fpsUpdateCounter = 0\n\n        // This leaks - might be L3 SubTexture issue\n        // renderer.on('fpsUpdate', (rM, { fps }) => {\n        //   minFps = Math.min(fps, minFps)\n        //   maxFps = Math.max(fps, maxFps)\n        //   totalFps += fps\n        //   fpsUpdateCounter++\n        //   avgFps = Math.round(totalFps / fpsUpdateCounter)\n\n        //   this.fps = fps.toString().padStart(3, '0')\n        //   this.avgFps = avgFps.toString().padStart(3, '0')\n        //   this.minFps = minFps.toString().padStart(3, '0')\n        //   this.maxFps = maxFps.toString().padStart(3, '0')\n        // })\n      },\n    },\n  })\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Circle from './Circle.js'\nimport RouterView from './RouterView.js'\nimport Sprite from './Sprite.js'\nimport FPScounter from './FPScounter.js'\n\nexport default () => ({\n  Circle: Circle(),\n  RouterView: RouterView(),\n  Sprite: Sprite(),\n  FPScounter: FPScounter(),\n})\n", "/*\n * Copyright 2024 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { default as log } from '../lib/log.js'\n\nexport default {\n  name: 'log',\n  plugin() {\n    return log('App')\n  },\n}\n", "import log from './plugins/log.js'\n\nexport const plugins = {\n  // log plugin added by default\n  log,\n}\n\nconst registerPlugin = (plugin, nameOrOptions = '', options = {}) => {\n  // map name and options depending on the arguments provided\n  let name = undefined\n  if (typeof nameOrOptions === 'object') {\n    options = nameOrOptions\n  } else {\n    name = nameOrOptions\n  }\n\n  if (typeof plugin === 'function') {\n    if (name === undefined || name === '') {\n      throw Error('Error registering plugin: name is required for plugin')\n    }\n    plugins[name] = { plugin, options }\n  } else if (plugin.plugin) {\n    registerPlugin(plugin.plugin, name || plugin.name, options)\n  }\n}\n\nexport default registerPlugin\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Log } from './lib/log.js'\nimport parser from './lib/templateparser/parser.js'\nimport codegenerator from './lib/codegenerator/generator.js'\nimport { createHumanReadableId, createInternalId } from './lib/componentId.js'\nimport { emit } from './lib/hooks.js'\nimport { reactive, getRaw } from './lib/reactivity/reactive.js'\nimport { effect } from './lib/reactivity/effect.js'\nimport Lifecycle from './lib/lifecycle.js'\nimport symbols from './lib/symbols.js'\n\nimport { stage, renderer } from './launch.js'\n\nimport { default as Base, shared } from './component/base/index.js'\n\nimport Settings from './settings.js'\n\nimport setupComponent from './component/setup/index.js'\nimport components from './components/index.js'\n\nimport { plugins } from './plugin.js'\n\n// object to store global components\nlet globalComponents\n\nconst required = (name) => {\n  throw new Error(`Parameter ${name} is required`)\n}\n\n/**\n * @typedef {function} BlitsComponentFactory\n * @param {object} opts - The options for the component instance\n * @param {BlitsComponent} parentEl - The parent element for the component instance\n * @param {BlitsComponent} parentComponent - The parent component for the component instance\n * @param {BlitsComponent} rootComponent - The root component for the component instance\n * @returns {BlitsComponent} - The component instance\n */\n\n/**\n *  Structure of a Blits component:\n *  Component:\n *   <Holder>\n *      <Wrapper>\n *           []<Elements>\n *      </Wrapper>\n *   </Holder>\n *\n * A Blits Element\n * @typedef {Object} BlitsAnnouncer\n * @property {(message: string) => void} assertive - Function to assertively announce a message.\n * @property {() => void} clear - Function to clear the announcer.\n * @property {() => void} disable - Function to disable the announcer.\n * @property {() => void} enable - Function to enable the announcer.\n * @property {(delay: number) => void} pause - Function to pause the announcer.\n * @property {(message: string) => void} polite - Function to politely announce a message.\n * @property {(message: string, politeness: 'off'|'polite'|'assertive') => void} announce - Function to announce a message with specified politeness.\n * @property {() => void} stop - Function to stop the announcer.\n * @property {(v: boolean) => void} toggle - Function to toggle the announcer.\n *\n * @typedef {Object} BlitsElementConfig\n * @property {BlitsElement} parent - The parent element of this element.\n * @property {any} node - The node object for the element.\n *\n * @typedef {Object} BlitsElementProps\n * @property {boolean} __textnode - Indicates if the element is a text node.\n * @property {boolean} __layout - Indicates if the element is a layout node.\n * @property {BlitsElement} element - The element to which the props belong?? Do we need this?\n * @property {BlitsElementConfig} config - Configuration object for the element.\n * @property {Object<string, any>} props - The props object containing the properties of the element.\n * @property {Object<string, any>} raw - The raw input props.\n * @property {Object<string, any>} scheduledTransitions - Tracks transitions by property name.\n *\n * @typedef {Object} BlitsElement\n * @property {BlitsComponent} component - Reference to the owning Blits component.\n * @property {BlitsElementConfig} config - Configuration object for the element.\n * @property {number} counter - Unique counter used for shader workarounds. FIXME?\n * @property {string[]} effectNames - Names of active shader effects.\n * @property {any} node - The underlying renderer node (e.g., WebGL node or text node).\n * @property {BlitsElementProps} props - Proxy-like object containing transformed props.\n * @property {any[]} children - WVB I cant see this populated? Filtered list of children owned by this element. FIXME?\n * @property {any} parent - WVB Shortcut to the parent CoreNode?\n * @property {number} nodeId - ID of the CoreNode, if available.\n * @property {string|null} ref - Ref name (if defined).\n * @property {function(Object):void} populate - Initializes the element with props and hooks.\n * @property {function(string, any):void} set - Updates a single property.\n * @property {function(string, any, Object):void} animate - Animates a property with transition options.\n * @property {function():void} destroy - Destroys the underlying node and cancels transitions.\n * @property {function(any): any} triggerLayout - Triggers a layout update for the element.\n *\n * @typedef {Object} BlitsLifecycle\n * @property {BlitsComponent} component - The Blits comonent instance this lifecycle belongs to.\n * @property {'init'|'ready'|'destroyed'} current - The current lifecycle state of the component.\n * @property {'init'|'ready'|'destroyed'|null} previous - The previous lifecycle state of the component.\n * @property {string} state - The current lifecycle state of the component.\n *\n * @typedef {object} BlitsComponent\n * Main properties of the Blits component:\n * @property {boolean?} eol - Indicates when a component is End of Life\n * @property {string} componentId - The unique identifier for the component instance\n * @property {BlitsLifecycle} lifecycle - The lifecycle object for the component instance\n * @property {BlitsComponent} parent - The parent component of the current component instance\n * @property {BlitsComponent} rootParent - Reference to the root component in case of slots, otherwise this is the same as parent\n * @property {BlitsComponent|BlitsElement[]} [children] - The children of the component instance\n * @property {BlitsElement} [holder] - The wrapper of the entire component instance\n * @property {number} [id] - The internal ID for the component instance\n * @property {number} [identifier] - The identifier for the component instance WVB Whats the difference with id?\n * @property {any[]} [intervals] - The intervals created by the component instance WVB Fixme\n * @property {Object<string, any>} [originalState] - The original state of the component instance\n * @property {Object<string, any>} [props] - The reactive properties of the component instance\n * @property {any[]} [slots] - The slots of the component instance WVB Fixme\n * @property {Object<string, any>} [state] - The reactive state of the component instance\n * @property {any[]} [timeouts] - The timeouts created by the component instance\n * @property {BlitsElement} [wrapper] - The reference to the outer element of the component instance\n * @property {object} [effects] - The effects of the component instance\n * @property {object} [watchers] - The watchers of the component instance\n * @property {Object<string, any>} computedKeys - The computed keys of the component instance\n * @property {any[]} [effects] - The effects of the component instance\n * @property {string[]} [propKeys] - The keys of the props of the component instance\n * @property {any[]} [stateKeys] - The keys of the state of the component instance\n * Single props:\n * @property {object} activeView - The active view of the component instance\n * @property {boolean} hasFocus - Indicates if the component has focus\n * @property {string} ref - The reference name of the component instance\n * @property {number|undefined} index - The index in a for loop\n * @property {number|undefined} activeRow - The active row in a for loop\n * @property {string} color - The color of the component instance\n * @property {number} radius - The radius of the component instance\n * @property {number} size - The size of the component instance\n * Methods:\n * @property {function(): void} destroy - Destroys the component and its children, clearing listeners and effects.\n * @property {function(any): any} focus - ⚠️ Deprecated. Use `$focus()` instead.\n * @property {function(string): any} select - ⚠️ Deprecated. Use `$select(ref)` instead.\n * @property {function(string, object): {type: string, props: object}} shader - Creates a shader definition object.\n * @property {function(string): void} trigger - ⚠️ Deprecated. Use `$trigger(key)` instead.\n * @property {function(): void} unfocus - Clears the focus state and sets lifecycle to 'unfocus'.\n * Builtins:\n * @property {BlitsAnnouncer} $announcer - The announcer object for the component instance\n * @property {() => void} $clearTimeouts - Clears all timeouts created by the component instance\n * @property {(timeoutId: number) => void} $clearTimeout - Clears all timeouts created by the component instance\n * @property {() => void} $clearIntervals - Clears all intervals created by the component instance\n * @property {(intervalId: number) => void} $clearInterval - Clears all intervals created by the component instance\n * @property {Object} $colors - The colors object for the component instance\n * @property {(event: string, params: object) => void} $emit - Emits an event with the specified parameters\n * @property {function(any): void} $focus - Sets the component focus state and delegates to the Focus manager.\n * @property {Object} $language - The language object for the component instance\n * @property {function(any): any} $listen - The listen object for the component instance\n * @property {Object} $log - The log object for the component instance\n * @property {Object} $router - The router object for the component instance\n * @property {function(string): any} $select - Selects a child component by `ref`.\n * @property {function(any): any} $setInterval - Sets an interval for the component instance\n * @property {function(any): any} $setTimeout - Sets a timeout for the component instance\n * @property {function(any): any} $size - The size object for the component instance\n * @property {function(any): any} $sizes - The sizes object for the component instance\n * @property {function(string): void} $trigger - Forces a reactivity trigger on a property in `originalState`.\n * @property {function(any): any} $unlisten - The unlisten object for the component instance\n *\n */\n\n/**\n * @typedef {Object} BlitsComponentConfig\n * @property {string} template - The template string for the component.\n * @property {function(this: BlitsComponent): Object} [state] - State factory function.\n * @property {Object} [hooks] - Lifecycle hooks (frameTick, idle, attach, detach, enter, exit, etc).\n * @property {Object} [code] - Compiled render/effects code (render: Function, effects: Function[]).\n * @property {string} [name] - Optional name for the component.\n * @property {any} [data] - Optional static data for the component.\n * @property {Object} [options] - Optional options for the component.\n */\n\n/**\n * Component factory function\n * @param {string} name - The name of the component\n * @param {BlitsComponentConfig} config - The configuration object for the component\n * @returns {BlitsComponentFactory} - The component factory function\n */\nconst Component = (name = required('name'), config = required('config')) => {\n  let base = undefined\n\n  const component = function (opts, parentEl, parentComponent, rootComponent) {\n    // generate a human readable ID for the component instance (i.e. Blits::ComponentName1)\n    this.componentId = createHumanReadableId(name)\n\n    this[symbols.effects] = []\n\n    // instantiate a lifecycle object for this instance\n    this.lifecycle = Object.assign(Object.create(Lifecycle), {\n      component: this,\n      previous: null,\n      current: null,\n    })\n\n    // set a reference to the parent component\n    this.parent = parentComponent\n\n    //\n    this.rootParent = rootComponent\n\n    // set a reference to the holder / parentElement\n    // Components are wrapped in a holder node (used to apply positioning and transforms\n    // such as rotation and scale to components)\n    this[symbols.holder] = parentEl\n\n    // generate an internal id (simple counter)\n    this[symbols.id] = createInternalId()\n\n    // set the internal props and make them reactive (based on the reactivity mode)\n    this[symbols.props] = reactive(opts.props || {}, Settings.get('reactivityMode'))\n\n    // create an empty array for storing timeouts created by this component (via this.$setTimeout)\n    this[symbols.timeouts] = []\n\n    // create an empty array for storing intervals created by this component (via this.$setInterval)\n    this[symbols.intervals] = []\n\n    // apply the state function (passing in the this reference to utilize configured props)\n    // and store a reference to this original state\n    this[symbols.originalState] =\n      (config.state && typeof config.state === 'function' && config.state.apply(this)) || {}\n    // add hasFocus key in\n    this[symbols.originalState]['hasFocus'] = false\n\n    // generate a reactive state (using the result of previously execute state function)\n    // and store it\n    this[symbols.state] = reactive(this[symbols.originalState], Settings.get('reactivityMode'))\n\n    // all basic setup has been done now, set the lifecycle to state 'init'\n    this.lifecycle.state = 'init'\n\n    // execute the render code that constructs the initial state of the component\n    // and store the children result (a flat map of elements and components)\n    const { elms, cleanup } = config.code.render.apply(stage, [\n      parentEl,\n      this,\n      config,\n      globalComponents,\n      effect,\n      getRaw,\n      Log,\n    ]) || { elms: [], cleanup: () => {} }\n\n    this[symbols.children] = elms\n    this[symbols.cleanup] = cleanup\n\n    // create a reference to the wrapper element of the component (i.e. the root Element of the component)\n    this[symbols.wrapper] = this[symbols.children][0]\n\n    // create a reference to an array of children that are slots\n    this[symbols.slots] = this[symbols.children].filter((child) => child[symbols.isSlot])\n\n    this[symbols.rendererEventListeners] = []\n    // register hooks if component has hooks specified\n    if (config.hooks) {\n      // push to next tick to ensure\n      setTimeout(() => {\n        // frame tick event\n        if (config.hooks.frameTick) {\n          const cb = (r, data) => emit('frameTick', this[symbols.identifier], this, [data])\n          this[symbols.rendererEventListeners].push({ event: 'frameTick', cb })\n          renderer.on('frameTick', cb)\n        }\n\n        // idle event\n        if (config.hooks.idle) {\n          const cb = () => {\n            emit('idle', this[symbols.identifier], this)\n          }\n          this[symbols.rendererEventListeners].push({ event: 'idle', cb })\n          renderer.on('idle', cb)\n        }\n\n        // fpsUpdate event\n        if (config.hooks.fpsUpdate) {\n          const cb = (r, data) => {\n            emit('fpsUpdate', this[symbols.identifier], this, [data.fps])\n          }\n          this[symbols.rendererEventListeners].push({ event: 'fpsUpdate', cb })\n          renderer.on('fpsUpdate', cb)\n        }\n      })\n\n      // inBounds event emiting a lifecycle attach event\n      if (config.hooks.attach) {\n        this[symbols.wrapper].node.on('inBounds', () => {\n          this.lifecycle.state = 'attach'\n        })\n      }\n\n      // outOfBounds event emiting a lifeycle detach event\n      if (config.hooks.detach) {\n        this[symbols.wrapper].node.on('outOfBounds', (node, { previous }) => {\n          if (previous > 0) this.lifecycle.state = 'detach'\n        })\n      }\n\n      // inViewport event emiting a lifecycle enter event\n      if (config.hooks.enter) {\n        this[symbols.wrapper].node.on('inViewport', () => {\n          this.lifecycle.state = 'enter'\n        })\n      }\n\n      // outOfViewport event emitting a lifecycle exit event\n      if (config.hooks.exit) {\n        this[symbols.wrapper].node.on('outOfBounds', () => {\n          this.lifecycle.state = 'exit'\n        })\n      }\n    }\n\n    // setup (and execute) all the generated side effects based on the\n    // reactive bindings define in the template\n    const effects = config.code.effects\n    for (let i = 0; i < effects.length; i++) {\n      const eff = () => {\n        effects[i](this, this[symbols.children], config, globalComponents, rootComponent, effect)\n      }\n      // store reference to the effect\n      this[symbols.effects].push(eff)\n      effect(eff)\n    }\n\n    // setup watchers if the components has watchers specified\n    if (this[symbols.watchers]) {\n      const watcherkeys = Object.keys(this[symbols.watchers])\n      const watcherkeysLength = watcherkeys.length\n      for (let i = 0; i < watcherkeysLength; i++) {\n        let target = this\n        let key = watcherkeys[i]\n        const watchKey = key\n        // when dot notation used, find the nested target\n        if (key.indexOf('.') > -1) {\n          const keys = key.split('.')\n          key = keys.pop()\n          for (let i = 0; i < keys.length; i++) {\n            target = target[keys[i]]\n          }\n        }\n\n        let old = this[key]\n\n        const eff = (force = false) => {\n          const newValue = target[key]\n          if (old !== newValue || force === true) {\n            this[symbols.watchers][watchKey].apply(this, [newValue, old])\n            old = newValue\n          }\n        }\n\n        // store reference to the effect\n        this[symbols.effects].push(eff)\n        effect(eff)\n      }\n    }\n\n    // finaly set the lifecycle state to ready (in the next tick)\n    setTimeout(() => (this.lifecycle.state = 'ready'))\n\n    // and return this\n    return this\n  }\n\n  /**\n   * Component factory function\n   * @typedef {BlitsComponentFactory}\n   * @param {Object} options\n   * @param {BlitsComponent} parentEl\n   * @param {BlitsComponent} parentComponent\n   * @param {BlitsComponent} rootComponent\n   * @returns {BlitsComponent}\n   */\n  const factory = (options = {}, parentEl, parentComponent, rootComponent) => {\n    if (Base[symbols['launched']] === false) {\n      // Register user defined plugins once on the Base object (after launch)\n      const pluginKeys = Object.keys(plugins)\n      const pluginKeysLength = pluginKeys.length\n      /** @type {Object} */\n      const pluginInstances = {}\n      for (let i = 0; i < pluginKeysLength; i++) {\n        const pluginName = pluginKeys[i]\n        const prefixedPluginName = `$${pluginName}`\n        if (prefixedPluginName in Base) {\n          Log.warn(\n            `\"${pluginName}\" (this.${prefixedPluginName}) already exists as a property or plugin on the Base Component. You may be overwriting built-in functionality. Proceed with care!`\n          )\n        }\n\n        const plugin = plugins[pluginName]\n\n        pluginInstances[prefixedPluginName] = {\n          // instantiate the plugin, passing in provided options\n          value: Object.defineProperties(plugin.plugin(plugin.options), shared),\n          writable: false,\n          enumerable: true,\n          configurable: true,\n        }\n      }\n\n      Object.defineProperties(Base, pluginInstances)\n\n      // expose other plugins inside each plugin\n      for (const plugin in pluginInstances) {\n        Object.defineProperties(Base[plugin], pluginInstances)\n        // but remove reference to plugin itself\n        delete Base[plugin][plugin]\n      }\n\n      // register global components once\n      globalComponents = components()\n\n      // mark launched true\n      Base[symbols['launched']] = true\n    }\n\n    // setup the component once per component type, using Base as the prototype\n    if (base === undefined) {\n      Log.debug(`Setting up ${name} component`)\n      base = setupComponent(Object.create(Base), config)\n    }\n\n    // one time code generation (only if precompilation is turned off)\n    if (config.code === undefined) {\n      Log.debug(`Generating code for ${name} component`)\n      config.code = codegenerator.call(config, parser(config.template, name))\n    }\n\n    // create an instance of the component, using base as the prototype (which contains Base)\n    return component.call(Object.create(base), options, parentEl, parentComponent, rootComponent)\n  }\n\n  // store the config on the factory, in order to access the config\n  // during the code generation step\n  factory[Symbol.for('config')] = config\n\n  // To determine whether dynamic component is actual Blits component or not\n  factory[symbols.isComponent] = true\n\n  return factory\n}\n\nexport default Component\n", "/*\n * Copyright 2023 Comcast Cable Communications Management, LLC\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport Component from './src/component.js'\nimport Application from './src/application.js'\nimport Launch from './src/launch.js'\nimport Plugin from './src/plugin.js'\n\nexport default {\n  Component,\n  Application,\n  Launch,\n  Plugin,\n}\n"],
  "mappings": "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",
  "names": ["n", "effect", "index", "key", "counter", "effect", "rgba", "TextureType", "_a", "state", "rgba", "rgba", "_a", "time", "settings", "key", "effect", "CoreNodeRenderState", "UpdateType", "stage", "_a", "renderer", "settings", "stage", "state", "_a", "TextureErrorCode", "stage", "settings", "renderer", "_a", "renderer", "renderer", "key", "renderer", "effect", "_a", "renderer", "renderer", "rgba", "stage", "_a", "state", "stage", "stage", "settings", "stage", "calcHeight", "renderer", "_a", "renderEngine", "renderer", "_a", "settings", "_a", "_a", "_a", "_a", "enable", "count", "bufferMemory", "_a", "i", "_a", "stage", "renderer", "_a", "stage", "state", "_a", "renderer", "n", "w", "i", "settings", "stage", "state", "_a", "rgba", "_a", "_a", "effect", "radii", "width", "height", "settings", "_a", "value", "stage", "stage", "effect", "settings", "effect", "renderer", "launch_default", "settings", "speak", "clear", "navigatingBack", "route", "i", "renderer", "router_default", "announcer_default", "renderer", "router_default", "announcer_default", "methods_default", "state", "counter", "methods_default", "effect", "getRaw", "Log", "skips", "effect", "getRaw", "Log", "skips", "effect", "getRaw", "Log", "skips", "renderer", "effect", "getRaw", "Log", "skips", "log_default", "log_default", "renderer", "i", "launch_default"]
}
